/** vim: et:ts=4:sw=4:sts=4
 * @license RequireJS 2.1.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/requirejs for details
 */

/*!
 * jQuery JavaScript Library v2.0.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-07-03T13:30Z
 */

/*!
 * Sizzle CSS Selector Engine v1.9.4-pre
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-06-03
 */

/**
 * @license
 * Lo-Dash 2.2.1 (Custom Build) <http://lodash.com/>
 * Build: `lodash underscore exports="amd,commonjs,global,node" -o ./dist/lodash.underscore.js`
 * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <http://lodash.com/license>
 */

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v2.4.3
//
// Copyright (c)2015 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

// Copyright (c)2015 Derick Bailey, Muted Solutions, LLC.

// Distributed under MIT license

/*!

 handlebars v1.1.2

Copyright (C) 2011 by Yehuda Katz

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

@license
*/

/*!
 * Bootstrap v3.2.0 (http://getbootstrap.com)
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/* ========================================================================
 * Bootstrap: transition.js v3.2.0
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: alert.js v3.2.0
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: button.js v3.2.0
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: carousel.js v3.2.0
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: collapse.js v3.2.0
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: dropdown.js v3.2.0
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: modal.js v3.2.0
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: tooltip.js v3.3.6
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: popover.js v3.3.6
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: scrollspy.js v3.2.0
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: tab.js v3.2.0
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* ========================================================================
 * Bootstrap: affix.js v3.2.0
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* =========================================================
 * bootstrap-datepicker.js
 * Repo: https://github.com/eternicode/bootstrap-datepicker/
 * Demo: http://eternicode.github.io/bootstrap-datepicker/
 * Docs: http://bootstrap-datepicker.readthedocs.org/
 * Forked from http://www.eyecon.ro/bootstrap-datepicker
 * =========================================================
 * Started by Stefan Petre; improvements by Andrew Rowls + contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================= */

//     Underscore.js 1.3.3
//     (c) 2009-2012 Jeremy Ashkenas, DocumentCloud Inc.
//     Underscore is freely distributable under the MIT license.
//     Portions of Underscore are inspired or borrowed from Prototype,
//     Oliver Steele's Functional, and John Resig's Micro-Templating.
//     For all details and documentation:
//     http://documentcloud.github.com/underscore

/**
 * @license Handlebars hbs 0.4.0 - Alex Sexton, but Handlebars has it's own licensing junk
 *
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/require-cs for details on the plugin this was based off of
 */

/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

/*! VelocityJS.org (1.1.0). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */

/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */

/*
 * Copyright (c) 2011, Yahoo! Inc.  All rights reserved.
 * Copyright (c) 2012, Log-Normal, Inc.  All rights reserved.
 * Copyright (c) 2014, SOASTA, Inc. All rights reserved.
 * Copyrights licensed under the BSD License. See the accompanying LICENSE.txt file for terms.
 */

/*
 * Copyright (c) 2011, Yahoo! Inc.  All rights reserved.
 * Copyright (c) 2012, Log-Normal, Inc.  All rights reserved.
 * Copyrights licensed under the BSD License. See the accompanying LICENSE.txt file for terms.
 */

/*
 * Copyright (c), Buddy Brewer.
 */

/*
 * Date Format 1.2.3
 * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
 * MIT license
 *
 * Includes enhancements by Scott Trenda <scott.trenda.net>
 * and Kris Kowal <cixar.com/~kris.kowal/>
 *
 * Accepts a date, a mask, or a date and a mask.
 * Returns a formatted version of the given date.
 * The date defaults to the current date/time.
 * The mask defaults to dateFormat.masks.default.
 */

/*! Hammer.JS - v2.0.8 - 2016-04-23
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */

/*!
* Parsleyjs
* Guillaume Potier - <guillaume@wisembly.com>
* Version 2.0.3 - built Mon Jul 21 2014 11:56:56
* MIT Licensed
*
*/

/*!
* validator.js
* Guillaume Potier - <guillaume@wisembly.com>
* Version 0.5.8 - built Sun Mar 16 2014 17:18:21
* MIT Licensed
*
*/

//     Parsley.js 2.0.3
//     http://parsleyjs.org
//     (c) 20012-2014 Guillaume Potier, Wisembly
//     Parsley may be freely distributed under the MIT license.

/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @version 1.0.3
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */

function BOOMR_check_doc_domain(e){var t;if(!e){if(window.parent===window||!document.getElementById("boomr-if-as"))return;e=document.domain}if(e.indexOf(".")===-1)return;try{t=window.parent.document;return}catch(n){document.domain=e}try{t=window.parent.document;return}catch(n){e=e.replace(/^[\w\-]+\./,"")}BOOMR_check_doc_domain(e)}var requirejs,require,define;(function(global){function isFunction(e){return ostring.call(e)==="[object Function]"}function isArray(e){return ostring.call(e)==="[object Array]"}function each(e,t){if(e){var n;for(n=0;n<e.length;n+=1)if(e[n]&&t(e[n],n,e))break}}function eachReverse(e,t){if(e){var n;for(n=e.length-1;n>-1;n-=1)if(e[n]&&t(e[n],n,e))break}}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,r){return t&&eachProp(t,function(t,i){if(n||!hasProp(e,i))r&&typeof t=="object"&&t&&!isArray(t)&&!isFunction(t)&&!(t instanceof RegExp)?(e[i]||(e[i]={}),mixin(e[i],t,n,r)):e[i]=t}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,r){var i=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return i.requireType=e,i.requireModules=r,n&&(i.originalError=n),i}function newContext(e){function m(e){var t,n;for(t=0;t<e.length;t++){n=e[t];if(n===".")e.splice(t,1),t-=1;else if(n===".."){if(t===0||t==1&&e[2]===".."||e[t-1]==="..")continue;t>0&&(e.splice(t-1,2),t-=2)}}}function g(e,t,n){var r,i,s,u,a,f,l,c,h,p,d,v,g=t&&t.split("index.html"),y=o.map,b=y&&y["*"];e&&(e=e.split("index.html"),l=e.length-1,o.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),e[0].charAt(0)==="."&&g&&(v=g.slice(0,g.length-1),e=v.concat(e)),m(e),e=e.join("index.html"));if(n&&y&&(g||b)){s=e.split("index.html");e:for(u=s.length;u>0;u-=1){f=s.slice(0,u).join("index.html");if(g)for(a=g.length;a>0;a-=1){i=getOwn(y,g.slice(0,a).join("index.html"));if(i){i=getOwn(i,f);if(i){c=i,h=u;break e}}}!p&&b&&getOwn(b,f)&&(p=getOwn(b,f),d=u)}!c&&p&&(c=p,h=d),c&&(s.splice(0,h,c),e=s.join("index.html"))}return r=getOwn(o.pkgs,e),r?r:e}function y(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===r.contextName)return t.parentNode.removeChild(t),!0})}function b(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),r.require.undef(e),r.makeRequire(null,{skipMap:!0})([e]),!0}function w(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function E(e,t,n,i){var s,o,u,a,f=null,l=t?t.name:null,h=e,p=!0,m="";return e||(p=!1,e="_@r"+(d+=1)),a=w(e),f=a[0],e=a[1],f&&(f=g(f,l,i),o=getOwn(c,f)),e&&(f?o&&o.normalize?m=o.normalize(e,function(e){return g(e,l,i)}):m=e.indexOf("!")===-1?g(e,l,i):e:(m=g(e,l,i),a=w(m),f=a[0],m=a[1],n=!0,s=r.nameToUrl(m))),u=f&&!o&&!n?"_unnormalized"+(v+=1):"",{prefix:f,name:m,parentMap:t,unnormalized:!!u,url:s,originalName:h,isDefine:p,id:(f?f+"!"+m:m)+u}}function S(e){var t=e.id,n=getOwn(u,t);return n||(n=u[t]=new r.Module(e)),n}function x(e,t,n){var r=e.id,i=getOwn(u,r);hasProp(c,r)&&(!i||i.defineEmitComplete)?t==="defined"&&n(c[r]):(i=S(e),i.error&&t==="error"?n(i.error):i.on(t,n))}function T(e,t){var n=e.requireModules,r=!1;t?t(e):(each(n,function(t){var n=getOwn(u,t);n&&(n.error=e,n.events.error&&(r=!0,n.emit("error",e)))}),r||req.onError(e))}function N(){globalDefQueue.length&&(apsp.apply(l,[l.length,0].concat(globalDefQueue)),globalDefQueue=[])}function C(e){delete u[e],delete a[e]}function k(e,t,n){var r=e.map.id;e.error?e.emit("error",e.error):(t[r]=!0,each(e.depMaps,function(r,i){var s=r.id,o=getOwn(u,s);o&&!e.depMatched[i]&&!n[s]&&(getOwn(t,s)?(e.defineDep(i,c[s]),e.check()):k(o,t,n))}),n[r]=!0)}function L(){var e,n,i=o.waitSeconds*1e3,u=i&&r.startTime+i<(new Date).getTime(),f=[],l=[],c=!1,h=!0;if(t)return;t=!0,eachProp(a,function(e){var t=e.map,r=t.id;if(!e.enabled)return;t.isDefine||l.push(e);if(!e.error)if(!e.inited&&u)b(r)?(n=!0,c=!0):(f.push(r),y(r));else if(!e.inited&&e.fetched&&t.isDefine){c=!0;if(!t.prefix)return h=!1}});if(u&&f.length)return e=makeError("timeout","Load timeout for modules: "+f,null,f),e.contextName=r.contextName,T(e);h&&each(l,function(e){k(e,{},{})}),(!u||n)&&c&&(isBrowser||isWebWorker)&&!s&&(s=setTimeout(function(){s=0,L()},50)),t=!1}function A(e){hasProp(c,e[0])||S(E(e[0],null,!0)).init(e[1],e[2])}function O(e,t,n,r){e.detachEvent&&!isOpera?r&&e.detachEvent(r,t):e.removeEventListener(n,t,!1)}function M(e){var t=e.currentTarget||e.srcElement;return O(t,r.onScriptLoad,"load","onreadystatechange"),O(t,r.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function _(){var e;N();while(l.length){e=l.shift();if(e[0]===null)return T(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));A(e)}}var t,n,r,i,s,o={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},u={},a={},f={},l=[],c={},h={},p={},d=1,v=1;return i={require:function(e){return e.require?e.require:e.require=r.makeRequire(e.map)},exports:function(e){e.usingExports=!0;if(e.map.isDefine)return e.exports?c[e.map.id]=e.exports:e.exports=c[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(o.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},n=function(e){this.events=getOwn(f,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},n.prototype={init:function(e,t,n,r){r=r||{};if(this.inited)return;this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=r.ignore,r.enabled||this.enabled?this.enable():this.check()},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(this.fetched)return;this.fetched=!0,r.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();r.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))},load:function(){var e=this.map.url;h[e]||(h[e]=!0,r.load(this.map.id,e))},check:function(){if(!this.enabled||this.enabling)return;var e,t,n=this.map.id,i=this.depExports,s=this.exports,o=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(this.depCount<1&&!this.defined){if(isFunction(o)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{s=r.execCb(n,o,i,s)}catch(u){e=u}else s=r.execCb(n,o,i,s);this.map.isDefine&&s===undefined&&(t=this.module,t?s=t.exports:this.usingExports&&(s=this.exports));if(e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",T(this.error=e)}else s=o;this.exports=s,this.map.isDefine&&!this.ignore&&(c[n]=s,req.onResourceLoad&&req.onResourceLoad(r,this.map,this.depMaps)),C(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}},callPlugin:function(){var e=this.map,t=e.id,n=E(e.prefix);this.depMaps.push(n),x(n,"defined",bind(this,function(n){var i,s,a,f=getOwn(p,this.map.id),l=this.map.name,c=this.map.parentMap?this.map.parentMap.name:null,h=r.makeRequire(e.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){n.normalize&&(l=n.normalize(l,function(e){return g(e,c,!0)})||""),s=E(e.prefix+"!"+l,this.map.parentMap),x(s,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),a=getOwn(u,s.id),a&&(this.depMaps.push(s),this.events.error&&a.on("error",bind(this,function(e){this.emit("error",e)})),a.enable());return}if(f){this.map.url=r.nameToUrl(f),this.load();return}i=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),i.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(u,function(e){e.map.id.indexOf(t+"_unnormalized")===0&&C(e.map.id)}),T(e)}),i.fromText=bind(this,function(n,s){var u=e.name,a=E(u),f=useInteractive;s&&(n=s),f&&(useInteractive=!1),S(a),hasProp(o.config,t)&&(o.config[u]=o.config[t]);try{req.exec(n)}catch(l){return T(makeError("fromtexteval","fromText eval for "+t+" failed: "+l,l,[t]))}f&&(useInteractive=!0),this.depMaps.push(a),r.completeLoad(u),h([u],i)}),n.load(e.name,h,i,o)})),r.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){a[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if(typeof e=="string"){e=E(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(i,e.id);if(o){this.depExports[t]=o(this);return}this.depCount+=1,x(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&x(e,"error",bind(this,this.errback))}n=e.id,s=u[n],!hasProp(i,n)&&s&&!s.enabled&&r.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(u,e.id);t&&!t.enabled&&r.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),e==="error"&&delete this.events[e]}},r={config:o,contextName:e,registry:u,defined:c,urlFetched:h,defQueue:l,Module:n,makeModuleMap:E,nextTick:req.nextTick,onError:T,configure:function(e){e.baseUrl&&e.baseUrl.charAt(e.baseUrl.length-1)!=="/"&&(e.baseUrl+="index.html");var t=o.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(o[t]||(o[t]={}),mixin(o[t],e,!0,!0)):o[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(p[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,n){isArray(e)&&(e={deps:e}),(e.exports||e.init)&&!e.exportsFn&&(e.exportsFn=r.makeShimExports(e)),t[n]=e}),o.shim=t),e.packages&&each(e.packages,function(e){var t,n;e=typeof e=="string"?{name:e}:e,n=e.name,t=e.location,t&&(o.paths[n]=e.location),o.pkgs[n]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(u,function(e,t){!e.inited&&!e.map.unnormalized&&(e.map=E(t))}),(e.deps||e.callback)&&r.require(e.deps||[],e.callback)},makeShimExports:function(e){function t(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}return t},makeRequire:function(t,n){function s(o,a,f){var l,h,p;return n.enableBuildCallback&&a&&isFunction(a)&&(a.__requireJsBuild=!0),typeof o=="string"?isFunction(a)?T(makeError("requireargs","Invalid require call"),f):t&&hasProp(i,o)?i[o](u[t.id]):req.get?req.get(r,o,t,s):(h=E(o,t,!1,!0),l=h.id,hasProp(c,l)?c[l]:T(makeError("notloaded",'Module name "'+l+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(_(),r.nextTick(function(){_(),p=S(E(null,t)),p.skipMap=n.skipMap,p.init(o,a,f,{enabled:!0}),L()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,i=e.lastIndexOf("."),s=e.split("index.html")[0],o=s==="."||s==="..";return i!==-1&&(!o||i>1)&&(n=e.substring(i,e.length),e=e.substring(0,i)),r.nameToUrl(g(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(c,E(e,t,!1,!0).id)},specified:function(e){return e=E(e,t,!1,!0).id,hasProp(c,e)||hasProp(u,e)}}),t||(s.undef=function(e){N();var n=E(e,t,!0),r=getOwn(u,e);y(e),delete c[e],delete h[n.url],delete f[e],eachReverse(l,function(t,n){t[0]===e&&l.splice(n,1)}),r&&(r.events.defined&&(f[e]=r.events),C(e))}),s},enable:function(e){var t=getOwn(u,e.id);t&&S(e).enable()},completeLoad:function(e){var t,n,r,i=getOwn(o.shim,e)||{},s=i.exports;N();while(l.length){n=l.shift();if(n[0]===null){n[0]=e;if(t)break;t=!0}else n[0]===e&&(t=!0);A(n)}r=getOwn(u,e);if(!t&&!hasProp(c,e)&&r&&!r.inited){if(o.enforceDefine&&(!s||!getGlobal(s))){if(b(e))return;return T(makeError("nodefine","No define call for "+e,null,[e]))}A([e,i.deps||[],i.exportsFn])}L()},nameToUrl:function(e,t,n){var i,s,u,a,f,l,c,h=getOwn(o.pkgs,e);h&&(e=h),c=getOwn(p,e);if(c)return r.nameToUrl(c,t,n);if(req.jsExtRegExp.test(e))f=e+(t||"");else{i=o.paths,s=e.split("index.html");for(u=s.length;u>0;u-=1){a=s.slice(0,u).join("index.html"),l=getOwn(i,a);if(l){isArray(l)&&(l=l[0]),s.splice(0,u,l);break}}f=s.join("index.html"),f+=t||(/^data\:|\?/.test(f)||n?"":".js"),f=(f.charAt(0)==="/"||f.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+f}return o.urlArgs?f+((f.indexOf("?")===-1?"?":"&")+o.urlArgs):f},load:function(e,t){req.load(r,e,t)},execCb:function(e,t,n,r){return t.apply(r,n)},onScriptLoad:function(e){if(e.type==="load"||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=M(e);r.completeLoad(t.id)}},onScriptError:function(e){var t=M(e);if(!b(t.id))return T(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}},r.require=r.makeRequire(),r}function getInteractiveScript(){return interactiveScript&&interactiveScript.readyState==="interactive"?interactiveScript:(eachReverse(scripts(),function(e){if(e.readyState==="interactive")return interactiveScript=e}),interactiveScript)}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.14",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,apsp=ap.splice,isBrowser=typeof window!="undefined"&&typeof navigator!="undefined"&&!!window.document,isWebWorker=!isBrowser&&typeof importScripts!="undefined",readyRegExp=isBrowser&&navigator.platform==="PLAYSTATION 3"?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera=typeof opera!="undefined"&&opera.toString()==="[object Opera]",contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(typeof define!="undefined")return;if(typeof requirejs!="undefined"){if(isFunction(requirejs))return;cfg=requirejs,requirejs=undefined}typeof require!="undefined"&&!isFunction(require)&&(cfg=require,require=undefined),req=requirejs=function(e,t,n,r){var i,s,o=defContextName;return!isArray(e)&&typeof e!="string"&&(s=e,isArray(t)?(e=t,t=n,n=r):e=[]),s&&s.context&&(o=s.context),i=getOwn(contexts,o),i||(i=contexts[o]=req.s.newContext(o)),s&&i.configure(s),i.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick=typeof setTimeout!="undefined"?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var r=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return r.type=e.scriptType||"text/javascript",r.charset="utf-8",r.async=!0,r},req.load=function(e,t,n){var r=e&&e.config||{},i;if(isBrowser)return i=req.createNode(r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),i.attachEvent&&!(i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0)&&!isOpera?(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)):(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(s){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,s,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){head||(head=e.parentNode),dataMain=e.getAttribute("data-main");if(dataMain)return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var r,i;typeof e!="string"&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(n.length===1?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(r=currentlyAddingScript||getInteractiveScript(),r&&(e||(e=r.getAttribute("data-requiremodule")),i=contexts[r.getAttribute("data-requirecontext")])),(i?i.defQueue:globalDefQueue).push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)})(this),define("requireLib",function(){}),require.config({paths:{underscore:"lib/lodash.underscore",requireLib:"lib/require",modernizr:"lib/modernizr.custom",jquery:"lib/jquery","jquery-cookie":"lib/jquery.cookie",backbone:"lib/backbone",bootstrap:"lib/bootstrap",datepicker:"../../common/lib/bootstrap/js/bootstrap-datepicker",marionette:"lib/backbone.marionette",hbs:"lib/hbs",parsley:"lib/parsley",fastclick:"lib/fastclick",velocity:"lib/velocity.min",virtualCollection:"lib/backbone.virtual-collection","google-analytics":"lib/google-analytics",typeahead:"lib/typeahead.jquery.min","source-map":"lib/source-map.min",stacktrace:"lib/stacktrace.min",boomerang:"lib/boomerang",jqueryVisible:"lib/jquery.visible.min",dateFormat:"lib/date.format",hammer:"lib/hammer.min"},shim:{backbone:{deps:["jquery","underscore"],exports:"Backbone"},marionette:{deps:["backbone"],exports:"Marionette"},"jquery-cookie":{deps:["jquery"]},bootstrap:{deps:["jquery"]},datepicker:{deps:["bootstrap"]},virtualCollection:{deps:["backbone"]},modernizr:{exports:"Modernizr"},"google-analytics":{exports:"ga"},velocity:{deps:["jquery"]},jqueryVisible:["jquery"],boomerang:{exports:"boomerang"},dateFormat:{exports:"dateFormat"}},hbs:{partialsUrl:"common/handlebars/partials",helperPathCallback:function(e){return"common/handlebars/helpers/"+e}}}),define("config",function(){}),function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&isHidden(e),p=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(c.display="inline-block")),n.overflow&&(c.overflow="hidden",f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(h?"hide":"show")){if(i!=="show"||!p||p[r]===undefined)continue;h=!0}l[r]=p&&p[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=data_priv.access(e,"fxshow",{}),s&&(p.hidden=!h),h?jQuery(e).show():f.done(function(){jQuery(e).hide()}),f.done(function(){var t;data_priv.remove(e,"fxshow");for(t in l)jQuery.style(e,t,l[t])});for(r in l)o=createTween(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function st(e,t,n,i){var s,o,u,a,f,l,p,m,g,E;(t?t.ownerDocument||t:w)!==h&&c(t),t=t||h,n=n||[];if(!e||typeof e!="string")return n;if((a=t.nodeType)!==1&&a!==9)return[];if(d&&!i){if(s=Y.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return P.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){m=p=b,g=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){l=vt(e),(p=t.getAttribute("id"))?m=p.replace(tt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+mt(l[f]);g=V.test(e)&&t.parentNode||t,E=l.join(",")}if(E)try{return P.apply(n,g.querySelectorAll(E)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return Tt(e.replace(z,"$1"),t,n,i)}function ot(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function ut(e){return e[b]=!0,e}function at(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),r=e.length;while(r--)s.attrHandle[n[r]]=t}function lt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(){}function vt(e,t){var n,r,i,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(i=[]);n=!1;if(r=X.exec(u))n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in s.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):T(e,a).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,s=n&&r==="parentNode",o=S++;return t.first?function(t,n,i){while(t=t[r])if(t.nodeType===1||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[r])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[r])if(t.nodeType===1||s){l=t[b]||(t[b]={});if((f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else{f=l[r]=[c],f[1]=e(t,n,u)||i;if(f[1]===!0)return!0}}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function wt(e,t,n,r,i,s){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||xt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?bt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=bt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=bt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function Et(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<i;a++)if(n=s.relative[e[a].type])h=[gt(yt(h),n)];else{n=s.filter[e[a].type].apply(null,e[a].matches);if(n[b]){r=++a;for(;r<i;r++)if(s.relative[e[r].type])break;return wt(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<r&&Et(e.slice(a,r)),r<i&&Et(e=e.slice(r)),r<i&&mt(e))}h.push(n)}return yt(h)}function St(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=E+=x==null?1:Math.random()||.1;S&&(f=a!==h&&a,i=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}S&&(E=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(c));g=bt(g)}P.apply(c,g),S&&!u&&g.length>0&&y+t.length>1&&st.uniqueSort(c)}return S&&(E=N,f=x),w};return r?ut(u):u}function xt(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function Tt(e,t,n,i){var o,u,f,l,c,h=vt(e);if(!i&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&r.getById&&t.nodeType===9&&d&&s.relative[u[1].type]){t=(s.find.ID(f.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(u.shift().value.length)}o=Q.needsContext.test(e)?0:u.length;while(o--){f=u[o];if(s.relative[l=f.type])break;if(c=s.find[l])if(i=c(f.matches[0].replace(nt,rt),V.test(u[0].type)&&t.parentNode||t)){u.splice(o,1),e=i.length&&mt(u);if(!e)return P.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,V.test(e)),n}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),w=e.document,E=0,S=0,x=ot(),T=ot(),N=ot(),C=!1,k=function(e,t){return e===t?(C=!0,0):0},L=typeof t,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+q+")|)|)"+F+"*\\]",U=":("+I+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+R.replace(3,8)+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\]'\"]*)"+F+"*\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},G=/^[^{]+\{\s*\[native \w/,Y=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\d$/i,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(w.childNodes),w.childNodes),M[w.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},r=st.support={},c=st.setDocument=function(e){var t=e?e.ownerDocument||e:w,n=t.defaultView;if(t===h||t.nodeType!==9||!t.documentElement)return h;h=t,p=t.documentElement,d=!u(t),n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){c()}),r.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=at(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),r.getById=at(function(e){return p.appendChild(e).id=b,!t.getElementsByName||!t.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==L&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&d)return t.getElementsByClassName(e)},m=[],v=[];if(r.qsa=G.test(t.querySelectorAll))at(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),at(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")});return(r.matchesSelector=G.test(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&at(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",U)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),y=G.test(p.contains)||p.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=p.compareDocumentPosition?function(e,n){if(e===n)return C=!0,0;var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);if(i)return i&1||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||y(w,e)?-1:n===t||y(w,n)?1:l?B.call(l,e)-B.call(l,n):0:i&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,u=[e],a=[n];if(e===n)return C=!0,0;if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:l?B.call(l,e)-B.call(l,n):0;if(s===o)return lt(e,n);r=e;while(r=r.parentNode)u.unshift(r);r=n;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?lt(u[i],a[i]):u[i]===w?-1:a[i]===w?1:0},t},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==h&&c(e),t=t.replace($,"='$1']");if(r.matchesSelector&&d&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(i){}return st(t,h,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},st.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&O.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],i=0,s=0;C=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=o(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(i===3||i===4)return e.nodeValue;return n},s=st.selectors={cacheLength:50,createPseudo:ut,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=vt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[b]||(c[b]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[b]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ut(function(e){return K.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[n<0?n+t:n]}),even:pt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},s.pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ct(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=ht(n);dt.prototype=s.filters=s.pseudos,s.setFilters=new dt,a=st.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=vt(e)),n=t.length;while(n--)s=Et(t[n]),s[b]?r.push(s):i.push(s);s=N(e,St(i,r))}return s},r.sortStable=b.split("").sort(k).join("")===b,r.detectDuplicates=C,c(),r.sortDetached=at(function(e){return e.compareDocumentPosition(h.createElement("div"))&1}),at(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||ft("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!r.attributes||!at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ft("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),at(function(e){return e.getAttribute("disabled")==null})||ft(j,function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null}),jQuery.find=st,jQuery.expr=st.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=st.uniqueSort,jQuery.text=st.getText,jQuery.isXMLDoc=st.isXML,jQuery.contains=st.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return u&&(!n||a)&&(t=t||[],t=[e,t.slice?t.slice():t],r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&typeof t=="string"&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,jQuery.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(core_rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=jQuery(this),s=e.match(core_rnotwhite)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<i;t++)if(jQuery.contains(r[t],this))return!0}));for(t=0;t<i;t++)jQuery.find(e,r[t],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(r&&r.parentNode!==s&&(r=this.nextSibling),jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.lastChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(Data.accepts(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length)for(o=0;(i=r[o])!==undefined;o++)u[i]?jQuery.event.remove(n,i):jQuery.removeEvent(n,i,t.handle);data_priv.cache[s]&&delete data_priv.cache[s]}}delete data_user.cache[n[data_user.expando]]}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\r\n")}}):{name:t.name,value:n.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)}(window),function(){function x(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}function T(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||typeof n=="undefined")return 1;if(n<r||typeof r=="undefined")return-1}return e.index-t.index}function N(e){return"\\"+g[e]}function C(){}function Q(e){return e instanceof Q?e:new G(e)}function G(e,t){this.__chain__=!!t,this.__wrapped__=e}function Z(e,t,n){if(typeof e!="function")return Vn;if(typeof t=="undefined")return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Dn(e,t)}function et(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(lt(u)||ft(u))){t||(u=et(u,t,n));var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f)o[l++]=u[a]}else n||o.push(u)}return o}function tt(e,t,r,i){if(e===t)return e!==0||1/e==1/t;var s=typeof e,o=typeof t;if(e===e&&(!e||!m[s])&&(!t||!m[o]))return!1;if(e==null||t==null)return e===t;var u=B.call(e),c=B.call(t);if(u!=c)return!1;switch(u){case f:case l:return+e==+t;case h:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case d:case v:return e==String(t)}var g=u==a;if(!g){if(D.call(e,"__wrapped__ ")||t instanceof Q)return tt(e.__wrapped__||e,t.__wrapped__||t,r,i);if(u!=p)return!1;var y=e.constructor,b=t.constructor;if(y!=b&&!(Mt(y)&&y instanceof y&&Mt(b)&&b instanceof b))return!1}r||(r=[]),i||(i=[]);var w=r.length;while(w--)if(r[w]==e)return i[w]==t;var E=!0,S=0;r.push(e),i.push(t);if(g){S=t.length,E=S==e.length;if(E)while(S--)if(!(E=tt(e[S],t[S],r,i)))break;return E}return wt(t,function(t,s,o){if(D.call(o,s))return S++,!(E=D.call(e,s)&&tt(e[s],t,r,i))&&n}),E&&wt(e,function(e,t,r){if(D.call(r,t))return!(E=--S>-1)&&n}),E}function nt(e,t,n){var r=-1,i=ut(),s=e?e.length:0,o=[],u=n?[]:o;while(++r<s){var a=e[r],f=n?n(a,r,e):a;if(t?!r||u[u.length-1]!==f:i(u,f)<0)n&&u.push(f),o.push(a)}return o}function rt(e){return function(t,n,r){var i={};n=Bn(n,r,3);var s=-1,o=t?t.length:0;if(typeof o=="number")while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}else Et(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function it(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,l=t&16,c=t&32,h=e;if(!u&&!Mt(e))throw new TypeError;l&&!n.length&&(t&=-17,l=n=!1),c&&!r.length&&(t&=-33,c=r=!1);if(o&&!(u||a||c)&&(Y.fastBind||F&&l)){if(l){var p=[i];H.apply(p,n)}var d=l?F.apply(e,p):F.call(e,i)}else d=function(){var p=arguments,v=o?i:this;if(a||l||c){p=$.call(p),l&&j.apply(p,n),c&&H.apply(p,r);if(a&&p.length<s)return t|=16,it(e,f?t:t&-4,p,null,i,s)}u&&(e=v[h]);if(this instanceof d){v=st(e.prototype);var m=e.apply(v,p);return _t(m)?m:v}return e.apply(v,p)};return d}function st(e){return _t(e)?I(e):{}}function ot(e){return pt[e]}function ut(){var e=(e=Q.indexOf)===bn?x:e;return e}function at(e){return dt[e]}function ft(e){return e&&typeof e=="object"&&typeof e.length=="number"&&B.call(e)==u||!1}function gt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)e[i]=r[i]}return e}function yt(e){return _t(e)?lt(e)?$.call(e):gt({},e):e}function bt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)typeof e[i]=="undefined"&&(e[i]=r[i])}return e}function St(e){var t=[];return wt(e,function(e,n){Mt(e)&&t.push(n)}),t.sort()}function xt(e,t){return e?D.call(e,t):!1}function Tt(e){var t=-1,n=ht(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Nt(e){return e===!0||e===!1||B.call(e)==f}function Ct(e){return e?typeof e=="object"&&B.call(e)==l:!1}function kt(e){return e?e.nodeType===1:!1}function Lt(e){if(!e)return!0;if(lt(e)||jt(e))return!e.length;for(var t in e)if(D.call(e,t))return!1;return!0}function At(e,t){return tt(e,t)}function Ot(e){return R(e)&&!U(parseFloat(e))}function Mt(e){return typeof e=="function"}function _t(e){return!!e&&!!m[typeof e]}function Dt(e){return Ht(e)&&e!=+e}function Pt(e){return e===null}function Ht(e){return typeof e=="number"||B.call(e)==h}function Bt(e){return e&&m[typeof e]?B.call(e)==d:!1}function jt(e){return typeof e=="string"||B.call(e)==v}function Ft(e){return typeof e=="undefined"}function It(e){var t=ut(),n=et(arguments,!0,!1,1),r={};return wt(e,function(e,i){t(n,i)<0&&(r[i]=e)}),r}function qt(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Rt(e){var t=-1,n=et(arguments,!0,!1,1),r=n.length,i={};while(++t<r){var s=n[t];s in e&&(i[s]=e[s])}return i}function Ut(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r)i[t]=e[n[t]];return i}function zt(e,t){var r=ut(),i=e?e.length:0,s=!1;return i&&typeof i=="number"?s=r(e,t)>-1:Et(e,function(e){return(s=e===t)&&n}),s}function Xt(e,t,r){var i=!0;t=Bn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(!(i=!!t(e[s],s,e)))break}else Et(e,function(e,r,s){return!(i=!!t(e,r,s))&&n});return i}function Vt(e,t,n){var r=[];t=Bn(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number")while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}else Et(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $t(e,t,r){t=Bn(t,r,3);var i=-1,s=e?e.length:0;if(typeof s!="number"){var u;return Et(e,function(e,r,i){if(t(e,r,i))return u=e,n}),u}while(++i<s){var o=e[i];if(t(o,i,e))return o}}function Jt(e,t){return dn(e,t,!0)}function Kt(e,t,r){var i=-1,s=e?e.length:0;t=t&&typeof r=="undefined"?t:Z(t,r,3);if(typeof s=="number"){while(++i<s)if(t(e[i],i,e)===n)break}else Et(e,t)}function Qt(e,t){var r=e?e.length:0;if(typeof r=="number"){while(r--)if(t(e[r],r,e)===!1)break}else{var i=ht(e);r=i.length,Et(e,function(e,s,o){return s=i?i[--r]:--r,t(o[s],s,o)===!1&&n})}}function Zt(e,t){var n=$.call(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);return Kt(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o}function en(e,t,n){var r=-1,i=e?e.length:0;t=Bn(t,n,3);if(typeof i=="number"){var s=Array(i);while(++r<i)s[r]=t(e[r],r,e)}else s=[],Et(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function tn(e,t,n){var r=-Infinity,i=r,s=-1,o=e?e.length:0;if(!t&&typeof o=="number")while(++s<o){var u=e[s];u>i&&(i=u)}else t=Bn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function nn(e,t,n){var r=Infinity,i=r,s=-1,o=e?e.length:0;if(!t&&typeof o=="number")while(++s<o){var u=e[s];u<i&&(i=u)}else t=Bn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function rn(e,t){var n=-1,r=e?e.length:0;if(typeof r=="number"){var i=Array(r);while(++n<r)i[n]=e[n][t]}return i||en(e,t)}function sn(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=Z(t,r,4);var s=-1,o=e.length;if(typeof o=="number"){i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else Et(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function on(e,t,n,r){var i=arguments.length<3;return t=Z(t,r,4),Qt(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function un(e,t,n){return t=Bn(t,n,3),Vt(e,function(e,n,r){return!t(e,n,r)})}function an(t,n,r){var i=t?t.length:0;typeof i!="number"&&(t=Ut(t));if(n==null||r)return t?t[Kn(i-1)]:e;var s=fn(t);return s.length=X(W(0,n),s.length),s}function fn(e){var t=-1,n=e?e.length:0,r=Array(typeof n=="number"?n:0);return Kt(e,function(e){var n=Kn(++t);r[t]=r[n],r[n]=e}),r}function ln(e){var t=e?e.length:0;return typeof t=="number"?t:ht(e).length}function cn(e,t,r){var i;t=Bn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(i=t(e[s],s,e))break}else Et(e,function(e,r,s){return(i=t(e,r,s))&&n});return!!i}function hn(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=Bn(t,n,3),Kt(e,function(e,n,i){s[++r]={criteria:t(e,n,i),index:r,value:e}}),i=s.length,s.sort(T);while(i--)s[i]=s[i].value;return s}function pn(e){return lt(e)?$.call(e):e&&typeof e.length=="number"?en(e):Ut(e)}function dn(t,n,r){return r&&Lt(n)?e:(r?$t:Vt)(t,n)}function vn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function mn(e){var t=-1,n=ut(),r=e.length,i=et(arguments,!0,!0,1),s=[];while(++t<r){var o=e[t];n(i,o)<0&&s.push(o)}return s}function gn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Bn(n,r,3);while(++o<s&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[0]:e}return $.call(t,0,X(W(0,i),s))}function yn(e,t){return et(e,t)}function bn(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?W(0,r+n):n||0}else if(n){var i=Cn(e,t);return e[i]===t?i:-1}return x(e,t,n)}function wn(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=Bn(t,n,3);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return $.call(e,0,X(W(0,i-r),i))}function En(e){var t=arguments,n=t.length,r=-1,i=ut(),s=e?e.length:0,o=[];e:while(++r<s){var u=e[r];if(i(o,u)<0){var a=n;while(--a)if(i(t[a],u)<0)continue e;o.push(u)}}return o}function Sn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=s;n=Bn(n,r,3);while(o--&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[s-1]:e}return $.call(t,W(0,s-i))}function xn(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?W(0,r+n):X(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function Tn(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var r=-1,i=W(0,M((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s}function Nn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Bn(t,n,3);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:W(0,t);return $.call(e,r)}function Cn(e,t,n,r){var i=0,s=e?e.length:i;n=n?Bn(n,r,1):Vn,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function kn(e){return nt(et(arguments,!0,!0))}function Ln(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=!r||r[t]!==e?t:null,t=!1),n!=null&&(n=Bn(n,r,3)),nt(e,t,n)}function An(e){return mn(e,$.call(arguments,1))}function On(){var e=-1,t=tn(rn(arguments,"length")),n=Array(t<0?0:t);while(++e<t)n[e]=rn(arguments,e);return n}function Mn(e,t){var n=-1,r=e?e.length:0,i={};while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function _n(e,t){if(!Mt(t))throw new TypeError;return function(){if(--e<1)return t.apply(this,arguments)}}function Dn(e,t){return arguments.length>2?it(e,17,$.call(arguments,2),null,t):it(e,1,null,null,t)}function Pn(e){var t=arguments.length>1?et(arguments,!0,!1,1):St(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=it(e[i],1,null,null,e)}return e}function Hn(){var e=arguments,t=e.length;while(t--)if(!Mt(e[t]))throw new TypeError;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Bn(e,t,n){var r=typeof e;if(e==null||r=="function")return Z(e,t,n);if(r!="object")return function(t){return t[e]};var i=ht(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=t[i[n]]===e[i[n]]))break;return r}}function jn(t,n,r){var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(!Mt(t))throw new TypeError;n=W(0,n)||0;if(r===!0){var d=!0;p=!1}else _t(r)&&(d=r.leading,h="maxWait"in r&&(W(n,r.maxWait)||0),p="trailing"in r?r.trailing:p);var v=function(){var r=n-(P()-u);if(r<=0){s&&clearTimeout(s);var h=l;s=f=l=e,h&&(c=P(),o=t.apply(a,i))}else f=setTimeout(v,r)},m=function(){f&&clearTimeout(f),s=f=l=e;if(p||h!==n)c=P(),o=t.apply(a,i)};return function(){i=arguments,u=P(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c);r<=0?(s&&(s=clearTimeout(s)),c=u,o=t.apply(a,i)):s||(s=setTimeout(m,r))}return!f&&n!==h&&(f=setTimeout(v,n)),e&&(o=t.apply(a,i)),o}}function Fn(t){if(!Mt(t))throw new TypeError;var n=$.call(arguments,1);return setTimeout(function(){t.apply(e,n)},1)}function In(t,n){if(!Mt(t))throw new TypeError;var r=$.call(arguments,2);return setTimeout(function(){t.apply(e,r)},n)}function qn(e,t){var n={};return function(){var i=t?t.apply(this,arguments):r+arguments[0];return D.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}}function Rn(e){var t,n;if(!Mt(e))throw new TypeError;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Un(e){return it(e,16,$.call(arguments,1))}function zn(e,t,n){var r=!0,i=!0;if(!Mt(e))throw new TypeError;return n===!1?r=!1:_t(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n={},n.leading=r,n.maxWait=t,n.trailing=i,jn(e,t,n)}function Wn(e,t){if(!Mt(t))throw new TypeError;return function(){var n=[e];return H.apply(n,arguments),t.apply(this,n)}}function Xn(e){return e==null?"":String(e).replace(mt,ot)}function Vn(e){return e}function $n(e){Kt(St(e),function(t){var n=Q[t]=e[t];Q.prototype[t]=function(){var e=[this.__wrapped__];H.apply(e,arguments);var t=n.apply(Q,e);return this.__chain__?new G(t,!0):t}})}function Jn(){return y._=A,this}function Kn(e,t){return e==null&&t==null&&(t=1),e=+e||0,t==null?(t=e,e=0):t=+t||0,e+_(V()*(t-e+1))}function Qn(e,t){if(e){var n=e[t];return Mt(n)?e[t]():n}}function Gn(e,t,n){var r=Q,i=r.templateSettings;e||(e=""),n=bt({},n,i);var u=0,a="__p += '",f=n.variable,l=RegExp((n.escape||s).source+"|"+(n.interpolate||s).source+"|"+(n.evaluate||s).source+"|$","g");e.replace(l,function(t,n,r,i,s){return a+=e.slice(u,s).replace(o,N),n&&(a+="' +\n_.escape("+n+") +\n'"),i&&(a+="';\n"+i+";\n__p += '"),r&&(a+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=s+t.length,t}),a+="';\n",f||(f="obj",a="with ("+f+" || {}) {\n"+a+"\n}\n"),a="function("+f+") {\n"+"var __t, __p = '', __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n"+a+"return __p\n}";try{var c=Function("_","return "+a)(r)}catch(h){throw h.source=a,h}return t?c(t):(c.source=a,c)}function Yn(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=Array(e);t=Z(t,n,1);while(++r<e)i[r]=t(r);return i}function Zn(e){return e==null?"":String(e).replace(vt,at)}function er(e){var n=++t+"";return e?e+n:n}function tr(e){return e=new G(e),e.__chain__=!0,e}function nr(e,t){return t(e),e}function rr(){return this.__chain__=!0,this}function ir(){return this.__wrapped__}var e,t=0,n={},r=+(new Date)+"",i=/<%=([\s\S]+?)%>/g,s=/($^)/,o=/['\n\r\t\u2028\u2029\\]/g,u="[object Arguments]",a="[object Array]",f="[object Boolean]",l="[object Date]",c="[object Function]",h="[object Number]",p="[object Object]",d="[object RegExp]",v="[object String]",m={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},g={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},y=m[typeof window]&&window||this,b=m[typeof exports]&&exports&&!exports.nodeType&&exports,w=m[typeof module]&&module&&!module.nodeType&&module,E=w&&w.exports===b&&b,S=m[typeof global]&&global;S&&(S.global===S||S.window===S)&&(y=S);var k=[],L=Object.prototype,A=y._,O=RegExp("^"+String(L.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),M=Math.ceil,_=Math.floor,D=L.hasOwnProperty,P=O.test(P=Date.now)&&P||function(){return+(new Date)},H=k.push,B=L.toString,j=k.unshift,F=O.test(F=B.bind)&&F,I=O.test(I=Object.create)&&I,q=O.test(q=Array.isArray)&&q,R=y.isFinite,U=y.isNaN,z=O.test(z=Object.keys)&&z,W=Math.max,X=Math.min,V=Math.random,$=k.slice,J=O.test(y.attachEvent),K=F&&!/\n|true/.test(F+J);G.prototype=Q.prototype;var Y={};(function(){var e={0:1,length:1};Y.fastBind=F&&!K,Y.spliceObjects=(k.splice.call(e,0,1),!e[0])})(1),Q.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:i,variable:""},I||(st=function(e){if(_t(e)){C.prototype=e;var t=new C;C.prototype=null}return t||{}}),ft(arguments)||(ft=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&D.call(e,"callee")||!1});var lt=q||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&B.call(e)==a||!1},ct=function(e){var t,n=e,r=[];if(!n)return r;if(!m[typeof e])return r;for(t in n)D.call(n,t)&&r.push(t);return r},ht=z?function(e){return _t(e)?z(e):[]}:ct,pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},dt=Tt(pt),vt=RegExp("("+ht(dt).join("|")+")","g"),mt=RegExp("["+ht(pt).join("")+"]","g"),wt=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(t(i[r],r,e)===n)return s;return s},Et=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(D.call(i,r)&&t(i[r],r,e)===n)return s;return s};Mt(/x/)&&(Mt=function(e){return typeof e=="function"&&B.call(e)==c});var Wt=rt(function(e,t,n){D.call(e,n)?e[n]++:e[n]=1}),Gt=rt(function(e,t,n){(D.call(e,n)?e[n]:e[n]=[]).push(t)}),Yt=rt(function(e,t,n){e[n]=t});Q.after=_n,Q.bind=Dn,Q.bindAll=Pn,Q.chain=tr,Q.compact=vn,Q.compose=Hn,Q.countBy=Wt,Q.debounce=jn,Q.defaults=bt,Q.defer=Fn,Q.delay=In,Q.difference=mn,Q.filter=Vt,Q.flatten=yn,Q.forEach=Kt,Q.functions=St,Q.groupBy=Gt,Q.indexBy=Yt,Q.initial=wn,Q.intersection=En,Q.invert=Tt,Q.invoke=Zt,Q.keys=ht,Q.map=en,Q.max=tn,Q.memoize=qn,Q.min=nn,Q.omit=It,Q.once=Rn,Q.pairs=qt,Q.partial=Un,Q.pick=Rt,Q.pluck=rn,Q.range=Tn,Q.reject=un,Q.rest=Nn,Q.shuffle=fn,Q.sortBy=hn,Q.tap=nr,Q.throttle=zn,Q.times=Yn,Q.toArray=pn,Q.union=kn,Q.uniq=Ln,Q.values=Ut,Q.where=dn,Q.without=An,Q.wrap=Wn,Q.zip=On,Q.collect=en,Q.drop=Nn,Q.each=Kt,Q.extend=gt,Q.methods=St,Q.object=Mn,Q.select=Vt,Q.tail=Nn,Q.unique=Ln,Q.clone=yt,Q.contains=zt,Q.escape=Xn,Q.every=Xt,Q.find=$t,Q.has=xt,Q.identity=Vn,Q.indexOf=bn,Q.isArguments=ft,Q.isArray=lt,Q.isBoolean=Nt,Q.isDate=Ct,Q.isElement=kt,Q.isEmpty=Lt,Q.isEqual=At,Q.isFinite=Ot,Q.isFunction=Mt,Q.isNaN=Dt,Q.isNull=Pt,Q.isNumber=Ht,Q.isObject=_t,Q.isRegExp=Bt,Q.isString=jt,Q.isUndefined=Ft,Q.lastIndexOf=xn,Q.mixin=$n,Q.noConflict=Jn,Q.random=Kn,Q.reduce=sn,Q.reduceRight=on,Q.result=Qn,Q.size=ln,Q.some=cn,Q.sortedIndex=Cn,Q.template=Gn,Q.unescape=Zn,Q.uniqueId=er,Q.all=Xt,Q.any=cn,Q.detect=$t,Q.findWhere=Jt,Q.foldl=sn,Q.foldr=on,Q.include=zt,Q.inject=sn,Q.first=gn,Q.last=Sn,Q.sample=an,Q.take=gn,Q.head=gn,$n(Q),Q.VERSION="2.2.1",Q.prototype.chain=rr,Q.prototype.value=ir,Kt(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=k[e];Q.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),!Y.spliceObjects&&e.length===0&&delete e[0],this}}),Kt(["concat","join","slice"],function(e){var t=k[e];Q.prototype[e]=function(){var e=this.__wrapped__,n=t.apply(e,arguments);return this.__chain__&&(n=new G(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(y._=Q,define("underscore",[],function(){return Q})):b&&w?E?(w.exports=Q)._=Q:b._=Q:y._=Q}.call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),function(e,t){if(typeof define=="function"&&define.amd)define("marionette",["backbone","underscore"],function(n,r){return e.Marionette=e.Mn=t(e,n,r)});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore");module.exports=t(e,n,r)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,n){(function(e,t){var n=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;return this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(r){t.isFunction(r[e])&&r[e].apply(r,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(e,t),e.ChildViewContainer.VERSION="0.1.10",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer})(t,n),function(e,t){var n=e.Wreqr,r=e.Wreqr={};return e.Wreqr.VERSION="1.3.5",e.Wreqr.noConflict=function(){return e.Wreqr=n,this},r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)return;return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,t),r.CommandStorage=function(){var n=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(n.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),n}(),r.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var n=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,n):this.storage.addCommand(e,n)},_executeCommands:function(e,n,r){var i=this.storage.getCommands(e);t.each(i.instances,function(e){n.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var n,r=e.storageType||this.storageType;t.isFunction(r)?n=new r:n=r,this.storage=n}})}(r,t),r.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){if(this.hasHandler(e))return this.getHandler(e).apply(this,t.rest(arguments))}})}(r,t),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,t),r.Channel=function(n){var r=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(r.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,n,r){if(!n)return;r=r||this;var i=e==="vent"?"on":"setHandler";t.each(n,function(n,s){this[e][i](s,t.bind(n,r))},this)}}),r}(r),r.radio=function(e,t){var n=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(n.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var n=this._channels[t];return n||(n=new e.Channel(t),this._channels[t]=n),n},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(r[e],function(t){this[e][t]=i(this,e,t)},this)},this)}});var r={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},i=function(e,n,r){return function(i){var s=e._getChannel(i)[n];return s[r].apply(s,t.rest(arguments))}};return new n}(r,t),e.Wreqr}(t,n);var r=e.Marionette,i=e.Mn,s=t.Marionette={};s.VERSION="2.4.3",s.noConflict=function(){return e.Marionette=r,e.Mn=i,this},t.Marionette=s,s.Deferred=t.$.Deferred,s.extend=t.Model.extend,s.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},s.mergeOptions=function(e,t){if(!e)return;n.extend(this,n.pick(e,t))},s.getOption=function(e,t){if(!e||!t)return;return e.options&&e.options[t]!==undefined?e.options[t]:e[t]},s.proxyGetOption=function(e){return s.getOption(this,e)},s._getValue=function(e,t,r){return n.isFunction(e)&&(e=r?e.apply(t,r):e.call(t)),e},s.normalizeMethods=function(e){return n.reduce(e,function(e,t,r){return n.isFunction(t)||(t=this[t]),t&&(e[r]=t),e},{},this)},s.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},s.normalizeUIKeys=function(e,t){return n.reduce(e,function(e,n,r){var i=s.normalizeUIString(r,t);return e[i]=n,e},{})},s.normalizeUIValues=function(e,t,r){return n.each(e,function(i,o){n.isString(i)?e[o]=s.normalizeUIString(i,t):n.isObject(i)&&n.isArray(r)&&(n.extend(i,s.normalizeUIValues(n.pick(i,r),t)),n.each(r,function(e){var r=i[e];n.isString(r)&&(i[e]=s.normalizeUIString(r,t))}))}),e},s.actAsCollection=function(e,t){var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];n.each(r,function(r){e[r]=function(){var e=n.values(n.result(this,t)),i=[e].concat(n.toArray(arguments));return n[r].apply(n,i)}})};var o=s.deprecate=function(e,t){n.isObject(e)&&(e=e.prev+" is going to be removed in the future. "+"Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),(t===undefined||!t)&&!o._cache[e]&&(o._warn("Deprecation warning: "+e),o._cache[e]=!0)};o._warn=typeof console!="undefined"&&(console.warn||console.log)||function(){},o._cache={},s._triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi;return function(r,i,s){var o=arguments.length<3;o&&(s=i,i=s[0]);var u="on"+i.replace(e,t),a=r[u],f;return n.isFunction(a)&&(f=a.apply(r,o?n.rest(s):s)),n.isFunction(r.trigger)&&(o+s.length>1?r.trigger.apply(r,o?s:[i].concat(n.drop(s,0))):r.trigger(i)),f}}(),s.triggerMethod=function(e){return s._triggerMethod(this,arguments)},s.triggerMethodOn=function(e){var t=n.isFunction(e.triggerMethod)?e.triggerMethod:s.triggerMethod;return t.apply(e,n.rest(arguments))},s.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,r()}function n(){e._isRendered=!0,r()}function r(){e._isShown&&e._isRendered&&s.isNodeAttached(e.el)&&s.triggerMethodOn(e,"dom:refresh",e)}if(e._isDomRefreshMonitored)return;e._isDomRefreshMonitored=!0,e.on({show:t,render:n})},function(e){function t(t,r,i,s){var o=s.split(/\s+/);n.each(o,function(n){var s=t[n];if(!s)throw new e.Error('Method "'+n+'" was configured as an event handler, but does not exist.');t.listenTo(r,i,s)})}function r(e,t,n,r){e.listenTo(t,n,r)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i)})}function s(e,t,n,r){e.stopListening(t,n,r)}function o(t,r,i,s,o){if(!r||!i)return;if(!n.isObject(i))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});i=e._getValue(i,t),n.each(i,function(e,i){n.isFunction(e)?s(t,r,i,e):o(t,r,i,e)})}e.bindEntityEvents=function(e,n,i){o(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){o(e,t,n,s,i)},e.proxyBindEntityEvents=function(t,n){return e.bindEntityEvents(this,t,n)},e.proxyUnbindEntityEvents=function(t,n){return e.unbindEntityEvents(this,t,n)}}(s);var u=["description","fileName","lineNumber","name","message","number"];return s.Error=s.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+s.VERSION+"/",constructor:function(e,t){n.isObject(e)?(t=e,e=t.message):t||(t={});var r=Error.call(this,e);n.extend(this,n.pick(r,u),n.pick(t,u)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,s.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),s.Error.extend=s.extend,s.Callbacks=function(){this._deferred=s.Deferred(),this._callbacks=[]},n.extend(s.Callbacks.prototype,{add:function(e,t){var r=n.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),r.then(function(n){t&&(n.context=t),e.call(n.context,n.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=s.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),s.Controller=function(e){this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},s.Controller.extend=s.extend,n.extend(s.Controller.prototype,t.Events,{destroy:function(){return s._triggerMethod(this,"before:destroy",arguments),s._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:s.triggerMethod,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption}),s.Object=function(e){this.options=n.extend({},n.result(this,"options"),e),this.initialize.apply(this,arguments)},s.Object.extend=s.extend,n.extend(s.Object.prototype,t.Events,{initialize:function(){},destroy:function(){return this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening(),this},triggerMethod:s.triggerMethod,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.Region=s.Object.extend({constructor:function(e){this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el;if(!this.el)throw new s.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),s.Object.call(this,e)},show:function(e,t){if(!this._ensureElement())return;this._ensureViewIsIntact(e),s.MonitorDOMRefresh(e);var r=t||{},i=e!==this.currentView,o=!!r.preventDestroy,u=!!r.forceShow,a=!!this.currentView,f=i&&!o,l=i||u;a&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,f?this.empty():a&&l&&this.currentView.off("destroy",this.empty,this);if(l){e.once("destroy",this.empty,this),this._renderView(e),e._parent=this,a&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),s.triggerMethodOn(e,"before:show",e,this,t),a&&this.triggerMethod("swapOut",this.currentView,this,t);var c=s.isNodeAttached(this.el),h=[],p=n.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},r);return c&&p.triggerBeforeAttach&&(h=this._displayedViews(e),this._triggerAttach(h,"before:")),this.attachHtml(e),this.currentView=e,c&&p.triggerAttach&&(h=this._displayedViews(e),this._triggerAttach(h)),a&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),s.triggerMethodOn(e,"show",e,this,t),this}return this},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var r=(t||"")+"attach";n.each(e,function(e){s.triggerMethodOn(e,r,e,this)},this)},_displayedViews:function(e){return n.union([e],n.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||s.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||s.triggerMethodOn(e,"render",e)},_ensureElement:function(){n.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]);if(!this.$el||this.$el.length===0){if(this.getOption("allowMissingEl"))return!1;throw new s.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new s.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new s.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,s._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,n=e||{},r=!!n.preventDestroy;if(!t)return;return t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),r||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,r&&this.$el.contents().detach(),this},_destroyView:function(){var e=this.currentView;if(e.isDestroyed)return;e.supportsDestroyLifecycle||s.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"destroy",e)},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(n.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(n.isFunction(e))return this._buildRegionFromRegionClass(e);throw new s.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var r=e.regionClass||t,i=n.omit(e,"selector","regionClass");return e.selector&&!i.el&&(i.el=e.selector),new r(i)},_buildRegionFromRegionClass:function(e){return new e}}),s.RegionManager=s.Controller.extend({constructor:function(e){this._regions={},this.length=0,s.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=s._getValue(e,this,arguments),n.reduce(e,function(e,r,i){return n.isString(r)&&(r={selector:r}),r.selector&&(r=n.defaults({},r,t)),e[i]=this.addRegion(i,r),e},{},this)},addRegion:function(e,t){var n;return t instanceof s.Region?n=t:n=s.Region.buildRegion(t,s.Region),this.triggerMethod("before:add:region",e,n),n._parent=this,this._store(e,n),this.triggerMethod("add:region",e,n),n},get:function(e){return this._regions[e]},getRegions:function(){return n.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return n.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return n.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),s.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),s.actAsCollection(s.RegionManager.prototype,"_regions"),s.TemplateCache=function(e){this.templateId=e},n.extend(s.TemplateCache,{templateCaches:{},get:function(e,t){var n=this.templateCaches[e];return n||(n=new s.TemplateCache(e),this.templateCaches[e]=n),n.load(t)},clear:function(){var e,t=n.toArray(arguments),r=t.length;if(r>0)for(e=0;e<r;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(s.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,n){var r=t.$(e);if(!r.length)throw new s.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return r.html()},compileTemplate:function(e,t){return n.template(e,t)}}),s.Renderer={render:function(e,t){if(!e)throw new s.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var r=n.isFunction(e)?e:s.TemplateCache.get(e);return r(t)}},s.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=n.bind(this.render,this),e=s._getValue(e,this),this.options=n.extend({},n.result(this,"options"),e),this._behaviors=s.Behaviors(this),t.View.call(this,this.options),s.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,n.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=s._getValue(t,this),n.extend(e,t)},normalizeUIKeys:function(e){var t=n.result(this,"_uiBindings");return s.normalizeUIKeys(e,t||n.result(this,"ui"))},normalizeUIValues:function(e,t){var r=n.result(this,"ui"),i=n.result(this,"_uiBindings");return s.normalizeUIValues(e,i||r,t)},configureTriggers:function(){if(!this.triggers)return;var e=this.normalizeUIKeys(n.result(this,"triggers"));return n.reduce(e,function(e,t,n){return e[n]=this._buildViewTrigger(t),e},{},this)},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var r=s._getValue(e||this.events,this);r=this.normalizeUIKeys(r),n.isUndefined(e)&&(this.events=r);var i={},o=n.result(this,"behaviorEvents")||{},u=this.configureTriggers(),a=n.result(this,"behaviorTriggers")||{};n.extend(i,o,r,u,a),t.View.prototype.delegateEvents.call(this,i)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new s.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=n.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),n.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),n.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(e,function(e,t){this.ui[t]=this.$(e)},this)},unbindUIElements:function(){this._unbindUIElements(),n.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){if(!this.ui||!this._uiBindings)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings},_buildViewTrigger:function(e){var t=n.defaults({},e,{preventDefault:!0,stopPropagation:!0}),r=n.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var n={view:this,model:this.model,collection:this.collection};this.triggerMethod(r,n)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return n.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=s._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],n.rest(arguments)),e},_triggerEventOnBehaviors:function(e){var t=s._triggerMethod,n=this._behaviors;for(var r=0,i=n&&n.length;r<i;r++)t(n[r],e)},_triggerEventOnParentLayout:function(e,t){var r=this._parentLayoutView();if(!r)return;var i=s.getOption(r,"childViewEventPrefix"),o=i+":"+e,u=[this].concat(t);s._triggerMethod(r,o,u);var a=s.getOption(r,"childEvents"),f=r.normalizeMethods(a);f&&n.isFunction(f[e])&&f[e].apply(r,u)},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?n.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_getAncestors:function(){var e=[],t=this._parent;while(t)e.push(t),t=t._parent;return e},_parentLayoutView:function(){var e=this._getAncestors();return n.find(e,function(e){return e instanceof s.LayoutView})},normalizeMethods:s.normalizeMethods,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.ItemView=s.View.extend({constructor:function(){s.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,n.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e===!1)return;if(!e)throw new s.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),n=s.Renderer.render(e,t,this);return this.attachElContent(n),this},attachElContent:function(e){return this.$el.html(e),this}}),s.CollectionView=s.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),s.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e=this._isShown&&s.isNodeAttached(this.el),t;this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),e&&this._triggerBeforeAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),e&&this._triggerAttach&&(t=this._getNestedViews(),this._triggerMethodMany(t,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,r){var i=n.drop(arguments,3);n.each(e,function(e){s.triggerMethodOn.apply(e,[e,r,e,t].concat(i))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,r){var i=r.at!==undefined&&(r.index||t.indexOf(e));if(this.getOption("filter")||i===!1)i=n.indexOf(this._filteredSortedModels(i),e);if(this._shouldAddChild(e,i)){this.destroyEmptyView();var s=this.getChildView(e);this.addChild(e,s,i)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){s.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){s.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels(),r=n.find(t,function(t){return!e.findByModel(t)});if(r)this.render();else{var i=n.map(t,function(t,n){var r=e.findByModel(t);return r._index=n,r.el});this.triggerMethod("before:reorder"),this._appendReorderedChildren(i),this.triggerMethod("reorder")}},resortView:function(){s.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels(),t=n.find(e,function(e,t){var n=this.children.findByModel(e);return!n||n._index!==t},this);t&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();n.each(t,function(t,n){e=this.getChildView(t),this.addChild(t,e,n)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),r=this.collection.models;e=Math.min(Math.max(e,0),r.length-1);if(t){var i;e&&(i=r[e],r=r.slice(0,e).concat(r.slice(e+1))),r=this._sortModelsBy(r,t),i&&r.splice(e,0,i)}return this.getOption("filter")&&(r=n.filter(r,function(e,t){return this._shouldAddChild(e,t)},this)),r},_sortModelsBy:function(e,t){return typeof t=="string"?n.sortBy(e,function(e){return e.get(t)},this):t.length===1?n.sortBy(e,t,this):e.sort(n.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var n=new t.Model;this.addEmptyView(n,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var r=this._isShown&&!this.isBuffering&&s.isNodeAttached(this.el),i,o=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");n.isFunction(o)&&(o=o.call(this,e,this._emptyViewIndex));var u=this.buildChildView(e,t,o);u._parent=this,this.proxyChildEvents(u),u.once("render",function(){this._isShown&&s.triggerMethodOn(u,"before:show",u),r&&this._triggerBeforeAttach&&(i=this._getViewAndNested(u),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(u),this.renderChildView(u,this._emptyViewIndex),r&&this._triggerAttach&&(i=this._getViewAndNested(u),this._triggerMethodMany(i,this,"attach")),this._isShown&&s.triggerMethodOn(u,"show",u)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new s.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,n){var r=this.getOption("childViewOptions");r=s._getValue(r,this,[e,n]);var i=this.buildChildView(e,t,r);return this._updateIndices(i,!0,n),this.triggerMethod("before:add:child",i),this._addChildView(i,n),this.triggerMethod("add:child",i),i._parent=this,i},_updateIndices:function(e,t,n){if(!this.getOption("sort"))return;t&&(e._index=n),this.children.each(function(n){n._index>=e._index&&(n._index+=t?1:-1)})},_addChildView:function(e,t){var n=this._isShown&&!this.isBuffering&&s.isNodeAttached(this.el),r;this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&s.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(r=this._getViewAndNested(e),this._triggerMethodMany(r,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(r=this._getViewAndNested(e),this._triggerMethodMany(r,this,"attach")),this._isShown&&!this.isBuffering&&s.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||s.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||s.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,r){var i=n.extend({model:e},r),o=new t(i);return s.MonitorDOMRefresh(o),o},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||this.collection.length===0},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return n.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,n){e.isBuffering?e._bufferedChildren.splice(n,0,t):e._insertBefore(t,n)||e._insertAfter(t)},_insertBefore:function(e,t){var n,r=this.getOption("sort")&&t<this.children.length-1;return r&&(n=this.children.find(function(e){return e._index===t+1})),n?(n.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),s.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},r=!0,i=this.children.map(n.identity);return n.isUndefined(t.checkEmpty)||(r=t.checkEmpty),this.children.each(this.removeChildView,this),r&&this.checkEmpty(),i},_shouldAddChild:function(e,t){var r=this.getOption("filter");return!n.isFunction(r)||r.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var r=n.toArray(arguments),i=r[0],s=this.normalizeMethods(n.result(this,"childEvents"));r[0]=t+":"+i,r.splice(1,0,e),typeof s!="undefined"&&n.isFunction(s[i])&&s[i].apply(this,r.slice(1)),this.triggerMethod.apply(this,r)})},_getImmediateChildren:function(){return n.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(n.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),s.CompositeView=s.CollectionView.extend({constructor:function(){s.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=n.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&s.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),n=s.Renderer.render(t,e,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var n=this.getChildViewContainer(e);n.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e,t){if(!e.$childViewContainer){var n,r=s.getOption(e,"childViewContainer");if(r){var i=s._getValue(r,e);i.charAt(0)==="@"&&e.ui?n=e.ui[i.substr(4)]:n=e.$(i);if(n.length<=0)throw new s.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else n=e.$el;return e.$childViewContainer=n,n}return e.$childViewContainer},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=undefined)}}),s.LayoutView=s.ItemView.extend({regionClass:s.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),s.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),s.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),s.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t){return this.getRegion(e).show(t)},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:n.partial(n.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=s._getValue(this.regions,this,[e])||{};var r=this.getOption.call(e,"regions");r=s._getValue(r,this,[e]),n.extend(t,r),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new s.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return n.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),s.Behavior=s.Object.extend({constructor:function(e,t){this.view=t,this.defaults=n.result(this,"defaults")||{},this.options=n.extend({},this.defaults,e),this.ui=n.extend({},n.result(t,"ui"),n.result(this,"ui")),s.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),s.Behaviors=function(e,t){function r(e,n){return t.isObject(e.behaviors)?(n=r.parseBehaviors(e,n||t.result(e,"behaviors")),r.wrap(e,n,t.keys(i)),n):{}}function s(e,t){this._view=e,this._behaviors=t,this._triggers={}}function o(e){return e._uiBindings||e.ui}var n=/^(\S+)\s*(.*)$/,i={behaviorTriggers:function(e,t){var n=new s(this,t);return n.buildBehaviorTriggers()},behaviorEvents:function(r,i){var s={};return t.each(i,function(r,i){var u={},a=t.clone(t.result(r,"events"))||{};a=e.normalizeUIKeys(a,o(r));var f=0;t.each(a,function(e,s){var o=s.match(n),a=o[1]+"."+[this.cid,i,f++," "].join(""),l=o[2],c=a+l,h=t.isFunction(e)?e:r[e];u[c]=t.bind(h,r)},this),s=t.extend(s,u)},this),s}};return t.extend(r,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(r.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,i){var s=r.getBehaviorClass(n,i),o=new s(n,e),u=r.parseBehaviors(e,t.result(o,"behaviors"));return[o].concat(u)}).flatten().value()},wrap:function(e,n,r){t.each(r,function(r){e[r]=t.partial(i[r],e[r],n)})}}),t.extend(s.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(n,r){var i=t.clone(t.result(n,"triggers"))||{};i=e.normalizeUIKeys(i,o(n)),t.each(i,t.bind(this._setHandlerForBehavior,this,n,r))},_setHandlerForBehavior:function(e,t,n,r){var i=r.replace(/^\S+/,function(e){return e+"."+"behaviortriggers"+t});this._triggers[i]=this._view._buildViewTrigger(n)}}),r}(s,n),s.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var n=this.getOption("appRoutes"),r=this._getController();this.processAppRoutes(r,n),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},_processOnRoute:function(e,t){if(n.isFunction(this.onRoute)){var r=n.invert(this.getOption("appRoutes"))[e];this.onRoute(e,r,t)}},processAppRoutes:function(e,t){if(!t)return;var r=n.keys(t).reverse();n.each(r,function(n){this._addAppRoute(e,n,t[n])},this)},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,r){var i=e[r];if(!i)throw new s.Error('Method "'+r+'" was not found on the controller');this.route(t,r,n.bind(i,e))},mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,triggerMethod:s.triggerMethod,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.Application=s.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new s.Callbacks,this.submodules={},n.extend(this,e),this._initChannel(),s.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var r=s.Module.getClass(t),i=n.toArray(arguments);return i.unshift(this),r.create.apply(r,i)},getRegionManager:function(){return new s.RegionManager},_initializeRegions:function(e){var t=n.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var r=s.getOption(e,"regions");return n.isFunction(r)&&(r=r.call(this,e)),n.extend(t,r),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){s._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,s._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){s._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],s._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=n.result(this,"channelName")||"global",this.channel=n.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=n.result(this,"vent")||this.channel.vent,this.commands=n.result(this,"commands")||this.channel.commands,this.reqres=n.result(this,"reqres")||this.channel.reqres}}),s.Module=function(e,t,r){this.moduleName=e,this.options=n.extend({},this.options,r),this.initialize=r.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,n.isFunction(this.initialize)&&this.initialize(e,t,this.options)},s.Module.extend=s.extend,n.extend(s.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,this.triggerMethod("before:stop"),n.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,r){if(!e)return;var i=n.flatten([this,this.app,t,s,t.$,n,r]);e.apply(this,i)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new s.Callbacks,this._finalizerCallbacks=new s.Callbacks},triggerMethod:s.triggerMethod}),n.extend(s.Module,{create:function(e,t,r){var i=e,s=n.drop(arguments,3);t=t.split(".");var o=t.length,u=[];return u[o-1]=r,n.each(t,function(t,n){var o=i;i=this._getModule(o,t,e,r),this._addModuleDefinition(o,i,u[n],s)},this),i},_getModule:function(e,t,r,i,s){var o=n.extend({},i),u=this.getClass(i),a=e[t];return a||(a=new u(t,r,o),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=s.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,n,r){var i=this._getDefine(n),s=this._getStartWithParent(n,t);i&&t.addDefinition(i,r),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var r;return n.isFunction(e)&&e.prototype instanceof s.Module?(r=t.constructor.prototype.startWithParent,n.isUndefined(r)?!0:r):n.isObject(e)?(r=e.startWithParent,n.isUndefined(r)?!0:r):!0},_getDefine:function(e){return!n.isFunction(e)||e.prototype instanceof s.Module?n.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,n){t.startWithParent=t.startWithParent&&n;if(!t.startWithParent||!!t.startWithParentIsConfigured)return;t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)})}}),s}),define("hbs/handlebars",[],function(){var e=function(){var e=function(){function t(e){this.string=e}var e;return t.prototype.toString=function(){return""+this.string},e=t,e}(),t=function(e){function o(e){return r[e]||"&amp;"}function u(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function c(e){return e instanceof n?e.toString():!e&&e!==0?"":(e=""+e,s.test(e)?e.replace(i,o):e)}function h(e){return!e&&e!==0?!0:l(e)&&e.length===0?!0:!1}var t={},n=e,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,s=/[&<>"'`]/;t.extend=u;var a=Object.prototype.toString;t.toString=a;var f=function(e){return typeof e=="function"};f(/x/)&&(f=function(e){return typeof e=="function"&&a.call(e)==="[object Function]"});var f;t.isFunction=f;var l=Array.isArray||function(e){return e&&typeof e=="object"?a.call(e)==="[object Array]":!1};return t.isArray=l,t.escapeExpression=c,t.isEmpty=h,t}(e),n=function(){function n(){var e=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<t.length;n++)this[t[n]]=e[t[n]]}var e,t=["description","fileName","lineNumber","message","name","number","stack"];return n.prototype=new Error,e=n,e}(),r=function(e,t){function h(e,t){this.helpers=e||{},this.partials=t||{},p(this)}function p(e){e.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var r=n.inverse||function(){},i=n.fn;return f(t)&&(t=t.call(this)),t===!0?i(this):t===!1||t==null?r(this):a(t)?t.length>0?e.helpers.each(t,n):r(this):i(t)}),e.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i=0,s="",o;f(e)&&(e=e.call(this)),t.data&&(o=m(t.data));if(e&&typeof e=="object")if(a(e))for(var u=e.length;i<u;i++)o&&(o.index=i,o.first=i===0,o.last=i===e.length-1),s+=n(e[i],{data:o});else for(var l in e)e.hasOwnProperty(l)&&(o&&(o.key=l),s+=n(e[l],{data:o}),i++);return i===0&&(s=r(this)),s}),e.registerHelper("if",function(e,t){return f(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){f(e)&&(e=e.call(this));if(!r.isEmpty(e))return t.fn(e)}),e.registerHelper("log",function(t,n){var r=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;e.log(r,t)})}function v(e,t){d.log(e,t)}var n={},r=e,i=t,s="1.1.2";n.VERSION=s;var o=4;n.COMPILER_REVISION=o;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};n.REVISION_CHANGES=u;var a=r.isArray,f=r.isFunction,l=r.toString,c="[object Object]";n.HandlebarsEnvironment=h,h.prototype={constructor:h,logger:d,log:v,registerHelper:function(e,t,n){if(l.call(e)===c){if(n||t)throw new i("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){l.call(e)===c?r.extend(this.partials,e):this.partials[e]=t}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(d.level<=e){var n=d.methodMap[e];typeof console!="undefined"&&console[n]&&console[n].call(console,t)}}};n.logger=d,n.log=v;var m=function(e){var t={};return r.extend(t,e),t};return n.createFrame=m,n}(t,n),i=function(e,t,n){function a(e){var t=e&&e[0]||1,n=o;if(t!==n){if(t<n){var r=u[n],i=u[t];throw new Error("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+i+").")}throw new Error("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function f(e,t){if(!t)throw new Error("No environment passed to template");var n;t.compile?n=function(e,n,r,i,s,o){var u=h.apply(this,arguments);if(u)return u;var a={helpers:i,partials:s,data:o};return s[n]=t.compile(e,{data:o!==undefined},t),s[n](r,a)}:n=function(e,t){var n=h.apply(this,arguments);if(n)return n;throw new s("The partial "+t+" could not be compiled when running in runtime-only mode")};var r={escapeExpression:i.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var r=this.programs[e];return n?r=c(e,t,n):r||(r=this.programs[e]=c(e,t)),r},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},i.extend(n,t),i.extend(n,e)),n},programWithDepth:l,noop:p,compilerInfo:null};return function(n,i){i=i||{};var s=i.partial?i:t,o,u;i.partial||(o=i.helpers,u=i.partials);var f=e.call(r,s,n,o,u,i.data);return i.partial||a(r.compilerInfo),f}}function l(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i}function c(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r}function h(e,t,n,r,i,o){var u={partial:!0,helpers:r,partials:i,data:o};if(e===undefined)throw new s("The partial "+t+" could not be found");if(e instanceof Function)return e(n,u)}function p(){return""}var r={},i=e,s=t,o=n.COMPILER_REVISION,u=n.REVISION_CHANGES;return r.template=f,r.programWithDepth=l,r.program=c,r.invokePartial=h,r.noop=p,r}(t,n,r),s=function(e,t,n,r,i){var s,o=e,u=t,a=n,f=r,l=i,c=function(){var e=new o.HandlebarsEnvironment;return f.extend(e,o),e.SafeString=u,e.Exception=a,e.Utils=f,e.VM=l,e.template=function(t){return l.template(t,e)},e},h=c();return h.create=c,s=h,s}(r,e,n,t,i),o=function(e){function r(e,t,n){this.type="program",this.statements=e,this.strip={},n?(this.inverse=new r(n,t),this.strip.right=t.left):t&&(this.strip.left=t.right)}function i(e,t,n,r){this.type="mustache",this.hash=t,this.strip=r;var i=n[3]||n[2];this.escaped=i!=="{"&&i!=="&";var s=this.id=e[0],o=this.params=e.slice(1),u=this.eligibleHelper=s.isSimple;this.isHelper=u&&(o.length||t)}function s(e,t,n){this.type="partial",this.partialName=e,this.context=t,this.strip=n}function o(e,t,r,i){if(e.id.original!==i.path.original)throw new n(e.id.original+" doesn't match "+i.path.original);this.type="block",this.mustache=e,this.program=t,this.inverse=r,this.strip={left:e.strip.left,right:i.strip.right},(t||r).strip.left=e.strip.right,(r||t).strip.right=i.strip.left,r&&!t&&(this.isInverse=!0)}function u(e){this.type="content",this.string=e}function a(e){this.type="hash",this.pairs=e}function f(e){this.type="ID";var t="",r=[],i=0;for(var s=0,o=e.length;s<o;s++){var u=e[s].part;t+=(e[s].separator||"")+u;if(u===".."||u==="."||u==="this"){if(r.length>0)throw new n("Invalid path: "+t);u===".."?i++:this.isScoped=!0}else r.push(u)}this.original=t,this.parts=r,this.string=r.join("."),this.depth=i,this.isSimple=e.length===1&&!this.isScoped&&i===0,this.stringModeValue=this.string}function l(e){this.type="PARTIAL_NAME",this.name=e.original}function c(e){this.type="DATA",this.id=e}function h(e){this.type="STRING",this.original=this.string=this.stringModeValue=e}function p(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)}function d(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue=e==="true"}function v(e){this.type="comment",this.comment=e}var t={},n=e;return t.ProgramNode=r,t.MustacheNode=i,t.PartialNode=s,t.BlockNode=o,t.ContentNode=u,t.HashNode=a,t.IdNode=f,t.PartialNameNode=l,t.DataNode=c,t.StringNode=h,t.IntegerNode=p,t.BooleanNode=d,t.CommentNode=v,t}(n),u=function(){var e,t=function(){function t(e,t){return{left:e[2]==="~",right:t[0]==="~"||t[1]==="~"}}function r(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(n,r,i,s,o,u,a){var f=u.length-1;switch(o){case 1:return new s.ProgramNode(u[f-1]);case 2:return new s.ProgramNode([]);case 3:this.$=new s.ProgramNode([],u[f-1],u[f]);break;case 4:this.$=new s.ProgramNode(u[f-2],u[f-1],u[f]);break;case 5:this.$=new s.ProgramNode(u[f-1],u[f],[]);break;case 6:this.$=new s.ProgramNode(u[f]);break;case 7:this.$=new s.ProgramNode([]);break;case 8:this.$=new s.ProgramNode([]);break;case 9:this.$=[u[f]];break;case 10:u[f-1].push(u[f]),this.$=u[f-1];break;case 11:this.$=new s.BlockNode(u[f-2],u[f-1].inverse,u[f-1],u[f]);break;case 12:this.$=new s.BlockNode(u[f-2],u[f-1],u[f-1].inverse,u[f]);break;case 13:this.$=u[f];break;case 14:this.$=u[f];break;case 15:this.$=new s.ContentNode(u[f]);break;case 16:this.$=new s.CommentNode(u[f]);break;case 17:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 18:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 19:this.$={path:u[f-1],strip:t(u[f-2],u[f])};break;case 20:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 21:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 22:this.$=new s.PartialNode(u[f-2],u[f-1],t(u[f-3],u[f]));break;case 23:this.$=t(u[f-1],u[f]);break;case 24:this.$=[[u[f-2]].concat(u[f-1]),u[f]];break;case 25:this.$=[[u[f]],null];break;case 26:this.$=u[f];break;case 27:this.$=new s.StringNode(u[f]);break;case 28:this.$=new s.IntegerNode(u[f]);break;case 29:this.$=new s.BooleanNode(u[f]);break;case 30:this.$=u[f];break;case 31:this.$=new s.HashNode(u[f]);break;case 32:this.$=[u[f-2],u[f]];break;case 33:this.$=new s.PartialNameNode(u[f]);break;case 34:this.$=new s.PartialNameNode(new s.StringNode(u[f]));break;case 35:this.$=new s.PartialNameNode(new s.IntegerNode(u[f]));break;case 36:this.$=new s.DataNode(u[f]);break;case 37:this.$=new s.IdNode(u[f]);break;case 38:u[f-2].push({part:u[f],separator:u[f-1]}),this.$=u[f-2];break;case 39:this.$=[{part:u[f]}];break;case 42:this.$=[];break;case 43:u[f-1].push(u[f]);break;case 46:this.$=[u[f]];break;case 47:u[f-1].push(u[f])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:29,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:30,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:31,21:24,30:25,38:[1,28],40:[1,27],41:26},{21:33,26:32,32:[1,34],33:[1,35],38:[1,28],41:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,38:[1,28],40:[1,27],41:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,42],24:[2,42],28:43,32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,25],24:[2,25]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[1,44]},{21:45,38:[1,28],41:26},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],40:[2,39],42:[2,39]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,40],21:50,27:49,38:[1,28],41:26},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{18:[2,35],38:[2,35]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,38:[1,28],41:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,44],21:56,24:[2,44],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:55,36:61,37:62,38:[1,63],40:[1,27],41:26},{38:[1,64]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,65]},{18:[2,41]},{18:[1,66]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24]},{18:[2,43],24:[2,43],32:[2,43],33:[2,43],34:[2,43],38:[2,43],40:[2,43]},{18:[2,45],24:[2,45]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],38:[2,30],40:[2,30]},{18:[2,31],24:[2,31],37:67,38:[1,68]},{18:[2,46],24:[2,46],38:[2,46]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],39:[1,69],40:[2,39],42:[2,39]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{18:[2,47],24:[2,47],38:[2,47]},{39:[1,69]},{21:56,30:60,31:70,32:[1,57],33:[1,58],34:[1,59],38:[1,28],40:[1,27],41:26},{18:[2,32],24:[2,32],38:[2,32]}],defaultActions:{3:[2,2],16:[2,1],50:[2,41]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){function s(e,t){return n.yytext=n.yytext.substr(e,n.yyleng-t)}var o=i;switch(r){case 0:n.yytext.slice(-2)==="\\\\"?(s(0,1),this.begin("mu")):n.yytext.slice(-1)==="\\"?(s(0,1),this.begin("emu")):this.begin("mu");if(n.yytext)return 14;break;case 1:return 14;case 2:return n.yytext.slice(-1)!=="\\"&&this.popState(),n.yytext.slice(-1)==="\\"&&s(0,1),14;case 3:return s(0,4),this.popState(),15;case 4:return 25;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 22;case 11:this.popState(),this.begin("com");break;case 12:return s(3,5),this.popState(),15;case 13:return 22;case 14:return 39;case 15:return 38;case 16:return 38;case 17:return 42;case 18:break;case 19:return this.popState(),24;case 20:return this.popState(),18;case 21:return n.yytext=s(1,2).replace(/\\"/g,'"'),32;case 22:return n.yytext=s(1,2).replace(/\\'/g,"'"),32;case 23:return 40;case 24:return 34;case 25:return 34;case 26:return 33;case 27:return 38;case 28:return n.yytext=s(1,2),38;case 29:return"INVALID";case 30:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s])))/,/^(?:false(?=([~}\s])))/,/^(?:-?[0-9]+(?=([~}\s])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}},e}();return e.lexer=n,r.prototype=e,e.Parser=r,new r}();return e=t,e}(),a=function(e,t){function s(e){return e.constructor===i.ProgramNode?e:(r.yy=i,r.parse(e))}var n={},r=e,i=t;return n.parser=r,n.parse=s,n}(u,o),f=function(e){function s(e){this.value=e}function o(){}var t,n=e.COMPILER_REVISION,r=e.REVISION_CHANGES,i=e.log;o.prototype={nameLookup:function(e,t){var n,r;return e.indexOf("depth")===0&&(n=!0),/^[0-9]+$/.test(t)?r=e+"["+t+"]":o.isValidJavaScriptVariableName(t)?r=e+"."+t:r=e+"['"+t+"']",n?"("+e+" && "+r+")":r},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},i("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var s=e.opcodes,o;this.i=0;for(var u=s.length;this.i<u;this.i++)o=s[this.i],o.opcode==="DECLARE"?this[o.name]=o.value:this[o.opcode].apply(this,o.args),o.opcode!==this.stripNext&&(this.stripNext=!1);return this.pushSource(""),this.createFunctionContext(r)},preamble:function(){var e=[];if(!this.isChild){var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild)for(var s in this.context.aliases)this.context.aliases.hasOwnProperty(s)&&(this.source[1]=this.source[1]+", "+s+"="+this.context.aliases[s]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");var o=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var u=0,a=this.environment.depths.list.length;u<a;u++)o.push("depth"+this.environment.depths.list[u]);var f=this.mergeSource();if(!this.isChild){var l=n,c=r[l];f="this.compilerInfo = ["+l+",'"+c+"'];\n"+f}if(e)return o.push(f),Function.apply(this,o);var h="function "+(this.name||"")+"("+o.join(",")+") {\n  "+f+"}";return i("debug",h+"\n\n"),h},mergeSource:function(){var e="",t;for(var n=0,r=this.source.length;n<r;n++){var i=this.source[n];i.appendToBuffer?t?t=t+"\n    + "+i.content:t=i.content:(t&&(e+="buffer += "+t+";\n  ",t=undefined),e+=i+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),typeof e=="string"?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=undefined,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0),r=this.nameLookup("depth"+this.lastContext,t,"context");this.push(n.name+" || "+r),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") "+": helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),i=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.pushSource("if ("+s+" = "+r+") { "+s+" = "+s+".call("+n.callParams+"); }"),this.pushSource("else { "+s+" = "+i+"; "+s+" = typeof "+s+" === functionType ? "+s+".call("+n.callParams+") : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t=this.popStack(),n,r;this.options.stringParams&&(r=this.popStack(),n=this.popStack());var i=this.hash;n&&i.contexts.push("'"+e+"': "+n),r&&i.types.push("'"+e+"': "+r),i.values.push("'"+e+"': ("+t+")")},compiler:o,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler;var u=this.matchExistingProgram(r);u==null?(this.context.programs.push(""),u=this.context.programs.length,r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context),this.context.environments[u]=r):(r.index=u,r.name="program"+u)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return t}},programExpression:function(e){this.context.aliases.self="this";if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r,i=[t.index,t.name,"data"];for(var s=0,o=n.length;s<o;s++)r=n[s],r===1?i.push("depth0"):i.push("depth"+(r-1));return(n.length===0?"self.program(":"self.programWithDepth(")+i.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new s(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=undefined),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t="",n=this.isInline(),r;if(n){var i=this.popStack(!0);if(i instanceof s)r=i.value;else{var o=this.stackSlot?this.topStackName():this.incrStack();t="("+this.push(o)+" = "+i+"),",r=this.topStack()}}else r=this.topStack();var u=e.call(this,r);return n?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+t+u+")")):(/^stack/.test(r)||(r=this.nextStack()),this.pushSource(r+" = ("+t+u+");")),r},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];r instanceof s?this.compileStack.push(r):this.pushStack(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();return!e&&n instanceof s?n.value:(t||this.stackSlot--,n)},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof s?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var r=[];this.setupParams(e,r,n);var i=this.nameLookup("helpers",t,"helper");return{params:r,name:i,callParams:["depth0"].concat(r).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(r).join(", ")}},setupParams:function(e,t,n){var r=[],i=[],s=[],o,u,a;r.push("hash:"+this.popStack()),u=this.popStack(),a=this.popStack();if(a||u)a||(this.context.aliases.self="this",a="self.noop"),u||(this.context.aliases.self="this",u="self.noop"),r.push("inverse:"+u),r.push("fn:"+a);for(var f=0;f<e;f++)o=this.popStack(),t.push(o),this.options.stringParams&&(s.push(this.popStack()),i.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+i.join(",")+"]"),r.push("types:["+s.join(",")+"]"),r.push("hashContexts:hashContexts"),r.push("hashTypes:hashTypes")),this.options.data&&r.push("data:data"),r="{"+r.join(",")+"}",n?(this.register("options",r),t.push("options")):t.push(r),t.join(", ")}};var u="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),a=o.RESERVED_WORDS={};for(var f=0,l=u.length;f<l;f++)a[u[f]]=!0;return o.isValidJavaScriptVariableName=function(e){return!o.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1},t=o,t}(r),l=function(e,t,n,r){function f(){}function l(e,t){if(e==null||typeof e!="string"&&e.constructor!==a.ProgramNode)throw new s("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var n=o(e),r=(new f).compile(n,t);return(new u).compile(r,t)}function c(e,t,n){function i(){var r=o(e),i=(new f).compile(r,t),s=(new u).compile(i,t,undefined,!0);return n.template(s)}if(e==null||typeof e!="string"&&e.constructor!==a.ProgramNode)throw new s("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var r;return function(e,t){return r||(r=i()),r.call(this,e,t)}}var i={},s=e,o=t.parse,u=n,a=r;return i.Compiler=f,f.prototype={compiler:f,disassemble:function(){var e=this.opcodes,t,n=[],r,i;for(var s=0,o=e.length;s<o;s++){t=e[s];if(t.opcode==="DECLARE")n.push("DECLARE "+t.name+"="+t.value);else{r=[];for(var u=0;u<t.args.length;u++)i=t.args[u],typeof i=="string"&&(i='"'+i.replace("\n","\\n")+'"'),r.push(i);n.push(t.opcode+" "+r.join(" "))}}return n.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||r.args.length!==i.args.length)return!1;for(var s=0;s<r.args.length;s++)if(r.args[s]!==i.args[s])return!1}t=this.children.length;if(e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.accept(e)},accept:function(e){var t=e.strip||{},n;return t.left&&this.opcode("strip"),n=this[e.type](e),t.right&&this.opcode("strip"),n},program:function(e){var t=e.statements;for(var n=0,r=t.length;n<r;n++)this.accept(t[n]);return this.isSimple=r===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++,r;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var i=0,s=t.depths.list.length;i<s;i++){r=t.depths.list[i];if(r<2)continue;this.addDepth(r-1)}return n},block:function(e){var t=e.mustache,n=e.program,r=e.inverse;n&&(n=this.compileProgram(n)),r&&(r=this.compileProgram(r));var i=this.classifyMustache(t);i==="helper"?this.helperMustache(t,n,r):i==="simple"?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("pushHash");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.options.stringParams?(r.depth&&this.addDepth(r.depth),this.opcode("getContext",r.depth||0),this.opcode("pushStringParam",r.stringModeValue,r.type)):this.accept(r),this.opcode("assignToHash",n[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);n==="simple"?this.simpleMustache(e):n==="helper"?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var r=e.id,i=r.parts[0],s=t!=null||n!=null;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",i,s)},simpleMustache:function(e){var t=e.id;t.type==="DATA"?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var r=this.setupFullMustacheParams(e,t,n),i=e.id.parts[0];if(this.options.knownHelpers[i])this.opcode("invokeKnownHelper",r.length,i);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+i);this.opcode("invokeHelper",r.length,i)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,r=e.parts.length;n<r;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){this.options.data=!0;if(e.id.isScoped||e.id.depth)throw new s("Scoped data references are not supported: "+e.original);this.opcode("lookupData");var t=e.id.parts;for(var n=0,r=t.length;n<r;n++)this.opcode("lookup",t[n])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,r=this.options;if(n&&!t){var i=e.id.parts[0];r.knownHelpers[i]?t=!0:r.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this[n.type](n)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),r}},i.precompile=l,i.compile=c,i}(n,a,f,o),c=function(e,t,n,r,i){var s,o=e,u=t,a=n.parser,f=n.parse,l=r.Compiler,c=r.compile,h=r.precompile,p=i,d=o.create,v=function(){var e=d();return e.compile=function(t,n){return c(t,n,e)},e.precompile=h,e.AST=u,e.Compiler=l,e.JavaScriptCompiler=p,e.Parser=a,e.parse=f,e};return o=v(),o.create=v,s=o,s}(s,o,a,l,f);return c}();return e});if(typeof jQuery=="undefined")throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(e.style[n]!==undefined)return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t();if(!e.support.transition)return;e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){if(e(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}}})}(jQuery),+function(e){function r(t){return this.each(function(){var r=e(this),i=r.data("bs.alert");i||r.data("bs.alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})}var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.VERSION="3.2.0",n.prototype.close=function(t){function s(){i.detach().trigger("closed.bs.alert").remove()}var n=e(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var i=e(r);t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close.bs.alert"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",s).emulateTransitionEnd(150):s()};var i=e.fn.alert;e.fn.alert=r,e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s=typeof n=="object"&&n;i||r.data("bs.button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})}var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.isLoading=!1};t.VERSION="3.2.0",t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(t){var n="disabled",r=this.$element,i=r.is("input")?"val":"html",s=r.data();t+="Text",s.resetText==null&&r.data("resetText",r[i]()),r[i](s[t]==null?this.options[t]:s[t]),setTimeout(e.proxy(function(){t=="loadingText"?(this.isLoading=!0,r.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,r.removeClass(n).removeAttr(n))},this),0)},t.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");n.prop("type")=="radio"&&(n.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}e&&this.$element.toggleClass("active")};var r=e.fn.button;e.fn.button=n,e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=r,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(t){var r=e(t.target);r.hasClass("btn")||(r=r.closest(".btn")),n.call(r,"toggle"),t.preventDefault()})}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("bs.carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})}var t=function(t,n){this.$element=e(t).on("keydown.bs.carousel",e.proxy(this.keydown,this)),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.pause=="hover"&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};t.VERSION="3.2.0",t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.keydown=function(e){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},t.prototype.to=function(t){var n=this,r=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){if(this.sliding)return;return this.slide("next")},t.prototype.prev=function(){if(this.sliding)return;return this.slide("prev")},t.prototype.slide=function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[u]()}if(i.hasClass("active"))return this.sliding=!1;var f=i[0],l=e.Event("slide.bs.carousel",{relatedTarget:f,direction:o});this.$element.trigger(l);if(l.isDefaultPrevented())return;this.sliding=!0,s&&this.pause();if(this.$indicators.length){this.$indicators.find(".active").removeClass("active");var c=e(this.$indicators.children()[this.getItemIndex(i)]);c&&c.addClass("active")}var h=e.Event("slid.bs.carousel",{relatedTarget:f,direction:o});return e.support.transition&&this.$element.hasClass("slide")?(i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),r.one("bsTransitionEnd",function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger(h)},0)}).emulateTransitionEnd(r.css("transition-duration").slice(0,-1)*1e3)):(r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger(h)),s&&this.cycle(),this};var r=e.fn.carousel;e.fn.carousel=n,e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=r,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var r,i=e(this),s=e(i.attr("data-target")||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""));if(!s.hasClass("carousel"))return;var o=e.extend({},s.data(),i.data()),u=i.attr("data-slide-to");u&&(o.interval=!1),n.call(s,o),u&&s.data("bs.carousel").to(u),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n);!i&&s.toggle&&n=="show"&&(n=!n),i||r.data("bs.collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})}var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.VERSION="3.2.0",t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var t=e.Event("show.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var r=this.$parent&&this.$parent.find("> .panel > .in");if(r&&r.length){var i=r.data("bs.collapse");if(i&&i.transitioning)return;n.call(r,"hide"),i||r.data("bs.collapse",null)}var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0),this.transitioning=1;var o=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return o.call(this);var u=e.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",e.proxy(o,this)).emulateTransitionEnd(350)[s](this.$element[0][u])},t.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var t=e.Event("hide.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one("bsTransitionEnd",e.proxy(r,this)).emulateTransitionEnd(350)},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var r=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=r,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(t){var r,i=e(this),s=i.attr("data-target")||t.preventDefault()||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),o=e(s),u=o.data("bs.collapse"),a=u?"toggle":i.data(),f=i.attr("data-parent"),l=f&&e(f);if(!u||!u.transitioning)l&&l.find('[data-toggle="collapse"][data-parent="'+f+'"]').not(i).addClass("collapsed"),i[o.hasClass("in")?"addClass":"removeClass"]("collapsed");n.call(o,a)})}(jQuery),+function(e){function i(r){if(r&&r.which===3)return;e(t).remove(),e(n).each(function(){var t=s(e(this)),n={relatedTarget:this};if(!t.hasClass("open"))return;t.trigger(r=e.Event("hide.bs.dropdown",n));if(r.isDefaultPrevented())return;t.removeClass("open").trigger("hidden.bs.dropdown",n)})}function s(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function o(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new r(this)),typeof t=="string"&&i[t].call(n)})}var t=".dropdown-backdrop",n='[data-toggle="dropdown"]',r=function(t){e(t).on("click.bs.dropdown",this.toggle)};r.VERSION="3.2.0",r.prototype.toggle=function(t){var n=e(this);if(n.is(".disabled, :disabled"))return;var r=s(n),o=r.hasClass("open");i();if(!o){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",i);var u={relatedTarget:this};r.trigger(t=e.Event("show.bs.dropdown",u));if(t.isDefaultPrevented())return;n.trigger("focus"),r.toggleClass("open").trigger("shown.bs.dropdown",u)}return!1},r.prototype.keydown=function(t){if(!/(38|40|27)/.test(t.keyCode))return;var r=e(this);t.preventDefault(),t.stopPropagation();if(r.is(".disabled, :disabled"))return;var i=s(r),o=i.hasClass("open");if(!o||o&&t.keyCode==27)return t.which==27&&i.find(n).trigger("focus"),r.trigger("click");var u=" li:not(.divider):visible a",a=i.find('[role="menu"]'+u+', [role="listbox"]'+u);if(!a.length)return;var f=a.index(a.filter(":focus"));t.keyCode==38&&f>0&&f--,t.keyCode==40&&f<a.length-1&&f++,~f||(f=0),a.eq(f).trigger("focus")};var u=e.fn.dropdown;e.fn.dropdown=o,e.fn.dropdown.Constructor=r,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",n,r.prototype.toggle).on("keydown.bs.dropdown.data-api",n+', [role="menu"], [role="listbox"]',r.prototype.keydown)}(jQuery),+function(e){function n(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),typeof n=="object"&&n);s||i.data("bs.modal",s=new t(this,o)),typeof n=="string"?s[n](r):o.show&&s.show(r)})}var t=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};t.VERSION="3.2.0",t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r);if(this.isShown||r.isDefaultPrevented())return;this.isShown=!0,this.checkScrollbar(),this.$body.addClass("modal-open"),this.setScrollbar(),this.escape(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(n.$body),n.$element.show().scrollTop(0),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one("bsTransitionEnd",function(){n.$element.trigger("focus").trigger(i)}).emulateTransitionEnd(300):n.$element.trigger("focus").trigger(i)})},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.$body.removeClass("modal-open"),this.resetScrollbar(),this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]!==e.target&&!this.$element.has(e.target).length&&this.$element.trigger("focus")},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){e.which==27&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(150):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){n.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(150):s()}else t&&t()},t.prototype.checkScrollbar=function(){if(document.body.clientWidth>=window.innerWidth)return;this.scrollbarWidth=this.scrollbarWidth||this.measureScrollbar()},t.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.scrollbarWidth&&this.$body.css("padding-right",e+this.scrollbarWidth)},t.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},t.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=n,e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&t.preventDefault(),s.one("show.bs.modal",function(e){if(e.isDefaultPrevented())return;s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),n.call(s,o,this)})}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s=typeof n=="object"&&n;if(!i&&/destroy|hide/.test(n))return;i||r.data("bs.tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})}var t=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};t.VERSION="3.3.6",t.TRANSITION_DURATION=150,t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},t.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1};if(this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");var i=this.options.trigger.split(" ");for(var s=i.length;s--;){var o=i[s];if(o=="click")this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if(o!="manual"){var u=o=="hover"?"mouseenter":"focusin",a=o=="hover"?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState[t.type=="focusin"?"focus":"hover"]=!0);if(n.tip().hasClass("in")||n.hoverState=="in"){n.hoverState="in";return}clearTimeout(n.timeout),n.hoverState="in";if(!n.options.delay||!n.options.delay.show)return n.show();n.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},t.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState[t.type=="focusout"?"focus":"hover"]=!1);if(n.isInStateTrue())return;clearTimeout(n.timeout),n.hoverState="out";if(!n.options.delay||!n.options.delay.hide)return n.hide();n.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},t.prototype.show=function(){var n=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(n);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(n.isDefaultPrevented()||!r)return;var i=this,s=this.tip(),o=this.getUID(this.type);this.setContent(),s.attr("id",o),this.$element.attr("aria-describedby",o),this.options.animation&&s.addClass("fade");var u=typeof this.options.placement=="function"?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,a=/\s?auto?\s?/i,f=a.test(u);f&&(u=u.replace(a,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(u).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var l=this.getPosition(),c=s[0].offsetWidth,h=s[0].offsetHeight;if(f){var p=u,d=this.getPosition(this.$viewport);u=u=="bottom"&&l.bottom+h>d.bottom?"top":u=="top"&&l.top-h<d.top?"bottom":u=="right"&&l.right+c>d.width?"left":u=="left"&&l.left-c<d.left?"right":u,s.removeClass(p).addClass(u)}var v=this.getCalculatedOffset(u,l,c,h);this.applyPlacement(v,u);var m=function(){var e=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,e=="out"&&i.leave(i)};e.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",m).emulateTransitionEnd(t.TRANSITION_DURATION):m()}},t.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top+=o,t.left+=u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;n=="top"&&f!=s&&(t.top=t.top+s-f);var l=this.getViewportAdjustedDelta(n,t,a,f);l.left?t.left+=l.left:t.top+=l.top;var c=/top|bottom/.test(n),h=c?l.left*2-i+a:l.top*2-s+f,p=c?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(h,r[0][p],c)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(n){function o(){r.hoverState!="in"&&i.detach(),r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),n&&n()}var r=this,i=e(this.$tip),s=e.Event("hide.bs."+this.type);this.$element.trigger(s);if(s.isDefaultPrevented())return;return i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.one("bsTransitionEnd",o).emulateTransitionEnd(t.TRANSITION_DURATION):o(),this.hoverState=null,this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r=n.tagName=="BODY",i=n.getBoundingClientRect();i.width==null&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},t.prototype.getCalculatedOffset=function(e,t,n,r){return e=="bottom"?{top:t.top+t.height,left:t.left+t.width/2-n/2}:e=="top"?{top:t.top-r,left:t.left+t.width/2-n/2}:e=="left"?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.right&&(i.left=o.left+o.width-l)}return i},t.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},t.prototype.getUID=function(e){do e+=~~(Math.random()*1e6);while(document.getElementById(e));return e},t.prototype.tip=function(){if(!this.$tip){this.$tip=e(this.options.template);if(this.$tip.length!=1)throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!")}return this.$tip},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null})};var r=e.fn.tooltip;e.fn.tooltip=n,e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s=typeof n=="object"&&n;if(!i&&/destroy|hide/.test(n))return;i||r.data("bs.popover",i=new t(this,s)),typeof n=="string"&&i[n]()})}var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.VERSION="3.3.6",t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?typeof n=="string"?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||(typeof t.content=="function"?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var r=e.fn.popover;e.fn.popover=n,e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){function t(n,r){var i=e.proxy(this.process,this);this.$body=e("body"),this.$scrollElement=e(n).is("body")?e(window):e(n),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",i),this.refresh(),this.process()}function n(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s=typeof n=="object"&&n;i||r.data("bs.scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})}t.VERSION="3.2.0",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t="offset",n=0;e.isWindow(this.$scrollElement[0])||(t="position",n=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var r=this;this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#./.test(i)&&e(i);return s&&s.length&&s.is(":visible")&&[[s[t]().top+n,i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){r.offsets.push(this[0]),r.targets.push(this[1])})},t.prototype.process=function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.getScrollHeight(),n=this.options.offset+t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;this.scrollHeight!=t&&this.refresh();if(e>=n)return s!=(o=i[i.length-1])&&this.activate(o);if(s&&e<=r[0])return s!=(o=i[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parentsUntil(this.options.target,".active").removeClass("active");var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")};var r=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=r,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new t(this)),typeof n=="string"&&i[n]()})}var t=function(t){this.element=e(t)};t.VERSION="3.2.0",t.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;var i=n.find(".active:last a")[0],s=e.Event("show.bs.tab",{relatedTarget:i});t.trigger(s);if(s.isDefaultPrevented())return;var o=e(r);this.activate(t.closest("li"),n),this.activate(o,o.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:i})})},t.prototype.activate=function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one("bsTransitionEnd",o).emulateTransitionEnd(150):o(),i.removeClass("in")};var r=e.fn.tab;e.fn.tab=n,e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=r,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),n.call(e(this),"show")})}(jQuery),+function(e){function n(n){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s=typeof n=="object"&&n;i||r.data("bs.affix",i=new t(this,s)),typeof n=="string"&&i[n]()})}var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(n),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};t.VERSION="3.2.0",t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0,target:window},t.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(t.RESET).addClass("affix");var e=this.$target.scrollTop(),n=this.$element.offset();return this.pinnedOffset=n.top-e},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var n=e(document).height(),r=this.$target.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.top,u=s.bottom;typeof s!="object"&&(u=o=s),typeof o=="function"&&(o=s.top(this.$element)),typeof u=="function"&&(u=s.bottom(this.$element));var a=this.unpin!=null&&r+this.unpin<=i.top?!1:u!=null&&i.top+this.$element.height()>=n-u?"bottom":o!=null&&r<=o?"top":!1;if(this.affixed===a)return;this.unpin!=null&&this.$element.css("top","");var f="affix"+(a?"-"+a:""),l=e.Event(f+".bs.affix");this.$element.trigger(l);if(l.isDefaultPrevented())return;this.affixed=a,this.unpin=a=="bottom"?this.getPinnedOffset():null,this.$element.removeClass(t.RESET).addClass(f).trigger(e.Event(f.replace("affix","affixed"))),a=="bottom"&&this.$element.offset({top:n-this.$element.height()-u})};var r=e.fn.affix;e.fn.affix=n,e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=r,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),r=t.data();r.offset=r.offset||{},r.offsetBottom&&(r.offset.bottom=r.offsetBottom),r.offsetTop&&(r.offset.top=r.offsetTop),n.call(t,r)})})}(jQuery),define("bootstrap",["jquery"],function(){}),function(e,t){function r(){return new Date(Date.UTC.apply(Date,arguments))}function i(){var e=new Date;return r(e.getFullYear(),e.getMonth(),e.getDate())}function s(e){return function(){return this[e].apply(this,arguments)}}function f(t,n){function u(e,t){return t.toLowerCase()}var r=e(t).data(),i={},s,o=new RegExp("^"+n.toLowerCase()+"([A-Z])");n=new RegExp("^"+n.toLowerCase());for(var a in r)n.test(a)&&(s=a.replace(o,u),i[s]=r[a]);return i}function l(t){var n={};if(!d[t]){t=t.split("-")[0];if(!d[t])return}var r=d[t];return e.each(p,function(e,t){t in r&&(n[t]=r[t])}),n}var n=e(window),o=function(){var t={get:function(e){return this.slice(e)[0]},contains:function(e){var t=e&&e.valueOf();for(var n=0,r=this.length;n<r;n++)if(this[n].valueOf()===t)return n;return-1},remove:function(e){this.splice(e,1)},replace:function(t){if(!t)return;e.isArray(t)||(t=[t]),this.clear(),this.push.apply(this,t)},clear:function(){this.length=0},copy:function(){var e=new o;return e.replace(this),e}};return function(){var n=[];return n.push.apply(n,arguments),e.extend(n,t),n}}(),u=function(t,n){this.dates=new o,this.viewDate=i(),this.focusDate=null,this._process_options(n),this.element=e(t),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.is(".date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&this.component.length===0&&(this.component=!1),this.picker=e(v.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot th.today").attr("colspan",function(e,t){return parseInt(t)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};u.prototype={constructor:u,_process_options:function(t){this._o=e.extend({},this._o,t);var n=this.o=e.extend({},this._o),r=n.language;d[r]||(r=r.split("-")[0],d[r]||(r=h.language)),n.language=r;switch(n.startView){case 2:case"decade":n.startView=2;break;case 1:case"year":n.startView=1;break;default:n.startView=0}switch(n.minViewMode){case 1:case"months":n.minViewMode=1;break;case 2:case"years":n.minViewMode=2;break;default:n.minViewMode=0}n.startView=Math.max(n.startView,n.minViewMode),n.multidate!==!0&&(n.multidate=Number(n.multidate)||!1,n.multidate!==!1?n.multidate=Math.max(0,n.multidate):n.multidate=1),n.multidateSeparator=String(n.multidateSeparator),n.weekStart%=7,n.weekEnd=(n.weekStart+6)%7;var i=v.parseFormat(n.format);n.startDate!==-Infinity&&(n.startDate?n.startDate instanceof Date?n.startDate=this._local_to_utc(this._zero_time(n.startDate)):n.startDate=v.parseDate(n.startDate,i,n.language):n.startDate=-Infinity),n.endDate!==Infinity&&(n.endDate?n.endDate instanceof Date?n.endDate=this._local_to_utc(this._zero_time(n.endDate)):n.endDate=v.parseDate(n.endDate,i,n.language):n.endDate=Infinity),n.daysOfWeekDisabled=n.daysOfWeekDisabled||[],e.isArray(n.daysOfWeekDisabled)||(n.daysOfWeekDisabled=n.daysOfWeekDisabled.split(/[,\s]*/)),n.daysOfWeekDisabled=e.map(n.daysOfWeekDisabled,function(e){return parseInt(e,10)});var s=String(n.orientation).toLowerCase().split(/\s+/g),o=n.orientation.toLowerCase();s=e.grep(s,function(e){return/^auto|left|right|top|bottom$/.test(e)}),n.orientation={x:"auto",y:"auto"};if(!!o&&o!=="auto")if(s.length===1)switch(s[0]){case"top":case"bottom":n.orientation.y=s[0];break;case"left":case"right":n.orientation.x=s[0]}else o=e.grep(s,function(e){return/^left|right$/.test(e)}),n.orientation.x=o[0]||"auto",o=e.grep(s,function(e){return/^top|bottom$/.test(e)}),n.orientation.y=o[0]||"auto"},_events:[],_secondaryEvents:[],_applyEvents:function(e){for(var n=0,r,i,s;n<e.length;n++)r=e[n][0],e[n].length===2?(i=t,s=e[n][1]):e[n].length===3&&(i=e[n][1],s=e[n][2]),r.on(s,i)},_unapplyEvents:function(e){for(var n=0,r,i,s;n<e.length;n++)r=e[n][0],e[n].length===2?(s=t,i=e[n][1]):e[n].length===3&&(s=e[n][1],i=e[n][2]),r.off(i,s)},_buildEvents:function(){this.isInput?this._events=[[this.element,{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])===-1&&this.update()},this),keydown:e.proxy(this.keydown,this)}]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),{focus:e.proxy(this.show,this),keyup:e.proxy(function(t){e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])===-1&&this.update()},this),keydown:e.proxy(this.keydown,this)}],[this.component,{click:e.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:e.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:e.proxy(function(e){this._focused_from=e.target},this)}],[this.element,{blur:e.proxy(function(e){this._focused_from=e.target},this)}]),this._secondaryEvents=[[this.picker,{click:e.proxy(this.click,this)}],[e(window),{resize:e.proxy(this.place,this)}],[e(document),{"mousedown touchstart":e.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(t,n){var r=n||this.dates.get(-1),i=this._utc_to_local(r);this.element.trigger({type:t,date:i,dates:e.map(this.dates,this._utc_to_local),format:e.proxy(function(e,t){arguments.length===0?(e=this.dates.length-1,t=this.o.format):typeof e=="string"&&(t=e,e=this.dates.length-1),t=t||this.o.format;var n=this.dates.get(e);return v.formatDate(n,t,this.o.language)},this)})},show:function(){this.isInline||this.picker.appendTo("body"),this.picker.show(),this.place(),this._attachSecondaryEvents(),this._trigger("show")},hide:function(){if(this.isInline)return;if(!this.picker.is(":visible"))return;this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide")},remove:function(){this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date},_utc_to_local:function(e){return e&&new Date(e.getTime()+e.getTimezoneOffset()*6e4)},_local_to_utc:function(e){return e&&new Date(e.getTime()-e.getTimezoneOffset()*6e4)},_zero_time:function(e){return e&&new Date(e.getFullYear(),e.getMonth(),e.getDate())},_zero_utc_time:function(e){return e&&new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))},getDates:function(){return e.map(this.dates,this._utc_to_local)},getUTCDates:function(){return e.map(this.dates,function(e){return new Date(e)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){return new Date(this.dates.get(-1))},setDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,t),this._trigger("changeDate"),this.setValue()},setUTCDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;this.update.apply(this,e.map(t,this._utc_to_local)),this._trigger("changeDate"),this.setValue()},setDate:s("setDates"),setUTCDate:s("setUTCDates"),setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e).change():this.component&&this.element.find("input").val(e).change()},getFormattedDate:function(n){n===t&&(n=this.o.format);var r=this.o.language;return e.map(this.dates,function(e){return v.formatDate(e,n,r)}).join(this.o.multidateSeparator)},setStartDate:function(e){this._process_options({startDate:e}),this.update(),this.updateNavArrows()},setEndDate:function(e){this._process_options({endDate:e}),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this._process_options({daysOfWeekDisabled:e}),this.update(),this.updateNavArrows()},place:function(){if(this.isInline)return;var t=this.picker.outerWidth(),r=this.picker.outerHeight(),i=10,s=n.width(),o=n.height(),u=n.scrollTop(),a=parseInt(this.element.parents().filter(function(){return e(this).css("z-index")!=="auto"}).first().css("z-index"))+10,f=this.component?this.component.parent().offset():this.element.offset(),l=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),c=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),h=f.left,p=f.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),this.o.orientation.x!=="auto"?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),this.o.orientation.x==="right"&&(h-=t-c)):(this.picker.addClass("datepicker-orient-left"),f.left<0?h-=f.left-i:f.left+t>s&&(h=s-t-i));var d=this.o.orientation.y,v,m;d==="auto"&&(v=-u+f.top-r,m=u+o-(f.top+l+r),Math.max(v,m)===m?d="top":d="bottom"),this.picker.addClass("datepicker-orient-"+d),d==="top"?p+=l:p-=r+parseInt(this.picker.css("padding-top")),this.picker.css({top:p,left:h,zIndex:a})},_allow_update:!0,update:function(){if(!this._allow_update)return;var t=this.dates.copy(),n=[],r=!1;arguments.length?(e.each(arguments,e.proxy(function(e,t){t instanceof Date&&(t=this._local_to_utc(t)),n.push(t)},this)),r=!0):(n=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),n&&this.o.multidate?n=n.split(this.o.multidateSeparator):n=[n],delete this.element.data().date),n=e.map(n,e.proxy(function(e){return v.parseDate(e,this.o.format,this.o.language)},this)),n=e.grep(n,e.proxy(function(e){return e<this.o.startDate||e>this.o.endDate||!e},this),!0),this.dates.replace(n),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),r?this.setValue():n.length&&String(t)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&t.length&&this._trigger("clearDate"),this.fill()},fillDow:function(){var e=this.o.weekStart,t="<tr>";if(this.o.calendarWeeks){var n='<th class="cw">&nbsp;</th>';t+=n,this.picker.find(".datepicker-days thead tr:first-child").prepend(n)}while(e<this.o.weekStart+7)t+='<th class="dow">'+d[this.o.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){var e="",t=0;while(t<12)e+='<span class="month">'+d[this.o.language].monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").html(e)},setRange:function(t){!t||!t.length?delete this.range:this.range=e.map(t,function(e){return e.valueOf()}),this.fill()},getClassNames:function(t){var n=[],r=this.viewDate.getUTCFullYear(),i=this.viewDate.getUTCMonth(),s=new Date;return t.getUTCFullYear()<r||t.getUTCFullYear()===r&&t.getUTCMonth()<i?n.push("old"):(t.getUTCFullYear()>r||t.getUTCFullYear()===r&&t.getUTCMonth()>i)&&n.push("new"),this.focusDate&&t.valueOf()===this.focusDate.valueOf()&&n.push("focused"),this.o.todayHighlight&&t.getUTCFullYear()===s.getFullYear()&&t.getUTCMonth()===s.getMonth()&&t.getUTCDate()===s.getDate()&&n.push("today"),this.dates.contains(t)!==-1&&n.push("active"),(t.valueOf()<this.o.startDate||t.valueOf()>this.o.endDate||e.inArray(t.getUTCDay(),this.o.daysOfWeekDisabled)!==-1)&&n.push("disabled"),this.range&&(t>this.range[0]&&t<this.range[this.range.length-1]&&n.push("range"),e.inArray(t.valueOf(),this.range)!==-1&&n.push("selected")),n},fill:function(){var n=new Date(this.viewDate),i=n.getUTCFullYear(),s=n.getUTCMonth(),o=this.o.startDate!==-Infinity?this.o.startDate.getUTCFullYear():-Infinity,u=this.o.startDate!==-Infinity?this.o.startDate.getUTCMonth():-Infinity,a=this.o.endDate!==Infinity?this.o.endDate.getUTCFullYear():Infinity,f=this.o.endDate!==Infinity?this.o.endDate.getUTCMonth():Infinity,l=d[this.o.language].today||d.en.today||"",c=d[this.o.language].clear||d.en.clear||"",h;this.picker.find(".datepicker-days thead th.datepicker-switch").text(d[this.o.language].months[s]+" "+i),this.picker.find("tfoot th.today").text(l).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot th.clear").text(c).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=r(i,s-1,28),m=v.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(m),p.setUTCDate(m-(p.getUTCDay()-this.o.weekStart+7)%7);var g=new Date(p);g.setUTCDate(g.getUTCDate()+42),g=g.valueOf();var y=[],b;while(p.valueOf()<g){if(p.getUTCDay()===this.o.weekStart){y.push("<tr>");if(this.o.calendarWeeks){var w=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),E=new Date(Number(w)+(11-w.getUTCDay())%7*864e5),S=new Date(Number(S=r(E.getUTCFullYear(),0,1))+(11-S.getUTCDay())%7*864e5),x=(E-S)/864e5/7+1;y.push('<td class="cw">'+x+"</td>")}}b=this.getClassNames(p),b.push("day");if(this.o.beforeShowDay!==e.noop){var T=this.o.beforeShowDay(this._utc_to_local(p));T===t?T={}:typeof T=="boolean"?T={enabled:T}:typeof T=="string"&&(T={classes:T}),T.enabled===!1&&b.push("disabled"),T.classes&&(b=b.concat(T.classes.split(/\s+/))),T.tooltip&&(h=T.tooltip)}b=e.unique(b),y.push('<td class="'+b.join(" ")+'"'+(h?' title="'+h+'"':"")+">"+p.getUTCDate()+"</td>"),p.getUTCDay()===this.o.weekEnd&&y.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(y.join(""));var N=this.picker.find(".datepicker-months").find("th:eq(1)").text(i).end().find("span").removeClass("active");e.each(this.dates,function(e,t){t.getUTCFullYear()===i&&N.eq(t.getUTCMonth()).addClass("active")}),(i<o||i>a)&&N.addClass("disabled"),i===o&&N.slice(0,u).addClass("disabled"),i===a&&N.slice(f+1).addClass("disabled"),y="",i=parseInt(i/10,10)*10;var C=this.picker.find(".datepicker-years").find("th:eq(1)").text(i+"-"+(i+9)).end().find("td");i-=1;var k=e.map(this.dates,function(e){return e.getUTCFullYear()}),L;for(var A=-1;A<11;A++)L=["year"],A===-1?L.push("old"):A===10&&L.push("new"),e.inArray(i,k)!==-1&&L.push("active"),(i<o||i>a)&&L.push("disabled"),y+='<span class="'+L.join(" ")+'">'+i+"</span>",i+=1;C.html(y)},updateNavArrows:function(){if(!this._allow_update)return;var e=new Date(this.viewDate),t=e.getUTCFullYear(),n=e.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-Infinity&&t<=this.o.startDate.getUTCFullYear()&&n<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==Infinity&&t>=this.o.endDate.getUTCFullYear()&&n>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-Infinity&&t<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==Infinity&&t>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},click:function(t){t.preventDefault();var n=e(t.target).closest("span, td, th"),i,s,o;if(n.length===1)switch(n[0].nodeName.toLowerCase()){case"th":switch(n[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var u=v.modes[this.viewMode].navStep*(n[0].className==="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,u),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,u),this.viewMode===1&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var a=new Date;a=r(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),this.showMode(-2);var f=this.o.todayBtn==="linked"?null:"view";this._setDate(a,f);break;case"clear":var l;this.isInput?l=this.element:this.component&&(l=this.element.find("input")),l&&l.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()}break;case"span":n.is(".disabled")||(this.viewDate.setUTCDate(1),n.is(".month")?(o=1,s=n.parent().find("span").index(n),i=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(s),this._trigger("changeMonth",this.viewDate),this.o.minViewMode===1&&this._setDate(r(i,s,o))):(o=1,s=0,i=parseInt(n.text(),10)||0,this.viewDate.setUTCFullYear(i),this._trigger("changeYear",this.viewDate),this.o.minViewMode===2&&this._setDate(r(i,s,o))),this.showMode(-1),this.fill());break;case"td":n.is(".day")&&!n.is(".disabled")&&(o=parseInt(n.text(),10)||1,i=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),n.is(".old")?s===0?(s=11,i-=1):s-=1:n.is(".new")&&(s===11?(s=0,i+=1):s+=1),this._setDate(r(i,s,o)))}this.picker.is(":visible")&&this._focused_from&&e(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(e){var t=this.dates.contains(e);e?t!==-1?this.dates.remove(t):this.dates.push(e):this.dates.clear();if(typeof this.o.multidate=="number")while(this.dates.length>this.o.multidate)this.dates.remove(0)},_setDate:function(e,t){(!t||t==="date")&&this._toggle_multidate(e&&new Date(e));if(!t||t==="view")this.viewDate=e&&new Date(e);this.fill(),this.setValue(),this._trigger("changeDate");var n;this.isInput?n=this.element:this.component&&(n=this.element.find("input")),n&&n.change(),this.o.autoclose&&(!t||t==="date")&&this.hide()},moveMonth:function(e,n){if(!e)return t;if(!n)return e;var r=new Date(e.valueOf()),i=r.getUTCDate(),s=r.getUTCMonth(),o=Math.abs(n),u,a;n=n>0?1:-1;if(o===1){a=n===-1?function(){return r.getUTCMonth()===s}:function(){return r.getUTCMonth()!==u},u=s+n,r.setUTCMonth(u);if(u<0||u>11)u=(u+12)%12}else{for(var f=0;f<o;f++)r=this.moveMonth(r,n);u=r.getUTCMonth(),r.setUTCDate(i),a=function(){return u!==r.getUTCMonth()}}while(a())r.setUTCDate(--i),r.setUTCMonth(u);return r},moveYear:function(e,t){return this.moveMonth(e,t*12)},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(this.picker.is(":not(:visible)")){e.keyCode===27&&this.show();return}var t=!1,n,r,s,o=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;n=e.keyCode===37?-1:1,e.ctrlKey?(r=this.moveYear(this.dates.get(-1)||i(),n),s=this.moveYear(o,n),this._trigger("changeYear",this.viewDate)):e.shiftKey?(r=this.moveMonth(this.dates.get(-1)||i(),n),s=this.moveMonth(o,n),this._trigger("changeMonth",this.viewDate)):(r=new Date(this.dates.get(-1)||i()),r.setUTCDate(r.getUTCDate()+n),s=new Date(o),s.setUTCDate(o.getUTCDate()+n)),this.dateWithinRange(r)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),e.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;n=e.keyCode===38?-1:1,e.ctrlKey?(r=this.moveYear(this.dates.get(-1)||i(),n),s=this.moveYear(o,n),this._trigger("changeYear",this.viewDate)):e.shiftKey?(r=this.moveMonth(this.dates.get(-1)||i(),n),s=this.moveMonth(o,n),this._trigger("changeMonth",this.viewDate)):(r=new Date(this.dates.get(-1)||i()),r.setUTCDate(r.getUTCDate()+n*7),s=new Date(o),s.setUTCDate(o.getUTCDate()+n*7)),this.dateWithinRange(r)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),e.preventDefault());break;case 32:break;case 13:o=this.focusDate||this.dates.get(-1)||this.viewDate,this._toggle_multidate(o),t=!0,this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(t){this.dates.length?this._trigger("changeDate"):this._trigger("clearDate");var u;this.isInput?u=this.element:this.component&&(u=this.element.find("input")),u&&u.change()}},showMode:function(e){e&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".datepicker-"+v.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var a=function(t,n){this.element=e(t),this.inputs=e.map(n.inputs,function(e){return e.jquery?e[0]:e}),delete n.inputs,e(this.inputs).datepicker(n).bind("changeDate",e.proxy(this.dateUpdated,this)),this.pickers=e.map(this.inputs,function(t){return e(t).data("datepicker")}),this.updateDates()};a.prototype={updateDates:function(){this.dates=e.map(this.pickers,function(e){return e.getUTCDate()}),this.updateRanges()},updateRanges:function(){var t=e.map(this.dates,function(e){return e.valueOf()});e.each(this.pickers,function(e,n){n.setRange(t)})},dateUpdated:function(t){if(this.updating)return;this.updating=!0;var n=e(t.target).data("datepicker"),r=n.getUTCDate(),i=e.inArray(t.target,this.inputs),s=this.inputs.length;if(i===-1)return;e.each(this.pickers,function(e,t){t.getUTCDate()||t.setUTCDate(r)});if(r<this.dates[i])while(i>=0&&r<this.dates[i])this.pickers[i--].setUTCDate(r);else if(r>this.dates[i])while(i<s&&r>this.dates[i])this.pickers[i++].setUTCDate(r);this.updateDates(),delete this.updating},remove:function(){e.map(this.pickers,function(e){e.remove()}),delete this.element.data().datepicker}};var c=e.fn.datepicker;e.fn.datepicker=function(n){var r=Array.apply(null,arguments);r.shift();var i;return this.each(function(){var s=e(this),o=s.data("datepicker"),c=typeof n=="object"&&n;if(!o){var p=f(this,"date"),d=e.extend({},h,p,c),v=l(d.language),m=e.extend({},h,v,p,c);if(s.is(".input-daterange")||m.inputs){var g={inputs:m.inputs||s.find("input").toArray()};s.data("datepicker",o=new a(this,e.extend(m,g)))}else s.data("datepicker",o=new u(this,m))}if(typeof n=="string"&&typeof o[n]=="function"){i=o[n].apply(o,r);if(i!==t)return!1}}),i!==t?i:this};var h=e.fn.datepicker.defaults={autoclose:!1,beforeShowDay:e.noop,calendarWeeks:!1,clearBtn:!1,daysOfWeekDisabled:[],endDate:Infinity,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-Infinity,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0},p=e.fn.datepicker.locale_opts=["format","rtl","weekStart"];e.fn.datepicker.Constructor=u;var d=e.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},v={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,v.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(e){var t=e.replace(this.validParts,"\0").split("\0"),n=e.match(this.validParts);if(!t||!t.length||!n||n.length===0)throw new Error("Invalid date format.");return{separators:t,parts:n}},parseDate:function(n,i,s){function w(){var e=this.slice(0,a[c].length),t=a[c].slice(0,e.length);return e===t}if(!n)return t;if(n instanceof Date)return n;typeof i=="string"&&(i=v.parseFormat(i));var o=/([\-+]\d+)([dmwy])/,a=n.match(/([\-+]\d+)([dmwy])/g),f,l,c;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(n)){n=new Date;for(c=0;c<a.length;c++){f=o.exec(a[c]),l=parseInt(f[1]);switch(f[2]){case"d":n.setUTCDate(n.getUTCDate()+l);break;case"m":n=u.prototype.moveMonth.call(u.prototype,n,l);break;case"w":n.setUTCDate(n.getUTCDate()+l*7);break;case"y":n=u.prototype.moveYear.call(u.prototype,n,l)}}return r(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),0,0,0)}a=n&&n.match(this.nonpunctuation)||[],n=new Date;var h={},p=["yyyy","yy","M","MM","m","mm","d","dd"],m={yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){if(isNaN(e))return e;t-=1;while(t<0)t+=12;t%=12,e.setUTCMonth(t);while(e.getUTCMonth()!==t)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}},g,y;m.M=m.MM=m.mm=m.m,m.dd=m.d,n=r(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0);var b=i.parts.slice();a.length!==b.length&&(b=e(b).filter(function(t,n){return e.inArray(n,p)!==-1}).toArray());if(a.length===b.length){var E;for(c=0,E=b.length;c<E;c++){g=parseInt(a[c],10),f=b[c];if(isNaN(g))switch(f){case"MM":y=e(d[s].months).filter(w),g=e.inArray(y[0],d[s].months)+1;break;case"M":y=e(d[s].monthsShort).filter(w),g=e.inArray(y[0],d[s].monthsShort)+1}h[f]=g}var S,x;for(c=0;c<p.length;c++)x=p[c],x in h&&!isNaN(h[x])&&(S=new Date(n),m[x](S,h[x]),isNaN(S)||(n=S))}return n},formatDate:function(t,n,r){if(!t)return"";typeof n=="string"&&(n=v.parseFormat(n));var i={d:t.getUTCDate(),D:d[r].daysShort[t.getUTCDay()],DD:d[r].days[t.getUTCDay()],m:t.getUTCMonth()+1,M:d[r].monthsShort[t.getUTCMonth()],MM:d[r].months[t.getUTCMonth()],yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear()};i.dd=(i.d<10?"0":"")+i.d,i.mm=(i.m<10?"0":"")+i.m,t=[];var s=e.extend([],n.separators);for(var o=0,u=n.parts.length;o<=u;o++)s.length&&t.push(s.shift()),t.push(i[n.parts[o]]);return t.join("")},headTemplate:'<thead><tr><th class="prev">&laquo;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&raquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};v.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+v.headTemplate+"<tbody></tbody>"+v.footTemplate+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+v.headTemplate+v.contTemplate+v.footTemplate+"</table>"+"</div>"+"</div>",e.fn.datepicker.DPGlobal=v,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=c,this},e(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(t){var n=e(this);if(n.data("datepicker"))return;t.preventDefault(),n.datepicker("show")}),e(function(){e('[data-provide="datepicker-inline"]').datepicker()})}(window.jQuery),define("datepicker",["bootstrap"],function(){}),define("hbs/underscore",[],function(){function T(e,t,n){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e._chain&&(e=e._wrapped),t._chain&&(t=t._wrapped);if(e.isEqual&&w.isFunction(e.isEqual))return e.isEqual(t);if(t.isEqual&&w.isFunction(t.isEqual))return t.isEqual(e);var r=o.call(e);if(r!=o.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var i=n.length;while(i--)if(n[i]==e)return!0;n.push(e);var s=0,u=!0;if(r=="[object Array]"){s=e.length,u=s==t.length;if(u)while(s--)if(!(u=s in e==s in t&&T(e[s],t[s],n)))break}else{if("constructor"in e!="constructor"in t||e.constructor!=t.constructor)return!1;for(var a in e)if(w.has(e,a)){s++;if(!(u=w.has(t,a)&&T(e[a],t[a],n)))break}if(u){for(a in t)if(w.has(t,a)&&!(s--))break;u=!s}}return n.pop(),u}var e={},t=Array.prototype,n=Object.prototype,r=Function.prototype,i=t.slice,s=t.unshift,o=n.toString,u=n.hasOwnProperty,a=t.forEach,f=t.map,l=t.reduce,c=t.reduceRight,h=t.filter,p=t.every,d=t.some,v=t.indexOf,m=t.lastIndexOf,g=Array.isArray,y=Object.keys,b=r.bind,w=function(e){return new _(e)};w.VERSION="1.3.3";var E=w.each=w.forEach=function(t,n,r){if(t==null)return;if(a&&t.forEach===a)t.forEach(n,r);else if(t.length===+t.length){for(var i=0,s=t.length;i<s;i++)if(i in t&&n.call(r,t[i],i,t)===e)return}else for(var o in t)if(w.has(t,o)&&n.call(r,t[o],o,t)===e)return};w.map=w.collect=function(e,t,n){var r=[];return e==null?r:f&&e.map===f?e.map(t,n):(E(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),e.length===+e.length&&(r.length=e.length),r)},w.reduce=w.foldl=w.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(l&&e.reduce===l)return r&&(t=w.bind(t,r)),i?e.reduce(t,n):e.reduce(t);E(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError("Reduce of empty array with no initial value");return n},w.reduceRight=w.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(c&&e.reduceRight===c)return r&&(t=w.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=w.toArray(e).reverse();return r&&!i&&(t=w.bind(t,r)),i?w.reduce(s,t,n,r):w.reduce(s,t)},w.find=w.detect=function(e,t,n){var r;return S(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},w.filter=w.select=function(e,t,n){var r=[];return e==null?r:h&&e.filter===h?e.filter(t,n):(E(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},w.reject=function(e,t,n){var r=[];return e==null?r:(E(e,function(e,i,s){t.call(n,e,i,s)||(r[r.length]=e)}),r)},w.every=w.all=function(t,n,r){var i=!0;return t==null?i:p&&t.every===p?t.every(n,r):(E(t,function(t,s,o){if(!(i=i&&n.call(r,t,s,o)))return e}),!!i)};var S=w.some=w.any=function(t,n,r){n||(n=w.identity);var i=!1;return t==null?i:d&&t.some===d?t.some(n,r):(E(t,function(t,s,o){if(i||(i=n.call(r,t,s,o)))return e}),!!i)};w.include=w.contains=function(e,t){var n=!1;return e==null?n:v&&e.indexOf===v?e.indexOf(t)!=-1:(n=S(e,function(e){return e===t}),n)},w.invoke=function(e,t){var n=i.call(arguments,2);return w.map(e,function(e){return(w.isFunction(t)?t||e:e[t]).apply(e,n)})},w.pluck=function(e,t){return w.map(e,function(e){return e[t]})},w.max=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&w.isEmpty(e))return-Infinity;var r={computed:-Infinity};return E(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},w.min=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&w.isEmpty(e))return Infinity;var r={computed:Infinity};return E(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},w.shuffle=function(e){var t=[],n;return E(e,function(e,r,i){n=Math.floor(Math.random()*(r+1)),t[r]=t[n],t[n]=e}),t},w.sortBy=function(e,t,n){var r=w.isFunction(t)?t:function(e){return e[t]};return w.pluck(w.map(e,function(e,t,i){return{value:e,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;return n===void 0?1:r===void 0?-1:n<r?-1:n>r?1:0}),"value")},w.groupBy=function(e,t){var n={},r=w.isFunction(t)?t:function(e){return e[t]};return E(e,function(e,t){var i=r(e,t);(n[i]||(n[i]=[])).push(e)}),n},w.sortedIndex=function(e,t,n){n||(n=w.identity);var r=0,i=e.length;while(r<i){var s=r+i>>1;n(e[s])<n(t)?r=s+1:i=s}return r},w.toArray=function(e){return e?w.isArray(e)?i.call(e):w.isArguments(e)?i.call(e):e.toArray&&w.isFunction(e.toArray)?e.toArray():w.values(e):[]},w.size=function(e){return w.isArray(e)?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,n){return t!=null&&!n?i.call(e,0,t):e[0]},w.initial=function(e,t,n){return i.call(e,0,e.length-(t==null||n?1:t))},w.last=function(e,t,n){return t!=null&&!n?i.call(e,Math.max(e.length-t,0)):e[e.length-1]},w.rest=w.tail=function(e,t,n){return i.call(e,t==null||n?1:t)},w.compact=function(e){return w.filter(e,function(e){return!!e})},w.flatten=function(e,t){return w.reduce(e,function(e,n){return w.isArray(n)?e.concat(t?n:w.flatten(n)):(e[e.length]=n,e)},[])},w.without=function(e){return w.difference(e,i.call(arguments,1))},w.uniq=w.unique=function(e,t,n){var r=n?w.map(e,n):e,i=[];return e.length<3&&(t=!0),w.reduce(r,function(n,r,s){if(t?w.last(n)!==r||!n.length:!w.include(n,r))n.push(r),i.push(e[s]);return n},[]),i},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=w.intersect=function(e){var t=i.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.indexOf(t,e)>=0})})},w.difference=function(e){var t=w.flatten(i.call(arguments,1),!0);return w.filter(e,function(e){return!w.include(t,e)})},w.zip=function(){var e=i.call(arguments),t=w.max(w.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=w.pluck(e,""+r);return n},w.indexOf=function(e,t,n){if(e==null)return-1;var r,i;if(n)return r=w.sortedIndex(e,t),e[r]===t?r:-1;if(v&&e.indexOf===v)return e.indexOf(t);for(r=0,i=e.length;r<i;r++)if(r in e&&e[r]===t)return r;return-1},w.lastIndexOf=function(e,t){if(e==null)return-1;if(m&&e.lastIndexOf===m)return e.lastIndexOf(t);var n=e.length;while(n--)if(n in e&&e[n]===t)return n;return-1},w.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var x=function(){};w.bind=function(t,n){var r,s;if(t.bind===b&&b)return b.apply(t,i.call(arguments,1));if(!w.isFunction(t))throw new TypeError;return s=i.call(arguments,2),r=function(){if(this instanceof r){x.prototype=t.prototype;var e=new x,o=t.apply(e,s.concat(i.call(arguments)));return Object(o)===o?o:e}return t.apply(n,s.concat(i.call(arguments)))}},w.bindAll=function(e){var t=i.call(arguments,1);return t.length==0&&(t=w.functions(e)),E(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var n={};return t||(t=w.identity),function(){var r=t.apply(this,arguments);return w.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},w.delay=function(e,t){var n=i.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(i.call(arguments,1)))},w.throttle=function(e,t){var n,r,i,s,o,u,a=w.debounce(function(){o=s=!1},t);return function(){n=this,r=arguments;var f=function(){i=null,o&&e.apply(n,r),a()};return i||(i=setTimeout(f,t)),s?o=!0:u=e.apply(n,r),a(),s=!0,u}},w.debounce=function(e,t,n){var r;return function(){var i=this,s=arguments,o=function(){r=null,n||e.apply(i,s)};n&&!r&&e.apply(i,s),clearTimeout(r),r=setTimeout(o,t)}},w.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments))}},w.wrap=function(e,t){return function(){var n=[e].concat(i.call(arguments,0));return t.apply(this,n)}},w.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},w.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},w.keys=y||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)w.has(e,n)&&(t[t.length]=n);return t},w.values=function(e){return w.map(e,w.identity)},w.functions=w.methods=function(e){var t=[];for(var n in e)w.isFunction(e[n])&&t.push(n);return t.sort()},w.extend=function(e){return E(i.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},w.pick=function(e){var t={};return E(w.flatten(i.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},w.defaults=function(e){return E(i.call(arguments,1),function(t){for(var n in t)e[n]==null&&(e[n]=t[n])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e},w.isEqual=function(e,t){return T(e,t,[])},w.isEmpty=function(e){if(e==null)return!0;if(w.isArray(e)||w.isString(e))return e.length===0;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!!e&&e.nodeType==1},w.isArray=g||function(e){return o.call(e)=="[object Array]"},w.isObject=function(e){return e===Object(e)},w.isArguments=function(e){return o.call(e)=="[object Arguments]"},w.isArguments(arguments)||(w.isArguments=function(e){return!!e&&!!w.has(e,"callee")}),w.isFunction=function(e){return o.call(e)=="[object Function]"},w.isString=function(e){return o.call(e)=="[object String]"},w.isNumber=function(e){return o.call(e)=="[object Number]"},w.isFinite=function(e){return w.isNumber(e)&&isFinite(e)},w.isNaN=function(e){return e!==e},w.isBoolean=function(e){return e===!0||e===!1||o.call(e)=="[object Boolean]"},w.isDate=function(e){return o.call(e)=="[object Date]"},w.isRegExp=function(e){return o.call(e)=="[object RegExp]"},w.isNull=function(e){return e===null},w.isUndefined=function(e){return e===void 0},w.has=function(e,t){return u.call(e,t)},w.noConflict=function(){return root._=previousUnderscore,this},w.identity=function(e){return e},w.times=function(e,t,n){for(var r=0;r<e;r++)t.call(n,r)},w.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},w.result=function(e,t){if(e==null)return null;var n=e[t];return w.isFunction(n)?n.call(e):n},w.mixin=function(e){E(w.functions(e),function(t){P(t,w[t]=e[t])})};var N=0;w.uniqueId=function(e){var t=N++;return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var C=/.^/,k={"\\":"\\","'":"'",r:"\r",n:"\n",t:"	",u2028:"\u2028",u2029:"\u2029"};for(var L in k)k[k[L]]=L;var A=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,M=function(e){return e.replace(O,function(e,t){return k[t]})};w.template=function(e,t,n){n=w.defaults(n||{},w.templateSettings);var r="__p+='"+e.replace(A,function(e){return"\\"+k[e]}).replace(n.escape||C,function(e,t){return"'+\n_.escape("+M(t)+")+\n'"}).replace(n.interpolate||C,function(e,t){return"'+\n("+M(t)+")+\n'"}).replace(n.evaluate||C,function(e,t){return"';\n"+M(t)+"\n;__p+='"})+"';\n";n.variable||(r="with(obj||{}){\n"+r+"}\n"),r="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+r+"return __p;\n";var i=new Function(n.variable||"obj","_",r);if(t)return i(t,w);var s=function(e){return i.call(this,e,w)};return s.source="function("+(n.variable||"obj")+"){\n"+r+"}",s},w.chain=function(e){return w(e).chain()};var _=function(e){this._wrapped=e};w.prototype=_.prototype;var D=function(e,t){return t?w(e).chain():e},P=function(e,t){_.prototype[e]=function(){var e=i.call(arguments);return s.call(e,this._wrapped),D(t.apply(w,e),this._chain)}};return w.mixin(w),E(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=t[e];_.prototype[e]=function(){var t=this._wrapped;n.apply(t,arguments);var r=t.length;return(e=="shift"||e=="splice")&&r===0&&delete t[0],D(t,this._chain)}}),E(["concat","join","slice"],function(e){var n=t[e];_.prototype[e]=function(){return D(n.apply(this._wrapped,arguments),this._chain)}}),_.prototype.chain=function(){return this._chain=!0,this},_.prototype.value=function(){return this._wrapped},w}),define("hbs/i18nprecompile",["hbs/handlebars","hbs/underscore"],function(e,t){function n(r,i,s){return s=s||{},i=i||{},r&&r.type==="program"&&r.statements&&(t(r.statements).forEach(function(t,o){var u="<!-- i18n error -->";if(t.type==="mustache"&&t.id&&t.id.original==="$"){if(t.params.length&&t.params[0].string){var a=t.params[0].string;u=i[a]||(s.originalKeyFallback?a:u)}r.statements[o]=new e.AST.ContentNode(u)}else t.program&&(t.program=n(t.program,i,s))}),r.inverse&&n(r.inverse,i,s)),r}return function(t,r,i){i=i||{};var s,o;return s=e.parse(t),r!==!1&&(s=n(s,r,i)),o=(new e.Compiler).compile(s,i),(new e.JavaScriptCompiler).compile(o,i)}}),function(window){var JSON=window.JSON||{};(function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})})(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",["hbs/handlebars","hbs/underscore","hbs/i18nprecompile","hbs/json2"],function(e,t,n,r){var i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=function(){throw new Error("Environment unsupported.")},a=[],f="w+",l="hbs",c="@hbs",h="/styles/",p="/demo-build/styles/",d="../../common/handlebars/helpers/",v="templates/i18n/",m="screen.build.css";e.registerHelper("$",function(){}),typeof window!="undefined"&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(s=function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return arguments[0]===!0?new XDomainRequest:new XMLHttpRequest;for(t=0;t<3;t++){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if(navigator.appName=="Microsoft Internet Explorer"){var t=navigator.userAgent,n=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");n.exec(t)!=null&&(e=parseFloat(RegExp.$1))}return e},u=function(e,t){var n=!1;if(e.indexOf("http")!=0)n=!1;else{var r=e.substr(0,5)==="https"?8:7,i=window.location.href.substr(0,5)==="https"?8:7,o=e.substr(r).split("/").shift(),u=getIEVersion();n=o!=window.location.href.substr(i).split("/").shift()&&u>=7}if(n){var a=s(!0);a.open("GET",e),a.onload=function(){t(a.responseText)},a.onprogress=function(){},a.ontimeout=function(){},a.onerror=function(){},setTimeout(function(){a.send()},0)}else{var f=s();f.open("GET",e,!0),f.onreadystatechange=function(e){f.readyState===4&&t(f.responseText)},f.send(null)}}):typeof process!="undefined"&&process.versions&&!!process.versions.node?(i=require.nodeRequire("fs"),u=function(e,t){var n=i.readFileSync(e,"utf8")||"";n=n.replace(/^\uFEFF/,""),t(n)}):typeof java!="undefined"&&typeof java.io!="undefined"&&(u=function(e,t){var n=new java.io.File(e),r=new java.io.FileReader(n),i=new java.io.BufferedReader(r),s,o="";while((s=i.readLine())!==null)o+=new String(s)+"\n";i.close(),t(o)});var g={},y=function(e,t){g[e]?t(g[e]):u(e,function(n){g[e]=n,t.call(this,n)})},b=[],w={};return{get:function(){return e},write:function(e,t,n){if(t+c in a){var r=a[t+c];n.asModule(e+"!"+t,r)}},version:"0.5.0",load:function(s,o,g,E){function k(e,n){return t(e).forEach(function(e){e&&e.type&&e.type==="partial"&&n.push(e.partialName.name),e&&e.program&&e.program.statements&&k(e.program.statements,n),e&&e.program&&e.program.inverse&&e.program.inverse.statements&&k(e.program.inverse.statements,n)}),n}function L(e){var n=[];return e&&e.statements&&(n=k(e.statements,[])),t(n).unique()}function A(e){var t,n,i;if(e&&e.statements){t=e.statements[0];if(t&&t.type==="comment")try{return n=t.comment.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),i=r.parse(n),n}catch(s){return'{ "description" : "'+t.comment+'" }'}}return"{}"}function O(e){if(!e)return[];var t=[e[0]],n=e[0],r;for(r=1;r<e.length;++r)e.hasOwnProperty(r)&&(n+="."+e[r],t.push(n));return t}function M(n,r,i,s){i=i?i+".":"";var o="",u=!1;return t(n).forEach(function(n){var u,a,f;if(n&&n.type&&n.type==="mustache"){if(!n.params||!n.params.length){u=O(n.id.parts);for(a in u)u[a]&&(o=u[a]||o,r.push(i+u[a]));r.push(i+n.id.string)}var l=["this",".","..","./..","../..","../../.."];n.params&&typeof e.helpers[n.id.string]=="undefined"&&t(n.params).forEach(function(a){(t(l).contains(a.original)||a instanceof e.AST.StringNode||a instanceof e.AST.IntegerNode||a instanceof e.AST.BooleanNode)&&s.push(n.id.string),u=O(a.parts);for(var f in u)u[f]&&(o=u[f]||o,s.push(n.id.string),r.push(i+u[f]))})}n&&n.mustache&&M([n.mustache],r,i+o,s),n&&n.program&&n.program.statements&&(f=M([n.mustache],[],"",s)[0]||"",n.program.inverse&&n.program.inverse.statements&&M(n.program.inverse.statements,r,i+o+(f?i+o?"."+f:f:""),s),M(n.program.statements,r,i+o+(f?i+o?"."+f:f:""),s))}),r}function D(e){var n=[],r=[];e&&e.statements&&(n=M(e.statements,[],undefined,r));var i=["helperMissing","blockHelperMissing","each","if","unless","with"];return{vars:t(n).chain().unique().map(function(e){return e===""?".":e.length&&e[e.length-1]==="."?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(r).chain().unique().map(function(e){return t(i).contains(e)?undefined:e}).compact().value()}}function P(e){var t=e.split("/");for(var n=0;n<t.length;n++)t[n]==".."&&(delete t[n-1],delete t[n]);return t.join("/").replace(/\/\/+/g,"/")}function H(l){u(B,function(u){var c=e.parse(u),v=L(c),y=A(c),C=D(c),k=C.vars,O=C.helpers||[],M="",H="",B="",j=[],F,I,q,R,U,z=s.substr(0,s.lastIndexOf("/")+1);require.config.hbs=require.config.hbs||{},require.config.hbs._partials=require.config.hbs._partials||{};if(y!=="{}")try{q=r.parse(y)}catch(W){console.log("couldn't parse meta for %s",$)}for(var X in v)if(v.hasOwnProperty(X)&&typeof v[X]=="string"){var V=v[X],$;V.match(/^(\.|\/)+/)?$=P(z+V):$=P(N+V),require.config.hbs._partials[$]=require.config.hbs._partials[$]||[],require.config.hbs._partials[$].references=require.config.hbs._partials[$].references||[],require.config.hbs._partials[$].references.push(V),require.config.hbs._loadedDeps=require.config.hbs._loadedDeps||{},j[X]="hbs!"+$}F=j.join("', '"),O=O.concat(q&&q.helpers?q.helpers:[]),I=T?"":function(){var e,t=[],n=E.hbs&&E.hbs.helperPathCallback?E.hbs.helperPathCallback:function(e){return(E.hbs&&E.hbs.helperDirectory?E.hbs.helperDirectory:d)+e};for(e=0;e<O.length;e++)t[e]="'"+n(O[e],$)+"'";return t}().join(","),I&&(I=","+I);if(q)try{q.styles&&(b=t.union(b,q.styles),require.isBrowser&&!E.isBuild?(R=document.head||document.getElementsByTagName("head")[0],t(q.styles).forEach(function(e){w[e]||(U=document.createElement("link"),U.href=E.baseUrl+h+e+".css",U.media="all",U.rel="stylesheet",U.type="text/css",R.appendChild(U),w[e]=U)})):E.isBuild&&function(){var e=require.nodeRequire("fs"),n=t(q.styles).map(function(e){return w[e]?"":(w[e]=!0,"@import url("+e+".css);\n")}).join("\n");e.open(__dirname+p+m,f,"0666",function(t,r){e.writeSync(r,n,null,encoding="utf8"),e.close(r)}),f="a"}())}catch(W){console.log("error injecting styles")}!E.isBuild&&!E.serverRender&&(M="<!-- START - "+s+" -->",H="<!-- END - "+s+" -->",B="t.meta = "+y+";\n"+"t.helpers = "+r.stringify(O)+";\n"+"t.deps = "+r.stringify(j)+";\n"+"t.vars = "+r.stringify(k)+";\n");var J=x?!1:t.extend(l,E.localeMapping),K=E.hbs||{},Q=t.extend(K.compileOptions||{},{originalKeyFallback:K.originalKeyFallback}),G=n(u,J,Q),Y=E.isBuild?"":"'"+s+"',";F&&(F=", '"+F+"'");var Z=[];require.config.hbs._partials[s]&&(Z=require.config.hbs._partials[s].references),u="/* START_TEMPLATE */\ndefine("+Y+"['hbs','hbs/handlebars'"+F+I+"], function( hbs, Handlebars ){ \n"+"var t = Handlebars.template("+G+");\n";for(var X=0;X<Z.length;X++)u+="Handlebars.registerPartial('"+Z[X]+"', t);\n";u+=B+"return t;\n"+"});\n"+"/* END_TEMPLATE */\n",E.isBuild&&(a[S]=u),E.isBuild||(u+="\r\n//@ sourceURL="+$),E.isBuild?(g.fromText(s,u),o([s],function(e){g(e)})):require(j,function(){g.fromText(u),o([s],function(e){g(e)})}),E.removeCombined&&i.unlinkSync($)})}var S=s+c;E.hbs=E.hbs||{};var x=E.hbs.i18n!=1,T=E.hbs.helpers==0,N="";E.hbs.partialsUrl&&(N=E.hbs.partialsUrl,N.match(/\/$/)||(N+="/"));var C=[],B,j=E.hbs&&E.hbs.templateExtension===!1;j?B=o.toUrl(s):B=o.toUrl(s+"."+(E.hbs&&E.hbs.templateExtension?E.hbs.templateExtension:l));if(x)H(!1);else{var F=(E.hbs&&E.hbs.i18nDirectory?E.hbs.i18nDirectory:v)+(E.locale||"en_us")+".json";try{y(o.toUrl(F),function(e){H(r.parse(e))})}catch(I){if(!!E.hbs)throw I;console.warn("hbs: Error reading "+F+", disabling i18n. Ignore this if you're using jam, otherwise check your i18n configuration.\n"),E.hbs={i18n:!1,helpers:!0},H(!1)}}}}}),define("hbs!common/glassPane/glassPaneTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return'\n<div class="loading-animation"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='\n<div class="glass-pane ',(o=n.type)?o=o.call(t,{hash:{}}):(o=t&&t.type,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n',o=n["if"].call(t,t&&t.loadingAnimation,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("common/glassPane/glassPane",["require","hbs!common/glassPane/glassPaneTemplate","backbone","marionette"],function(e){var t=e("hbs!common/glassPane/glassPaneTemplate"),n=e("backbone"),r=e("marionette"),i={Dark:"dark",Loading:"loading"},s=r.ItemView.extend({template:t,ui:{glassPane:".glass-pane"}}),o=new r.Region({el:"#glass-pane-region"}),u,a,f=function(e){var t=function(t){e=_.defaults(t||{},{type:i.Dark})};t(e),this.show=function(t){if(a!=undefined)return;a=t;if(this._currentType==i.Dark&&e.type==i.Loading)return;var r=new s({model:new n.Model});r.model.set("type",e.type),r.model.set("loadingAnimation",e.loadingAnimation),this._region=e.region?e.region:o,this._region.show(r),e.zIndex&&r.ui.glassPane.css({zIndex:e.zIndex}),e.region==undefined&&(this._currentType=e.type)},this.hide=function(n){if(this._region){if(this._currentType==i.Dark&&e.type==i.Loading||a!=n)return;this._region.empty(),this._currentType=undefined,t(),a==n&&(a=undefined)}}};return{getInstance:function(e){return e.isDefault?(u==undefined&&(u=new f(e)),u):new f(e)},Type:i}}),define("hbs!common/modal/modalTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){var r;return r=n["if"].call(e,e&&e.isSearch,{hash:{},inverse:u.program(2,f,t),fn:u.noop}),r||r===0?r:""}function f(e,t){return'class="container"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="modal fade">\r\n	<div class="modal-dialog">\r\n		<div class="modal-content">\r\n			<div class="modal-header clearfix">\r\n			    <div ',o=n["if"].call(t,t&&t.isDrawer,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+='>\r\n                    <button type="button" class="close"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\r\n			    </div>\r\n			</div>\r\n			<div class="modal-body"></div>\r\n		</div>\r\n	</div>\r\n</div>',s});return n}),define("common/modal/modal",["backbone","marionette","hbs!common/modal/modalTemplate"],function(e,t,n){var r=t.LayoutView.extend({template:n,regions:{body:".modal-body",footer:".modal-footer"},ui:{modal:".modal",closeButton:"button.close"},events:{"click .close":"_onCloseClicked","hidden.bs.modal .modal":"_onHide"},show:function(){var e={},t=!1;if(!this.options.isAuto||!(this.options.isOnceDuringSession&&sessionStorage[this.modalKey()]||this.options.isOnce&&localStorage[this.modalKey()])){this.options.isDisallowClose?(e.backdrop="static",e.keyboard=!1):e.backdrop=!this.options.isDrawer,this.$(".modal").modal(e).modal("show"),this.options.isDrawer&&this.ui.modal.addClass("drawer");if(this.options.isSearch){this.ui.modal.addClass("search-drawer");var n=$("#categories").parent().css("position")==="fixed"?$("#header-region").height()+$("#categories").height():$("#categories").offset().top+$("#categories").height();n-=$(window).scrollTop(),this.ui.modal.find(".modal-dialog").css("margin-top",n)}this.body.show(this.model.get("bodyView")),t=!0}return this.options.isDisallowClose&&this.ui.closeButton.hide(),t},hide:function(){return this._deferred=$.Deferred(),this.ui.modal.modal("hide"),this._deferred},_onCloseClicked:function(){this.trigger("closeClicked"),this.hide()},_onHide:function(){this._deferred&&this._deferred.resolve(),this.options.closeCallback&&_.isFunction(this.options.closeCallback)&&this.options.closeCallback(),this.options.isOnceDuringSession&&sessionStorage.setItem(this.modalKey(),!0),this.options.isOnce&&localStorage.setItem(this.modalKey(),!0)},modalKey:function(){return"modal_"+this.options.key}}),i=new t.Region({el:"#modal-region"}),s=function(t,n){i.hasView()&&(i.currentView.hide(),$(".modal-backdrop").remove(),i.empty()),n=n||{},n.model=new e.Model(n);var s=new r(n);s.model.set("bodyView",t),s.$el.addClass(n.className),i.show(s);var o=s.show();return o?s:undefined},o=function(e,t){var n=$.Deferred(),r=i.currentView&&i.currentView.options;return i.currentView&&(e==undefined||e==i.currentView.model.get("modalId"))&&(!t||!r.isDisallowClose&&!r.isDisallowCloseByRoute)?i.currentView.hide().done(function(){i.empty(),n.resolve()}):n.resolve(),n.promise()},u=function(e){return i.hasView()&&i.currentView.model.get("bodyView")==e};return{show:s,close:o,hasView:u}}),define("common/globals",["require","backbone","marionette","common/modal/modal"],function(e){var t=e("backbone");e("marionette");var n=e("common/modal/modal"),r=new t.Wreqr.EventAggregator,i={},s={init:function(){s.discountChange={},s.isOrderHasSavedItems=!1,s.isOrderCanceled=!1,s.isFormDirty=!1,s.itemsInBundleQuantityMap={},s.setBaselineOrder([]),s.setIsOrderEditable(!1)},setBaselineOrder:function(e){i.baselineOrder=[],e&&e.forEach(function(e){i.baselineOrder.push(_.clone(e))}),i.order=i.baselineOrder,i.isOrderDirty=!1},getBaselineOrder:function(){return i.baselineOrder},setOrder:function(e){i.order=e},setIsOrderDirty:function(e){i.isOrderDirty=e},isOrderDirty:function(){var e=i.isOrderDirty;return e||(i.order.length==i.baselineOrder.length?i.order.forEach(function(t){var n=i.baselineOrder.filter(function(e){return t.shareKey===e.shareKey});if(n.length==1){if(t.scheduleKey!=n[0].scheduleKey||t.quantity!=n[0].quantity)e=!0}else e=!0}):e=!0),e},setIsOrderEditable:function(e){i.isOrderEditable=e},isOrderEditable:function(){return i.isOrderEditable||this.isOrderDirty()},setLastCategories:function(e,t){s.lastCategory=e,s.lastSubCategory=t}};return s.init(),{eventBus:r,EventAggregator:t.Wreqr.EventAggregator,data:s,model:new t.Model,modal:n}}),define("common/loadingAnimation",["require","common/glassPane/glassPane","common/globals"],function(e){var t=e("common/glassPane/glassPane"),n=e("common/globals"),r,i,s=t.getInstance({type:t.Type.Loading});n.eventBus.on({"loading:show":function(e){r=!0,i=e}}),n.eventBus.on({"loading:hide":function(){r=!1,i=!1}}),$(".main-region").on("click","[loading-animation]",function(e){var t=$(e.currentTarget),o=function(){t.addClass("loading").attr("disabled",""),i||s.show()},u=function(){t.removeClass("loading").removeAttr("disabled"),i||s.hide()},a=function(){n.eventBus.once({"loading:hide":function(){setTimeout(function(){r?a():u()},1)}})};return r&&(o(),a()),!1})}),function(e){typeof define=="function"&&define.amd?define("jquery-cookie",["jquery"],e):e(jQuery)}(function(e){function n(e){return e}function r(e){return decodeURIComponent(e.replace(t," "))}function i(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return s.json?JSON.parse(e):e}catch(t){}}var t=/\+/g,s=e.cookie=function(t,o,u){if(o!==undefined){u=e.extend({},s.defaults,u);if(typeof u.expires=="number"){var a=u.expires,f=u.expires=new Date;f.setDate(f.getDate()+a)}return o=s.json?JSON.stringify(o):String(o),document.cookie=[s.raw?t:encodeURIComponent(t),"=",s.raw?o:encodeURIComponent(o),u.expires?"; expires="+u.expires.toUTCString():"",u.path?"; path="+u.path:"",u.domain?"; domain="+u.domain:"",u.secure?"; secure":""].join("")}var l=s.raw?n:r,c=document.cookie.split("; "),h=t?undefined:{};for(var p=0,d=c.length;p<d;p++){var v=c[p].split("="),m=l(v.shift()),g=l(v.join("="));if(t&&t===m){h=i(g);break}t||(h[m]=i(g))}return h};s.defaults={},e.removeCookie=function(t,n){return e.cookie(t)!==undefined?(e.cookie(t,"",e.extend({},n,{expires:-1})),!0):!1}}),window.Modernizr=function(e,t,n){function r(e){v.cssText=e}function i(e,t){return r(y.join(e+";")+(t||""))}function s(e,t){return typeof e===t}function o(e,t){return!!~(""+e).indexOf(t)}function u(e,t){for(var r in e){var i=e[r];if(!o(i,"-")&&v[i]!==n)return t=="pfx"?i:!0}return!1}function a(e,t,r){for(var i in e){var o=t[e[i]];if(o!==n)return r===!1?e[i]:s(o,"function")?o.bind(r||t):o}return!1}function f(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+w.join(r+" ")+r).split(" ");return s(t,"string")||s(t,"undefined")?u(i,t):(i=(e+" "+E.join(r+" ")+r).split(" "),a(i,t,n))}var l="2.8.3",c={},h=t.documentElement,p="modernizr",d=t.createElement(p),v=d.style,m,g={}.toString,y=" -webkit- -moz- -o- -ms- ".split(" "),b="Webkit Moz O ms",w=b.split(" "),E=b.toLowerCase().split(" "),S={},x={},T={},N=[],C=N.slice,k,L=function(e,n,r,i){var s,o,u,a,f=t.createElement("div"),l=t.body,c=l||t.createElement("body");if(parseInt(r,10))while(r--)u=t.createElement("div"),u.id=i?i[r]:p+(r+1),f.appendChild(u);return s=["&#173;",'<style id="s',p,'">',e,"</style>"].join(""),f.id=p,(l?f:c).innerHTML+=s,c.appendChild(f),l||(c.style.background="",c.style.overflow="hidden",a=h.style.overflow,h.style.overflow="hidden",h.appendChild(c)),o=n(f,e),l?f.parentNode.removeChild(f):(c.parentNode.removeChild(c),h.style.overflow=a),!!o},A={}.hasOwnProperty,O;!s(A,"undefined")&&!s(A.call,"undefined")?O=function(e,t){return A.call(e,t)}:O=function(e,t){return t in e&&s(e.constructor.prototype[t],"undefined")},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if(typeof t!="function")throw new TypeError;var n=C.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(C.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(C.call(arguments)))};return r}),S.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:L(["@media (",y.join("touch-enabled),("),p,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=e.offsetTop===9}),n},S.csstransforms=function(){return!!f("transform")},S.csstransforms3d=function(){var e=!!f("perspective");return e&&"webkitPerspective"in h.style&&L("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},S.csstransitions=function(){return f("transition")};for(var M in S)O(S,M)&&(k=M.toLowerCase(),c[k]=S[M](),N.push((c[k]?"":"no-")+k));return c.addTest=function(e,t){if(typeof e=="object")for(var r in e)O(e,r)&&c.addTest(r,e[r]);else{e=e.toLowerCase();if(c[e]!==n)return c;t=typeof t=="function"?t():t,typeof enableClasses!="undefined"&&enableClasses&&(h.className+=" "+(t?"":"no-")+e),c[e]=t}return c},r(""),d=m=null,c._version=l,c._prefixes=y,c._domPrefixes=E,c._cssomPrefixes=w,c.testProp=function(e){return u([e])},c.testAllProps=f,c.testStyles=L,c.prefixed=function(e,t,n){return t?f(e,t,n):f(e,"pfx")},c}(this,this.document),define("modernizr",function(e){return function(){var t,n;return t||e.Modernizr}}(this)),!function(e){function t(e){var t=e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}if(!e.jQuery){var n=function(e,t){return new n.fn.init(e,t)};n.isWindow=function(e){return null!=e&&e==e.window},n.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?i[o.call(e)]||"object":typeof e},n.isArray=Array.isArray||function(e){return"array"===n.type(e)},n.isPlainObject=function(e){var t;if(!e||"object"!==n.type(e)||e.nodeType||n.isWindow(e))return!1;try{if(e.constructor&&!s.call(e,"constructor")&&!s.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(t in e);return void 0===t||s.call(e,t)},n.each=function(e,n,r){var i,s=0,o=e.length,u=t(e);if(r){if(u)for(;o>s&&(i=n.apply(e[s],r),i!==!1);s++);else for(s in e)if(i=n.apply(e[s],r),i===!1)break}else if(u)for(;o>s&&(i=n.call(e[s],s,e[s]),i!==!1);s++);else for(s in e)if(i=n.call(e[s],s,e[s]),i===!1)break;return e},n.data=function(e,t,i){if(void 0===i){var s=e[n.expando],o=s&&r[s];if(void 0===t)return o;if(o&&t in o)return o[t]}else if(void 0!==t){var s=e[n.expando]||(e[n.expando]=++n.uuid);return r[s]=r[s]||{},r[s][t]=i,i}},n.removeData=function(e,t){var i=e[n.expando],s=i&&r[i];s&&n.each(t,function(e,t){delete s[t]})},n.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"!=typeof u&&"function"!==n.type(u)&&(u={}),a===f&&(u=this,a--);f>a;a++)if(null!=(s=arguments[a]))for(i in s)e=u[i],r=s[i],u!==r&&(l&&r&&(n.isPlainObject(r)||(t=n.isArray(r)))?(t?(t=!1,o=e&&n.isArray(e)?e:[]):o=e&&n.isPlainObject(e)?e:{},u[i]=n.extend(l,o,r)):void 0!==r&&(u[i]=r));return u},n.queue=function(e,r,i){function s(e,n){var r=n||[];return null!=e&&(t(Object(e))?!function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;)e[i++]=t[r++];if(n!==n)for(;void 0!==t[r];)e[i++]=t[r++];return e.length=i,e}(r,"string"==typeof e?[e]:e):[].push.call(r,e)),r}if(e){r=(r||"fx")+"queue";var o=n.data(e,r);return i?(!o||n.isArray(i)?o=n.data(e,r,s(i)):o.push(i),o):o||[]}},n.dequeue=function(e,t){n.each(e.nodeType?[e]:e,function(e,r){t=t||"fx";var i=n.queue(r,t),s=i.shift();"inprogress"===s&&(s=i.shift()),s&&("fx"===t&&i.unshift("inprogress"),s.call(r,function(){n.dequeue(r,t)}))})},n.fn=n.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){for(var e=this.offsetParent||document;e&&"html"===!e.nodeType.toLowerCase&&"static"===e.style.position;)e=e.offsetParent;return e||document}var t=this[0],e=e.apply(t),r=this.offset(),i=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:n(e).offset();return r.top-=parseFloat(t.style.marginTop)||0,r.left-=parseFloat(t.style.marginLeft)||0,e.style&&(i.top+=parseFloat(e.style.borderTopWidth)||0,i.left+=parseFloat(e.style.borderLeftWidth)||0),{top:r.top-i.top,left:r.left-i.left}}};var r={};n.expando="velocity"+(new Date).getTime(),n.uuid=0;for(var i={},s=i.hasOwnProperty,o=i.toString,u="Boolean Number String Function Array Date RegExp Object Error".split(" "),a=0;a<u.length;a++)i["[object "+u[a]+"]"]=u[a].toLowerCase();n.fn.init.prototype=n.fn,e.Velocity={Utilities:n}}}(window),function(e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define("velocity",e):e()}(function(){return function(e,t,n,r){function i(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r}function s(e){return d.isWrapped(e)?e=[].slice.call(e):d.isNode(e)&&(e=[e]),e}function o(e){var t=v.data(e,"velocity");return null===t?r:t}function u(e){return function(t){return Math.round(t*e)*(1/e)}}function a(e,n,r,i){function s(e,t){return 1-3*t+3*e}function o(e,t){return 3*t-6*e}function u(e){return 3*e}function a(e,t,n){return((s(t,n)*e+o(t,n))*e+u(t))*e}function f(e,t,n){return 3*s(t,n)*e*e+2*o(t,n)*e+u(t)}function l(t,n){for(var i=0;v>i;++i){var s=f(n,e,r);if(0===s)return n;var o=a(n,e,r)-t;n-=o/s}return n}function c(){for(var t=0;b>t;++t)x[t]=a(t*w,e,r)}function h(t,n,i){var s,o,u=0;do o=n+(i-n)/2,s=a(o,e,r)-t,s>0?i=o:n=o;while(Math.abs(s)>g&&++u<y);return o}function p(t){for(var n=0,i=1,s=b-1;i!=s&&x[i]<=t;++i)n+=w;--i;var o=(t-x[i])/(x[i+1]-x[i]),u=n+o*w,a=f(u,e,r);return a>=m?l(t,u):0==a?u:h(t,n,n+w)}function d(){T=!0,(e!=n||r!=i)&&c()}var v=4,m=.001,g=1e-7,y=10,b=11,w=1/(b-1),E="Float32Array"in t;if(4!==arguments.length)return!1;for(var S=0;4>S;++S)if("number"!=typeof arguments[S]||isNaN(arguments[S])||!isFinite(arguments[S]))return!1;e=Math.min(e,1),r=Math.min(r,1),e=Math.max(e,0),r=Math.max(r,0);var x=E?new Float32Array(b):new Array(b),T=!1,N=function(t){return T||d(),e===n&&r===i?t:0===t?0:1===t?1:a(p(t),n,i)};N.getControlPoints=function(){return[{x:e,y:n},{x:r,y:i}]};var C="generateBezier("+[e,n,r,i]+")";return N.toString=function(){return C},N}function f(e,t){var n=e;return d.isString(e)?b.Easings[e]||(n=!1):n=d.isArray(e)&&1===e.length?u.apply(null,e):d.isArray(e)&&2===e.length?w.apply(null,e.concat([t])):d.isArray(e)&&4===e.length?a.apply(null,e):!1,n===!1&&(n=b.Easings[b.defaults.easing]?b.defaults.easing:y),n}function l(e){if(e)for(var t=(new Date).getTime(),n=0,i=b.State.calls.length;i>n;n++)if(b.State.calls[n]){var s=b.State.calls[n],u=s[0],a=s[2],f=s[3],h=!!f;f||(f=b.State.calls[n][3]=t-16);for(var p=Math.min((t-f)/a.duration,1),m=0,g=u.length;g>m;m++){var y=u[m],w=y.element;if(o(w)){var S=!1;if(a.display!==r&&null!==a.display&&"none"!==a.display){if("flex"===a.display){var T=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];v.each(T,function(e,t){E.setPropertyValue(w,"display",t)})}E.setPropertyValue(w,"display",a.display)}a.visibility!==r&&"hidden"!==a.visibility&&E.setPropertyValue(w,"visibility",a.visibility);for(var N in y)if("element"!==N){var C=y[N],k,L=d.isString(C.easing)?b.Easings[C.easing]:C.easing;if(1===p)k=C.endValue;else if(k=C.startValue+(C.endValue-C.startValue)*L(p),!h&&k===C.currentValue)continue;if(C.currentValue=k,E.Hooks.registered[N]){var A=E.Hooks.getRoot(N),O=o(w).rootPropertyValueCache[A];O&&(C.rootPropertyValue=O)}var M=E.setPropertyValue(w,N,C.currentValue+(0===parseFloat(k)?"":C.unitType),C.rootPropertyValue,C.scrollData);E.Hooks.registered[N]&&(o(w).rootPropertyValueCache[A]=E.Normalizations.registered[A]?E.Normalizations.registered[A]("extract",null,M[1]):M[1]),"transform"===M[0]&&(S=!0)}a.mobileHA&&o(w).transformCache.translate3d===r&&(o(w).transformCache.translate3d="(0px, 0px, 0px)",S=!0),S&&E.flushTransformCache(w)}}a.display!==r&&"none"!==a.display&&(b.State.calls[n][2].display=!1),a.visibility!==r&&"hidden"!==a.visibility&&(b.State.calls[n][2].visibility=!1),a.progress&&a.progress.call(s[1],s[1],p,Math.max(0,f+a.duration-t),f),1===p&&c(n)}b.State.isTicking&&x(l)}function c(e,t){if(!b.State.calls[e])return!1;for(var n=b.State.calls[e][0],i=b.State.calls[e][1],s=b.State.calls[e][2],u=b.State.calls[e][4],a=!1,f=0,l=n.length;l>f;f++){var c=n[f].element;if(t||s.loop||("none"===s.display&&E.setPropertyValue(c,"display",s.display),"hidden"===s.visibility&&E.setPropertyValue(c,"visibility",s.visibility)),s.loop!==!0&&(v.queue(c)[1]===r||!/\.velocityQueueEntryFlag/i.test(v.queue(c)[1]))&&o(c)){o(c).isAnimating=!1,o(c).rootPropertyValueCache={};var h=!1;v.each(E.Lists.transforms3D,function(e,t){var n=/^scale/.test(t)?1:0,i=o(c).transformCache[t];o(c).transformCache[t]!==r&&(new RegExp("^\\("+n+"[^.]")).test(i)&&(h=!0,delete o(c).transformCache[t])}),s.mobileHA&&(h=!0,delete o(c).transformCache.translate3d),h&&E.flushTransformCache(c),E.Values.removeClass(c,"velocity-animating")}if(!t&&s.complete&&!s.loop&&f===l-1)try{s.complete.call(i,i)}catch(p){setTimeout(function(){throw p},1)}u&&s.loop!==!0&&u(i),s.loop!==!0||t||(v.each(o(c).tweensContainer,function(e,t){/^rotate/.test(e)&&360===parseFloat(t.endValue)&&(t.endValue=0,t.startValue=360)}),b(c,"reverse",{loop:!0,delay:s.delay})),s.queue!==!1&&v.dequeue(c,s.queue)}b.State.calls[e]=!1;for(var d=0,m=b.State.calls.length;m>d;d++)if(b.State.calls[d]!==!1){a=!0;break}a===!1&&(b.State.isTicking=!1,delete b.State.calls,b.State.calls=[])}var h=function(){if(n.documentMode)return n.documentMode;for(var e=7;e>4;e--){var t=n.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return t=null,e}return r}(),p=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var n=(new Date).getTime(),r;return r=Math.max(0,16-(n-e)),e=n+r,setTimeout(function(){t(n+r)},r)}}(),d={isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return"object"==typeof e&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==r&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)return!1;return!0}},v,m=!1;if(e.fn&&e.fn.jquery?(v=e,m=!0):v=t.Velocity.Utilities,8>=h&&!m)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=h)return void (jQuery.fn.velocity=jQuery.fn.animate);var g=400,y="swing",b={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:n.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:v,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:g,easing:y,begin:r,complete:r,progress:r,display:r,visibility:r,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(e){v.data(e,"velocity",{isSVG:d.isSVG(e),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:1,patch:0},debug:!1};t.pageYOffset!==r?(b.State.scrollAnchor=t,b.State.scrollPropertyLeft="pageXOffset",b.State.scrollPropertyTop="pageYOffset"):(b.State.scrollAnchor=n.documentElement||n.body.parentNode||n.body,b.State.scrollPropertyLeft="scrollLeft",b.State.scrollPropertyTop="scrollTop");var w=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,n,r){var i={x:t.x+r.dx*n,v:t.v+r.dv*n,tension:t.tension,friction:t.friction};return{dx:i.v,dv:e(i)}}function n(n,r){var i={dx:n.v,dv:e(n)},s=t(n,.5*r,i),o=t(n,.5*r,s),u=t(n,r,o),a=1/6*(i.dx+2*(s.dx+o.dx)+u.dx),f=1/6*(i.dv+2*(s.dv+o.dv)+u.dv);return n.x=n.x+a*r,n.v=n.v+f*r,n}return function r(e,t,i){var s={x:-1,v:0,tension:null,friction:null},o=[0],u=0,a=1e-4,f=.016,l,c,h;for(e=parseFloat(e)||500,t=parseFloat(t)||20,i=i||null,s.tension=e,s.friction=t,l=null!==i,l?(u=r(e,t),c=u/i*f):c=f;;)if(h=n(h||s,c),o.push(1+h.x),u+=16,!(Math.abs(h.x)>a&&Math.abs(h.v)>a))break;return l?function(e){return o[e*(o.length-1)|0]}:u}}();b.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},v.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){b.Easings[t[0]]=a.apply(null,t[1])});var E=b.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<E.Lists.colors.length;e++){var t="color"===E.Lists.colors[e]?"0 0 0 1":"255 255 255 1";E.Hooks.templates[E.Lists.colors[e]]=["Red Green Blue Alpha",t]}var n,r,i;if(h)for(n in E.Hooks.templates){r=E.Hooks.templates[n],i=r[0].split(" ");var s=r[1].match(E.RegEx.valueSplit);"Color"===i[0]&&(i.push(i.shift()),s.push(s.shift()),E.Hooks.templates[n]=[i.join(" "),s.join(" ")])}for(n in E.Hooks.templates){r=E.Hooks.templates[n],i=r[0].split(" ");for(var e in i){var o=n+i[e],u=e;E.Hooks.registered[o]=[n,u]}}},getRoot:function(e){var t=E.Hooks.registered[e];return t?t[0]:e},cleanRootPropertyValue:function(e,t){return E.RegEx.valueUnwrap.test(t)&&(t=t.match(E.RegEx.valueUnwrap)[1]),E.Values.isCSSNullValue(t)&&(t=E.Hooks.templates[e][1]),t},extractValue:function(e,t){var n=E.Hooks.registered[e];if(n){var r=n[0],i=n[1];return t=E.Hooks.cleanRootPropertyValue(r,t),t.toString().match(E.RegEx.valueSplit)[i]}return t},injectValue:function(e,t,n){var r=E.Hooks.registered[e];if(r){var i=r[0],s=r[1],o,u;return n=E.Hooks.cleanRootPropertyValue(i,n),o=n.toString().match(E.RegEx.valueSplit),o[s]=t,u=o.join(" ")}return n}},Normalizations:{registered:{clip:function(e,t,n){switch(e){case"name":return"clip";case"extract":var r;return E.RegEx.wrappedValueAlreadyExtracted.test(n)?r=n:(r=n.toString().match(E.RegEx.valueUnwrap),r=r?r[1].replace(/,(\s+)?/g," "):n),r;case"inject":return"rect("+n+")"}},blur:function(e,t,n){switch(e){case"name":return"-webkit-filter";case"extract":var r=parseFloat(n);if(!r&&0!==r){var i=n.toString().match(/blur\(([0-9]+[A-z]+)\)/i);r=i?i[1]:0}return r;case"inject":return parseFloat(n)?"blur("+n+")":"none"}},opacity:function(e,t,n){if(8>=h)switch(e){case"name":return"filter";case"extract":var r=n.toString().match(/alpha\(opacity=(.*)\)/i);return n=r?r[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(n)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(n),10)+")"}else switch(e){case"name":return"opacity";case"extract":return n;case"inject":return n}}},register:function(){9>=h||b.State.isGingerbread||(E.Lists.transformsBase=E.Lists.transformsBase.concat(E.Lists.transforms3D));for(var e=0;e<E.Lists.transformsBase.length;e++)!function(){var t=E.Lists.transformsBase[e];E.Normalizations.registered[t]=function(e,n,i){switch(e){case"name":return"transform";case"extract":return o(n)===r||o(n).transformCache[t]===r?/^scale/i.test(t)?1:0:o(n).transformCache[t].replace(/[()]/g,"");case"inject":var s=!1;switch(t.substr(0,t.length-1)){case"translate":s=!/(%|px|em|rem|vw|vh|\d)$/i.test(i);break;case"scal":case"scale":b.State.isAndroid&&o(n).transformCache[t]===r&&1>i&&(i=1),s=!/(\d)$/i.test(i);break;case"skew":s=!/(deg|\d)$/i.test(i);break;case"rotate":s=!/(deg|\d)$/i.test(i)}return s||(o(n).transformCache[t]="("+i+")"),o(n).transformCache[t]}}}();for(var e=0;e<E.Lists.colors.length;e++)!function(){var t=E.Lists.colors[e];E.Normalizations.registered[t]=function(e,n,i){switch(e){case"name":return t;case"extract":var s;if(E.RegEx.wrappedValueAlreadyExtracted.test(i))s=i;else{var o,u={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(i)?o=u[i]!==r?u[i]:u.black:E.RegEx.isHex.test(i)?o="rgb("+E.Values.hexToRgb(i).join(" ")+")":/^rgba?\(/i.test(i)||(o=u.black),s=(o||i).toString().match(E.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=h||3!==s.split(" ").length||(s+=" 1"),s;case"inject":return 8>=h?4===i.split(" ").length&&(i=i.split(/\s+/).slice(0,3).join(" ")):3===i.split(" ").length&&(i+=" 1"),(8>=h?"rgb":"rgba")+"("+i.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(h||b.State.isAndroid&&!b.State.isChrome)&&(t+="|transform"),(new RegExp("^("+t+")$","i")).test(e)},prefixCheck:function(e){if(b.State.prefixMatches[e])return[b.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],n=0,r=t.length;r>n;n++){var i;if(i=0===n?e:t[n]+e.replace(/^\w/,function(e){return e.toUpperCase()}),d.isString(b.State.prefixElement.style[i]))return b.State.prefixMatches[e]=i,[i,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,r;return e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r}),r=n.exec(e),r?[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)]:[0,0,0]},isCSSNullValue:function(e){return 0==e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":"block"},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=(e.className.length?" ":"")+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(e,n,i,s){function u(e,n){function i(){f&&E.setPropertyValue(e,"display","none")}var a=0;if(8>=h)a=v.css(e,n);else{var f=!1;if(/^(width|height)$/.test(n)&&0===E.getPropertyValue(e,"display")&&(f=!0,E.setPropertyValue(e,"display",E.Values.getDisplayType(e))),!s){if("height"===n&&"border-box"!==E.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var l=e.offsetHeight-(parseFloat(E.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(E.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(E.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(E.getPropertyValue(e,"paddingBottom"))||0);return i(),l}if("width"===n&&"border-box"!==E.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var c=e.offsetWidth-(parseFloat(E.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(E.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(E.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(E.getPropertyValue(e,"paddingRight"))||0);return i(),c}}var p;p=o(e)===r?t.getComputedStyle(e,null):o(e).computedStyle?o(e).computedStyle:o(e).computedStyle=t.getComputedStyle(e,null),(h||b.State.isFirefox)&&"borderColor"===n&&(n="borderTopColor"),a=9===h&&"filter"===n?p.getPropertyValue(n):p[n],(""===a||null===a)&&(a=e.style[n]),i()}if("auto"===a&&/^(top|right|bottom|left)$/i.test(n)){var d=u(e,"position");("fixed"===d||"absolute"===d&&/top|left/i.test(n))&&(a=v(e).position()[n]+"px")}return a}var a;if(E.Hooks.registered[n]){var f=n,l=E.Hooks.getRoot(f);i===r&&(i=E.getPropertyValue(e,E.Names.prefixCheck(l)[0])),E.Normalizations.registered[l]&&(i=E.Normalizations.registered[l]("extract",e,i)),a=E.Hooks.extractValue(f,i)}else if(E.Normalizations.registered[n]){var c,p;c=E.Normalizations.registered[n]("name",e),"transform"!==c&&(p=u(e,E.Names.prefixCheck(c)[0]),E.Values.isCSSNullValue(p)&&E.Hooks.templates[n]&&(p=E.Hooks.templates[n][1])),a=E.Normalizations.registered[n]("extract",e,p)}return/^[\d-]/.test(a)||(a=o(e)&&o(e).isSVG&&E.Names.SVGAttribute(n)?/^(height|width)$/i.test(n)?e.getBBox()[n]:e.getAttribute(n):u(e,E.Names.prefixCheck(n)[0])),E.Values.isCSSNullValue(a)&&(a=0),b.debug>=2&&console.log("Get "+n+": "+a),a},setPropertyValue:function(e,n,r,i,s){var u=n;if("scroll"===n)s.container?s.container["scroll"+s.direction]=r:"Left"===s.direction?t.scrollTo(r,s.alternateValue):t.scrollTo(s.alternateValue,r);else if(E.Normalizations.registered[n]&&"transform"===E.Normalizations.registered[n]("name",e))E.Normalizations.registered[n]("inject",e,r),u="transform",r=o(e).transformCache[n];else{if(E.Hooks.registered[n]){var a=n,f=E.Hooks.getRoot(n);i=i||E.getPropertyValue(e,f),r=E.Hooks.injectValue(a,r,i),n=f}if(E.Normalizations.registered[n]&&(r=E.Normalizations.registered[n]("inject",e,r),n=E.Normalizations.registered[n]("name",e)),u=E.Names.prefixCheck(n)[0],8>=h)try{e.style[u]=r}catch(l){b.debug&&console.log("Browser does not support ["+r+"] for ["+u+"]")}else o(e)&&o(e).isSVG&&E.Names.SVGAttribute(n)?e.setAttribute(n,r):e.style[u]=r;b.debug>=2&&console.log("Set "+n+" ("+u+"): "+r)}return[u,r]},flushTransformCache:function(e){function t(t){return parseFloat(E.getPropertyValue(e,t))}var n="";if((h||b.State.isAndroid&&!b.State.isChrome)&&o(e).isSVG){var r={translate:[t("translateX"),t("translateY")],skewX:[t("skewX")],skewY:[t("skewY")],scale:1!==t("scale")?[t("scale"),t("scale")]:[t("scaleX"),t("scaleY")],rotate:[t("rotateZ"),0,0]};v.each(o(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),r[e]&&(n+=e+"("+r[e].join(" ")+") ",delete r[e])})}else{var i,s;v.each(o(e).transformCache,function(t){return i=o(e).transformCache[t],"transformPerspective"===t?(s=i,!0):(9===h&&"rotateZ"===t&&(t="rotate"),void (n+=t+i+" "))}),s&&(n="perspective"+s+" "+n)}E.setPropertyValue(e,"transform",n)}};E.Hooks.register(),E.Normalizations.register(),b.hook=function(e,t,n){var i=r;return e=s(e),v.each(e,function(e,s){if(o(s)===r&&b.init(s),n===r)i===r&&(i=b.CSS.getPropertyValue(s,t));else{var u=b.CSS.setPropertyValue(s,t,n);"transform"===u[0]&&b.CSS.flushTransformCache(s),i=u}}),i};var S=function(){function e(){return h?L.promise||null:p}function u(){function e(e){function h(e,t){var n=r,i=r,o=r;return d.isArray(e)?(n=e[0],!d.isArray(e[1])&&/^[\d-]/.test(e[1])||d.isFunction(e[1])||E.RegEx.isHex.test(e[1])?o=e[1]:(d.isString(e[1])&&!E.RegEx.isHex.test(e[1])||d.isArray(e[1]))&&(i=t?e[1]:f(e[1],u.duration),e[2]!==r&&(o=e[2]))):n=e,t||(i=i||u.easing),d.isFunction(n)&&(n=n.call(s,N,T)),d.isFunction(o)&&(o=o.call(s,N,T)),[n||0,i,o]}function p(e,t){var n,r;return r=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return n=e,""}),n||(n=E.Values.getUnitType(e)),[r,n]}function m(){var e={myParent:s.parentNode||n.body,position:E.getPropertyValue(s,"position"),fontSize:E.getPropertyValue(s,"fontSize")},r=e.position===H.lastPosition&&e.myParent===H.lastParent,i=e.fontSize===H.lastFontSize;H.lastParent=e.myParent,H.lastPosition=e.position,H.lastFontSize=e.fontSize;var u=100,a={};if(i&&r)a.emToPx=H.lastEmToPx,a.percentToPxWidth=H.lastPercentToPxWidth,a.percentToPxHeight=H.lastPercentToPxHeight;else{var f=o(s).isSVG?n.createElementNS("http://www.w3.org/2000/svg","rect"):n.createElement("div");b.init(f),e.myParent.appendChild(f),v.each(["overflow","overflowX","overflowY"],function(e,t){b.CSS.setPropertyValue(f,t,"hidden")}),b.CSS.setPropertyValue(f,"position",e.position),b.CSS.setPropertyValue(f,"fontSize",e.fontSize),b.CSS.setPropertyValue(f,"boxSizing","content-box"),v.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){b.CSS.setPropertyValue(f,t,u+"%")}),b.CSS.setPropertyValue(f,"paddingLeft",u+"em"),a.percentToPxWidth=H.lastPercentToPxWidth=(parseFloat(E.getPropertyValue(f,"width",null,!0))||1)/u,a.percentToPxHeight=H.lastPercentToPxHeight=(parseFloat(E.getPropertyValue(f,"height",null,!0))||1)/u,a.emToPx=H.lastEmToPx=(parseFloat(E.getPropertyValue(f,"paddingLeft"))||1)/u,e.myParent.removeChild(f)}return null===H.remToPx&&(H.remToPx=parseFloat(E.getPropertyValue(n.body,"fontSize"))||16),null===H.vwToPx&&(H.vwToPx=parseFloat(t.innerWidth)/100,H.vhToPx=parseFloat(t.innerHeight)/100),a.remToPx=H.remToPx,a.vwToPx=H.vwToPx,a.vhToPx=H.vhToPx,b.debug>=1&&console.log("Unit ratios: "+JSON.stringify(a),s),a}if(u.begin&&0===N)try{u.begin.call(y,y)}catch(g){setTimeout(function(){throw g},1)}if("scroll"===A){var S=/^x$/i.test(u.axis)?"Left":"Top",C=parseFloat(u.offset)||0,k,O,M;u.container?d.isWrapped(u.container)||d.isNode(u.container)?(u.container=u.container[0]||u.container,k=u.container["scroll"+S],M=k+v(s).position()[S.toLowerCase()]+C):u.container=null:(k=b.State.scrollAnchor[b.State["scrollProperty"+S]],O=b.State.scrollAnchor[b.State["scrollProperty"+("Left"===S?"Top":"Left")]],M=v(s).offset()[S.toLowerCase()]+C),a={scroll:{rootPropertyValue:!1,startValue:k,currentValue:k,endValue:M,unitType:"",easing:u.easing,scrollData:{container:u.container,direction:S,alternateValue:O}},element:s},b.debug&&console.log("tweensContainer (scroll): ",a.scroll,s)}else if("reverse"===A){if(!o(s).tweensContainer)return void v.dequeue(s,u.queue);"none"===o(s).opts.display&&(o(s).opts.display="auto"),"hidden"===o(s).opts.visibility&&(o(s).opts.visibility="visible"),o(s).opts.loop=!1,o(s).opts.begin=null,o(s).opts.complete=null,x.easing||delete u.easing,x.duration||delete u.duration,u=v.extend({},o(s).opts,u);var _=v.extend(!0,{},o(s).tweensContainer);for(var D in _)if("element"!==D){var P=_[D].startValue;_[D].startValue=_[D].currentValue=_[D].endValue,_[D].endValue=P,d.isEmptyObject(x)||(_[D].easing=u.easing),b.debug&&console.log("reverse tweensContainer ("+D+"): "+JSON.stringify(_[D]),s)}a=_}else if("start"===A){var _;o(s).tweensContainer&&o(s).isAnimating===!0&&(_=o(s).tweensContainer),v.each(w,function(e,t){if(RegExp("^"+E.Lists.colors.join("$|^")+"$").test(e)){var n=h(t,!0),i=n[0],s=n[1],o=n[2];if(E.RegEx.isHex.test(i)){for(var u=["Red","Green","Blue"],a=E.Values.hexToRgb(i),f=o?E.Values.hexToRgb(o):r,l=0;l<u.length;l++){var c=[a[l]];s&&c.push(s),f!==r&&c.push(f[l]),w[e+u[l]]=c}delete w[e]}}});for(var j in w){var F=h(w[j]),I=F[0],q=F[1],U=F[2];j=E.Names.camelCase(j);var z=E.Hooks.getRoot(j),W=!1;if(o(s).isSVG||E.Names.prefixCheck(z)[1]!==!1||E.Normalizations.registered[z]!==r){(u.display!==r&&null!==u.display&&"none"!==u.display||u.visibility!==r&&"hidden"!==u.visibility)&&/opacity|filter/.test(j)&&!U&&0!==I&&(U=0),u._cacheValues&&_&&_[j]?(U===r&&(U=_[j].endValue+_[j].unitType),W=o(s).rootPropertyValueCache[z]):E.Hooks.registered[j]?U===r?(W=E.getPropertyValue(s,z),U=E.getPropertyValue(s,j,W)):W=E.Hooks.templates[z][1]:U===r&&(U=E.getPropertyValue(s,j));var X,J,K,Q=!1;if(X=p(j,U),U=X[0],K=X[1],X=p(j,I),I=X[0].replace(/^([+-\/*])=/,function(e,t){return Q=t,""}),J=X[1],U=parseFloat(U)||0,I=parseFloat(I)||0,"%"===J&&(/^(fontSize|lineHeight)$/.test(j)?(I/=100,J="em"):/^scale/.test(j)?(I/=100,J=""):/(Red|Green|Blue)$/i.test(j)&&(I=I/100*255,J="")),/[\/*]/.test(Q))J=K;else if(K!==J&&0!==U)if(0===I)J=K;else{c=c||m();var G=/margin|padding|left|right|width|text|word|letter/i.test(j)||/X$/.test(j)||"x"===j?"x":"y";switch(K){case"%":U*="x"===G?c.percentToPxWidth:c.percentToPxHeight;break;case"px":break;default:U*=c[K+"ToPx"]}switch(J){case"%":U*=1/("x"===G?c.percentToPxWidth:c.percentToPxHeight);break;case"px":break;default:U*=1/c[J+"ToPx"]}}switch(Q){case"+":I=U+I;break;case"-":I=U-I;break;case"*":I=U*I;break;case"/":I=U/I}a[j]={rootPropertyValue:W,startValue:U,currentValue:U,endValue:I,unitType:J,easing:q},b.debug&&console.log("tweensContainer ("+j+"): "+JSON.stringify(a[j]),s)}else b.debug&&console.log("Skipping ["+z+"] due to a lack of browser support.")}a.element=s}a.element&&(E.Values.addClass(s,"velocity-animating"),B.push(a),""===u.queue&&(o(s).tweensContainer=a,o(s).opts=u),o(s).isAnimating=!0,N===T-1?(b.State.calls.length>1e4&&(b.State.calls=i(b.State.calls)),b.State.calls.push([B,y,u,null,L.resolver]),b.State.isTicking===!1&&(b.State.isTicking=!0,l())):N++)}var s=this,u=v.extend({},b.defaults,x),a={},c;switch(o(s)===r&&b.init(s),parseFloat(u.delay)&&u.queue!==!1&&v.queue(s,u.queue,function(e){b.velocityQueueEntryFlag=!0,o(s).delayTimer={setTimeout:setTimeout(e,parseFloat(u.delay)),next:e}}),u.duration.toString().toLowerCase()){case"fast":u.duration=200;break;case"normal":u.duration=g;break;case"slow":u.duration=600;break;default:u.duration=parseFloat(u.duration)||1}b.mock!==!1&&(b.mock===!0?u.duration=u.delay=1:(u.duration*=parseFloat(b.mock)||1,u.delay*=parseFloat(b.mock)||1)),u.easing=f(u.easing,u.duration),u.begin&&!d.isFunction(u.begin)&&(u.begin=null),u.progress&&!d.isFunction(u.progress)&&(u.progress=null),u.complete&&!d.isFunction(u.complete)&&(u.complete=null),u.display!==r&&null!==u.display&&(u.display=u.display.toString().toLowerCase(),"auto"===u.display&&(u.display=b.CSS.Values.getDisplayType(s))),u.visibility!==r&&null!==u.visibility&&(u.visibility=u.visibility.toString().toLowerCase()),u.mobileHA=u.mobileHA&&b.State.isMobile&&!b.State.isGingerbread,u.queue===!1?u.delay?setTimeout(e,u.delay):e():v.queue(s,u.queue,function(t,n){return n===!0?(L.promise&&L.resolver(y),!0):(b.velocityQueueEntryFlag=!0,void e(t))}),""!==u.queue&&"fx"!==u.queue||"inprogress"===v.queue(s)[0]||v.dequeue(s)}var a=arguments[0]&&(v.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||d.isString(arguments[0].properties)),h,p,m,y,w,x;if(d.isWrapped(this)?(h=!1,m=0,y=this,p=this):(h=!0,m=1,y=a?arguments[0].elements:arguments[0]),y=s(y)){a?(w=arguments[0].properties,x=arguments[0].options):(w=arguments[m],x=arguments[m+1]);var T=y.length,N=0;if("stop"!==w&&!v.isPlainObject(x)){var C=m+1;x={};for(var k=C;k<arguments.length;k++)d.isArray(arguments[k])||!/^(fast|normal|slow)$/i.test(arguments[k])&&!/^\d/.test(arguments[k])?d.isString(arguments[k])||d.isArray(arguments[k])?x.easing=arguments[k]:d.isFunction(arguments[k])&&(x.complete=arguments[k]):x.duration=arguments[k]}var L={promise:null,resolver:null,rejecter:null};h&&b.Promise&&(L.promise=new b.Promise(function(e,t){L.resolver=e,L.rejecter=t}));var A;switch(w){case"scroll":A="scroll";break;case"reverse":A="reverse";break;case"stop":v.each(y,function(e,t){o(t)&&o(t).delayTimer&&(clearTimeout(o(t).delayTimer.setTimeout),o(t).delayTimer.next&&o(t).delayTimer.next(),delete o(t).delayTimer)});var O=[];return v.each(b.State.calls,function(e,t){t&&v.each(t[1],function(n,i){var s=d.isString(x)?x:"";return x!==r&&t[2].queue!==s?!0:void v.each(y,function(t,n){n===i&&(x!==r&&(v.each(v.queue(n,s),function(e,t){d.isFunction(t)&&t(null,!0)}),v.queue(n,s,[])),o(n)&&""===s&&v.each(o(n).tweensContainer,function(e,t){t.endValue=t.currentValue}),O.push(e))})})}),v.each(O,function(e,t){c(t,!0)}),L.promise&&L.resolver(y),e();default:if(!v.isPlainObject(w)||d.isEmptyObject(w)){if(d.isString(w)&&b.Redirects[w]){var M=v.extend({},x),_=M.duration,D=M.delay||0;return M.backwards===!0&&(y=v.extend(!0,[],y).reverse()),v.each(y,function(e,t){parseFloat(M.stagger)?M.delay=D+parseFloat(M.stagger)*e:d.isFunction(M.stagger)&&(M.delay=D+M.stagger.call(t,e,T)),M.drag&&(M.duration=parseFloat(_)||(/^(callout|transition)/.test(w)?1e3:g),M.duration=Math.max(M.duration*(M.backwards?1-e/T:(e+1)/T),.75*M.duration,200)),b.Redirects[w].call(t,t,M||{},e,T,y,L.promise?L:r)}),e()}var P="Velocity: First argument ("+w+") was not a property map, a known action, or a registered redirect. Aborting.";return L.promise?L.rejecter(new Error(P)):console.log(P),e()}A="start"}var H={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},B=[];v.each(y,function(e,t){d.isNode(t)&&u.call(t)});var M=v.extend({},b.defaults,x),j;if(M.loop=parseInt(M.loop),j=2*M.loop-1,M.loop)for(var F=0;j>F;F++){var I={delay:M.delay,progress:M.progress};F===j-1&&(I.display=M.display,I.visibility=M.visibility,I.complete=M.complete),S(y,"reverse",I)}return e()}};b=v.extend(S,b),b.animate=S;var x=t.requestAnimationFrame||p;return b.State.isMobile||n.hidden===r||n.addEventListener("visibilitychange",function(){n.hidden?(x=function(e){return setTimeout(function(){e(!0)},16)},l()):x=t.requestAnimationFrame||p}),e.Velocity=b,e!==t&&(e.fn.velocity=S,e.fn.velocity.defaults=b.defaults),v.each(["Down","Up"],function(e,t){b.Redirects["slide"+t]=function(e,n,i,s,o,u){var a=v.extend({},n),f=a.begin,l=a.complete,c={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},h={};a.display===r&&(a.display="Down"===t?"inline"===b.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),a.begin=function(){f&&f.call(o,o);for(var n in c){h[n]=e.style[n];var r=b.CSS.getPropertyValue(e,n);c[n]="Down"===t?[r,0]:[0,r]}h.overflow=e.style.overflow,e.style.overflow="hidden"},a.complete=function(){for(var t in h)e.style[t]=h[t];l&&l.call(o,o),u&&u.resolver(o)},b(e,c,a)}}),v.each(["In","Out"],function(e,t){b.Redirects["fade"+t]=function(e,n,i,s,o,u){var a=v.extend({},n),f={opacity:"In"===t?1:0},l=a.complete;a.complete=i!==s-1?a.begin=null:function(){l&&l.call(o,o),u&&u.resolver(o)},a.display===r&&(a.display="In"===t?"auto":"none"),b(this,f,a)}}),b}(window.jQuery||window.Zepto||window,window,document)}),define("common/handlebars/helpers/formatDateHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n={};n.padNumber=function(e,t,n){var r,i;typeof n=="undefined"&&(n="0"),r=t-String(e).length,i="";if(r>0)while(r--)i+=n;return i+e},n.dayOfYear=function(e){var t;return t=new Date(e.getFullYear(),0,1),Math.ceil((e-t)/864e5)},n.weekOfYear=function(e){var t;return t=new Date(e.getFullYear(),0,1),Math.ceil(((e-t)/864e5+t.getDay()+1)/7)},n.isoWeekOfYear=function(e){var t,n,r,i;return i=new Date(e.valueOf()),n=(e.getDay()+6)%7,i.setDate(i.getDate()-n+3),r=new Date(i.getFullYear(),0,4),t=(i-r)/864e5,1+Math.ceil(t/7)},n.tweleveHour=function(e){return e.getHours()>12?e.getHours()-12:e.getHours()},n.timeZoneOffset=function(e){var t,r;return t=-e.getTimezoneOffset()/60,r=n.padNumber(Math.abs(t),4),(t>0?"+":"-")+r},n.format=function(e,t){return t.replace(n.formats,function(t,r){switch(r){case"a":return n.abbreviatedWeekdays[e.getDay()];case"A":return n.fullWeekdays[e.getDay()];case"b":return n.abbreviatedMonths[e.getMonth()];case"B":return n.fullMonths[e.getMonth()];case"c":return e.toLocaleString();case"C":return Math.round(e.getFullYear()/100);case"d":return n.padNumber(e.getDate(),2);case"D":return n.format(e,"%m/%d/%y");case"e":return n.padNumber(e.getDate(),2," ");case"F":return n.format(e,"%Y-%m-%d");case"h":return n.format(e,"%b");case"H":return n.padNumber(e.getHours(),2);case"I":return n.padNumber(n.tweleveHour(e),2);case"j":return n.padNumber(n.dayOfYear(e),3);case"k":return n.padNumber(e.getHours(),2," ");case"l":return n.padNumber(n.tweleveHour(e),2," ");case"L":return n.padNumber(e.getMilliseconds(),3);case"m":return n.padNumber(e.getMonth()+1,2);case"M":return n.padNumber(e.getMinutes(),2);case"n":return"\n";case"p":return e.getHours()>11?"PM":"AM";case"P":return n.format(e,"%p").toLowerCase();case"r":return n.format(e,"%I:%M:%S %p");case"R":return n.format(e,"%H:%M");case"s":return e.getTime()/1e3;case"S":return n.padNumber(e.getSeconds(),2);case"t":return"	";case"T":return n.format(e,"%H:%M:%S");case"u":return e.getDay()===0?7:e.getDay();case"U":return n.padNumber(n.weekOfYear(e),2);case"v":return n.format(e,"%e-%b-%Y");case"V":return n.padNumber(n.isoWeekOfYear(e),2);case"W":return n.padNumber(n.weekOfYear(e),2);case"w":return n.padNumber(e.getDay(),2);case"x":return e.toLocaleDateString();case"X":return e.toLocaleTimeString();case"y":return String(e.getFullYear()).substring(2);case"Y":return e.getFullYear();case"z":return n.timeZoneOffset(e);default:return match}})},n.formats=/%(a|A|b|B|c|C|d|D|e|F|h|H|I|j|k|l|L|m|M|n|p|P|r|R|s|S|t|T|u|U|v|V|W|w|x|X|y|Y|z)/g,n.abbreviatedWeekdays=["Sun","Mon","Tue","Wed","Thur","Fri","Sat"],n.fullWeekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n.abbreviatedMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n.fullMonths=["January","February","March","April","May","June","July","August","September","October","November","December"];var r=function(e,t){var r;return e?(r=new Date(e),r.setHours(r.getHours()+12),n.format(r,t)):null};return t.registerHelper("formatDateHelper",r),r.Dates=n,r}),define("common/utils",["common/handlebars/helpers/formatDateHelper"],function(e){var t=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],n=["January","February","March","April","May","June","July","August","September","October","November","December"],r,i,s;window.addEventListener("resize",function(){r!==undefined&&(r=undefined,i=undefined,s=undefined)});var o=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")},u=function(e){if(e.length>0){function t(e){e.attr("src","/site/common/images/anonymous-avatar.png").siblings(".frame").addClass("no-photo")}e.on("error",function(){t($(this))}),setTimeout(function(){e.each(function(){this.complete||t($(this))})},5e3)}},a=function(e,t,n){var r=new $.Deferred;if(C.isXs())r.resolve();else{n=_.defaults(n||{},{duration:600,endWidth:20,endHeight:20});var i=$(window).scrollTop(),s=$(window).scrollLeft(),o=e.offset().left-s,u=e.offset().top-i,a=t.offset().left-s+t.width()/2-n.endWidth/2,f=t.offset().top-i+t.height()/2-n.endHeight/2,l={position:"fixed",left:o,top:u,width:e.outerWidth(),opacity:1,"z-index":5e3,overflow:"hidden"},c={opacity:.4,left:a,top:f,width:n.endWidth,height:n.endHeight};e.clone().prependTo($("body")).css(l).velocity(c,n.duration,function(){$(this).remove(),r.resolve()})}return r},f=function(e){e.find("[ellipsis]").each(function(e,t){var n=$(t);t.offsetWidth<t.scrollWidth&&n.tooltip({title:n.html(),placement:"bottom",html:!0,container:"body"})})},l=function(e,t,n){var r;if(!e)return"";if(e.indexOf("googleusercontent.com")==-1||t==undefined)return e;var i="w"+t+"-"+"h"+n;return e=e.replace(/w\d+-h\d+/,i),e},c=function(e){e.on("click",function(e){$(e.target).select()})},h=function(e,t,n){if(!e||e.length===0)return;for(var r=0;r<e.length;r++){var i=e[r];i[t]===n&&(e.splice(r,1),r--)}},p=function(e){var t={},n;return e||(e=location.search),n=e.replace("?","").split("&"),$.each(n,function(e,n){var r=n.split("=");t[r[0]]=decodeURIComponent(r[1])}),t},d=function(){return window.history&&window.history.pushState},v=function(e){if(e){var t=e.split(/-/g);return new Date(t[0],t[1]-1,t[2])}return null},m=function(e){return e instanceof Date?e?e.getFullYear()+"-"+N(e.getMonth()+1,2)+"-"+N(e.getDate(),2):"":""},g=function(t){return t=E(t),e(t,"%D")},y=function(t,n){t=E(t);var r=e(t,"%A");return n?r.slice(0,3):r},b=function(e,t){e=E(e);var r=n[e.getMonth()];return t?r.slice(0,3):r},w=function(e){e=E(e);if(!e)return"";var t=y(e,!0),n=b(e,!0),r=e.getDate(),i=r<10?"0"+r:r,s=e.getFullYear().toString().slice(2,4);return i+"-"+n+"-"+s+" ("+t+")"},E=function(e){if(!e)return;return e instanceof Date||(e=v(e)),e},S=function(e,t,n){var r=typeof e=="string"?v(e):e;n=n||{};var i=n.clone?new Date(r.getTime()):r;return i.setTime(r.getTime()+t*24*60*60*1e3),typeof e=="string"&&(i=m(i)),i},x=function(e,t,n){return!_.isDate(e)||!_.isDate(t)||!_.isDate(n)?!1:e.getTime()>=t.getTime()&&e.getTime()<=n.getTime()},T=function(e,t){return t==undefined||e>t?e:t},N=function(e,t){return("0000000000"+e).slice(-t)},C={isXs:function(){return r===undefined&&(r=$("#xs-indicator").is(":visible")),r},isSm:function(){return i===undefined&&(i=$("#sm-indicator").is(":visible")),i},isMd:function(){return s===undefined&&(s=$("#md-indicator").is(":visible")),s}},k={setBodyBackgroundImage:function(e,t){var n=_.defaults(t||{},{backgroundSize:"cover",backgroundAttachment:"fixed"});$("body").css("background-image").indexOf(e)==-1&&(n.backgroundImage='url("/site/market/images/bg/'+e+'.jpg")',$("body").css(n))},clearBodyBackgroundImage:function(){$("body").css("background","")},setBoxedPage:function(e){C.isXs()||$("body").toggleClass("boxed",e||!1)}},L=function(e){var t=window.location.hostname.toLowerCase();(t==="localhost"||t==="sandbox-4.farmigo.com")&&console.log(e)},A=function(){var e=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);return e},O=function(){return navigator.userAgent.match(/iPhone/)},M=function(e){var t,n,r=p();if(r.search)return{category:"Search results"};if(r.category==="favorites")return{category:"favorites"};var i=r.category,s=r.subCategory;if(!i)t=_.findWhere(e.categories,{order:0}).title,n="All";else{var o=_.find(e.categories,function(e){return e.id==i}),u=_.find(o.subCategories,function(e){return e.id==s});t=o?o.title:undefined,n=u?u.title:i!="favorites"&&i!="search"?"All":undefined}return{category:t,subCategory:n}},D=function(e,t){return Math.random()*(t-e)+e},P=function(e,t){if(!t){t=_.pluck(e,"weight");if(!t)return}var n=_.reduce(t,function(e,t){return e+t},0),r=D(0,n),i=0;for(var s=0;s<e.length;s++){i+=t[s],i=+i.toFixed(2);if(r<=i)return e[s]}};return{weekDays:t,getLocationOrigin:o,handleImageLoad:u,animateElement:a,handleEllipsis:f,handlePicasaImage:l,makeAutoSelect:c,spliceByProperty:h,deparam:p,hasPushState:d,addDays:S,maxDate:T,pad:N,parseFromServerDate:v,isDateBetweenRange:x,formatToServerDate:m,formatToRegularDate:g,formatToAnalyticsDateString:w,formatWeekdayFromServerDate:y,html:k,clientViewPort:C,log:L,isMobile:A,isIphone:O,getCategoriesFromUrl:M,getRandomItemByWeight:P}}),define("common/nav",["require","common/globals","common/utils"],function(e){var t=e("common/globals"),n=e("common/utils"),r=" | Farmigo Food Community",i={Market:{path:"market",title:"Market"},Order:{path:"order",isRequireLogin:!0,title:"Order"},Payment:{path:"payment",isBoxed:!0,title:"Payment Info"},ThankYou:{path:"thankyou",isBoxed:!0,title:"Thank You"},Reorder:{path:"reorder",isRequireLogin:!0,title:"Reorder"},History:{path:"history",isRequireLogin:!0,title:"Order History"},Account:{path:"account-info",isRequireLogin:!0,isBoxed:!0,title:"Account Info"},Login:{path:"login",isBoxed:!0,title:"Login"},SignUp:{path:"sign-up",isBoxed:!0,title:"Create Account"},ForgotPassword:{path:"forgot-password",isBoxed:!0,title:"Forgot Password"},ChangePassword:{path:"change-password",isBoxed:!0,title:"Change Password"},ChooseCommunity:{path:"map",title:"Choose Community",isCommunityDependent:!1},Logout:{path:"logout",title:"Logout"}};for(var s in i)i[s].isCommunityDependent==undefined&&(i[s].isCommunityDependent=!0),i[s].title+=r;var o={IsForceNotRequireLogin:"nrl",ReferralInstanceKey:"ref",ReactivateSubscription:"r",Checkout:"ch",ChangePaymentDetails:"cpd",AccountChangePassword:"acp",Item:"item",Producer:"producer",Category:"category",SubCategory:"subCategory",Tag:"tag",Search:"search",Location:"location",Zoom:"zoom",Share:"share"},u=[o.Item,o.Producer,o.Category,o.SubCategory,o.Tag,o.Search],a=function(e,r,i,s){var o=n.deparam();o&&o.modal&&(t.modal.close(),r=r||{},r.replace=!0),t.eventBus.trigger("navigate",e,r,i,s)},f=function(){var e;return n.hasPushState()?e=location.pathname.split("/")[1]:location.hash?e=location.hash.split("?")[0].replace("#",""):e=i.Market.path,location.hostname==="localhost"&&e.indexOf("jsessionid")>0&&(e=e.split(";")[0]),e},l=function(e){var t;e===undefined&&(e=f());for(t in i)if(i[t].path===e)return i[t]},c=function(e){var t;e===undefined&&(e=f());for(t in i)if(i[t].path===e)return t},h=function(){return n.deparam(location.search)};return{PROMOTIONAL_PARAMS:u,PageEnum:i,PageParam:o,navigate:a,getPage:l,getPageName:c,getParams:h}}),define("hbs!common/alert/alertTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return"alert-dismissible"}function c(e,t){return'class="container"'}function h(e,t){return'\n			<button class="close pull-right" type="button">\n				<span aria-hidden="true">&times;</span>\n				<span class="sr-only">Close</span>\n			</button>\n		'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="',(o=n.className)?o=o.call(t,{hash:{}}):(o=t&&t.className,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+" alert ",(o=n.alertType)?o=o.call(t,{hash:{}}):(o=t&&t.alertType,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+" ",o=n["if"].call(t,t&&t.isDismissible,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' fade in clearfix" role="alert" style="display: block">\n	<div ',o=n["if"].call(t,t&&t.isWide,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='>\n		<i class="type pull-left"></i>\n		<div class="message pull-left">\n			',(o=n.message)?o=o.call(t,{hash:{}}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;s+='\n			<div class="alert-region"></div>\n		</div>\n		',o=n["if"].call(t,t&&t.isDismissible,{hash:{},inverse:f.noop,fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="\n	</div>\n</div>",s});return n}),define("common/alert/alert",["require","hbs!common/alert/alertTemplate","backbone","marionette"],function(e){var t=e("hbs!common/alert/alertTemplate"),n=e("backbone"),r=e("marionette"),i={success:"alert-success",info:"alert-info",warning:"alert-warning",danger:"alert-danger",untyped:"alert-untyped"},s=i.success,o=r.LayoutView.extend({template:t,ui:{alert:".alert"},regions:{message:".alert-region"},className:function(){return this.model.get("parentClassName")},onRender:function(){this.ui.alert.on("closed.bs.alert",function(){this.$el.remove()}.bind(this))},events:{"click button.close":function(){this.model.get("isDismissible")&&(this.ui.alert.alert("close"),this.trigger("close:clicked"))},"click a":function(){this.trigger("link:clicked")}},fade:function(){this.ui.alert.alert("close")}}),u=function(e,t,r,i){r=r||s,i=_.defaults(i||{},{isDismissible:!0,isMessageView:!1});var u=new n.Model({alertType:r,isDismissible:i.isDismissible,isWide:i.isWide,className:i.className,title:i.title,parentClassName:i.parentClassName});i.isMessageView||u.set("message",e);var a=new o({model:u}),f="alert_"+i.key;if(!i.isOnceDuringSession||!sessionStorage[f])t.show(a),i.isMessageView&&a.message.show(e),i.isOnceDuringSession&&a.on("close:clicked",function(){sessionStorage.setItem(f,!0)});return a},a=function(e){e.empty()},f=function(e){e.fade()};return{show:u,hide:a,fade:f,AlertType:i}}),define("common/globalMessage",["require","common/alert/alert","common/globals"],function(e){var t=e("common/alert/alert"),n=e("common/globals"),r,i,s,o={AutoCouponApplied:"autoCouponApplied"},u=function(e){return e==undefined||e!=undefined&&e==s};return{init:function(e){r=e||{},n.eventBus.on("route",this.hideMessage)},showError:function(e,n){return this.show(e,t.AlertType.warning,n)},showSuccess:function(e,n){return this.show(e,t.AlertType.success,n)},show:function(e,n,o){return o=o||{},o.isWide=!0,s=o.key,$("body").scrollTop(0),i=t.show(e,r.region,n,o),i},hide:function(e){u(e)&&r.region&&r.region.hasView()&&r.region.empty()},fade:function(e){u(e)&&i&&t.fade(i)},getHeight:function(){return i&&i.$el.is(":visible")?i.$el.height():0},getKey:function(){return i&&i.$el.is(":visible")?s:null},AlertType:t.AlertType,KEYS:o}}),define("common/enums",["underscore"],function(e){var t=e.clone(Farmigo.enums);return delete Farmigo.enums,t.SingleItemType={Share:"Share",Producer:"Producer"},t.ShareActionType={Add:1,AddQuantity:2,SubQuantity:3,OpenProducerPage:4,OpenProductPage:5},t.ShareViewType={Main:"Main",Related:"Related"},t.CouponErrorCode={NO_COUPON:"NO_COUPON",INVALID_MEMBER_TYPE:"INVALID_MEMBER_TYPE",SAME_COUPON:"SAME_COUPON",COUPON_INACTIVE:"COUPON_INACTIVE",OK:"OK"},t.SubCategory={NonLocal:"Beyond Our Region"},t.UserRole={Member:"Member",Organizer:"Organizer",Farmigo:"Farmigo",FarmigoOrganizer:"Farmigo (Organizer)"},t.FilterType={Category:"Category",SubCategory:"SubCategory",Producer:"Producer",Upsell:"Upsell",Tag:"Tag",Custom:"Custom",Random:"Random",BestSellers:"BestSellers"},t.SortType={Category:"Category",Availability:" Availability"},t}),define("common/dataUtils/baseDataUtils",["require","common/enums","common/globals"],function(e){var t=e("common/enums"),n=e("common/globals"),r=function(e,t){var n=_.findWhere(e,{key:t});return(n||{}).id},i=function(n){var r=n.member,i=r&&r.hasDeliveries?t.MemberType.Existing:t.MemberType.New;return i},s=function(e){return e.autoCouponApplied},o=function(e){return e&&e.subscription&&e.subscription.referralDiscount};return{getMemberType:i,getIdByKey:r,isAutoCouponApplied:s,getHasReferral:o}}),define("common/dataUtils/orderDataUtils",["require","common/enums","common/globals","common/dataUtils/baseDataUtils"],function(e){var t=e("common/enums"),n=e("common/globals"),r=e("common/dataUtils/baseDataUtils"),i=function(e,n){var r=0,i=n||e.orderData;return i&&_.each(i,function(n){var i=e.sharesMap[n.shareKey];i&&i.status!==t.ShareStatus.TEMPORALLY_UNAVAILABLE&&(r+=u(e,n))}),r},s=function(e,n){if(n.subscriptionDiscount)return n.subscriptionDiscount;var i=e.sharesMap[n.shareKey];return i?r.getMemberType(e)===t.MemberType.New&&!r.getHasReferral(e)&&!r.isAutoCouponApplied(e)&&!e.isLoginOptimizedFlow?i.promotedNewMemberDiscount:i.promotedExistReferralMemberDiscount:0},o=function(e,t){var n=e.sharesMap[t.shareKey]?e.sharesMap[t.shareKey].price:t.price,r=a(t);if(r){var i=r.value,o=r.isFixed?n-i:n*(100-i)/100;return parseFloat(o.toFixed(2))}if(t.volumeDiscounts&&t.volumeDiscounts.length>0)return n;if(t.calculateDiscount){var i=s(e,t)||0;return t.price*(100-i)/100}return t.price},u=function(e,t){return o(e,t)*t.quantity},a=function(e){var t=e.volumeDiscounts,n;if(t&&t.length){var r=e.quantity;for(var i=0;i<t.length;i++)r>=t[i].numberOfItems&&(n=t[i])}return n},f=function(e){var t=e.subscription;return t&&t.discount?i(e)*t.discount/100:null},l=function(e){return!e||!e.subscription||!e.subscriptionDraft?!1:e.subscriptionDraft.lastModifiedTimeStamp>e.subscription.lastModifiedTimeStamp&&e.subscriptionDraft.orderItems&&e.subscriptionDraft.orderItems.length},c=function(e){var t=e.orderLock;return t&&!t.isOrderLocked},h=function(e){if(l(e)&&c(e)){var t=e.subscriptionDraft.orderItems,n=e.sharesMap;return e.orderData=t.reduce(function(e,t){var r=n[t.shareKey];if(r){var i={orderDeliveryDate:r.schedules[0].rawNextDelivery,price:r.price,quantity:t.quantity||1,scheduleKey:t.scheduleKey,shareKey:t.shareKey};e.push(i)}return e},[]),!0}return!1};return{getOrderTotal:i,getDiscount:f,getPromotionDiscount:s,getItemPrice:o,getItemTotal:u,restoreSubscriptionDraft:h}}),define("common/itemType",[],function(){return{Regular:"Regular",Bundle:"Bundle"}}),define("hbs!common/confirmationModal/confirmationModalTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function f(e,t){var r="",i;r+='\n		<button class="button cancel light" loading-animation>',(i=n.cancelText)?i=i.call(e,{hash:{}}):(i=e&&e.cancelText,i=typeof i===u?i.call(e,{hash:{}}):i);if(i||i===0)r+=i;return r+="</button>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this;s+='<h2 class="message">',(o=n.message)?o=o.call(t,{hash:{}}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;s+='</h2>\n<div class="actions">\n	<button class="button ok" loading-animation>',(o=n.okText)?o=o.call(t,{hash:{}}):(o=t&&t.okText,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;s+="</button>\n	",o=n["if"].call(t,t&&t.cancelText,{hash:{},inverse:a.noop,fn:a.program(1,f,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("common/confirmationModal/confirmationModal",["require","backbone","marionette","common/modal/modal","hbs!common/confirmationModal/confirmationModalTemplate"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/modal/modal"),i=e("hbs!common/confirmationModal/confirmationModalTemplate"),s=n.ItemView.extend({template:i,events:{"click button.ok":"_onOk","click button.cancel":"_onCancel"},_onOk:function(){this._onAction(this.model.get("onOk"))},_onCancel:function(){this._onAction(this.model.get("onCancel"))},_onAction:function(e){var t;e&&(t=e()),e&&t?t.then(function(){r.close()}):r.close()}}),o=function(n,i){var o=new t.Model(_.defaults(i||{},{okText:"OK",message:n})),u=new s({model:o});r.show(u,{className:"confirmation-modal",isDisallowClose:!0})};return{show:o}}),define("common/dataUtils/couponDataUtils",["require","common/enums","common/globals","common/dataUtils/baseDataUtils","common/dataUtils/orderDataUtils"],function(e){var t=e("common/enums"),n=e("common/globals"),r=e("common/dataUtils/baseDataUtils"),i=e("common/dataUtils/orderDataUtils"),s=function(t,n){return!a(n)&&!u(t,n)&&f(t,n)},o=function(e){return e?e.isMultiValue&&e.nestedCoupons&&e.nestedCoupons.length:!1},u=function(t,n){var r=!0,i=t.subscription;return i&&i.usedCoupons&&(r=!_.contains(i.usedCoupons,n.id)),!r},a=function(t){return t.isSingleUse&&t.status==="Used"},f=function(n,i){return i.memberType===t.MemberType.All||i.memberType===r.getMemberType(n)},l=function(n,i){var s=r.getMemberType(n),o,f;if(!i)return;switch(i.errorCode){case t.CouponErrorCode.OK:u(n,i.coupon)&&(o="Looks like you already used that coupon.",f="already used by member"),a(i.coupon)&&(o="Looks like that coupon was already used.",f="already used by another member");break;case t.CouponErrorCode.NO_COUPON:o="Looks like that coupon doesn’t exist.",f="doesn’t exist";break;case t.CouponErrorCode.COUPON_INACTIVE:o="Sorry, that coupon is expired.",f="expired";break;case t.CouponErrorCode.INVALID_MEMBER_TYPE:s===t.MemberType.Existing?(o="Sorry, this coupon is for first-time orders only.",f="first-time orders only"):(o="This coupon is for existing members. Please log in.",f="existing members only");break;case t.CouponErrorCode.SAME_COUPON:break;default:o="Opps, something went wrong",f="unknown error"}return{errorMessage:o,analyticsErrorMessage:f}},c=function(e){var t=p(e);if(t){var n=!1;return t&&t.key&&(n=!t.minimumOrder&&!t.couponTarget||t.minimumOrder&&i.getOrderTotal(e)>=t.minimumOrder||t.couponTarget&&_.findWhere(e.orderData,{shareKey:t.couponTarget})),e.subscription.currentCouponKey=n?t.id:null,n}},h=function(e){if(c(e)){var t=p(e),n;if(t.isMultiValue){n=i.getOrderTotal(e);var r=_.sortBy(t.nestedCoupons,function(e){return-e.minimumOrder});for(var s=0,o=r.length;s<o;s++){var u=r[s];if(n>u.minimumOrder){t=u;break}}}if(t.isFixedAmount)return t.discount;var a=i.getDiscount(e)||0;return n||(n=i.getOrderTotal(e)),t.discount*(n-a)/100}return 0},p=function(e){var t=e.subscription&&e.subscription.coupon;if(o(t)){var n,r=i.getOrderTotal(e),s=_.sortBy(t.nestedCoupons,function(e){return-e.minimumOrder});for(var u=0,a=s.length;u<a;u++){var f=s[u];if(r>f.minimumOrder){n=f;break}}t=n||s[s.length-1]}return t},d=function(e){var t=p(e);if(t)return t.parentId||t.id},v=function(t,r,i){t.subscription||(t.subscription={});var s={};s.key=i.key,s.couponTarget=i.couponTarget,s.id=i.id,s.couponType=i.couponType,s.discount=i.discount,s.minimumOrder=i.minimumOrder,s.isFixedAmount=i.isFixedAmount,s.isSingleUse=i.isSingleUse,s.usage=i.usage,s.memberType=i.memberType,s.voucherCampaignName=i.voucherCampaignName,s.nestedCoupons=i.nestedCoupons,s.isMultiValue=i.isMultiValue,s.parentKey=i.parentKey,s.parentId=i.parentId,s.isAppliedNow=!0,t.subscription.coupon=s,t.autoCouponApplied=!1,c(t),n.data.setIsOrderDirty(!0)},m=function(e){e.subscription&&(e.subscription.coupon={},e.subscription.currentCouponKey=null),e.autoCouponApplied=!1,n.data.setIsOrderDirty(!0)};return{getCoupon:p,getCouponId:d,isCouponValid:s,isCouponMemberTypeValid:f,isCouponUsedByMember:u,isSingleUsedCouponUsed:a,getCouponErrorMessage:l,isCouponActive:c,applyCoupon:v,removeCoupon:m,getCouponValue:h}}),define("common/dataUtils/mergeOrder",["require","common/dataUtils/baseDataUtils","common/dataUtils/orderDataUtils","common/dataUtils/couponDataUtils","common/enums","common/globals"],function(e){var t=e("common/dataUtils/baseDataUtils"),n=e("common/dataUtils/orderDataUtils"),r=e("common/dataUtils/couponDataUtils"),i=e("common/enums"),s=e("common/globals"),o=function(t,n,o){var u=n.orderData||[];n.orderData=u;var a=!1,f=n&&n.member&&n.member.hasDeliveries;s.data.discountChange={},u||(t.orderData=u);if(n.member){var l=n.sharesMap,c=n.nextDeliveryDate;for(var h=0,p=o.length;h<p;h++){var d=o[h];if(d.orderDeliveryDate<c)return;if(!_.findWhere(u,{shareKey:d.shareKey})){var v=l[d.shareKey];v&&(v.promotedExistReferralMemberDiscount||v.promotedNewMemberDiscount)&&f&&v.promotedExistReferralMemberDiscount!==v.promotedNewMemberDiscount&&(s.data.discountChange.promotedItemKey=v.key,d.calculateDiscount=!0,d.price=v.price),u.push(d),a=!0}if(t.subscription&&t.subscription.coupon){var m=t.subscription.coupon,g=n.subscription&&n.subscription.coupon;if(!g)if(r.isCouponValid(n,m))r.applyCoupon(n,m.id,m),a=!0;else{r.isCouponMemberTypeValid(n,m)||(m.errorCode=i.CouponErrorCode.INVALID_MEMBER_TYPE);var y=r.getCouponErrorMessage(n,m);s.model.set("mergeCouponErrorMessage",y?y.errorMessage:"")}}a&&(n.orderMerged=!0,s.data.setOrder(t.orderData))}}};return o}),define("common/dataService",["require","underscore","common/globals","common/globalMessage","common/enums","common/utils","common/dataUtils/baseDataUtils","common/dataUtils/orderDataUtils","common/itemType","common/confirmationModal/confirmationModal","common/dataUtils/mergeOrder"],function(e){function H(){c=t.clone(Farmigo.initialData,!0),D(c),n.data.isOrderHasSavedItems=c.orderData&&c.orderData.length>0,n.data.setBaselineOrder(c.orderData);if(u.restoreSubscriptionDraft(c))n.data.setOrder(c.orderData);else{var e=C();L(c,e)&&(c.orderData=e.order,e.coupon&&localStorage.setItem("coupon",e.coupon),n.data.setOrder(c.orderData))}m(c),g(!0);var r=document.getElementById("farmigo-data");$(r).remove(),A()}function B(){h=t.clone(Farmigo.initialData,!0),p.resolve(h)}function j(){Farmigo.initialDataType=="marketData"?H():B()}var t=e("underscore"),n=e("common/globals"),r=e("common/globalMessage"),i=e("common/enums"),s=e("common/utils"),o=e("common/dataUtils/baseDataUtils"),u=e("common/dataUtils/orderDataUtils"),a=e("common/itemType"),f=e("common/confirmationModal/confirmationModal"),l=e("common/dataUtils/mergeOrder"),c,h,p=new $.Deferred,d=function(e,i,s,o){var u=new $.Deferred;return e=t.defaults(e,{dataType:"json",type:"post"}),n.eventBus.trigger("loading:show",o),$.ajax(e).done(function(e){if(e&&e.error==="client refresh needed"){f.show('We\'ve made some improvements to our site!  Please click "Ok" to refresh this page.  Any unsaved changes will be lost - we apologize for any inconvenience.',{okText:"OK",onOk:function(){window.onbeforeunload=null,k(),window.location.href="/market/"+c.pickupSite.url}});return}i&&t.isFunction(i)&&i(e),n.eventBus.trigger("loading:hide"),u.resolve(e)}).fail(function(e){n.eventBus.trigger("loading:hide");if(e&&e.status===200){i&&t.isFunction(i)&&i(),u.resolve();return}s&&t.isFunction(s)&&s(e),u.reject(e),r.showError("Oops, something went wrong... Please try again")}),u.promise()},v=function(e){return e.addressLine1?e.addressLine1+(e.addressLine2?", "+e.addressLine2:""):""},m=function(e){var r=e.orderData;if(e.orderData&&e.orderData.length>0){var i=g();t.each(r,function(e){var t=i[e.shareKey];t&&(t.maxPerMember=Math.min(t.available,t.maxPerMember),t.maxPerMember==t.available&&n.data.isOrderHasSavedItems&&(t.maxPerMember=t.maxPerMember+e.quantity),t.itemType===a.Bundle&&(t.savedOrderQuantity=e.quantity))})}},g=function(t,n){return n||c?n?n.sharesMap:c.sharesMap:{}},y=function(e){return c&&e?c[e]:c},b=function(e){var t={farmKey:P.farmKey,memberKey:P.memberKey,pickupSiteKey:P.pickupSiteKey,basket:JSON.stringify(c.orderData||[])};e&&(c.subscription||{}).currentCouponKey&&(t[e||"coupon"]=c.subscription.currentCouponKey);var n=x();return n&&(t.referralInstance=n),c.orderDataBeforeSubmission=c.orderData,t},w=function(e){var t=e.statusCode=="FAILURE"?e.message:"Timeout error for payment";r.showError(t)},E=function(e,n,i){if(i&&t.isFunction(i))i(e);else{var s="Unknown server error occurred: "+e.error;r.showError(s)}n.reject(e)},S=function(e,n,r){var i=$.Deferred();return d(e,null,r).done(function(e){e&&e.error?E(e,i,r):(n&&t.isFunction(n)&&n(e),i.resolve(e))}),i.promise()},x=function(){var e=localStorage.getItem("referral.instance");if(e){e=JSON.parse(e);if(e.key&&e.expires&&(new Date).getTime()<e.expires)return e.key;localStorage.removeItem("referral.instance")}return null},T=function(e){return S({url:"/dispatcher/ReferralService.getReferralByReferralInstanceKey",data:{farmKey:P.farmKey,referralInstanceKey:e,includeSenderDetails:!0}},function(n){n&&(localStorage.setItem("referral.instance",JSON.stringify({key:t.isFunction(e)?e():e,expires:(new Date).getTime()+6048e5})),c.subscription=t.extend(c.subscription||{},{referralDiscount:n.recipientDiscount,isReferralDiscountFixed:n.isRecipientDiscountFixed,referralInstanceSet:!0}),c.referredBy=n.senderFirstName)})},N=function(e){e&&(e=JSON.stringify(e));try{localStorage.orderData=e}catch(t){}},C=function(){var e=localStorage.orderData;return e?(e=JSON.parse(e),e):null},k=function(){localStorage.removeItem("orderData")},L=function(e,r){if(!r)return!1;var u=!0,f=[];e.subscription&&e.subscription.key&&e.orderData&&e.orderData.length&&(u=!1,f.push("Existing member")),s.formatToServerDate(new Date)>r.storeCloseDate&&(u=!1,f.push("Cutoff"),t.defer(function(){n.eventBus.trigger("analytics:event","order","Saved Items - Expired by Cutoff"),mixpanel.register({Module:"Save Items"})})),r.storeCloseDate!==e.orderLock.storeCloseDate&&(u=!1,f.push("Delivery day changed"));var l=g();return t.each(r.order,function(n){var r=l[n.shareKey],s=t.findWhere(e.orderData,{shareKey:n.shareKey});if(!r)u=!1,f.push("Share doesn't exist (unavailable?)");else{if(r.itemType===a.Bundle){var c=!1;t.each(r.bundleComponents,function(e){if(!c){var t=l[e.itemKey];if(!t)c=!0;else if(t.status!=="AVAILABLE"||t.isSoldOut)c=!0}})}if(r.status!=="AVAILABLE"||r.isSoldOut||c)u=!1,f.push("Share temp unavailable/sold out");var h=x()||o.getMemberType(e)===i.MemberType.Existing,p=h?r.promotedExistReferralMemberDiscount:r.promotedNewMemberDiscount,d=p?r.price-p*r.price/100:r.price;d!==n.price&&(u=!1,f.push("price changed"))}}),u||t.defer(function(){var e=f.join(", ");s.log("conflicts"),mixpanel.register({Module:"Save Items"}),n.eventBus.trigger("analytics:event","order","Saved Items - Conflict",e)}),u},A=function(){n.eventBus.trigger("dataUpdated",c)},O=function(e,n){return t.map(e,function(e){var r=t.findWhere(n,{key:e});return r})},M=function(e,n){var r=t.map(n.tags,function(n){var r=t.filter(t.values(e),function(e){var r=t.find(e.tags,function(e){return e&&e.key===n.key});return r});return n.itemsNumber=r?r.length:0,n});r.sort(function(e,t){return t.itemsNumber-e.itemsNumber}),n.tags=r},_=function(){if(P.memberKey)return S({url:"/dispatcher/CommunitiesMemberService.loadFavorites",data:{farmKey:P.farmKey,memberKey:P.memberKey,pickupSiteKey:P.pickupSiteKey}}).done(function(e){c.favoriteShares=e,n.eventBus.trigger("loadFavorites:done")})},D=function(e){_(),e.previousOrderData=c?t.map(c.orderData,function(e){return t.clone(e)}):[];var n=g(!0,e);t.each(t.values(n),function(r){if(r.itemType===a.Bundle){var s=r.isSoldOut,o=r.status===i.ShareStatus.UNAVAILABLE,u=r.status===i.ShareStatus.TEMPORALLY_UNAVAILABLE;t.each(r.bundleComponents,function(e){var t=n[e.itemKey];t?(s||(s=t.isSoldOut),e.quantity>t.available&&(s=!0),u||(u=t.status===i.ShareStatus.TEMPORALLY_UNAVAILABLE)):o=!0}),r.isSoldOut=s||o,u&&(r.status=i.ShareStatus.TEMPORALLY_UNAVAILABLE)}r.tags=O(r.tags,e.tags)});var r={key:"LANDING_PAGE",title:"What's Cookin'",order:0,internalType:"CATEGORY",itemKeys:[],itemSortOrders:[],iconUrl:"/site/market/images/category/whats-cookin.svg",isEmpty:!0,type:"Regular",id:"LANDING_PAGE",subCategories:[]};e.categories.unshift(r),e.categories.forEach(function(e){var t;e.layout&&(e.layout=JSON.parse(e.layout)),e.subCategories.forEach(function(e,r){e.title==i.SubCategory.NonLocal&&(t=r,e.itemKeys&&e.itemKeys.forEach(function(e,t){var r=n[e];r&&(r.isNonLocal=!0)}))}),t!=undefined&&e.subCategories.splice(t,1)}),M(n,e),e.shouldShowLogin=e.isLoginOptimizedFlow&&(!e.member||!e.member.key)},P=t.clone(Farmigo.serverData,!0);return delete Farmigo.serverData,Farmigo.initialData?j():document.addEventListener("initialDataReady",j),{isProduction:P.isProduction,isIos:P.isIos,loadMarketData:function(e){var t=P.memberKey?"getMarketData":"getPublicMarketData";return S({url:"/dispatcher/MarketService."+t,data:{farmKey:P.farmKey,pickupSiteKey:P.pickupSiteKey,memberKey:P.memberKey}}).then(function(t){n.data.setBaselineOrder(t.orderData),n.data.itemsInBundleQuantityMap={},n.data.isOrderHasSavedItems=t.orderData&&t.orderData.length>0,D(t);if(e&&P.memberKey&&c&&!t.orderLock.isOrderLocked){u.restoreSubscriptionDraft(t)&&n.data.setOrder(t.orderData);var r=c.orderData;r&&r.length>0&&l(c,t,r)}c=t,m(c),g(!0),c.orderData=c.orderData||[],c.subscription&&(c.subscription.coupon=c.subscription.coupon||{}),A()})},getMarketData:y,signUp:function(e,t,i,s){return r.hide(),S({url:"/dispatcher/MembersService.createLightMember",data:{farmKey:P.farmKey,communityKey:P.pickupSiteKey,firstName:e,lastName:t,email:i,password:s}},function(r){r&&r.key&&(P.memberKey=r.key,c.member={changePassword:!1,email:i,firstName:e,hasCreditCard:!1,hasDeliveries:!1,hasSubscription:!1,key:r.key,lastName:t,receiveEmailReminders:!0,receiveNewsletter:!0,receiveSmsReminders:!1},_(c),n.eventBus.trigger("new-account-created",c),A())},function(e){r.showError(e.error)})},signUpWithFacebook:function(e,t,r,i){return S({url:"/dispatcher/MembersService.createCommunityFacebookMember",data:{farmKey:P.farmKey,communityKey:P.pickupSiteKey,firstName:e,lastName:t,email:r,facebookId:i}},function(i){i&&i.member&&(P.memberKey=i.member.key,c.member={changePassword:!1,email:r,firstName:e,hasCreditCard:!1,hasDeliveries:!1,hasSubscription:!1,key:i.member.key,lastName:t,receiveEmailReminders:!0,receiveNewsletter:!0,receiveSmsReminders:!1},n.eventBus.trigger("new-account-created",c),A())})},login:function(e,t){return S({url:"/dispatcher/AuthenticationService.signinSubscription",data:{farmKey:P.farmKey,email:e,password:t,remember:!0,sourceRequestUrl:window.location.href}},function(t){t.member&&t.member.key&&(P.memberKey=t.member.key,P.memberEmail=e)})},loginWithFacebook:function(e,t){return S({url:"/dispatcher/MembersService.facebookSubscriptionAuthenticate",data:{farmKey:P.farmKey,email:t,facebookId:e,remember:"true",sourceRequestUrl:window.location.href}},function(e){e.loginWithFacebook=!0,e.member&&e.member.key&&(P.memberKey=e.member.key)})},logout:function(){return S({url:"/dispatcher/AuthenticationService.signout",data:{farmKey:P.farmKey}},function(e){delete P.memberKey,n.eventBus.trigger("analytics:pageEvent","logout"),n.eventBus.trigger("app:logout",c)})},isLoggedIn:function(){return P.memberKey!==undefined},reactivateSubscription:function(){var e={memberKey:P.memberKey,farmKey:P.farmKey,subscriptionKey:(c.subscription||{}).key};return S({url:"/dispatcher/CommunitiesMemberService.reactivateSubscription",data:e},function(e){n.eventBus.trigger("analytics:pageEvent","Successful payment"),c.orderLock=c.orderLock||{},c.orderLock.isOrderLocked=!1,c.orderLock.lockReason="";if(e.message){var t=JSON.parse(e.message);t.nextDeliveryDate&&(c.orderLock.isOrderLocked=!0,c.orderLock.isStoreClosed=!0,c.orderLock.lockReason=i.EnumOrderLockReason.Other)}})},changeSubscription:function(e,r,i){var s=$.Deferred(),o=b("couponId");return o.privateCommunityReason=e,S({url:"/dispatcher/CommunitiesMemberService.changeSubscription",data:o}).done(function(e){i&&i(),c.previousOrderData=t.map(c.orderData,function(e){return t.clone(e)}),c.subscription=e.subscription||{},c.subscription.referralInstanceSet=!1,c.orderData=e.orders,c.orderExceptions=e.exceptions,n.data.setBaselineOrder(c.orderData),n.data.isOrderHasSavedItems=c.orderData&&c.orderData.length>0,n.data.isOrderCanceled=c.orderData&&c.orderData.length==0,r&&this._maintainOrderCount(),n.eventBus.trigger("change-subscription:order-updated",c),A(),s.resolve(e)}.bind(this)).fail(function(e){c.orderDataBeforeSubmission=null,s.reject(e)}),s},updateSubscriptionDraft:function(e,t){var n=b("couponId");return n.deliveryDate=e,t&&(n.basket=JSON.stringify([])),$.ajax({url:"/dispatcher/CommunitiesMemberService.updateSubscriptionDraft",type:"post",data:n})},createSubscription:function(e,t,r){var i=b("coupon"),s=v(e);i.cc=JSON.stringify({firstName:e.firstName,lastName:e.lastName,creditCardNumber:e.creditCardNumber,ccv:e.ccv,expirationDate:e.expYear+"-"+e.expMonth,city:e.city,address:s,state:e.state,zipCode:e.zipCode}),i.phone=e.phone,i.receiveSmsReminders=e.receiveSmsReminders,i.privateCommunityReason=e.privateCommunityReason;var o=$.Deferred();return d({url:"/dispatcher/CommunitiesMemberService.marketCheckout",data:i},null,null,r).done(function(r){r.statusCode=="OK"?(t&&t(),c.memberCommunities=[{title:c.pickupSite.title,url:c.pickupSite.url}],c.subscription=r.subscription||c.subscription||{},c.subscription.referralInstanceSet=!1,c.orderData=r.orders,c.orderExceptions=r.exceptions,c.subscription.hasToken=!0,c.subscription.key=r.message,c.member.phone=e.phone,c.featuresFlags=r.featuresFlags,n.data.isOrderHasSavedItems=c.orderData&&c.orderData.length>0,this._maintainOrderCount(),n.data.setBaselineOrder(c.orderData),A(),o.resolve(r)):(w(r),c.orderDataBeforeSubmission=null,o.reject(r))}.bind(this)).fail(function(e){c.orderDataBeforeSubmission=null,o.reject(e)}),o.promise()},_maintainOrderCount:function(){if(c.pickupSite.isIncubate||c.pickupSite.status=="Relaunch")c.pickupSite.orderCount=c.pickupSite.orderCount||0,c.pickupSite.orderCount++},createToken:function(e){var t=$.Deferred(),r=v(e);return d({url:"/dispatcher/AuthorizeDotNetService.authenticate",data:{farmKey:P.farmKey,member:P.memberKey,firstName:e.firstName,lastName:e.lastName,cardNumber:e.creditCardNumber,expirationDate:e.expYear+"-"+e.expMonth,CCV:e.ccv,address:r,city:e.city||"",state:e.state||"",zip:e.zipCode||"",postActionKeyString:c.subscription.key}}).done(function(e){n.eventBus.trigger("analytics:pageEvent","Payment details submitted"),e.statusCode=="OK"?(c.subscription.hasToken=!0,t.resolve(e)):(w(e),t.reject(e))}).fail(function(e){t.reject(e)}),t.promise()},updateHoldPeriods:function(e){var n=$.Deferred(),i=[],s=[];return t.each(e,function(e){i.push(e.startDate),s.push(e.endDate)}),d({url:"/dispatcher/CommunitiesMemberService.updateVacations",data:{subscriptionKey:(c.subscription||{}).key,farmKey:P.farmKey,memberKey:P.memberKey,vacationStart:JSON.stringify(i),vacationEnd:JSON.stringify(s),sendEmail:!0}}).done(function(e){"OK"!=e.statusCode?(r.showError(e.message||"Timeout, please try again"),n.reject(e)):n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()},pay:function(e){var t=$.Deferred(),n=c.subscription||{};if(n.balance&&n.balance<0){var r={memberKey:P.memberKey,farmKey:P.farmKey,subscriptionKeyString:n.key,amount:-n.balance,emailTemplate:"extraPaymentTemplate"};e&&(r.amountOnBalance=!0),S({url:"/dispatcher/AuthorizeDotNetService.createCustomerProfileTransactionWithAmount",data:r}).done(function(e){e.statusCode=="OK"?t.resolve(e):(w(e),t.reject(e))}).fail(function(e){t.reject(e)})}else t.resolve();return t.promise()},getCouponData:function(e,t){return S({url:"/dispatcher/CommunitiesMemberService.getCouponData2",data:{farmKey:P.farmKey,pickupSiteKey:P.pickupSiteKey,member:P.memberKey,couponCode:e,couponMemberType:t,includeDraft:!0}})},sendSimpleEmail:function(e){return S({url:"/dispatcher/EmailService.sendEmailSimple",data:t.extend(e,{farmKey:P.farmKey})})},forgotPassword:function(e){return S({url:"/dispatcher/MembersService.forgotPassword",data:{farmKey:P.farmKey,email:e}})},changePassword:function(e){return S({url:"/dispatcher/AuthenticationService.changePassword",data:t.extend(e,{farmKey:P.farmKey,email:c.member.email,remember:!0})})},changeMemberDetails:function(e){return e.farmKey=P.farmKey,S({url:"/dispatcher/CommunitiesMemberService.changeMemberDetails",data:e},function(t){t&&t.statusCode==="OK"&&(c.member.firstName=e.firstName,c.member.lastName=e.lastName,c.member.email=e.email,c.member.phone=e.phone,c.member.receiveEmailReminders=!!e.receiveEmailReminders,c.member.receiveNewsletter=!!e.receiveNewsletter,c.member.receiveSmsReminders=!!e.receiveSmsReminders,A())})},getOrders:function(){return S({url:"/dispatcher/OrdersService.getHistoryForMember",data:{farmKey:P.farmKey,memberKey:P.memberKey,subscriptionKey:c.subscription.key}})},getCommunities:function(e){var t=6e4;return Farmigo.initialDataType!="communities"||h&&(new Date).getTime()-Farmigo.initialDataTimeStamp>t?S({url:"/dispatcher/MarketService.getCommunities"}):p},notifyMe:function(e){return S({url:"/dispatcher/CommunitiesMemberService.saveMemberSpreadsheetEntry",data:{entry:JSON.stringify(e)}})},sendSms:function(e,t){return d({url:"/dispatcher/SMSService.sendSMS",data:{to:e,message:t}})},setReferralInstance:T,getReferralInstance:x,writeOrderDataToLocalStorage:N,serverData:P,getSharesMap:g,getTagsWithTitles:O,triggerDataUpdated:A}}),define("common/dataUtils/farmShareDataUtils",["require","underscore","common/dataUtils/orderDataUtils"],function(e){function u(e){var n=t.reduce(e.orderData,function(n,r){var i=e.sharesMap[r.shareKey];return i&&!i.isNonLocal&&(t.isEmpty(i.bundleComponents)?n[i.producerKey]=i.marketProducerName:t.each(i.bundleComponents,function(t){var r=e.sharesMap[t.itemKey];r&&!r.isNonLocal&&(n[r.producerKey]=r.marketProducerName)})),n},{});return n}var t=e("underscore"),n=e("common/dataUtils/orderDataUtils"),r=60,i=function(e){var n=u(e);return t.unique(t.keys(n)).length>1},s=function(e){var t=n.getOrderTotal(e);return t*r/100},o=function(){return r},a=function(e){var n=u(e),r=t.unique(t.keys(n)),i=t.map(r,function(t){var r=e.producers[t];return r.title=n[t]||r.title,r});return i.length>=4?i.slice(0,4):i};return{shouldShowProducerShare:i,getFarmShareTotal:s,getFarmSharePercentage:o,getFarmShareProducers:a}}),define("common/dataUtils",["require","common/dataUtils/baseDataUtils","common/dataUtils/orderDataUtils","common/dataUtils/couponDataUtils","common/dataUtils/farmShareDataUtils","common/dataService","common/utils","common/enums","common/itemType","common/globals","jquery-cookie"],function(e){var t=e("common/dataUtils/baseDataUtils"),n=e("common/dataUtils/orderDataUtils"),r=e("common/dataUtils/couponDataUtils"),s=e("common/dataUtils/farmShareDataUtils"),o=e("common/dataService"),u=e("common/utils"),a=e("common/enums"),f=e("common/itemType"),l=e("common/globals");e("jquery-cookie");var c,h=o.getMarketData(),p=o.getSharesMap(),d={};l.eventBus.on("dataUpdated",function(){h=o.getMarketData(),p=o.getSharesMap()});var v=$.cookie("xDomainData");v&&(d=JSON.parse(v),l.eventBus.on("flow:header:logout",function(){d={}}));var m=function(e){return h.featuresFlags&&h.featuresFlags[e]},g=function(){return h&&h.subscription&&h.subscription.referralDiscount},y=function(){return c},b=function(e,t){var n=p[e];if(n.itemType==="Bundle"){var r=n.bundleComponents.every(function(e){var n=l.data.itemsInBundleQuantityMap[e.itemKey]||0,r=0,i=h.orderData;if(i){var s=_.findWhere(i,{shareKey:e.itemKey});s&&(r=s.quantity)}return p[e.itemKey]&&e.quantity*t+n+r<p[e.itemKey].maxPerMember});return r&&t<n.maxPerMember}var i=l.data.itemsInBundleQuantityMap[e]||0;return t+i<n.maxPerMember},w=function(t){d.homePageEmail&&!d.couponCode&&!h.isLoginOptimizedFlow&&(d.couponCode=sessionStorage.getItem("FarmigOptimizelyCoupon")||h.homePageCouponCode),d.couponCode?o.getCouponData(d.couponCode,k()).done(function(e){e&&e.errorCode===a.CouponErrorCode.OK&&C(e.coupon)?(N(d.couponCode,e.coupon),h.autoCouponApplied=!0,t(!0,!!d.homePageEmail)):t(!1)}):t(!1)},E=function(e){c=e},S=function(){c=""},x=function(e){$.removeCookie(e,{path:"/"}),$.removeCookie(e,{path:"/",domain:"."+window.location.hostname})},T=function(){$.removeCookie("xDomainData",{path:"/"}),$.removeCookie("xDomainData",{path:"/",domain:"."+window.location.hostname}),d={}},N=function(e,t){return r.applyCoupon(h,e,t)},C=function(e){return r.isCouponValid(h,e)},k=function(){return t.getMemberType(h)},L=function(){var e=h.senderReferral;return e?e.shareLink:""},A=function(){return u.getLocationOrigin()+"/"+(h.pickupSite||{}).shortUrl},O=function(){return h.orderCount<h.minCapacity&&!this.get("isPending")},M=function(){return h.status===a.EnumStatus.Pending},D=function(){if(!h||!h.member)return"";var e=h.isOrganizer,t=h.member.isFarmigoEmployee;return e&&t?a.UserRole.FarmigoOrganizer:e?a.UserRole.Organizer:t?a.UserRole.Farmigo:a.UserRole.Member},P=function(e){var t=h.favoriteShares,n=h.sharesMap,r=[];return _.each(t,function(t){var i=n[t];i&&(!e||e&&i.itemType!==f.Bundle)&&r.push(i)}),r},H=function(e,t){if(e&&e.length>0){var n=_.filter(e,function(e){return e.numberOfItems<=t});return n}};return{getMemberType:k,getUserRole:D,getFavouriteShares:P,isMemberTypeExist:function(){return k()===a.MemberType.Existing},getHasReferral:g,getPrivateCommunityReason:y,canAddShareToOrder:b,getOrderTotal:function(e){return n.getOrderTotal(h,e)},getItemTotal:function(e){return n.getItemTotal(h,e)},getItemPrice:function(e){return n.getItemPrice(h,e)},getDiscount:function(e){return n.getDiscount(h)},getPromotionDiscount:function(e){return n.getPromotionDiscount(h,e)},getVolumeDiscounts:H,isCouponValid:C,isCouponUsedByMember:function(e){return r.isCouponUsedByMember(h,e)},isSingleUsedCouponUsed:function(e){return r.isSingleUsedCouponUsed(e)},getCouponErrorMessage:function(e){return r.getCouponErrorMessage(h,e)},isCouponActive:function(){return r.isCouponActive(h)},getCoupon:function(){return r.getCoupon(h)},getCouponId:function(){return r.getCouponId(h)},getCouponValue:function(){return r.getCouponValue(h)},applyCoupon:N,applyAutoCoupon:w,removeCoupon:function(){return r.removeCoupon(h)},isAutoCouponApplied:function(){return t.isAutoCouponApplied(h)},isGroupBuyingDisplayedAlready:function(){return sessionStorage.groupBuying},shouldDisplayGroupBuying:function(){return m("groupBuying")},setGroupBuyingSessionStorage:function(){sessionStorage.setItem("groupBuying","true")},isPostalDeliveryDisplayedAlready:function(){var e=localStorage.postalDelivery;if(e){var t=(new Date).getTime(),n=t-e,r=Math.floor(n/864e5);return r>=7?!1:!0}return!1},shouldDisplayPostalDelivery:function(){return m("postalDelivery")},setPostalDeliverySessionStorage:function(){localStorage.postalDelivery=(new Date).getTime()},shouldDisplaySchoolWelcome:function(){return m("schoolWelcome")},ignoreFavoritesPopOver:function(){if(localStorage.popover_favorites)return!0},shouldDisplayMultiValueDiscount:function(){return h.multiValueCoupon&&m("multiValue_"+h.multiValueCoupon.id)&&k()===a.MemberType.Existing&&!h.orderLock.isOrderLocked&&!h.orderLock.isDeliveryHoldLocked&&(l.data.isOrderDirty()||!l.data.isOrderHasSavedItems&&!l.data.isOrderCanceled)},shouldDisplayMinimumOrder:function(){return(m("minimumOrder")||m("minimumOrder70"))&&h.minimumOrderCoupon&&k()===a.MemberType.Existing&&!h.orderLock.isOrderLocked&&!h.orderLock.isDeliveryHoldLocked},shouldShowWootric:function(){var e=o.getMarketData("subscription");if(e&&e.totalDeliveries%5==1)return!0},setWootric:function(){var e=o.isProduction?"NPS-bad9518f":"NPS-9a2cdb8f";sessionStorage.wootric||l.eventBus.trigger("analytics:event","Wootric","questionnaire shown","",0,!1),sessionStorage.setItem("wootric","true");var t=o.getMarketData(),n=t.subscription;if(n){var r=n.totalDeliveries+1;wootric_survey_immediately=!0,window.wootricSettings={account_token:e,email:t.member.email,properties:{siteType:t.pickupSite.communityType,region:t.region,Community:t.pickupSite.title,isOrganizer:t.isOrganizer?"yes":"no",orderNumber:r.toString()}},window.wootricSettings&&(i=new Image,i.src="//d8myem934l1zi.cloudfront.net/pixel.gif?account_token="+window.wootricSettings.account_token+"&email="+encodeURIComponent(window.wootricSettings.email)+"&created_at="+window.wootricSettings.created_at+"&url="+encodeURIComponent(window.location)+"&random="+Math.random()),window.lightningjs||function(e){function t(t,r){return r&&(r+=(/\?/.test(r)?"&":"?")+"lv=1"),e[t]||function(){var i=window,s=document,o=t,u=s.location.protocol,a="load",f=0;(function(){function t(){l.P(a),l.w=1,e[o]("_load")}e[o]=function(){function t(){return t.id=r,e[o].apply(t,arguments)}var n,r=++f;return n=this&&this!=i?this.id||0:0,(l.s=l.s||[]).push([r,n,arguments]),t.then=function(e,n,i){var s=l.fh[r]=l.fh[r]||[],o=l.eh[r]=l.eh[r]||[],u=l.ph[r]=l.ph[r]||[];return e&&s.push(e),n&&o.push(n),i&&u.push(i),t},t};var l=e[o]._={};l.fh={},l.eh={},l.ph={},l.l=r?r.replace(/^\/\//,(u=="https:"?u:"http:")+"//"):r,l.p={0:+(new Date)},l.P=function(e){l.p[e]=new Date-l.p[0]},l.w&&t(),i.addEventListener?i.addEventListener(a,t,!1):i.attachEvent("on"+a,t);var c=function(){function e(){return["<head></head><",t,' onload="var d=',d,";d.getElementsByTagName('head')[0].",i,"(d.",u,"('script')).",a,"='",l.l,"'\"></",t,">"].join("")}var t="body",r=s[t];if(!r)return setTimeout(c,100);l.P(1);var i="appendChild",u="createElement",a="src",f=s[u]("div"),h=f[i](s[u]("div")),p=s[u]("iframe"),d="document",v;f.style.display="none",r.insertBefore(f,r.firstChild).id=n+"-"+o,p.frameBorder="0",p.id=n+"-frame-"+o,/MSIE[ ]+6/.test(navigator.userAgent)&&(p[a]="javascript:false"),p.allowTransparency="true",h[i](p);try{p.contentWindow[d].open()}catch(m){l.domain=s.domain,v="javascript:var d="+d+".open();d.domain='"+s.domain+"';",p[a]=v+"void(0);"}try{var g=p.contentWindow[d];g.write(e()),g.close()}catch(y){p[a]=v+'d.write("'+e().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}l.P(2)};l.l&&c()})()}(),e[t].lv="1",e[t]}var n="lightningjs",r=window[n]=t(n);r.require=t,r.modules=e}({}),window.wootric=lightningjs.require("wootric","//d27j601g4x0gd5.cloudfront.net/beacon.js"),window.wootric("run")}},getOrderVariation:function(){return m("orderSecondVariation")?"second-variation":m("orderThirdVariation")?"third-variation":""},getIsGoalNotReached:O,getIsPending:M,getReferralLink:L,getShareLink:A,shouldShowProducerShare:function(){return s.shouldShowProducerShare(h)},getFarmShareTotal:function(){return s.getFarmShareTotal(h)},getFarmShareProducers:function(){return s.getFarmShareProducers(h)},getFarmSharePercentage:s.getFarmSharePercentage,setPrivateCommunityReason:E,removeCookie:x,clearPrivateCommunityReason:S,getIdByKey:t.getIdByKey,cleanup:T}}),function(){function i(e,t){return e.href=t}function s(e,t){return e.name=t}function X(e){W.set(e)}function V(e){return"function"==typeof e}function $(e){return"[object Array]"==Object[P].toString[j](Object(e))}function J(e){return void 0!=e&&-1<(e.constructor+"")[O]("String")}function K(e,t){return 0==e[O](t)}function Q(e){return e?e[o](/^[\s\xa0]+|[\s\xa0]+$/g,""):""}function G(){return[It()^yt()&2147483647,r.round((new Date)[d]()/1e3)][U](".")}function Y(e){var t=ct[h]("img");return t.width=1,t.height=1,t.src=e,t}function Z(){}function et(t){return e instanceof Function?e(t):(X(28),t)}function tt(e){return et(e)[o](/\(/g,"%28")[o](/\)/g,"%29")}function it(e,t){if(e){var n=ct[h]("script");n.type="text/javascript",n.async=!0,n.src=e,n.id=t;var r=ct.getElementsByTagName("script")[0];r[R].insertBefore(n,r)}}function st(){return tn||"https:"==ct[g][E]?"https:":"http:"}function ot(){var e=""+ct[g][b];return 0==e[O]("www.")?e[I](4):e}function ut(e){var t=ct.referrer;if(/^https?:\/\//i[k](t)){if(e)return t;e="//"+ct[g][b];var n=t[O](e);if(5==n||6==n)if(e=t[a](n+e[D]),"/"==e||"?"==e||""==e||":"==e)return;return t}}function at(e,t){if(1==t[D]&&null!=t[0]&&"object"==typeof t[0])return t[0];for(var n={},i=r.min(e[D]+1,t[D]),s=0;s<i;s++){if("object"==typeof t[s]){for(var o in t[s])t[s][y](o)&&(n[o]=t[s][o]);break}s<e[D]&&(n[e[s]]=t[s])}return n}function Lt(e){if(100!=e.get(Tr)&&Bi(Wt(e,hr))%1e4>=100*Xt(e,Tr))throw"abort"}function At(e){if(ht(Wt(e,dr)))throw"abort"}function Ot(){var e=ct[g][E];if("http:"!=e&&"https:"!=e)throw"abort"}function Mt(e){try{lt.XMLHttpRequest&&"withCredentials"in new lt.XMLHttpRequest?X(40):lt.XDomainRequest&&X(41),lt[q].sendBeacon&&X(42)}catch(t){}e.set(ln,Xt(e,ln)+1);var n=[];Ut.map(function(t,r){if(r.p){var i=e.get(t);void 0!=i&&i!=r[M]&&("boolean"==typeof i&&(i*=1),n[N](r.p+"="+et(""+i)))}});if(_r(new Mr(1e4))){var r=[];r[N](jt()),r[N][T](r,G()[m](".")),r[N](Ft()),r[N](r[0]|r[1]|r[2]|r[3]),n[N]("z="+r[U]("."))}else n[N]("z="+Ft());e.set(an,n[U]("&"),!0)}function _t(e){var t=Wt(e,kr)||bt()+"/collect";St(t,Wt(e,an),e.get(un),e.get(fn)),e.set(un,Z,!0)}function Dt(e){var t=lt.gaData;t&&(t.expId&&e.set(qn,t.expId),t.expVar&&e.set(Rn,t.expVar))}function Pt(){if(lt[q]&&"preview"==lt[q].loadPurpose)throw"abort"}function Ht(e){var t=lt.gaDevIds;$(t)&&0!=t[D]&&e.set("&did",t[U](","),!0)}function Bt(e){if(!e.get(dr))throw"abort"}function qt(e){var t=Xt(e,Xn);500<=t&&X(15);var n=Wt(e,on);if("transaction"!=n&&"item"!=n){var n=Xt(e,$n),i=(new Date)[d](),s=Xt(e,Vn);0==s&&e.set(Vn,i),s=r.round(2*(i-s)/1e3),0<s&&(n=r.min(n+s,20),e.set(Vn,i));if(0>=n)throw"abort";e.set($n,--n)}e.set(Xn,++t)}function Or(e,t,n,i){t[e]=function(){try{return i&&X(i),n[T](this,arguments)}catch(t){var s=t&&t[_];if(!(1<=100*r.random()||ht("?"))){var o=["t=error","_e=exc","_v=j26","sr=1"];e&&o[N]("_f="+e),s&&o[N]("_m="+et(s[I](0,100))),o[N]("aip=1"),o[N]("z="+It()),St(bt()+"/collect",o[U]("&"))}throw t}}}function Dr(){var e,t,n;if((n=(n=lt[q])?n.plugins:null)&&n[D])for(var r=0;r<n[D]&&!t;r++){var i=n[r];-1<i[_][O]("Shockwave Flash")&&(t=i.description)}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7"),t=e.GetVariable("$version")}catch(s){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),t="WIN 6,0,21,0",e.AllowScriptAccess="always",t=e.GetVariable("$version")}catch(o){}if(!t)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),t=e.GetVariable("$version")}catch(u){}return t&&(e=t[f](/[\d]+/g))&&3<=e[D]&&(t=e[0]+"."+e[1]+" r"+e[2]),t||void 0}function Kr(e,t,n){"none"==t&&(t="");var r=[],i=dt(e);e="__utma"==e?6:2;for(var s=0;s<i[D];s++){var o=(""+i[s])[m](".");o[D]>=e&&r[N]({hash:o[0],R:i[s],O:o})}return 0==r[D]?void 0:1==r[D]?r[0]:Qr(t,r)||Qr(n,r)||Qr(null,r)||r[0]}function Qr(e,t){var n,r;null==e?n=r=1:(n=Bi(e),r=Bi(K(e,".")?e[I](1):"."+e));for(var i=0;i<t[D];i++)if(t[i][C]==n||t[i][C]==r)return t[i]}function Zr(e){e=e.get(hr);var t=ei(e,0);return"_ga=1."+et(t+"."+e)}function ei(e,t){for(var n=new Date,r=lt[q],i=r.plugins||[],n=[e,r.userAgent,n.getTimezoneOffset(),n.getYear(),n.getDate(),n.getHours(),n.getMinutes()+t],r=0;r<i[D];++r)n[N](i[r].description);return Bi(n[U]("."))}function ii(e,t){if(t==ct[g][b])return!1;for(var n=0;n<e[D];n++)if(e[n]instanceof RegExp){if(e[n][k](t))return!0}else if(0<=t[O](e[n]))return!0;return!1}function mi(){var e=lt.gaGlobal=lt.gaGlobal||{};return e.hid=e.hid||It()}function ki(e){return 0<=e[O](".")||0<=e[O](":")}function Bi(e){var t=1,n=0,r;if(e)for(t=0,r=e[D]-1;0<=r;r--)n=e.charCodeAt(r),t=(t<<6&268435455)+n+(n<<14),n=t&266338304,t=0!=n?t^n>>21:t;return t}var e=encodeURIComponent,t=window,n=setTimeout,r=Math,o="replace",u="data",a="charAt",f="match",l="send",c="port",h="createElement",p="setAttribute",d="getTime",v="host",m="split",g="location",y="hasOwnProperty",b="hostname",w="search",E="protocol",S="href",x="action",T="apply",N="push",C="hash",k="test",L="slice",A="cookie",O="indexOf",M="defaultValue",_="name",D="length",P="prototype",H="clientWidth",B="target",j="call",F="clientHeight",I="substring",q="navigator",R="parentNode",U="join",z="toLowerCase",W=new function(){var e=[];this.set=function(t){e[t]=!0},this.M=function(){for(var t=[],n=0;n<e[D];n++)e[n]&&(t[r.floor(n/6)]=t[r.floor(n/6)]^1<<n%6);for(n=0;n<t[D];n++)t[n]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[a](t[n]||0);return t[U]("")+"~"}},nt=function(e,t,n,r){try{e.addEventListener?e.addEventListener(t,n,!!r):e.attachEvent&&e.attachEvent("on"+t,n)}catch(i){X(27)}},rt=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},ft=function(){this.keys=[],this.w={},this.m={}};ft[P].set=function(e,t,n){this.keys[N](e),n?this.m[":"+e]=t:this.w[":"+e]=t},ft[P].get=function(e){return this.m[y](":"+e)?this.m[":"+e]:this.w[":"+e]},ft[P].map=function(e){for(var t=0;t<this.keys[D];t++){var n=this.keys[t],r=this.get(n);r&&e(n,r)}};var lt=t,ct=document,ht=function(e){var t=lt._gaUserPrefs;if(t&&t.ioo&&t.ioo()||e&&!0===lt["ga-disable-"+e])return!0;try{var n=lt.external;if(n&&n._gaUserPrefs&&"oo"==n._gaUserPrefs)return!0}catch(r){}return!1},pt=function(e){n(e,100)},dt=function(e){var t=[],n=ct[A][m](";");e=new RegExp("^\\s*"+e+"=\\s*(.*?)\\s*$");for(var r=0;r<n[D];r++){var i=n[r][f](e);i&&t[N](i[1])}return t},vt=function(e,t,n,r,i,s){i=ht(i)?!1:gt[k](ct[g][b])||"/"==n&&mt[k](r)?!1:!0;if(!i)return!1;t&&1200<t[D]&&(t=t[I](0,1200),X(24)),n=e+"="+t+"; path="+n+"; ",s&&(n+="expires="+(new Date((new Date)[d]()+s)).toGMTString()+"; "),r&&"none"!=r&&(n+="domain="+r+";"),r=ct[A],ct.cookie=n;if(!(r=r!=ct[A]))e:{e=dt(e);for(r=0;r<e[D];r++)if(t==e[r]){r=!0;break e}r=!1}return r},mt=new RegExp(/^(www\.)?google(\.com?)?(\.[a-z]{2})?$/),gt=new RegExp(/(^|\.)doubleclick\.net$/i),yt=function(){for(var e=lt[q],e=e.appName+e.version+e.platform+e.userAgent+(ct[A]?ct[A]:"")+(ct.referrer?ct.referrer:""),t=e[D],n=lt.history[D];0<n;)e+=n--^t++;return Bi(e)},bt=function(){return st()+"//www.google-analytics.com"},wt=function(e){s(this,"len"),this.message=e+"-8192"},Et=function(e){s(this,"ff2post"),this.message=e+"-2036"},St=function(e,t,n,r){n=n||Z,r&&(r=n,lt[q].sendBeacon?lt[q].sendBeacon(e,t)?(r(),r=!0):r=!1:r=!1);if(!r)if(2036>=t[D])xt(e,t,n);else{if(!(8192>=t[D]))throw new wt(t[D]);if(0<=lt[q].userAgent[O]("Firefox")&&![].reduce)throw new Et(t[D]);Nt(e,t,n)||Tt(e,t,n)||Ct(t,n)||n()}},xt=function(e,t,n){var r=Y(e+"?"+t);r.onload=r.onerror=function(){r.onload=null,r.onerror=null,n()}},Tt=function(e,t,n){var r;return r=lt.XDomainRequest,r?(r=new r,r.open("POST",e),r.onerror=function(){n()},r.onload=n,r[l](t),!0):!1},Nt=function(e,t,n){var r=lt.XMLHttpRequest;if(!r)return!1;var i=new r;return"withCredentials"in i?(i.open("POST",e,!0),i.withCredentials=!0,i.setRequestHeader("Content-Type","text/plain"),i.onreadystatechange=function(){4==i.readyState&&(n(),i=null)},i[l](t),!0):!1},Ct=function(t,r){if(!ct.body)return pt(function(){Ct(t,r)}),!0;t=e(t);try{var i=ct[h]('<iframe name="'+t+'"></iframe>')}catch(o){i=ct[h]("iframe"),s(i,t)}i.height="0",i.width="0",i.style.display="none",i.style.visibility="hidden";var u=ct[g],u=bt()+"/analytics_iframe.html#"+e(u[E]+"//"+u[v]+"/favicon.ico"),a=function(){i.src="",i[R]&&i[R].removeChild(i)};nt(lt,"beforeunload",a);var f=!1,l=0,c=function(){if(!f){try{if(9<l||i.contentWindow[g][v]==ct[g][v]){f=!0,a(),rt(lt,"beforeunload",a),r();return}}catch(e){}l++,n(c,200)}};return nt(i,"load",c),ct.body.appendChild(i),i.src=u,!0},kt=function(){this.t=[]};kt[P].add=function(e){this.t[N](e)},kt[P].D=function(e){try{for(var t=0;t<this.t[D];t++){var r=e.get(this.t[t]);r&&V(r)&&r[j](lt,e)}}catch(i){}t=e.get(un),t!=Z&&V(t)&&(e.set(un,Z,!0),n(t,10))};var jt=function(){return r.round(2147483647*r.random())},Ft=function(){try{var e=new Uint32Array(1);return lt.crypto.getRandomValues(e),e[0]&2147483647}catch(t){return jt()}},It=jt,Rt=function(){this.data=new ft},Ut=new ft,zt=[];Rt[P].get=function(e){var t=Jt(e),n=this[u].get(e);return t&&void 0==n&&(n=V(t[M])?t[M]():t[M]),t&&t.n?t.n(this,e,n):n};var Wt=function(e,t){var n=e.get(t);return void 0==n?"":""+n},Xt=function(e,t){var n=e.get(t);return void 0==n||""===n?0:1*n};Rt[P].set=function(e,t,n){if(e)if("object"==typeof e)for(var r in e)e[y](r)&&Vt(this,r,e[r],n);else Vt(this,e,t,n)};var Vt=function(e,t,n,r){if(void 0!=n)switch(t){case dr:bi[k](n)}var i=Jt(t);i&&i.o?i.o(e,t,n,r):e[u].set(t,n,r)},$t=function(e,t,n,r,i){s(this,e),this.p=t,this.n=r,this.o=i,this.defaultValue=n},Jt=function(e){var t=Ut.get(e);if(!t)for(var n=0;n<zt[D];n++){var r=zt[n],i=r[0].exec(e);if(i){t=r[1](i),Ut.set(t[_],t);break}}return t},Kt=function(e){var t;return Ut.map(function(n,r){r.p==e&&(t=r)}),t&&t[_]},Qt=function(e,t,n,r,i){return e=new $t(e,t,n,r,i),Ut.set(e[_],e),e[_]},Gt=function(e,t){zt[N]([new RegExp("^"+e+"$"),t])},Yt=function(e,t,n){return Qt(e,t,n,void 0,Zt)},Zt=function(){},en=J(t.GoogleAnalyticsObject)&&Q(t.GoogleAnalyticsObject)||"ga",tn=!1,nn=Yt("apiVersion","v"),rn=Yt("clientVersion","_v");Qt("anonymizeIp","aip");var sn=Qt("adSenseId","a"),on=Qt("hitType","t"),un=Qt("hitCallback"),an=Qt("hitPayload");Qt("nonInteraction","ni"),Qt("currencyCode","cu");var fn=Qt("useBeacon",void 0,!1);Qt("sessionControl","sc",""),Qt("sessionGroup","sg"),Qt("queueTime","qt");var ln=Qt("_s","_s");Qt("screenName","cd");var cn=Qt("location","dl",""),hn=Qt("referrer","dr"),pn=Qt("page","dp","");Qt("hostname","dh");var dn=Qt("language","ul"),vn=Qt("encoding","de");Qt("title","dt",function(){return ct.title||void 0}),Gt("contentGroup([0-9]+)",function(e){return new $t(e[0],"cg"+e[1])});var mn=Qt("screenColors","sd"),gn=Qt("screenResolution","sr"),yn=Qt("viewportSize","vp"),bn=Qt("javaEnabled","je"),wn=Qt("flashVersion","fl");Qt("campaignId","ci"),Qt("campaignName","cn"),Qt("campaignSource","cs"),Qt("campaignMedium","cm"),Qt("campaignKeyword","ck"),Qt("campaignContent","cc");var En=Qt("eventCategory","ec"),Sn=Qt("eventAction","ea"),xn=Qt("eventLabel","el"),Tn=Qt("eventValue","ev"),Nn=Qt("socialNetwork","sn"),Cn=Qt("socialAction","sa"),kn=Qt("socialTarget","st"),Ln=Qt("l1","plt"),An=Qt("l2","pdt"),On=Qt("l3","dns"),Mn=Qt("l4","rrt"),_n=Qt("l5","srt"),Dn=Qt("l6","tcp"),Pn=Qt("l7","dit"),Hn=Qt("l8","clt"),Bn=Qt("timingCategory","utc"),jn=Qt("timingVar","utv"),Fn=Qt("timingLabel","utl"),In=Qt("timingValue","utt");Qt("appName","an"),Qt("appVersion","av",""),Qt("appId","aid",""),Qt("appInstallerId","aiid",""),Qt("exDescription","exd"),Qt("exFatal","exf");var qn=Qt("expId","xid"),Rn=Qt("expVar","xvar"),Un=Qt("_utma","_utma"),zn=Qt("_utmz","_utmz"),Wn=Qt("_utmht","_utmht"),Xn=Qt("_hc",void 0,0),Vn=Qt("_ti",void 0,0),$n=Qt("_to",void 0,20);Gt("dimension([0-9]+)",function(e){return new $t(e[0],"cd"+e[1])}),Gt("metric([0-9]+)",function(e){return new $t(e[0],"cm"+e[1])}),Qt("linkerParam",void 0,void 0,Zr,Zt);var Jn=Qt("usage","_u",void 0,function(){return W.M()},Zt);Qt("forceSSL",void 0,void 0,function(){return tn},function(e,t,n){X(34),tn=!!n});var Kn=Qt("_j1","jid"),Qn=Qt("_j2","gjid");Gt("\\&(.*)",function(e){var t=new $t(e[0],e[1]),n=Kt(e[0][I](1));return n&&(t.n=function(e){return e.get(n)},t.o=function(e,t,r,i){e.set(n,r,i)},t.p=void 0),t});var Gn=Yt("_oot"),Yn=Qt("previewTask"),Zn=Qt("checkProtocolTask"),er=Qt("validationTask"),tr=Qt("checkStorageTask"),nr=Qt("historyImportTask"),rr=Qt("samplerTask"),ir=Yt("_rlt"),sr=Qt("buildHitTask"),or=Qt("sendHitTask"),ur=Qt("ceTask"),ar=Qt("devIdTask"),fr=Qt("timingTask"),lr=Qt("displayFeaturesTask"),cr=Yt("name"),hr=Yt("clientId","cid"),pr=Qt("userId","uid"),dr=Yt("trackingId","tid"),vr=Yt("cookieName",void 0,"_ga"),mr=Yt("cookieDomain"),gr=Yt("cookiePath",void 0,"/"),yr=Yt("cookieExpires",void 0,63072e3),br=Yt("legacyCookieDomain"),wr=Yt("legacyHistoryImport",void 0,!0),Er=Yt("storage",void 0,"cookie"),Sr=Yt("allowLinker",void 0,!1),xr=Yt("allowAnchor",void 0,!0),Tr=Yt("sampleRate","sf",100),Nr=Yt("siteSpeedSampleRate",void 0,1),Cr=Yt("alwaysSendReferrer",void 0,!1),kr=Qt("transportUrl"),Lr=Qt("_r","_r"),Ar=Qt("_dfr",void 0,100),Mr=function(e){this.V=e,this.fa=void 0,this.$=!1,this.ha=void 0,this.ea=1},_r=function(e,t,n){if(e.fa&&e.$)return 0;e.$=!0;if(t){if(e.ha&&Xt(t,e.ha))return Xt(t,e.ha);if(0==t.get(Nr))return 0}return 0==e.V?0:(void 0===n&&(n=Ft()),0==n%e.V?r.floor(n/e.V)%e.ea+1:0)},Pr=function(e,t){var n=r.min(Xt(e,Nr),100);if(!(Bi(Wt(e,hr))%100>=n)&&(n={},Hr(n)||Br(n))){var i=n[Ln];void 0==i||Infinity==i||isNaN(i)||(0<i?(jr(n,On),jr(n,Dn),jr(n,_n),jr(n,An),jr(n,Mn),jr(n,Pn),jr(n,Hn),t(n)):nt(lt,"load",function(){Pr(e,t)},!1))}},Hr=function(e){var t=lt.performance||lt.webkitPerformance,t=t&&t.timing;if(!t)return!1;var n=t.navigationStart;return 0==n?!1:(e[Ln]=t.loadEventStart-n,e[On]=t.domainLookupEnd-t.domainLookupStart,e[Dn]=t.connectEnd-t.connectStart,e[_n]=t.responseStart-t.requestStart,e[An]=t.responseEnd-t.responseStart,e[Mn]=t.fetchStart-n,e[Pn]=t.domInteractive-n,e[Hn]=t.domContentLoadedEventStart-n,!0)},Br=function(e){if(lt.top!=lt)return!1;var t=lt.external,n=t&&t.onloadT;return t&&!t.isValidLoadTime&&(n=void 0),2147483648<n&&(n=void 0),0<n&&t.setPageReadyTime(),void 0==n?!1:(e[Ln]=n,!0)},jr=function(e,t){var n=e[t];if(isNaN(n)||Infinity==n||0>n)e[t]=void 0},Fr=function(e){return function(t){"pageview"!=t.get(on)||e.I||(e.I=!0,Pr(t,function(t){e[l]("timing",t)}))}},Ir=!1,qr=function(e){if("cookie"==Wt(e,Er)){var t=Wt(e,vr),n=zr(e),r=$r(Wt(e,gr)),i=Xr(Wt(e,mr)),s=1e3*Xt(e,yr),o=Wt(e,dr);if("auto"!=i)vt(t,n,r,i,o,s)&&(Ir=!0);else{X(32);var a;e:{n=[],i=ot()[m](".");if(4==i[D]&&(a=i[i[D]-1],parseInt(a,10)==a)){a=["none"];break e}for(a=i[D]-2;0<=a;a--)n[N](i[L](a)[U]("."));n[N]("none"),a=n}for(var f=0;f<a[D];f++)if(i=a[f],e[u].set(mr,i),n=zr(e),vt(t,n,r,i,o,s)){1==Vr(i)&&X(36),"none"==i&&X(37),Ir=!0;return}e[u].set(mr,"auto")}}},Rr=function(e){if("cookie"==Wt(e,Er)&&!Ir&&(qr(e),!Ir))throw"abort"},Ur=function(e){if(e.get(wr)){var t=Wt(e,mr),n=Wt(e,br)||ot(),r=Kr("__utma",n,t);r&&(X(19),e.set(Wn,(new Date)[d](),!0),e.set(Un,r.R),(t=Kr("__utmz",n,t))&&r[C]==t[C]&&e.set(zn,t.R))}},zr=function(e){var t=tt(Wt(e,hr)),n=Vr(Wt(e,mr));return e=Jr(Wt(e,gr)),1<e&&(n+="-"+e),["GA1",n,t][U](".")},Wr=function(e,t,n){for(var r=[],i=[],s,o=0;o<e[D];o++){var u=e[o];u.r[n]==t?r[N](u):void 0==s||u.r[n]<s?(i=[u],s=u.r[n]):u.r[n]==s&&i[N](u)}return 0<r[D]?r:i},Xr=function(e){return 0==e[O](".")?e.substr(1):e},Vr=function(e){return Xr(e)[m](".")[D]},$r=function(e){return e?(1<e[D]&&e.lastIndexOf("/")==e[D]-1&&(e=e.substr(0,e[D]-1)),0!=e[O]("/")&&(e="/"+e),e):"/"},Jr=function(e){return e=$r(e),"/"==e?1:e[m]("/")[D]},Gr=new RegExp(/^https?:\/\/([^\/:]+)/),Yr=/(.*)([?&#])(?:_ga=[^&#]*)(?:&?)(.*)/,ti=function(e){X(48),this.target=e,this.T=!1};ti[P].Q=function(e,t){if(e.tagName){if("a"==e.tagName[z]()){e[S]&&i(e,ni(this,e[S],t));return}if("form"==e.tagName[z]())return ri(this,e)}if("string"==typeof e)return ni(this,e,t)};var ni=function(e,t,n){var r=Yr.exec(t);r&&3<=r[D]&&(t=r[1]+(r[3]?r[2]+r[3]:"")),e=e[B].get("linkerParam");var i=t[O]("?"),r=t[O]("#");return n?t+=(-1==r?"#":"&")+e:(n=-1==i?"?":"&",t=-1==r?t+(n+e):t[I](0,r)+n+e+t[I](r)),t},ri=function(e,t){if(t&&t[x]){var n=e[B].get("linkerParam")[m]("=")[1];if("get"==t.method[z]()){for(var r=t.childNodes||[],i=0;i<r[D];i++)if("_ga"==r[i][_]){r[i][p]("value",n);return}r=ct[h]("input"),r[p]("type","hidden"),r[p]("name","_ga"),r[p]("value",n),t.appendChild(r)}else"post"==t.method[z]()&&(t.action=ni(e,t[x]))}};ti[P].S=function(e,t,n){function r(n){try{n=n||lt.event;var r;e:{var o=n[B]||n.srcElement;for(n=100;o&&0<n;){if(o[S]&&o.nodeName[f](/^a(?:rea)?$/i)){r=o;break e}o=o[R],n--}r={}}("http:"==r[E]||"https:"==r[E])&&ii(e,r[b]||"")&&r[S]&&i(r,ni(s,r[S],t))}catch(u){X(26)}}var s=this;this.T||(this.T=!0,nt(ct,"mousedown",r,!1),nt(ct,"touchstart",r,!1),nt(ct,"keyup",r,!1));if(n){n=function(t){t=t||lt.event;if((t=t[B]||t.srcElement)&&t[x]){var n=t[x][f](Gr);n&&ii(e,n[1])&&ri(s,t)}};for(var o=0;o<ct.forms[D];o++)nt(ct.forms[o],"submit",n)}};var si=function(e,t,n,r){this.U=t,this.aa=n,(t=r)||(t=(t=Wt(e,cr))&&"t0"!=t?li[k](t)?"_gat_"+tt(Wt(e,dr)):"_gat_"+tt(t):"_gat"),this.Y=t},oi=function(e,t){var n=t.get(sr);t.set(sr,function(t){ui(e,t);var r=n(t);return ai(e,t),r});var r=t.get(or);t.set(or,function(t){var n=r(t);return fi(e,t),n})},ui=function(e,t){t.get(e.U)||("1"==dt(e.Y)[0]?t.set(e.U,"",!0):t.set(e.U,""+It(),!0))},ai=function(e,t){t.get(e.U)&&vt(e.Y,"1",t.get(gr),t.get(mr),t.get(dr),6e5)},fi=function(e,t){if(t.get(e.U)){var n=new ft,r=function(e){n.set(Jt(e).p,t.get(e))};r(nn),r(rn),r(dr),r(hr),r(e.U),r(Jn);var i=e.aa;"/"===i[a](0)&&(i=st()+i),n.map(function(e,t){i+=et(e)+"="+et(""+t)+"&"}),i+="z="+It(),Y(i),t.set(e.U,"",!0)}},li=/^gtm\d+$/,ci,hi;ci=new Mr(10),hi=!1;var pi=function(e,t){var n=e.b;if(!n.get("dcLoaded")){X(29),t=t||{};var r;t[vr]&&(r=tt(t[vr]));var i="//stats.g.doubleclick.net/collect?t=dc&aip=1&";if("https:"!=ct[g][E]&&!tn){var s=Bi(n.get(hr));if(hi||_r(ci,void 0,s))i="https:"+i,X(33),hi=!0}r=new si(n,Kn,i,r),oi(r,n),n.set("dcLoaded",!0)}},di=function(e){var t;e.get("dcLoaded")?t=!1:(t=new Mr(Xt(e,Ar)),t=_r(t,null,Bi(e.get(hr)))),t&&(X(51),t=new si(e,Kn),ui(t,e),ai(t,e),e.get(t.U)&&(e.set(Lr,1,!0),e.set(kr,bt()+"/r/collect",!0)))},vi=function(e,t){var n=e.b;if(!n.get("_rlsaLoaded")){X(38),t=t||{};if(t[vr])var r=tt(t[vr]);r=new si(n,Qn,"https://www.google.com/ads/ga-audiences?t=sr&aip=1&",r),oi(r,n),n.set("_rlsaLoaded",!0),Mi("displayfeatures",e,t)}},gi,yi=function(e,n,r){if(!gi){var i;i=ct[g][C];var s=lt[_],o=/^#?gaso=([^&]*)/;if(s=(i=(i=i&&i[f](o)||s&&s[f](o))?i[1]:dt("GASO")[0]||"")&&i[f](/^(?:!([-0-9a-z.]{1,40})!)?([-.\w]{10,1200})$/i))vt("GASO",""+i,r,n,e,0),t._udo||(t._udo=n),t._utcp||(t._utcp=r),e=s[1],it("https://www.google.com/analytics/web/inpage/pub/inpage.js?"+(e?"prefix="+e+"&":"")+It(),"_gasojs");gi=!0}},bi=/^(UA|YT|MO|GP)-(\d+)-(\d+)$/,wi=function(e){function t(e,t){r.b[u].set(e,t)}function n(e,n){t(e,n),r.filters.add(e)}var r=this;this.b=new Rt,this.filters=new kt,t(cr,e[cr]),t(dr,Q(e[dr])),t(vr,e[vr]),t(mr,e[mr]||ot()),t(gr,e[gr]),t(yr,e[yr]),t(br,e[br]),t(wr,e[wr]),t(Sr,e[Sr]),t(xr,e[xr]),t(Tr,e[Tr]),t(Nr,e[Nr]),t(Cr,e[Cr]),t(Er,e[Er]),t(pr,e[pr]),t(nn,1),t(rn,"j26"),n(Gn,At),n(Yn,Pt),n(Zn,Ot),n(er,Bt),n(tr,Rr),n(nr,Ur),n(rr,Lt),n(ir,qt),n(ur,Dt),n(ar,Ht),n(lr,di),n(sr,Mt),n(or,_t),n(fr,Fr(this)),Ei(this.b,e[hr]),Si(this.b),this.b.set(sn,mi()),yi(this.b.get(dr),this.b.get(mr),this.b.get(gr))},Ei=function(e,t){if("cookie"==Wt(e,Er)){Ir=!1;var n;e:{var r=dt(Wt(e,vr));if(r&&!(1>r[D])){n=[];for(var i=0;i<r[D];i++){var s;s=r[i][m](".");var a=s.shift();("GA1"==a||"1"==a)&&1<s[D]?(a=s.shift()[m]("-"),1==a[D]&&(a[1]="1"),a[0]*=1,a[1]*=1,s={r:a,s:s[U](".")}):s=void 0,s&&n[N](s)}if(1==n[D]){X(13),n=n[0].s;break e}if(0!=n[D]){X(14),r=Vr(Wt(e,mr)),n=Wr(n,r,0);if(1==n[D]){n=n[0].s;break e}r=Jr(Wt(e,gr)),n=Wr(n,r,1),n=n[0]&&n[0].s;break e}X(12)}n=void 0}n||(n=Wt(e,mr),r=Wt(e,br)||ot(),n=Kr("__utma",r,n),(n=void 0==n?void 0:n.O[1]+"."+n.O[2])&&X(10)),n&&(e[u].set(hr,n),Ir=!0)}n=e.get(xr);if(i=(n=ct[g][n?"href":"search"][f]("(?:&|#|\\?)"+et("_ga")[o](/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"=([^&#]*)"))&&2==n[D]?n[1]:"")e.get(Sr)?(n=i[O]("."),-1==n?X(22):(r=i[I](n+1),"1"!=i[I](0,n)?X(22):(n=r[O]("."),-1==n?X(22):(i=r[I](0,n),n=r[I](n+1),i!=ei(n,0)&&i!=ei(n,-1)&&i!=ei(n,-2)?X(23):(X(11),e[u].set(hr,n)))))):X(21);t&&(X(9),e[u].set(hr,et(t))),e.get(hr)||((n=(n=lt.gaGlobal&&lt.gaGlobal.vid)&&-1!=n[w](/^(?:utma\.)?\d+\.\d+$/)?n:void 0)?(X(17),e[u].set(hr,n)):(X(8),e[u].set(hr,G()))),qr(e)},Si=function(e){var t=lt[q],n=lt.screen,r=ct[g];e.set(hn,ut(e.get(Cr)));if(r){var i=r.pathname||"";"/"!=i[a](0)&&(X(31),i="/"+i),e.set(cn,r[E]+"//"+r[b]+i+r[w])}n&&e.set(gn,n.width+"x"+n.height),n&&e.set(mn,n.colorDepth+"-bit");var n=ct.documentElement,s=(i=ct.body)&&i[H]&&i[F],o=[];n&&n[H]&&n[F]&&("CSS1Compat"===ct.compatMode||!s)?o=[n[H],n[F]]:s&&(o=[i[H],i[F]]),n=0>=o[0]||0>=o[1]?"":o[U]("x"),e.set(yn,n),e.set(wn,Dr()),e.set(vn,ct.characterSet||ct.charset),e.set(bn,t&&"function"==typeof t.javaEnabled&&t.javaEnabled()||!1),e.set(dn,(t&&(t.language||t.browserLanguage)||"")[z]());if(r&&e.get(xr)&&(t=ct[g][C])){t=t[m](/[?&#]+/),r=[];for(n=0;n<t[D];++n)(K(t[n],"utm_id")||K(t[n],"utm_campaign")||K(t[n],"utm_source")||K(t[n],"utm_medium")||K(t[n],"utm_term")||K(t[n],"utm_content")||K(t[n],"gclid")||K(t[n],"dclid")||K(t[n],"gclsrc"))&&r[N](t[n]);0<r[D]&&(t="#"+r[U]("&"),e.set(cn,e.get(cn)+t))}};wi[P].get=function(e){return this.b.get(e)},wi[P].set=function(e,t){this.b.set(e,t)};var xi={pageview:[pn],event:[En,Sn,xn,Tn],social:[Nn,Cn,kn],timing:[Bn,jn,In,Fn]};wi[P].send=function(e){if(!(1>arguments[D])){var t,n;"string"==typeof arguments[0]?(t=arguments[0],n=[][L][j](arguments,1)):(t=arguments[0]&&arguments[0][on],n=arguments),t&&(n=at(xi[t]||[],n),n[on]=t,this.b.set(n,void 0,!0),this.filters.D(this.b),this.b[u].m={},X(44))}};var Ti=function(e){return"prerender"==ct.visibilityState?!1:(e(),!0)},Ni=/^(?:(\w+)\.)?(?:(\w+):)?(\w+)$/,Ci=function(e){if(V(e[0]))this.u=e[0];else{var t=Ni.exec(e[0]);null!=t&&4==t[D]&&(this.c=t[1]||"t0",this.e=t[2]||"",this.d=t[3],this.a=[][L][j](e,1),this.e||(this.A="create"==this.d,this.i="require"==this.d,this.g="provide"==this.d,this.ba="remove"==this.d),this.i&&(3<=this.a[D]?(this.X=this.a[1],this.W=this.a[2]):this.a[1]&&(J(this.a[1])?this.X=this.a[1]:this.W=this.a[1]))),t=e[1],e=e[2];if(!this.d)throw"abort";if(this.i&&(!J(t)||""==t))throw"abort";if(this.g&&(!J(t)||""==t||!V(e)))throw"abort";if(ki(this.c)||ki(this.e))throw"abort";if(this.g&&"t0"!=this.c)throw"abort"}},Li,Ai,Oi;Li=new ft,Oi=new ft,Ai={ec:45,ecommerce:46,linkid:47};var Mi=function(e,t,n){t==Pi?X(35):t.get(cr);var r=Li.get(e);return V(r)?(t.plugins_=t.plugins_||new ft,t.plugins_.get(e)?!0:(t.plugins_.set(e,new r(t,n||{})),!0)):!1},_i=function(e){function t(e){var t=(e[b]||"")[m](":")[0][z](),n=(e[E]||"")[z](),n=1*e[c]||("http:"==n?80:"https:"==n?443:"");return e=e.pathname||"",K(e,"/")||(e="/"+e),[t,""+n,e]}var n=ct[h]("a");i(n,ct[g][S]);var r=(n[E]||"")[z](),s=t(n),o=n[w]||"",u=r+"//"+s[0]+(s[1]?":"+s[1]:"");return K(e,"//")?e=r+e:K(e,"/")?e=u+e:!e||K(e,"?")?e=u+s[2]+(e||o):0>e[m]("/")[0][O](":")&&(e=u+s[2][I](0,s[2].lastIndexOf("/"))+"/"+e),i(n,e),r=t(n),{protocol:(n[E]||"")[z](),host:r[0],port:r[1],path:r[2],G:n[w]||"",url:e||""}},Di={ga:function(){Di.f=[]}};Di.ga(),Di.D=function(e){var t=Di.J[T](Di,arguments),t=Di.f.concat(t);for(Di.f=[];0<t[D]&&!Di.v(t[0])&&!(t.shift(),0<Di.f[D]););Di.f=Di.f.concat(t)},Di.J=function(e){for(var t=[],n=0;n<arguments[D];n++)try{var r=new Ci(arguments[n]);if(r.g)Li.set(r.a[0],r.a[1]);else{if(r.i){var i=r,s=i.a[0];if(!V(Li.get(s))&&!Oi.get(s)){Ai[y](s)&&X(Ai[s]);var o=i.X;!o&&Ai[y](s)?(X(39),o=s+".js"):X(43);if(o){o&&0<=o[O]("/")||(o=st()+"//www.google-analytics.com/plugins/ua/"+o);var u=_i(o),i=void 0,a=u[E],f=ct[g][E],i="https:"==a||a==f?!0:"http:"!=a?!1:"http:"==f,l;if(l=i){var i=u,h=_i(ct[g][S]);if(i.G||0<=i.url[O]("?")||0<=i.path[O]("://"))l=!1;else if(i[v]==h[v]&&i[c]==h[c])l=!0;else{var p="http:"==i[E]?80:443;l="www.google-analytics.com"==i[v]&&(i[c]||p)==p&&K(i.path,"/plugins/")?!0:!1}}l&&(it(u.url),Oi.set(s,!0))}}}t[N](r)}}catch(d){}return t},Di.v=function(e){try{if(e.u)e.u[j](lt,Pi.j("t0"));else{var t=e.c==en?Pi:Pi.j(e.c);if(e.A)"t0"==e.c&&Pi.create[T](Pi,e.a);else if(e.ba)Pi.remove(e.c);else if(t)if(e.i){if(!Mi(e.a[0],t,e.W))return!0}else if(e.e){var n=e.d,r=e.a,i=t.plugins_.get(e.e);i[n][T](i,r)}else t[e.d][T](t,e.a)}}catch(s){}};var Pi=function(e){X(1),Di.D[T](Di,[arguments])};Pi.h={},Pi.P=[],Pi.L=0,Pi.answer=42;var Hi=[dr,mr,cr];Pi.create=function(e){var t=at(Hi,[][L][j](arguments));t[cr]||(t[cr]="t0");var n=""+t[cr];return Pi.h[n]?Pi.h[n]:(t=new wi(t),Pi.h[n]=t,Pi.P[N](t),t)},Pi.remove=function(e){for(var t=0;t<Pi.P[D];t++)if(Pi.P[t].get(cr)==e){Pi.P.splice(t,1),Pi.h[e]=null;break}},Pi.j=function(e){return Pi.h[e]},Pi.K=function(){return Pi.P[L](0)},Pi.N=function(){"ga"!=en&&X(49);var e=lt[en];if(!e||42!=e.answer){Pi.L=e&&e.l,Pi.loaded=!0;var t=lt[en]=Pi;Or("create",t,t.create,3),Or("remove",t,t.remove),Or("getByName",t,t.j,5),Or("getAll",t,t.K,6),t=wi[P],Or("get",t,t.get,7),Or("set",t,t.set,4),Or("send",t,t[l],2),t=Rt[P],Or("get",t,t.get),Or("set",t,t.set),(lt.gaplugins=lt.gaplugins||{}).Linker=ti,t=ti[P],Li.set("linker",ti),Or("decorate",t,t.Q,20),Or("autoLink",t,t.S,25),Li.set("displayfeatures",pi),Li.set("adfeatures",vi),e=e&&e.q,$(e)?Di.D[T](Pi,e):X(50)}},function(){var e=Pi.N;if(!Ti(e)){X(16);var t=!1,n=function(){!t&&Ti(e)&&(t=!0,rt(ct,"visibilitychange",n))};nt(ct,"visibilitychange",n)}}()}(window),define("google-analytics",function(e){return function(){var t,n;return t||e.ga}}(this)),define("common/analytics",["require","jquery","common/globals","common/nav","common/utils","common/dataService","common/dataUtils","google-analytics"],function(e){function h(e,t,n,i,o){if(arguments.length==1)return h(null,arguments[0]);var u=s.getMarketData(),a=r.getPage(),f=e||(a?a.path:"unknown-page");return m("Community-"+f,t,n||(u?u.pickupSite.url:"[N/A]"),i,o)}function p(e,t){var r={dimension4:e.pickupSite.url,dimension5:e.pickupSite.communityType,dimension7:e.pickupSite.deliveryDays,dimension9:e.region,dimension10:i.formatToAnalyticsDateString(e.nextDeliveryDate)},s=o.getUserRole();s&&(r.dimension11=s);if(t){var u,a,f;u=n.data.lastCategory,u?a=u:(u=i.getCategoriesFromUrl(e).category,a=u+" (default)"),f=n.data.lastSubCategory,(u.toLowerCase()=="my top items"||u.toLowerCase()=="find a product"||u.toLocaleString()=="favorites")&&f!=="Try These Farmigo Favorites"&&(f="All (default)"),!f&&u.toLowerCase()!="my top items"&&u.toLowerCase()!="find a product"&&u.toLowerCase()!="search results"&&u.toLocaleString()!="favorites"&&(f=i.getCategoriesFromUrl(e).subCategory+" (default)"),r.dimension12=a,r.dimension13=f}e&&e.member&&e.member.key?r.dimension14=e.member.key:r.dimension14=undefined;var l=[],c=!1;return e.featuresFlags&&_.each(e.featuresFlags,function(e,t){e&&(t==="orderSecondVariation"?(t="orderPageLogic-var2",c=!0):t==="orderThirdVariation"&&(t="orderPageLogic-var3",c=!0),l.push(t))}),c||l.push("orderPageLogic-var1"),e.experiments&&_.each(e.experiments,function(e,t){l.push(t+"-"+e.name)}),r.dimension15=l.join(", "),e&&e.subscription&&e.subscription.totalDeliveries?r.dimension16=e.subscription.totalDeliveries.toString():r.dimension16="0",r}function d(e,t){u("set","dimension4",e.pickupSite.url),u("set","dimension5",e.pickupSite.communityType),u("set","dimension7",e.pickupSite.deliveryDays),u("set","dimension9",e.region),u("set","dimension10",i.formatToAnalyticsDateString(e.nextDeliveryDate));var r=o.getUserRole();r&&u("set","dimension11",r);if(t){var s,a,f;s=n.data.lastCategory,s?a=s:(s=i.getCategoriesFromUrl(e).category,a=s+" (default)"),f=n.data.lastSubCategory,(s.toLowerCase()=="my top items"||s.toLowerCase()=="find a product"||s.toLocaleString()=="favorites")&&f!=="Try These Farmigo Favorites"&&(f="All (default)"),!f&&s.toLowerCase()!="my top items"&&s.toLowerCase()!="find a product"&&s.toLowerCase()!="search results"&&s.toLocaleString()!="favorites"&&(f=i.getCategoriesFromUrl(e).subCategory+" (default)"),u("set","dimension12",a),u("set","dimension13",f)}e&&e.member&&e.member.key?u("set","dimension14",e.member.key):u("set","dimension14",undefined);var l=[],c=!1;e.featuresFlags&&_.each(e.featuresFlags,function(e,t){e&&(t==="orderSecondVariation"?(t="orderPageLogic-var2",c=!0):t==="orderThirdVariation"&&(t="orderPageLogic-var3",c=!0),l.push(t))}),c||l.push("orderPageLogic-var1"),e.experiments&&_.each(e.experiments,function(e,t){l.push(t+"-"+e.name)}),u("set","dimension15",l.join(", ")),e&&e.subscription&&e.subscription.totalDeliveries?u("set","dimension16",e.subscription.totalDeliveries.toString()):u("set","dimension16","0")}function v(e,t){var r=s.getMarketData(),o="[N/A]",a=["market","market/product","market/producer","add-first-item"].indexOf(e)!=-1;e="/"+e,r&&d(r,a),u("send","pageview",e);if(mixpanel){var f=!0;e==="/market"&&(f=!n.data.marketPageView,f&&(n.data.marketPageView=!0)),f&&mixpanel.track(e,{subAction:t,community:o,communityType:r?r.pickupSite.communityType:"[N/A]",incubate:r?r.pickupSite.isIncubate:"[N/A]",deliveryDay:r?r.pickupSite.deliveryDays:"[N/A]",region:r?r.region:"[N/A]",pickupDate:r?i.formatToAnalyticsDateString(r.nextDeliveryDate):"[N/A]"})}if(window.Intercom&&r&&r.member){var l={page:e};window.Intercom("trackEvent","Page: "+e,l)}}function m(e,t,n,r,o,a){var f=["sub category clicked","Search value entered","Search result clicked","Search clicked","search button clicked","producer info clicked","Item unit hover","item info clicked","category tab clicked","Add Items button pressed","tag clicked","carousel arrow clicked - left","carousel arrow clicked - right"].indexOf(t)!=-1,l=s.getMarketData();l&&d(l,f);if(!a){var c=window.location.pathname.split("/");a=c&&c.length>1?"/"+c[1]:"/homepage"}u("send","event",e,t,n,r,{page:a}),mixpanel&&!o&&mixpanel.track(t,{category:e,action:t,label:n,community:l?l.pickupSite.url:"[N/A]",communityType:l?l.pickupSite.communityType:"[N/A]",incubate:l?l.pickupSite.isIncubate:"[N/A]",deliveryDay:l?l.pickupSite.deliveryDays:"[N/A]",region:l?l.region:"[N/A]",pickupDate:l?i.formatToAnalyticsDateString(l.nextDeliveryDate):"[N/A]","Search Term":t==="Search clicked"?n:"[N/A]"});if(window.Intercom&&l&&l.member){var h={category:e,action:t,label:n};window.Intercom("trackEvent",t,h)}}function g(e,t){u("set",e,t)}function y(e,t){e==r.PageEnum.Market&&t==r.PageEnum.Order&&n.eventBus.trigger("analytics:pageEvent","Accessed order")}function b(){u("create","UA-8893503-1",{cookieDomain:"none"}),E(function(e){var t=e.member;u("set","&uid",t?t.key:null)})}function w(){E(function(e){var t=e.member;if(!t||!t.firstName)return;mixpanel.identify(t.email)}),a.on("new-account-created",function(e){var t=e.member;if(!t||!t.firstName)return;mixpanel.alias(t.email),mixpanel.people.set({$email:t.email,$first_name:t.firstName,$last_name:t.lastName}),v("account-created")})}function E(e){t(function(){var t=s.getMarketData();t!=null&&e(t),a.on("dataUpdated",function(t){e(t)})})}function S(e){}var t=e("jquery"),n=e("common/globals"),r=e("common/nav"),i=e("common/utils"),s=e("common/dataService"),o=e("common/dataUtils"),u=e("google-analytics"),a=n.eventBus,f=null,l=["thankyou","payment"],c=!1;b(),w(),a.on("route",function(e){var t=s.getMarketData();l.indexOf(e.path)===-1&&(v(e.path),t&&t.isLoginOptimizedFlow&&!c&&(m("Community-market","Is Login Optimized Flow"),c=!0),window.__insp&&window.__insp.push(["virtualPage"])),y(f,e),f=e}),a.on("analytics:pageView",v),a.on("analytics:event",m),a.on("analytics:pageEvent",h),a.on("analytics:set",g),t("body").on("click","[data-analytics-action], [data-analytics-category]",function(e){var n=t(e.currentTarget),r=n.data("analyticsCategory"),i=n.data("analyticsAction"),s=n.data("analyticsLabel");h(r,i,s)})}),BOOMR_start=(new Date).getTime(),BOOMR_check_doc_domain(),function(e){var t,n,r,i,s,o,u,a;e.parent!==e&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"&&(e=e.parent,i=document.getElementById("boomr-if-as").src),r=e.document,e.BOOMR||(e.BOOMR={}),BOOMR=e.BOOMR;if(BOOMR.version)return;BOOMR.version="0.9.1448986678",BOOMR.window=e,BOOMR.plugins||(BOOMR.plugins={}),function(){try{new e.CustomEvent("CustomEvent")!==undefined&&(s=function(t,n){return new e.CustomEvent(t,n)})}catch(t){}try{!s&&r.createEvent&&r.createEvent("CustomEvent")&&(s=function(e,t){var n=r.createEvent("CustomEvent");return t=t||{cancelable:!1,bubbles:!1},n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n})}catch(t){}!s&&r.createEventObject&&(s=function(e,t){var n=r.createEventObject();return n.type=n.propertyName=e,n.detail=t.detail,n}),s||(s=function(){return undefined})}(),o=function(e,t,n){function o(){r.dispatchEvent?r.dispatchEvent(i):r.fireEvent&&r.fireEvent("onpropertychange",i)}var i=s(e,{detail:t});if(!i)return;n?BOOMR.setImmediate(o):o()},typeof document.hidden!="undefined"?(u="visibilityState",a="visibilitychange"):typeof document.mozHidden!="undefined"?(u="mozVisibilityState",a="mozvisibilitychange"):typeof document.msHidden!="undefined"?(u="msVisibilityState",a="msvisibilitychange"):typeof document.webkitHidden!="undefined"&&(u="webkitVisibilityState",a="webkitvisibilitychange"),t={beacon_url:"",beacon_type:"POST",site_domain:e.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",strip_query_string:!1,onloadfired:!1,handlers_attached:!1,events:{page_ready:[],page_unload:[],before_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],onbeacon:[],xhr_load:[],click:[],form_submit:[]},public_events:{before_beacon:"onBeforeBoomerangBeacon",onbeacon:"onBoomerangBeacon",onboomerangloaded:"onBoomerangLoaded"},vars:{},errors:{},disabled_plugins:{},xb_handler:function(n){return function(r){var i;r||(r=e.event),r.target?i=r.target:r.srcElement&&(i=r.srcElement),i.nodeType===3&&(i=i.parentNode);if(i&&i.nodeName.toUpperCase()==="OBJECT"&&i.type==="application/x-shockwave-flash")return;t.fireEvent(n,i)}},fireEvent:function(e,t){var n,r,i;e=e.toLowerCase();if(!this.events.hasOwnProperty(e))return!1;this.public_events.hasOwnProperty(e)&&o(this.public_events[e],t),i=this.events[e];for(n=0;n<i.length;n++)try{r=i[n],r.fn.call(r.scope,t,r.cb_data)}catch(s){BOOMR.addError(s,"fireEvent."+e+"<"+n+">")}return!0}},n={t_lstart:null,t_start:BOOMR_start,t_end:null,url:i,utils:{objectToString:function(e,t,n){var r=[],i;if(!e||typeof e!="object")return e;t===undefined&&(t="\n	"),n||(n=0);if(Object.prototype.toString.call(e)==="[object Array]"){for(i=0;i<e.length;i++)n>0&&e[i]!==null&&typeof e[i]=="object"?r.push(this.objectToString(e[i],t+(t==="\n	"?"	":""),n-1)):t==="&"?r.push(encodeURIComponent(e[i])):r.push(e[i]);t=","}else for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n>0&&e[i]!==null&&typeof e[i]=="object"?r.push(encodeURIComponent(i)+"="+this.objectToString(e[i],t+(t==="\n	"?"	":""),n-1)):t==="&"?r.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i])):r.push(i+"="+e[i]));return r.join(t)},getCookie:function(e){if(!e)return null;e=" "+e+"=";var t,n;return n=" "+r.cookie+";",(t=n.indexOf(e))>=0?(t+=e.length,n=n.substring(t,n.indexOf(";",t)),n):null},setCookie:function(e,n,i){var s,o,u,a,f;if(!e||!t.site_domain)return!1;s=this.objectToString(n,"&"),o=e+"="+s,a=[o,"path=/","domain="+t.site_domain],i&&(f=new Date,f.setTime(f.getTime()+i*1e3),f=f.toGMTString(),a.push("expires="+f));if(o.length<500){r.cookie=a.join("; "),u=this.getCookie(e);if(s===u)return!0}return!1},getSubCookies:function(e){var t,n,r,i,s=!1,o={};if(!e)return null;if(typeof e!="string")return null;t=e.split("&");for(n=0,r=t.length;n<r;n++)i=t[n].split("="),i[0]&&(i.push(""),o[decodeURIComponent(i[0])]=decodeURIComponent(i[1]),s=!0);return s?o:null},removeCookie:function(e){return this.setCookie(e,{},-86400)},cleanupURL:function(e){return e?t.strip_query_string?e.replace(/\?.*/,"?qs-redacted"):e:""},hashQueryString:function(e,t){return e?e.match?(e.match(/^\/\//)&&(e=location.protocol+e),e.match(/^(https?|file):/)?(t&&(e=e.replace(/#.*/,"")),BOOMR.utils.MD5?e.replace(/\?([^#]*)/,function(e,t){return"?"+(t.length>10?BOOMR.utils.MD5(t):t)}):e):""):(BOOMR.addError("TypeError: Not a string","hashQueryString",typeof e),""):e},pluginConfig:function(e,t,n,r){var i,s=0;if(!t||!t[n])return!1;for(i=0;i<r.length;i++)t[n][r[i]]!==undefined&&(e[r[i]]=t[n][r[i]],s++);return s>0},addObserver:function(e,t,n,r,i,s){function u(e){var t=!1;o.timer&&(clearTimeout(o.timer),o.timer=null),r&&(t=r.call(s,e,i),t||(r=null)),!t&&o.observer&&(o.observer.disconnect(),o.observer=null),typeof t=="number"&&t>0&&(o.timer=setTimeout(u,t))}var o={observer:null,timer:null};return!window.MutationObserver||!r||!e?null:(o.observer=new MutationObserver(u),n&&(o.timer=setTimeout(u,o.timeout)),o.observer.observe(e,t),o)},addListener:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},removeListener:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},pushVars:function(e,t,n){var r,i,s=0,o;for(r in t)if(t.hasOwnProperty(r))if(Object.prototype.toString.call(t[r])==="[object Array]")for(i=0;i<t[r].length;++i)s+=BOOMR.utils.pushVars(e,t[r][i],r+"["+i+"]");else o=document.createElement("input"),o.type="hidden",o.name=n?n+"["+r+"]":r,o.value=t[r]===undefined||t[r]===null?"":t[r],e.appendChild(o),s+=encodeURIComponent(o.name).length+encodeURIComponent(o.value).length+2;return s},sendData:function(e,n){function s(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)}function o(){var t,n="boomerang_post-"+encodeURIComponent(e.action)+"-"+Math.random();try{t=document.createElement('<iframe name="'+n+'">')}catch(r){t=document.createElement("iframe")}e.action=i.shift(),e.target=t.name=t.id=n,t.style.display=e.style.display="none",t.src="javascript:false",s(t.id),s(e.id),document.body.appendChild(t),document.body.appendChild(e),e.submit(),i.length&&BOOMR.setImmediate(o),setTimeout(function(){s(t.id)},1e4)}var r=document.createElement("input"),i=[t.beacon_url];e.method=n,e.id="beacon_form",e.enctype="application/x-www-form-urlencoded",t.secondary_beacons&&t.secondary_beacons.length&&i.push.apply(i,t.secondary_beacons),o()}},init:function(n){var i,s,o=["beacon_url","beacon_type","site_domain","user_ip","strip_query_string","secondary_beacons"];BOOMR_check_doc_domain(),n||(n={});for(i=0;i<o.length;i++)n[o[i]]!==undefined&&(t[o[i]]=n[o[i]]);n.log!==undefined&&(this.log=n.log),this.log||(this.log=function(){});for(s in this.plugins)if(this.plugins.hasOwnProperty(s)){if(n[s]&&n[s].hasOwnProperty("enabled")&&n[s].enabled===!1){t.disabled_plugins[s]=1;continue}if(t.disabled_plugins[s]){if(!n[s]||!n[s].hasOwnProperty("enabled")||n[s].enabled!==!0)continue;delete t.disabled_plugins[s]}if(typeof this.plugins[s].init=="function")try{this.plugins[s].init(n)}catch(u){BOOMR.addError(u,s+".init")}}return t.handlers_attached?this:(!t.onloadfired&&(n.autorun===undefined||n.autorun!==!1)&&(r.readyState&&r.readyState==="complete"?(BOOMR.loadedLate=!0,this.setImmediate(BOOMR.page_ready,null,null,BOOMR)):e.onpagehide||e.onpagehide===null?BOOMR.utils.addListener(e,"pageshow",BOOMR.page_ready):BOOMR.utils.addListener(e,"load",BOOMR.page_ready)),BOOMR.utils.addListener(e,"DOMContentLoaded",function(){t.fireEvent("dom_loaded")}),function(){var n,i;a!==undefined&&(BOOMR.utils.addListener(r,a,function(){t.fireEvent("visibility_changed")}),BOOMR.subscribe("visibility_changed",function(){BOOMR.lastVisibilityEvent[BOOMR.visibilityState()]=BOOMR.now()})),BOOMR.utils.addListener(r,"mouseup",t.xb_handler("click")),n=r.getElementsByTagName("form");for(i=0;i<n.length;i++)BOOMR.utils.addListener(n[i],"submit",t.xb_handler("form_submit"));!e.onpagehide&&e.onpagehide!==null&&BOOMR.utils.addListener(e,"unload",function(){BOOMR.window=e=null})}(),t.handlers_attached=!0,this)},page_ready:function(n){return n||(n=e.event),n||(n={name:"load"}),t.onloadfired?this:(t.fireEvent("page_ready",n),t.onloadfired=!0,this)},setImmediate:function(t,n,r,i){var s=function(){t.call(i||null,n,r||{}),s=null};e.setImmediate?e.setImmediate(s):e.msSetImmediate?e.msSetImmediate(s):e.webkitSetImmediate?e.webkitSetImmediate(s):e.mozSetImmediate?e.mozSetImmediate(s):setTimeout(s,10)},now:function(){try{if("performance"in window&&window.performance&&window.performance.now)return function(){return Math.round(window.performance.now()+window.performance.timing.navigationStart)}}catch(e){}return Date.now||function(){return(new Date).getTime()}}(),visibilityState:u===undefined?function(){return"visible"}:function(){return r[u]},lastVisibilityEvent:{},subscribe:function(e,n,r,i){var s,o,u,a;e=e.toLowerCase();if(!t.events.hasOwnProperty(e))return this;u=t.events[e];for(s=0;s<u.length;s++){o=u[s];if(o&&o.fn===n&&o.cb_data===r&&o.scope===i)return this}return u.push({fn:n,cb_data:r||{},scope:i||null}),e==="page_ready"&&t.onloadfired&&this.setImmediate(n,null,r,i),this},addError:function(e,n,r){var i;typeof e!="string"&&(i=String(e),i.match(/^\[object/)&&(i=e.name+": "+(e.description||e.message).replace(/\r\n$/,"")),e=i),n!==undefined&&(e="["+n+":"+BOOMR.now()+"] "+e),r&&(e+=":: "+r),t.errors[e]?t.errors[e]++:t.errors[e]=1},addVar:function(e,n){if(typeof e=="string")t.vars[e]=n;else if(typeof e=="object"){var r=e,i;for(i in r)r.hasOwnProperty(i)&&(t.vars[i]=r[i])}return this},removeVar:function(e){var n,r;if(!arguments.length)return this;arguments.length===1&&Object.prototype.toString.apply(e)==="[object Array]"?r=e:r=arguments;for(n=0;n<r.length;n++)t.vars.hasOwnProperty(r[n])&&delete t.vars[r[n]];return this},hasVar:function(e){return t.vars.hasOwnProperty(e)},requestStart:function(e){var t=BOOMR.now();return BOOMR.plugins.RT.startTimer("xhr_"+e,t),{loaded:function(n){BOOMR.responseEnd(e,t,n)}}},responseEnd:function(e,n,r){typeof e=="object"&&e.url?t.fireEvent("xhr_load",e):(BOOMR.plugins.RT.startTimer("xhr_"+e,n),t.fireEvent("xhr_load",{name:"xhr_"+e,data:r}))},sendBeacon:function(){var n,i,s,o,u,a=[];for(n in this.plugins)if(this.plugins.hasOwnProperty(n)){if(t.disabled_plugins[n])continue;if(!this.plugins[n].is_complete())return!1}t.vars.pgu=BOOMR.utils.cleanupURL(r.URL.replace(/#.*/,"")),t.vars.u||(t.vars.u=t.vars.pgu),t.vars.pgu===t.vars.u&&delete t.vars.pgu,t.vars.v=BOOMR.version,BOOMR.visibilityState()&&(t.vars["vis.st"]=BOOMR.visibilityState(),BOOMR.lastVisibilityEvent.visible&&(t.vars["vis.lv"]=BOOMR.now()-BOOMR.lastVisibilityEvent.visible),BOOMR.lastVisibilityEvent.hidden&&(t.vars["vis.lh"]=BOOMR.now()-BOOMR.lastVisibilityEvent.hidden)),e!==window&&(t.vars["if"]="");for(n in t.errors)t.errors.hasOwnProperty(n)&&a.push(n+(t.errors[n]>1?" (*"+t.errors[n]+")":""));return a.length>0&&(t.vars.errors=a.join("\n")),t.errors={},t.fireEvent("before_beacon",t.vars),t.beacon_url?(i=document.createElement("form"),u=BOOMR.utils.pushVars(i,t.vars),t.fireEvent("onbeacon",t.vars),u?(BOOMR.utils.sendData(i,t.beacon_type==="AUTO"?u>2e3?"POST":"GET":"POST"),!0):this):!0}},delete BOOMR_start,typeof BOOMR_lstart=="number"?(n.t_lstart=BOOMR_lstart,delete BOOMR_lstart):typeof BOOMR.window.BOOMR_lstart=="number"&&(n.t_lstart=BOOMR.window.BOOMR_lstart),function(){var e;typeof console=="object"&&console.log!==undefined&&(n.log=function(e,t,n){console.log(n+": ["+t+"] "+e)}),e=function(e){return function(t,n){return this.log(t,e,"boomerang"+(n?"."+n:"")),this}},n.debug=e("debug"),n.info=e("info"),n.warn=e("warn"),n.error=e("error")}(),function(){var e;for(e in n)n.hasOwnProperty(e)&&(BOOMR[e]=n[e]);BOOMR.xhr_excludes||(BOOMR.xhr_excludes={})}(),o("onBoomerangLoaded",{BOOMR:BOOMR},!0)}(window),function(e){var t=e.document,n;BOOMR=BOOMR||{},BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.RT)return;n={onloadfired:!1,unloadfired:!1,visiblefired:!1,initialized:!1,complete:!1,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:!0,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,cached_t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,basic_timers:{t_done:1,t_resp:1,t_page:1},addedVars:[],updateCookie:function(e,t){var n,r,i,s;if(!this.cookie)return!1;i=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(typeof e=="object")for(s in e)if(e.hasOwnProperty(s))if(e[s]===undefined)i.hasOwnProperty(s)&&delete i[s];else{if(s==="nu"||s==="r")e[s]=BOOMR.utils.hashQueryString(e[s],!0);i[s]=e[s]}return r=BOOMR.now(),t&&(i[t]=r),BOOMR.utils.setCookie(this.cookie,i,this.cookie_exp)?(n=BOOMR.now(),n-r>50&&(BOOMR.utils.removeCookie(this.cookie),BOOMR.error("took more than 50ms to set cookie... aborting: "+r+" -> "+n,"rt")),!0):!1},initFromCookie:function(){var e,n;n=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!n)return;n.s=Math.max(+n.ul||0,+n.cl||0),n.s&&(n.r||n.nu)&&(this.r=n.r,e=BOOMR.utils.hashQueryString(t.URL,!0),!this.strict_referrer||n.nu&&n.nu===e&&n.s<+n.cl+15||n.s===+n.ul&&this.r===this.r2?(this.t_start=n.s,+n.hd>n.s&&(this.t_fb_approx=parseInt(n.hd,10))):this.t_start=this.t_fb_approx=undefined),this.updateCookie({s:undefined,r:undefined,nu:undefined,ul:undefined,cl:undefined,hd:undefined})},getBoomerangTimings:function(){function u(e,t){var n=Math.round(e?e:0),r=Math.round(t?t:0);return n=n===0?0:n-r,n?n:""}var e,t,r,i,s,o;BOOMR.t_start&&(BOOMR.plugins.RT.startTimer("boomerang",BOOMR.t_start),BOOMR.plugins.RT.endTimer("boomerang",BOOMR.t_end),BOOMR.plugins.RT.endTimer("boomr_fb",BOOMR.t_start),BOOMR.t_lstart&&(BOOMR.plugins.RT.endTimer("boomr_ld",BOOMR.t_lstart),BOOMR.plugins.RT.setTimer("boomr_lat",BOOMR.t_start-BOOMR.t_lstart)));try{if(window.performance&&window.performance.getEntriesByName){r={"rt.bmr":BOOMR.url};for(i in r)if(r.hasOwnProperty(i)&&r[i]){e=window.performance.getEntriesByName(r[i]);if(!e||e.length===0)continue;e=e[0],s=u(e.startTime,0),o=[s,u(e.responseEnd,s),u(e.responseStart,s),u(e.requestStart,s),u(e.connectEnd,s),u(e.secureConnectionStart,s),u(e.connectStart,s),u(e.domainLookupEnd,s),u(e.domainLookupStart,s),u(e.redirectEnd,s),u(e.redirectStart,s)].join(",").replace(/,+$/,""),BOOMR.addVar(i,o),n.addedVars.push(i)}}}catch(a){BOOMR.addError(a,"rt.getBoomerangTimings")}},checkPreRender:function(){return BOOMR.visibilityState()!=="prerender"?!1:(BOOMR.plugins.RT.startTimer("t_load",this.navigationStart),BOOMR.plugins.RT.endTimer("t_load"),BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart),BOOMR.plugins.RT.startTimer("t_postrender"),!0)},initFromNavTiming:function(){var t,n,r;if(this.navigationStart)return;n=e.performance||e.msPerformance||e.webkitPerformance||e.mozPerformance,n&&n.navigation&&(this.navigationType=n.navigation.type),n&&n.timing?t=n.timing:e.chrome&&e.chrome.csi&&e.chrome.csi().startE?(t={navigationStart:e.chrome.csi().startE},r="csi"):e.gtbExternal&&e.gtbExternal.startE()&&(t={navigationStart:e.gtbExternal.startE()},r="gtb"),t&&(BOOMR.addVar("rt.start",r||"navigation"),this.navigationStart=t.navigationStart||t.fetchStart||undefined,this.responseStart=t.responseStart||undefined,navigator.userAgent.match(/Firefox\/[78]\./)&&(this.navigationStart=t.unloadEventStart||t.fetchStart||undefined));return},validateLoadTimestamp:function(t,n){var r=t;return n&&n.timing&&n.timing.loadEventEnd?r=n.timing.loadEventEnd:BOOMR.loadedLate&&(e.performance&&e.performance.timing?e.performance.timing.loadEventStart&&e.performance.timing.loadEventStart<BOOMR.t_end&&(r=e.performance.timing.loadEventStart):r=BOOMR.t_lstart||BOOMR.t_start||t),r},setPageLoadTimers:function(e,t,r){var i;if(e!=="xhr"){n.initFromCookie(),n.initFromNavTiming();if(n.checkPreRender())return!1}return e==="xhr"?r&&r.timing&&(i=r.timing.responseStart):n.responseStart?i=n.responseStart:n.timers.hasOwnProperty("t_page")?BOOMR.plugins.RT.endTimer("t_page"):n.t_fb_approx&&(i=n.t_fb_approx),i&&(BOOMR.plugins.RT.endTimer("t_resp",i),n.timers.t_load?BOOMR.plugins.RT.setTimer("t_page",n.timers.t_load.end-i):BOOMR.plugins.RT.setTimer("t_page",t-i)),n.timers.hasOwnProperty("t_postrender")&&(BOOMR.plugins.RT.endTimer("t_postrender"),BOOMR.plugins.RT.endTimer("t_prerender")),!0},setSupportingTimestamps:function(e){e&&BOOMR.addVar("rt.tstart",e),typeof n.t_start=="number"&&n.t_start!==e&&BOOMR.addVar("rt.cstart",n.t_start),BOOMR.addVar("rt.bstart",BOOMR.t_start),BOOMR.t_lstart&&BOOMR.addVar("rt.blstart",BOOMR.t_lstart),BOOMR.addVar("rt.end",n.timers.t_done.end)},determineTStart:function(e,t){var r;return e==="xhr"?(t&&t.name&&n.timers[t.name]?r=n.timers[t.name].start:t&&t.timing&&t.timing.requestStart&&(r=t.timing.requestStart),BOOMR.addVar("rt.start","manual")):n.navigationStart?r=n.navigationStart:n.t_start&&n.navigationType!==2?(r=n.t_start,BOOMR.addVar("rt.start","cookie")):n.cached_t_start?r=n.cached_t_start:(BOOMR.addVar("rt.start","none"),r=undefined),n.cached_t_start=r,r},page_ready:function(){this.onloadfired=!0},check_visibility:function(){BOOMR.visibilityState()==="visible"&&(n.visiblefired=!0),n.visibilityState==="prerender"&&BOOMR.visibilityState()!=="prerender"&&BOOMR.plugins.RT.done(null,"visible"),n.visibilityState=BOOMR.visibilityState()},page_unload:function(e){this.unloadfired||BOOMR.plugins.RT.done(e,"unload"),this.updateCookie({r:t.URL},e.type==="beforeunload"?"ul":"hd"),this.unloadfired=!0},_iterable_click:function(e,t,r,i){var s;if(!r)return;while(r&&r.nodeName.toUpperCase()!==t)r=r.parentNode;r&&r.nodeName.toUpperCase()===t&&(s=i(r),this.updateCookie({nu:s},"cl"),BOOMR.addVar("nu",BOOMR.utils.cleanupURL(s)),n.addedVars.push("nu"))},onclick:function(e){n._iterable_click("Click","A",e,function(e){return e.href})},onsubmit:function(e){n._iterable_click("Submit","FORM",e,function(e){var n=e.getAttribute("action")||t.URL||"";return n.match(/\?/)?n:n+"?"})},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded")},clear:function(e){n.addedVars&&n.addedVars.length>0&&(BOOMR.removeVar(n.addedVars),n.addedVars=[])}},BOOMR.plugins.RT={init:function(r){return e!==BOOMR.window&&(e=BOOMR.window),t=e.document,BOOMR.utils.pluginConfig(n,r,"RT",["cookie","cookie_exp","strict_referrer"]),n.r=n.r2=BOOMR.utils.hashQueryString(t.referrer,!0),n.initFromCookie(),n.getBoomerangTimings(),n.initialized?this:(n.complete=!1,n.timers={},n.check_visibility(),BOOMR.subscribe("page_ready",n.page_ready,null,n),BOOMR.subscribe("visibility_changed",n.check_visibility,null,n),BOOMR.subscribe("page_ready",this.done,"load",this),BOOMR.subscribe("xhr_load",this.done,"xhr",this),BOOMR.subscribe("dom_loaded",n.domloaded,null,n),BOOMR.subscribe("page_unload",n.page_unload,null,n),BOOMR.subscribe("click",n.onclick,null,n),BOOMR.subscribe("form_submit",n.onsubmit,null,n),BOOMR.subscribe("before_beacon",this.addTimersToBeacon,"beacon",this),BOOMR.subscribe("onbeacon",n.clear,null,n),n.initialized=!0,this)},startTimer:function(e,t){return e&&(e==="t_page"&&this.endTimer("t_resp",t),n.timers[e]={start:typeof t=="number"?t:BOOMR.now()}),this},endTimer:function(e,t){return e&&(n.timers[e]=n.timers[e]||{},n.timers[e].end===undefined&&(n.timers[e].end=typeof t=="number"?t:BOOMR.now())),this},setTimer:function(e,t){return e&&(n.timers[e]={delta:t}),this},addTimersToBeacon:function(e,t){var r,i,s=[];for(r in n.timers)if(n.timers.hasOwnProperty(r)){i=n.timers[r],typeof i.delta!="number"&&(typeof i.start!="number"&&(i.start=n.cached_t_start),i.delta=i.end-i.start);if(isNaN(i.delta))continue;n.basic_timers.hasOwnProperty(r)?(BOOMR.addVar(r,i.delta),n.addedVars.push(r)):s.push(r+"|"+i.delta)}s.length&&(BOOMR.addVar("t_other",s.join(",")),n.addedVars.push("t_other")),t==="beacon"&&(n.timers={},n.complete=!1)},done:function(e,t){try{}catch(r){}var i,s,o=BOOMR.now(),u=!1;n.complete=!1,s=n.validateLoadTimestamp(o,e);if(t==="load"||t==="visible"||t==="xhr")if(!n.setPageLoadTimers(t,s,e))return this;return i=n.determineTStart(t,e),e&&e.data&&(e=e.data),t==="xhr"&&e&&(u=e.subresource),this.endTimer("t_done",s),BOOMR.removeVar("t_done","t_page","t_resp","t_postrender","t_prerender","t_load","t_other","r","r2","rt.tstart","rt.cstart","rt.bstart","rt.end","rt.subres","rt.abld","http.errno","http.method","xhr.sync"),n.setSupportingTimestamps(i),this.addTimersToBeacon(),BOOMR.addVar("r",BOOMR.utils.cleanupURL(n.r)),n.r2!==n.r&&BOOMR.addVar("r2",BOOMR.utils.cleanupURL(n.r2)),t==="xhr"&&e&&e&&e.data&&(e=e.data),t==="xhr"&&e&&(u=e.subresource,e.url&&(BOOMR.addVar("u",BOOMR.utils.cleanupURL(e.url.replace(/#.*/,""))),n.addedVars.push("u")),e.status&&(e.status<-1||e.status>=400)&&BOOMR.addVar("http.errno",e.status),e.method&&e.method!=="GET"&&BOOMR.addVar("http.method",e.method),e.headers&&BOOMR.addVar("http.hdr",e.headers),e.synchronous&&BOOMR.addVar("xhr.sync",1),e.initiator&&BOOMR.addVar("http.initiator",e.initiator),n.addedVars.push("http.errno","http.method","http.hdr","xhr.sync","http.initiator")),u&&(BOOMR.addVar("rt.subres",1),n.addedVars.push("rt.subres")),n.updateCookie(),t==="unload"&&(BOOMR.addVar("rt.quit",""),n.onloadfired||BOOMR.addVar("rt.abld",""),n.visiblefired||BOOMR.addVar("rt.ntvu","")),n.complete=!0,BOOMR.sendBeacon(),this},is_complete:function(){return n.complete}}}(window),function(){BOOMR=BOOMR||{},BOOMR.plugins=BOOMR.plugins||{};if(BOOMR.plugins.NavigationTiming)return;var e={complete:!1,xhr_done:function(t){var n=BOOMR.window,r,i={},s;if(!t)return;t.data&&(t=t.data);if(t.url&&n.performance&&n.performance.getEntriesByName){r=n.performance.getEntriesByName(t.url);if(r&&r.length>0){r=r[0],i={nt_red_st:r.redirectStart,nt_red_end:r.redirectEnd,nt_fet_st:r.fetchStart,nt_dns_st:r.domainLookupStart,nt_dns_end:r.domainLookupEnd,nt_con_st:r.connectStart,nt_con_end:r.connectEnd,nt_req_st:r.requestStart,nt_res_st:r.responseStart,nt_res_end:r.responseEnd},r.secureConnectionStart&&(i.nt_ssl_st=r.secureConnectionStart);for(s in i)i.hasOwnProperty(s)&&i[s]&&(i[s]+=n.performance.timing.navigationStart)}}t.timing&&(r=t.timing,i.nt_req_st||(i.nt_req_st=r.requestStart),i.nt_res_st||(i.nt_res_st=r.responseStart),i.nt_res_end||(i.nt_res_end=r.responseEnd),i.nt_domint=r.domInteractive,i.nt_domcomp=r.domComplete,i.nt_load_st=r.loadEventEnd,i.nt_load_end=r.loadEventEnd);for(s in i)i.hasOwnProperty(s)&&!i[s]&&delete i[s];BOOMR.addVar(i);try{e.addedVars.push.apply(e.addedVars,Object.keys(i))}catch(o){}this.complete=!0,BOOMR.sendBeacon()},done:function(){var t=BOOMR.window,n,r,i,s;if(this.complete)return this;e.addedVars=[],n=t.performance||t.msPerformance||t.webkitPerformance||t.mozPerformance;if(n&&n.timing&&n.navigation){r=n.navigation,i=n.timing,s={nt_red_cnt:r.redirectCount,nt_nav_type:r.type,nt_nav_st:i.navigationStart,nt_red_st:i.redirectStart,nt_red_end:i.redirectEnd,nt_fet_st:i.fetchStart,nt_dns_st:i.domainLookupStart,nt_dns_end:i.domainLookupEnd,nt_con_st:i.connectStart,nt_con_end:i.connectEnd,nt_req_st:i.requestStart,nt_res_st:i.responseStart,nt_res_end:i.responseEnd,nt_domloading:i.domLoading,nt_domint:i.domInteractive,nt_domcontloaded_st:i.domContentLoadedEventStart,nt_domcontloaded_end:i.domContentLoadedEventEnd,nt_domcomp:i.domComplete,nt_load_st:i.loadEventStart,nt_load_end:i.loadEventEnd,nt_unload_st:i.unloadEventStart,nt_unload_end:i.unloadEventEnd},i.secureConnectionStart&&(s.nt_ssl_st=i.secureConnectionStart),i.msFirstPaint&&(s.nt_first_paint=i.msFirstPaint),BOOMR.addVar(s);try{e.addedVars.push.apply(e.addedVars,Object.keys(s))}catch(o){}}if(t.chrome&&t.chrome.loadTimes){i=t.chrome.loadTimes();if(i){s={nt_spdy:i.wasFetchedViaSpdy?1:0,nt_cinf:i.connectionInfo,nt_first_paint:i.firstPaintTime},BOOMR.addVar(s);try{e.addedVars.push.apply(e.addedVars,Object.keys(s))}catch(o){}}}this.complete=!0,BOOMR.sendBeacon()},clear:function(t){e.addedVars&&e.addedVars.length>0&&(BOOMR.removeVar(e.addedVars),e.addedVars=[]),this.complete=!1}};BOOMR.plugins.NavigationTiming={init:function(){return e.initialized||(BOOMR.subscribe("page_ready",e.done,null,e),BOOMR.subscribe("xhr_load",e.xhr_done,null,e),BOOMR.subscribe("before_unload",e.done,null,e),BOOMR.subscribe("onbeacon",e.clear,null,e),e.initialized=!0),this},is_complete:function(){return e.complete}}}(),BOOMR.t_end=(new Date).getTime(),define("boomerang",function(e){return function(){var t,n;return t||e.boomerang}}(this));var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){e=String(e),t=t||2;while(e.length<t)e="0"+e;return e};return function(i,s,o){var u=dateFormat;arguments.length==1&&Object.prototype.toString.call(i)=="[object String]"&&!/\d/.test(i)&&(s=i,i=undefined),i=i?new Date(i):new Date;if(isNaN(i))throw SyntaxError("invalid date");s=String(u.masks[s]||s||u.masks["default"]),s.slice(0,4)=="UTC:"&&(s=s.slice(4),o=!0);var a=o?"getUTC":"get",f=i[a+"Date"](),l=i[a+"Day"](),c=i[a+"Month"](),h=i[a+"FullYear"](),p=i[a+"Hours"](),d=i[a+"Minutes"](),v=i[a+"Seconds"](),m=i[a+"Milliseconds"](),g=o?0:i.getTimezoneOffset(),y={d:f,dd:r(f),ddd:u.i18n.dayNames[l],dddd:u.i18n.dayNames[l+7],m:c+1,mm:r(c+1),mmm:u.i18n.monthNames[c],mmmm:u.i18n.monthNames[c+12],yy:String(h).slice(2),yyyy:h,h:p%12||12,hh:r(p%12||12),H:p,HH:r(p),M:d,MM:r(d),s:v,ss:r(v),l:r(m,3),L:r(m>99?Math.round(m/10):m),t:p<12?"a":"p",tt:p<12?"am":"pm",T:p<12?"A":"P",TT:p<12?"AM":"PM",Z:o?"UTC":(String(i).match(t)||[""]).pop().replace(n,""),o:(g>0?"-":"+")+r(Math.floor(Math.abs(g)/60)*100+Math.abs(g)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10]};return s.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)},define("dateFormat",function(e){return function(){var t,n;return t||e.dateFormat}}(this)),!function(e,t,n,r){function i(e,t,n){return setTimeout(f(e,n),t)}function s(e,t,n){return Array.isArray(e)?(o(e,n[t],n),!0):!1}function o(e,t,n){var i;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==r)for(i=0;i<e.length;)t.call(n,e[i],i,e),i++;else for(i in e)e.hasOwnProperty(i)&&t.call(n,e[i],i,e)}function u(t,n,r){var i="DEPRECATED METHOD: "+n+"\n"+r+" AT \n";return function(){var n=new Error("get-stack-trace"),r=n&&n.stack?n.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",s=e.console&&(e.console.warn||e.console.log);return s&&s.call(e.console,i,r),t.apply(this,arguments)}}function a(e,t,n){var r,i=t.prototype;r=e.prototype=Object.create(i),r.constructor=e,r._super=i,n&&ct(r,n)}function f(e,t){return function(){return e.apply(t,arguments)}}function l(e,t){return typeof e==dt?e.apply(t?t[0]||r:r,t):e}function c(e,t){return e===r?t:e}function h(e,t,n){o(m(t),function(t){e.addEventListener(t,n,!1)})}function p(e,t,n){o(m(t),function(t){e.removeEventListener(t,n,!1)})}function d(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function v(e,t){return e.indexOf(t)>-1}function m(e){return e.trim().split(/\s+/g)}function g(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function y(e){return Array.prototype.slice.call(e,0)}function b(e,t,n){for(var r=[],i=[],s=0;s<e.length;){var o=t?e[s][t]:e[s];g(i,o)<0&&r.push(e[s]),i[s]=o,s++}return n&&(r=t?r.sort(function(e,n){return e[t]>n[t]}):r.sort()),r}function w(e,t){for(var n,i,s=t[0].toUpperCase()+t.slice(1),o=0;o<ht.length;){if(n=ht[o],i=n?n+s:t,i in e)return i;o++}return r}function E(){return wt++}function S(t){var n=t.ownerDocument||t;return n.defaultView||n.parentWindow||e}function x(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){l(e.options.enable,[e])&&n.handler(t)},this.init()}function T(e){var t,n=e.options.inputClass;return new(t=n?n:xt?F:Tt?R:St?z:j)(e,N)}function N(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,s=t&Ot&&r-i===0,o=t&(_t|Dt)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(e.session={}),n.eventType=t,C(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function C(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=A(t)),i>1&&!n.firstMultiple?n.firstMultiple=A(t):1===i&&(n.firstMultiple=!1);var s=n.firstInput,o=n.firstMultiple,u=o?o.center:s.center,a=t.center=O(r);t.timeStamp=gt(),t.deltaTime=t.timeStamp-s.timeStamp,t.angle=P(u,a),t.distance=D(u,a),k(n,t),t.offsetDirection=_(t.deltaX,t.deltaY);var f=M(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=mt(f.x)>mt(f.y)?f.x:f.y,t.scale=o?B(o.pointers,r):1,t.rotation=o?H(o.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,L(n,t);var l=e.element;d(t.srcEvent.target,l)&&(l=t.srcEvent.target),t.target=l}function k(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},s=e.prevInput||{};t.eventType!==Ot&&s.eventType!==_t||(i=e.prevDelta={x:s.deltaX||0,y:s.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y}),t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}function L(e,t){var n,i,s,o,u=e.lastInterval||t,a=t.timeStamp-u.timeStamp;if(t.eventType!=Dt&&(a>At||u.velocity===r)){var f=t.deltaX-u.deltaX,l=t.deltaY-u.deltaY,c=M(a,f,l);i=c.x,s=c.y,n=mt(c.x)>mt(c.y)?c.x:c.y,o=_(f,l),e.lastInterval=t}else n=u.velocity,i=u.velocityX,s=u.velocityY,o=u.direction;t.velocity=n,t.velocityX=i,t.velocityY=s,t.direction=o}function A(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:vt(e.pointers[n].clientX),clientY:vt(e.pointers[n].clientY)},n++;return{timeStamp:gt(),pointers:t,center:O(t),deltaX:e.deltaX,deltaY:e.deltaY}}function O(e){var t=e.length;if(1===t)return{x:vt(e[0].clientX),y:vt(e[0].clientY)};for(var n=0,r=0,i=0;t>i;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:vt(n/t),y:vt(r/t)}}function M(e,t,n){return{x:t/e||0,y:n/e||0}}function _(e,t){return e===t?Pt:mt(e)>=mt(t)?0>e?Ht:Bt:0>t?jt:Ft}function D(e,t,n){n||(n=Ut);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function P(e,t,n){n||(n=Ut);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}function H(e,t){return P(t[1],t[0],zt)+P(e[1],e[0],zt)}function B(e,t){return D(t[0],t[1],zt)/D(e[0],e[1],zt)}function j(){this.evEl=Xt,this.evWin=Vt,this.pressed=!1,x.apply(this,arguments)}function F(){this.evEl=Kt,this.evWin=Qt,x.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function I(){this.evTarget=Yt,this.evWin=Zt,this.started=!1,x.apply(this,arguments)}function q(e,t){var n=y(e.touches),r=y(e.changedTouches);return t&(_t|Dt)&&(n=b(n.concat(r),"identifier",!0)),[n,r]}function R(){this.evTarget=tn,this.targetIds={},x.apply(this,arguments)}function U(e,t){var n=y(e.touches),r=this.targetIds;if(t&(Ot|Mt)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,s,o=y(e.changedTouches),u=[],a=this.target;if(s=n.filter(function(e){return d(e.target,a)}),t===Ot)for(i=0;i<s.length;)r[s[i].identifier]=!0,i++;for(i=0;i<o.length;)r[o[i].identifier]&&u.push(o[i]),t&(_t|Dt)&&delete r[o[i].identifier],i++;return u.length?[b(s.concat(u),"identifier",!0),u]:void 0}function z(){x.apply(this,arguments);var e=f(this.handler,this);this.touch=new R(this.manager,e),this.mouse=new j(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function W(e,t){e&Ot?(this.primaryTouch=t.changedPointers[0].identifier,X.call(this,t)):e&(_t|Dt)&&X.call(this,t)}function X(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches,i=function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)};setTimeout(i,nn)}}function V(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],s=Math.abs(t-i.x),o=Math.abs(n-i.y);if(rn>=s&&rn>=o)return!0}return!1}function $(e,t){this.manager=e,this.set(t)}function J(e){if(v(e,ln))return ln;var t=v(e,cn),n=v(e,hn);return t&&n?ln:t||n?t?cn:hn:v(e,fn)?fn:an}function K(){if(!on)return!1;var t={},n=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(r){t[r]=n?e.CSS.supports("touch-action",r):!0}),t}function Q(e){this.options=ct({},this.defaults,e||{}),this.id=E(),this.manager=null,this.options.enable=c(this.options.enable,!0),this.state=dn,this.simultaneous={},this.requireFail=[]}function G(e){return e&bn?"cancel":e&gn?"end":e&mn?"move":e&vn?"start":""}function Y(e){return e==Ft?"down":e==jt?"up":e==Ht?"left":e==Bt?"right":""}function Z(e,t){var n=t.manager;return n?n.get(e):e}function et(){Q.apply(this,arguments)}function tt(){et.apply(this,arguments),this.pX=null,this.pY=null}function nt(){et.apply(this,arguments)}function rt(){Q.apply(this,arguments),this._timer=null,this._input=null}function it(){et.apply(this,arguments)}function st(){et.apply(this,arguments)}function ot(){Q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ut(e,t){return t=t||{},t.recognizers=c(t.recognizers,ut.defaults.preset),new at(e,t)}function at(e,t){this.options=ct({},ut.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=T(this),this.touchAction=new $(this,this.options.touchAction),ft(this,!0),o(this.options.recognizers,function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])},this)}function ft(e,t){var n=e.element;if(n.style){var r;o(e.options.cssProps,function(i,s){r=w(n.style,s),t?(e.oldCssProps[r]=n.style[r],n.style[r]=i):n.style[r]=e.oldCssProps[r]||""}),t||(e.oldCssProps={})}}function lt(e,n){var r=t.createEvent("Event");r.initEvent(e,!0,!0),r.gesture=n,n.target.dispatchEvent(r)}var ct,ht=["","webkit","Moz","MS","ms","o"],pt=t.createElement("div"),dt="function",vt=Math.round,mt=Math.abs,gt=Date.now;ct="function"!=typeof Object.assign?function(e){if(e===r||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i!==r&&null!==i)for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}return t}:Object.assign;var yt=u(function(e,t,n){for(var i=Object.keys(t),s=0;s<i.length;)(!n||n&&e[i[s]]===r)&&(e[i[s]]=t[i[s]]),s++;return e},"extend","Use `assign`."),bt=u(function(e,t){return yt(e,t,!0)},"merge","Use `assign`."),wt=1,Et=/mobile|tablet|ip(ad|hone|od)|android/i,St="ontouchstart"in e,xt=w(e,"PointerEvent")!==r,Tt=St&&Et.test(navigator.userAgent),Nt="touch",Ct="pen",kt="mouse",Lt="kinect",At=25,Ot=1,Mt=2,_t=4,Dt=8,Pt=1,Ht=2,Bt=4,jt=8,Ft=16,It=Ht|Bt,qt=jt|Ft,Rt=It|qt,Ut=["x","y"],zt=["clientX","clientY"];x.prototype={handler:function(){},init:function(){this.evEl&&h(this.element,this.evEl,this.domHandler),this.evTarget&&h(this.target,this.evTarget,this.domHandler),this.evWin&&h(S(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&p(this.element,this.evEl,this.domHandler),this.evTarget&&p(this.target,this.evTarget,this.domHandler),this.evWin&&p(S(this.element),this.evWin,this.domHandler)}};var Wt={mousedown:Ot,mousemove:Mt,mouseup:_t},Xt="mousedown",Vt="mousemove mouseup";a(j,x,{handler:function(e){var t=Wt[e.type];t&Ot&&0===e.button&&(this.pressed=!0),t&Mt&&1!==e.which&&(t=_t),this.pressed&&(t&_t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:kt,srcEvent:e}))}});var $t={pointerdown:Ot,pointermove:Mt,pointerup:_t,pointercancel:Dt,pointerout:Dt},Jt={2:Nt,3:Ct,4:kt,5:Lt},Kt="pointerdown",Qt="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Kt="MSPointerDown",Qt="MSPointerMove MSPointerUp MSPointerCancel"),a(F,x,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=$t[r],s=Jt[e.pointerType]||e.pointerType,o=s==Nt,u=g(t,e.pointerId,"pointerId");i&Ot&&(0===e.button||o)?0>u&&(t.push(e),u=t.length-1):i&(_t|Dt)&&(n=!0),0>u||(t[u]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:s,srcEvent:e}),n&&t.splice(u,1))}});var Gt={touchstart:Ot,touchmove:Mt,touchend:_t,touchcancel:Dt},Yt="touchstart",Zt="touchstart touchmove touchend touchcancel";a(I,x,{handler:function(e){var t=Gt[e.type];if(t===Ot&&(this.started=!0),this.started){var n=q.call(this,e,t);t&(_t|Dt)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:Nt,srcEvent:e})}}});var en={touchstart:Ot,touchmove:Mt,touchend:_t,touchcancel:Dt},tn="touchstart touchmove touchend touchcancel";a(R,x,{handler:function(e){var t=en[e.type],n=U.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:Nt,srcEvent:e})}});var nn=2500,rn=25;a(z,x,{handler:function(e,t,n){var r=n.pointerType==Nt,i=n.pointerType==kt;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)W.call(this,t,n);else if(i&&V.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var sn=w(pt.style,"touchAction"),on=sn!==r,un="compute",an="auto",fn="manipulation",ln="none",cn="pan-x",hn="pan-y",pn=K();$.prototype={set:function(e){e==un&&(e=this.compute()),on&&this.manager.element.style&&pn[e]&&(this.manager.element.style[sn]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return o(this.manager.recognizers,function(t){l(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))}),J(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)return void t.preventDefault();var r=this.actions,i=v(r,ln)&&!pn[ln],s=v(r,hn)&&!pn[hn],o=v(r,cn)&&!pn[cn];if(i){var u=1===e.pointers.length,a=e.distance<2,f=e.deltaTime<250;if(u&&a&&f)return}return o&&s?void 0:i||s&&n&It||o&&n&qt?this.preventSrc(t):void 0},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var dn=1,vn=2,mn=4,gn=8,yn=gn,bn=16,wn=32;Q.prototype={defaults:{},set:function(e){return ct(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(s(e,"recognizeWith",this))return this;var t=this.simultaneous;return e=Z(e,this),t[e.id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return s(e,"dropRecognizeWith",this)?this:(e=Z(e,this),delete this.simultaneous[e.id],this)},requireFailure:function(e){if(s(e,"requireFailure",this))return this;var t=this.requireFail;return e=Z(e,this),-1===g(t,e)&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(s(e,"dropRequireFailure",this))return this;e=Z(e,this);var t=g(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){function t(t){n.manager.emit(t,e)}var n=this,r=this.state;gn>r&&t(n.options.event+G(r)),t(n.options.event),e.additionalEvent&&t(e.additionalEvent),r>=gn&&t(n.options.event+G(r))},tryEmit:function(e){return this.canEmit()?this.emit(e):void (this.state=wn)},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(this.requireFail[e].state&(wn|dn)))return!1;e++}return!0},recognize:function(e){var t=ct({},e);return l(this.options.enable,[this,t])?(this.state&(yn|bn|wn)&&(this.state=dn),this.state=this.process(t),void (this.state&(vn|mn|gn|bn)&&this.tryEmit(t))):(this.reset(),void (this.state=wn))},process:function(e){},getTouchAction:function(){},reset:function(){}},a(et,Q,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=t&(vn|mn),i=this.attrTest(e);return r&&(n&Dt||!i)?t|bn:r||i?n&_t?t|gn:t&vn?t|mn:vn:wn}}),a(tt,et,{defaults:{event:"pan",threshold:10,pointers:1,direction:Rt},getTouchAction:function(){var e=this.options.direction,t=[];return e&It&&t.push(hn),e&qt&&t.push(cn),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,s=e.deltaX,o=e.deltaY;return i&t.direction||(t.direction&It?(i=0===s?Pt:0>s?Ht:Bt,n=s!=this.pX,r=Math.abs(e.deltaX)):(i=0===o?Pt:0>o?jt:Ft,n=o!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return et.prototype.attrTest.call(this,e)&&(this.state&vn||!(this.state&vn)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Y(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),a(nt,et,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[ln]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||this.state&vn)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),a(rt,Q,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[an]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,s=e.deltaTime>t.time;if(this._input=e,!r||!n||e.eventType&(_t|Dt)&&!s)this.reset();else if(e.eventType&Ot)this.reset(),this._timer=i(function(){this.state=yn,this.tryEmit()},t.time,this);else if(e.eventType&_t)return yn;return wn},reset:function(){clearTimeout(this._timer)},emit:function(e){this.state===yn&&(e&&e.eventType&_t?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=gt(),this.manager.emit(this.options.event,this._input)))}}),a(it,et,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[ln]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||this.state&vn)}}),a(st,et,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:It|qt,pointers:1},getTouchAction:function(){return tt.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return n&(It|qt)?t=e.overallVelocity:n&It?t=e.overallVelocityX:n&qt&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&mt(t)>this.options.velocity&&e.eventType&_t},emit:function(e){var t=Y(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),a(ot,Q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[fn]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&Ot&&0===this.count)return this.failTimeout();if(r&&s&&n){if(e.eventType!=_t)return this.failTimeout();var o=this.pTime?e.timeStamp-this.pTime<t.interval:!0,u=!this.pCenter||D(this.pCenter,e.center)<t.posThreshold;this.pTime=e.timeStamp,this.pCenter=e.center,u&&o?this.count+=1:this.count=1,this._input=e;var a=this.count%t.taps;if(0===a)return this.hasRequireFailures()?(this._timer=i(function(){this.state=yn,this.tryEmit()},t.interval,this),vn):yn}return wn},failTimeout:function(){return this._timer=i(function(){this.state=wn},this.options.interval,this),wn},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==yn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ut.VERSION="2.0.8",ut.defaults={domEvents:!1,touchAction:un,enable:!0,inputTarget:null,inputClass:null,preset:[[it,{enable:!1}],[nt,{enable:!1},["rotate"]],[st,{direction:It}],[tt,{direction:It},["swipe"]],[ot],[ot,{event:"doubletap",taps:2},["tap"]],[rt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var En=1,Sn=2;at.prototype={set:function(e){return ct(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?Sn:En},recognize:function(e){var t=this.session;if(!t.stopped){this.touchAction.preventDefaults(e);var n,r=this.recognizers,i=t.curRecognizer;(!i||i&&i.state&yn)&&(i=t.curRecognizer=null);for(var s=0;s<r.length;)n=r[s],t.stopped===Sn||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&n.state&(vn|mn|gn)&&(i=t.curRecognizer=n),s++}},get:function(e){if(e instanceof Q)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(s(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(s(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=g(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==r&&t!==r){var n=this.handlers;return o(m(e),function(e){n[e]=n[e]||[],n[e].push(t)}),this}},off:function(e,t){if(e!==r){var n=this.handlers;return o(m(e),function(e){t?n[e]&&n[e].splice(g(n[e],t),1):delete n[e]}),this}},emit:function(e,t){this.options.domEvents&&lt(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&ft(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},ct(ut,{INPUT_START:Ot,INPUT_MOVE:Mt,INPUT_END:_t,INPUT_CANCEL:Dt,STATE_POSSIBLE:dn,STATE_BEGAN:vn,STATE_CHANGED:mn,STATE_ENDED:gn,STATE_RECOGNIZED:yn,STATE_CANCELLED:bn,STATE_FAILED:wn,DIRECTION_NONE:Pt,DIRECTION_LEFT:Ht,DIRECTION_RIGHT:Bt,DIRECTION_UP:jt,DIRECTION_DOWN:Ft,DIRECTION_HORIZONTAL:It,DIRECTION_VERTICAL:qt,DIRECTION_ALL:Rt,Manager:at,Input:x,TouchAction:$,TouchInput:R,MouseInput:j,PointerEventInput:F,TouchMouseInput:z,SingleTouchInput:I,Recognizer:Q,AttrRecognizer:et,Tap:ot,Pan:tt,Swipe:st,Pinch:nt,Rotate:it,Press:rt,on:h,off:p,each:o,merge:bt,extend:yt,assign:ct,inherit:a,bindFn:f,prefixed:w});var xn="undefined"!=typeof e?e:"undefined"!=typeof self?self:{};xn.Hammer=ut,"function"==typeof define&&define.amd?define("hammer",[],function(){return ut}):"undefined"!=typeof module&&module.exports?module.exports=ut:e[n]=ut}(window,document,"Hammer"),!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("source-map",[],t):"object"==typeof exports?exports.sourceMap=t():e.sourceMap=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return e[i].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){t.SourceMapGenerator=n(1).SourceMapGenerator,t.SourceMapConsumer=n(7).SourceMapConsumer,t.SourceNode=n(10).SourceNode},function(e,t,n){function r(e){e||(e={}),this._file=s.getArg(e,"file",null),this._sourceRoot=s.getArg(e,"sourceRoot",null),this._skipValidation=s.getArg(e,"skipValidation",!1),this._sources=new o,this._names=new o,this._mappings=new u,this._sourcesContents=null}var i=n(2),s=n(4),o=n(5).ArraySet,u=n(6).MappingList;r.prototype._version=3,r.fromSourceMap=function(e){var t=e.sourceRoot,n=new r({file:e.file,sourceRoot:t});return e.eachMapping(function(e){var r={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(r.source=e.source,null!=t&&(r.source=s.relative(t,r.source)),r.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(r.name=e.name)),n.addMapping(r)}),e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&n.setSourceContent(t,r)}),n},r.prototype.addMapping=function(e){var t=s.getArg(e,"generated"),n=s.getArg(e,"original",null),r=s.getArg(e,"source",null),i=s.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,n,r,i),null==r||this._sources.has(r)||this._sources.add(r),null==i||this._names.has(i)||this._names.add(i),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=n&&n.line,originalColumn:null!=n&&n.column,source:r,name:i})},r.prototype.setSourceContent=function(e,t){var n=e;null!=this._sourceRoot&&(n=s.relative(this._sourceRoot,n)),null!=t?(this._sourcesContents||(this._sourcesContents={}),this._sourcesContents[s.toSetString(n)]=t):this._sourcesContents&&(delete this._sourcesContents[s.toSetString(n)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))},r.prototype.applySourceMap=function(e,t,n){var r=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');r=e.file}var i=this._sourceRoot;null!=i&&(r=s.relative(i,r));var u=new o,a=new o;this._mappings.unsortedForEach(function(t){if(t.source===r&&null!=t.originalLine){var o=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=o.source&&(t.source=o.source,null!=n&&(t.source=s.join(n,t.source)),null!=i&&(t.source=s.relative(i,t.source)),t.originalLine=o.line,t.originalColumn=o.column,null!=o.name&&(t.name=o.name))}var f=t.source;null==f||u.has(f)||u.add(f);var l=t.name;null==l||a.has(l)||a.add(l)},this),this._sources=u,this._names=a,e.sources.forEach(function(t){var r=e.sourceContentFor(t);null!=r&&(null!=n&&(t=s.join(n,t)),null!=i&&(t=s.relative(i,t)),this.setSourceContent(t,r))},this)},r.prototype._validateMapping=function(e,t,n,r){if((!(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0)||t||n||r)&&!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&n))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:n,original:t,name:r}))},r.prototype._serializeMappings=function(){for(var e,t,n,r=0,o=1,u=0,a=0,f=0,l=0,c="",h=this._mappings.toArray(),p=0,d=h.length;d>p;p++){if(e=h[p],e.generatedLine!==o)for(r=0;e.generatedLine!==o;)c+=";",o++;else if(p>0){if(!s.compareByGeneratedPositionsInflated(e,h[p-1]))continue;c+=","}c+=i.encode(e.generatedColumn-r),r=e.generatedColumn,null!=e.source&&(n=this._sources.indexOf(e.source),c+=i.encode(n-l),l=n,c+=i.encode(e.originalLine-1-a),a=e.originalLine-1,c+=i.encode(e.originalColumn-u),u=e.originalColumn,null!=e.name&&(t=this._names.indexOf(e.name),c+=i.encode(t-f),f=t))}return c},r.prototype._generateSourcesContent=function(e,t){return e.map(function(e){if(!this._sourcesContents)return null;null!=t&&(e=s.relative(t,e));var n=s.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,n)?this._sourcesContents[n]:null},this)},r.prototype.toJSON=function(){var e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e},r.prototype.toString=function(){return JSON.stringify(this.toJSON())},t.SourceMapGenerator=r},function(e,t,n){function r(e){return 0>e?(-e<<1)+1:(e<<1)+0}function i(e){var t=1===(1&e),n=e>>1;return t?-n:n}var s=n(3),o=5,u=1<<o,a=u-1,f=u;t.encode=function(e){var t,n="",i=r(e);do t=i&a,i>>>=o,i>0&&(t|=f),n+=s.encode(t);while(i>0);return n},t.decode=function(e,t,n){var r,u,c=e.length,h=0,p=0;do{if(t>=c)throw new Error("Expected more digits in base 64 VLQ value.");if(u=s.decode(e.charCodeAt(t++)),-1===u)throw new Error("Invalid base64 digit: "+e.charAt(t-1));r=!!(u&f),u&=a,h+=u<<p,p+=o}while(r);n.value=i(h),n.rest=t}},function(e,t){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");t.encode=function(e){if(e>=0&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){var t=65,n=90,r=97,i=122,s=48,o=57,u=43,a=47,f=26,l=52;return e>=t&&n>=e?e-t:e>=r&&i>=e?e-r+f:e>=s&&o>=e?e-s+l:e==u?62:e==a?63:-1}},function(e,t){function n(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')}function r(e){var t=e.match(d);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function i(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function s(e){var n=e,s=r(e);if(s){if(!s.path)return e;n=s.path}for(var o,u=t.isAbsolute(n),a=n.split(/\/+/),f=0,l=a.length-1;l>=0;l--)o=a[l],"."===o?a.splice(l,1):".."===o?f++:f>0&&(""===o?(a.splice(l+1,f),f=0):(a.splice(l,2),f--));return n=a.join("/"),""===n&&(n=u?"/":"."),s?(s.path=n,i(s)):n}function o(e,t){""===e&&(e="."),""===t&&(t=".");var n=r(t),o=r(e);if(o&&(e=o.path||"/"),n&&!n.scheme)return o&&(n.scheme=o.scheme),i(n);if(n||t.match(v))return t;if(o&&!o.host&&!o.path)return o.host=t,i(o);var u="/"===t.charAt(0)?t:s(e.replace(/\/+$/,"")+"/"+t);return o?(o.path=u,i(o)):u}function u(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");for(var n=0;0!==t.indexOf(e+"/");){var r=e.lastIndexOf("/");if(0>r)return t;if(e=e.slice(0,r),e.match(/^([^\/]+:\/)?\/*$/))return t;++n}return Array(n+1).join("../")+t.substr(e.length+1)}function a(e){return"$"+e}function f(e){return e.substr(1)}function l(e,t,n){var r=e.source-t.source;return 0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r||n?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=e.generatedLine-t.generatedLine,0!==r?r:e.name-t.name))))}function c(e,t,n){var r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r||n?r:(r=e.source-t.source,0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:e.name-t.name))))}function h(e,t){return e===t?0:e>t?1:-1}function p(e,t){var n=e.generatedLine-t.generatedLine;return 0!==n?n:(n=e.generatedColumn-t.generatedColumn,0!==n?n:(n=h(e.source,t.source),0!==n?n:(n=e.originalLine-t.originalLine,0!==n?n:(n=e.originalColumn-t.originalColumn,0!==n?n:h(e.name,t.name)))))}t.getArg=n;var d=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,v=/^data:.+\,.+$/;t.urlParse=r,t.urlGenerate=i,t.normalize=s,t.join=o,t.isAbsolute=function(e){return"/"===e.charAt(0)||!!e.match(d)},t.relative=u,t.toSetString=a,t.fromSetString=f,t.compareByOriginalPositions=l,t.compareByGeneratedPositionsDeflated=c,t.compareByGeneratedPositionsInflated=p},function(e,t,n){function r(){this._array=[],this._set={}}var i=n(4);r.fromArray=function(e,t){for(var n=new r,i=0,s=e.length;s>i;i++)n.add(e[i],t);return n},r.prototype.size=function(){return Object.getOwnPropertyNames(this._set).length},r.prototype.add=function(e,t){var n=i.toSetString(e),r=this._set.hasOwnProperty(n),s=this._array.length;(!r||t)&&this._array.push(e),r||(this._set[n]=s)},r.prototype.has=function(e){var t=i.toSetString(e);return this._set.hasOwnProperty(t)},r.prototype.indexOf=function(e){var t=i.toSetString(e);if(this._set.hasOwnProperty(t))return this._set[t];throw new Error('"'+e+'" is not in the set.')},r.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},r.prototype.toArray=function(){return this._array.slice()},t.ArraySet=r},function(e,t,n){function r(e,t){var n=e.generatedLine,r=t.generatedLine,i=e.generatedColumn,o=t.generatedColumn;return r>n||r==n&&o>=i||s.compareByGeneratedPositionsInflated(e,t)<=0}function i(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}var s=n(4);i.prototype.unsortedForEach=function(e,t){this._array.forEach(e,t)},i.prototype.add=function(e){r(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))},i.prototype.toArray=function(){return this._sorted||(this._array.sort(s.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},t.MappingList=i},function(e,t,n){function r(e){var t=e;return"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,""))),null!=t.sections?new o(t):new i(t)}function i(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=u.getArg(t,"version"),r=u.getArg(t,"sources"),i=u.getArg(t,"names",[]),s=u.getArg(t,"sourceRoot",null),o=u.getArg(t,"sourcesContent",null),a=u.getArg(t,"mappings"),l=u.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(u.normalize).map(function(e){return s&&u.isAbsolute(s)&&u.isAbsolute(e)?u.relative(s,e):e}),this._names=f.fromArray(i,!0),this._sources=f.fromArray(r,!0),this.sourceRoot=s,this.sourcesContent=o,this._mappings=a,this.file=l}function s(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}function o(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=u.getArg(t,"version"),i=u.getArg(t,"sections");if(n!=this._version)throw new Error("Unsupported version: "+n);this._sources=new f,this._names=new f;var s={line:-1,column:0};this._sections=i.map(function(e){if(e.url)throw new Error("Support for url field in sections not implemented.");var t=u.getArg(e,"offset"),n=u.getArg(t,"line"),i=u.getArg(t,"column");if(n<s.line||n===s.line&&i<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=t,{generatedOffset:{generatedLine:n+1,generatedColumn:i+1},consumer:new r(u.getArg(e,"map"))}})}var u=n(4),a=n(8),f=n(5).ArraySet,l=n(2),c=n(9).quickSort;r.fromSourceMap=function(e){return i.fromSourceMap(e)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(e,t){var n=e.charAt(t);return";"===n||","===n},r.prototype._parseMappings=function(e,t){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(e,t,n){var i,s=t||null,o=n||r.GENERATED_ORDER;switch(o){case r.GENERATED_ORDER:i=this._generatedMappings;break;case r.ORIGINAL_ORDER:i=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;i.map(function(e){var t=null===e.source?null:this._sources.at(e.source);return null!=t&&null!=a&&(t=u.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:null===e.name?null:this._names.at(e.name)}},this).forEach(e,s)},r.prototype.allGeneratedPositionsFor=function(e){var t=u.getArg(e,"line"),n={source:u.getArg(e,"source"),originalLine:t,originalColumn:u.getArg(e,"column",0)};if(null!=this.sourceRoot&&(n.source=u.relative(this.sourceRoot,n.source)),!this._sources.has(n.source))return[];n.source=this._sources.indexOf(n.source);var r=[],i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",u.compareByOriginalPositions,a.LEAST_UPPER_BOUND);if(i>=0){var s=this._originalMappings[i];if(void 0===e.column)for(var o=s.originalLine;s&&s.originalLine===o;)r.push({line:u.getArg(s,"generatedLine",null),column:u.getArg(s,"generatedColumn",null),lastColumn:u.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++i];else for(var f=s.originalColumn;s&&s.originalLine===t&&s.originalColumn==f;)r.push({line:u.getArg(s,"generatedLine",null),column:u.getArg(s,"generatedColumn",null),lastColumn:u.getArg(s,"lastGeneratedColumn",null)}),s=this._originalMappings[++i]}return r},t.SourceMapConsumer=r,i.prototype=Object.create(r.prototype),i.prototype.consumer=r,i.fromSourceMap=function(e){var t=Object.create(i.prototype),n=t._names=f.fromArray(e._names.toArray(),!0),r=t._sources=f.fromArray(e._sources.toArray(),!0);t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file;for(var o=e._mappings.toArray().slice(),a=t.__generatedMappings=[],l=t.__originalMappings=[],h=0,p=o.length;p>h;h++){var d=o[h],v=new s;v.generatedLine=d.generatedLine,v.generatedColumn=d.generatedColumn,d.source&&(v.source=r.indexOf(d.source),v.originalLine=d.originalLine,v.originalColumn=d.originalColumn,d.name&&(v.name=n.indexOf(d.name)),l.push(v)),a.push(v)}return c(t.__originalMappings,u.compareByOriginalPositions),t},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?u.join(this.sourceRoot,e):e},this)}}),i.prototype._parseMappings=function(e,t){for(var n,r,i,o,a,f=1,h=0,p=0,d=0,v=0,m=0,y=e.length,b=0,w={},E={},S=[],x=[];y>b;)if(";"===e.charAt(b))f++,b++,h=0;else if(","===e.charAt(b))b++;else{for(n=new s,n.generatedLine=f,o=b;y>o&&!this._charIsMappingSeparator(e,o);o++);if(r=e.slice(b,o),i=w[r])b+=r.length;else{for(i=[];o>b;)l.decode(e,b,E),a=E.value,b=E.rest,i.push(a);if(2===i.length)throw new Error("Found a source, but no line and column");if(3===i.length)throw new Error("Found a source and line, but no column");w[r]=i}n.generatedColumn=h+i[0],h=n.generatedColumn,i.length>1&&(n.source=v+i[1],v+=i[1],n.originalLine=p+i[2],p=n.originalLine,n.originalLine+=1,n.originalColumn=d+i[3],d=n.originalColumn,i.length>4&&(n.name=m+i[4],m+=i[4])),x.push(n),"number"==typeof n.originalLine&&S.push(n)}c(x,u.compareByGeneratedPositionsDeflated),this.__generatedMappings=x,c(S,u.compareByOriginalPositions),this.__originalMappings=S},i.prototype._findMapping=function(e,t,n,r,i,s){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return a.search(e,t,i,s)},i.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(e){var t={generatedLine:u.getArg(e,"line"),generatedColumn:u.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",u.compareByGeneratedPositionsDeflated,u.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(n>=0){var i=this._generatedMappings[n];if(i.generatedLine===t.generatedLine){var s=u.getArg(i,"source",null);null!==s&&(s=this._sources.at(s),null!=this.sourceRoot&&(s=u.join(this.sourceRoot,s)));var o=u.getArg(i,"name",null);return null!==o&&(o=this._names.at(o)),{source:s,line:u.getArg(i,"originalLine",null),column:u.getArg(i,"originalColumn",null),name:o}}}return{source:null,line:null,column:null,name:null}},i.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(e){return null==e}):!1},i.prototype.sourceContentFor=function(e,t){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=u.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var n;if(null!=this.sourceRoot&&(n=u.urlParse(this.sourceRoot))){var r=e.replace(/^file:\/\//,"");if("file"==n.scheme&&this._sources.has(r))return this.sourcesContent[this._sources.indexOf(r)];if((!n.path||"/"==n.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(e){var t=u.getArg(e,"source");if(null!=this.sourceRoot&&(t=u.relative(this.sourceRoot,t)),!this._sources.has(t))return{line:null,column:null,lastColumn:null};t=this._sources.indexOf(t);var n={source:t,originalLine:u.getArg(e,"line"),originalColumn:u.getArg(e,"column")},i=this._findMapping(n,this._originalMappings,"originalLine","originalColumn",u.compareByOriginalPositions,u.getArg(e,"bias",r.GREATEST_LOWER_BOUND));if(i>=0){var s=this._originalMappings[i];if(s.source===n.source)return{line:u.getArg(s,"generatedLine",null),column:u.getArg(s,"generatedColumn",null),lastColumn:u.getArg(s,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},t.BasicSourceMapConsumer=i,o.prototype=Object.create(r.prototype),o.prototype.constructor=r,o.prototype._version=3,Object.defineProperty(o.prototype,"sources",{get:function(){for(var e=[],t=0;t<this._sections.length;t++)for(var n=0;n<this._sections[t].consumer.sources.length;n++)e.push(this._sections[t].consumer.sources[n]);return e}}),o.prototype.originalPositionFor=function(e){var t={generatedLine:u.getArg(e,"line"),generatedColumn:u.getArg(e,"column")},n=a.search(t,this._sections,function(e,t){var n=e.generatedLine-t.generatedOffset.generatedLine;return n?n:e.generatedColumn-t.generatedOffset.generatedColumn}),r=this._sections[n];return r?r.consumer.originalPositionFor({line:t.generatedLine-(r.generatedOffset.generatedLine-1),column:t.generatedColumn-(r.generatedOffset.generatedLine===t.generatedLine?r.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}},o.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(e){return e.consumer.hasContentsOfAllSources()})},o.prototype.sourceContentFor=function(e,t){for(var n=0;n<this._sections.length;n++){var r=this._sections[n],i=r.consumer.sourceContentFor(e,!0);if(i)return i}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')},o.prototype.generatedPositionFor=function(e){for(var t=0;t<this._sections.length;t++){var n=this._sections[t];if(-1!==n.consumer.sources.indexOf(u.getArg(e,"source"))){var r=n.consumer.generatedPositionFor(e);if(r){var i={line:r.line+(n.generatedOffset.generatedLine-1),column:r.column+(n.generatedOffset.generatedLine===r.line?n.generatedOffset.generatedColumn-1:0)};return i}}}return{line:null,column:null}},o.prototype._parseMappings=function(e,t){this.__generatedMappings=[],this.__originalMappings=[];for(var n=0;n<this._sections.length;n++)for(var r=this._sections[n],i=r.consumer._generatedMappings,s=0;s<i.length;s++){var o=i[s],a=r.consumer._sources.at(o.source);null!==r.consumer.sourceRoot&&(a=u.join(r.consumer.sourceRoot,a)),this._sources.add(a),a=this._sources.indexOf(a);var f=r.consumer._names.at(o.name);this._names.add(f),f=this._names.indexOf(f);var l={source:a,generatedLine:o.generatedLine+(r.generatedOffset.generatedLine-1),generatedColumn:o.generatedColumn+(r.generatedOffset.generatedLine===o.generatedLine?r.generatedOffset.generatedColumn-1:0),originalLine:o.originalLine,originalColumn:o.originalColumn,name:f};this.__generatedMappings.push(l),"number"==typeof l.originalLine&&this.__originalMappings.push(l)}c(this.__generatedMappings,u.compareByGeneratedPositionsDeflated),c(this.__originalMappings,u.compareByOriginalPositions)},t.IndexedSourceMapConsumer=o},function(e,t){function n(e,i,s,o,u,a){var f=Math.floor((i-e)/2)+e,l=u(s,o[f],!0);return 0===l?f:l>0?i-f>1?n(f,i,s,o,u,a):a==t.LEAST_UPPER_BOUND?i<o.length?i:-1:f:f-e>1?n(e,f,s,o,u,a):a==t.LEAST_UPPER_BOUND?f:0>e?-1:e}t.GREATEST_LOWER_BOUND=1,t.LEAST_UPPER_BOUND=2,t.search=function(e,i,s,o){if(0===i.length)return-1;var u=n(-1,i.length,e,i,s,o||t.GREATEST_LOWER_BOUND);if(0>u)return-1;for(;u-1>=0&&0===s(i[u],i[u-1],!0);)--u;return u}},function(e,t){function n(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function r(e,t){return Math.round(e+Math.random()*(t-e))}function i(e,t,s,u){if(u>s){var a=r(s,u),f=s-1;n(e,a,u);for(var l=e[u],c=s;u>c;c++)t(e[c],l)<=0&&(f+=1,n(e,f,c));n(e,f+1,c);var h=f+1;i(e,t,s,h-1),i(e,t,h+1,u)}}t.quickSort=function(e,t){i(e,t,0,e.length-1)}},function(e,t,n){function r(e,t,n,r,i){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==n?null:n,this.name=null==i?null:i,this[a]=!0,null!=r&&this.add(r)}var i=n(1).SourceMapGenerator,s=n(4),o=/(\r?\n)/,u=10,a="$$$isSourceNode$$$";r.fromStringWithSourceMap=function(e,t,n){function i(e,t){if(null===e||void 0===e.source)u.add(t);else{var i=n?s.join(n,e.source):e.source;u.add(new r(e.originalLine,e.originalColumn,i,t,e.name))}}var u=new r,a=e.split(o),f=function(){var e=a.shift(),t=a.shift()||"";return e+t},l=1,c=0,h=null;return t.eachMapping(function(e){if(null!==h){if(!(l<e.generatedLine)){var t=a[0],n=t.substr(0,e.generatedColumn-c);return a[0]=t.substr(e.generatedColumn-c),c=e.generatedColumn,i(h,n),void (h=e)}i(h,f()),l++,c=0}for(;l<e.generatedLine;)u.add(f()),l++;if(c<e.generatedColumn){var t=a[0];u.add(t.substr(0,e.generatedColumn)),a[0]=t.substr(e.generatedColumn),c=e.generatedColumn}h=e},this),a.length>0&&(h&&i(h,f()),u.add(a.join(""))),t.sources.forEach(function(e){var r=t.sourceContentFor(e);null!=r&&(null!=n&&(e=s.join(n,e)),u.setSourceContent(e,r))}),u},r.prototype.add=function(e){if(Array.isArray(e))e.forEach(function(e){this.add(e)},this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this},r.prototype.prepend=function(e){if(Array.isArray(e))for(var t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this},r.prototype.walk=function(e){for(var t,n=0,r=this.children.length;r>n;n++)t=this.children[n],t[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(e){var t,n,r=this.children.length;if(r>0){for(t=[],n=0;r-1>n;n++)t.push(this.children[n]),t.push(e);t.push(this.children[n]),this.children=t}return this},r.prototype.replaceRight=function(e,t){var n=this.children[this.children.length-1];return n[a]?n.replaceRight(e,t):"string"==typeof n?this.children[this.children.length-1]=n.replace(e,t):this.children.push("".replace(e,t)),this},r.prototype.setSourceContent=function(e,t){this.sourceContents[s.toSetString(e)]=t},r.prototype.walkSourceContents=function(e){for(var t=0,n=this.children.length;n>t;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);for(var r=Object.keys(this.sourceContents),t=0,n=r.length;n>t;t++)e(s.fromSetString(r[t]),this.sourceContents[r[t]])},r.prototype.toString=function(){var e="";return this.walk(function(t){e+=t}),e},r.prototype.toStringWithSourceMap=function(e){var t={code:"",line:1,column:0},n=new i(e),r=!1,s=null,o=null,a=null,f=null;return this.walk(function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?((s!==i.source||o!==i.line||a!==i.column||f!==i.name)&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),s=i.source,o=i.line,a=i.column,f=i.name,r=!0):r&&(n.addMapping({generated:{line:t.line,column:t.column}}),s=null,r=!1);for(var c=0,h=e.length;h>c;c++)e.charCodeAt(c)===u?(t.line++,t.column=0,c+1===h?(s=null,r=!1):r&&n.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++}),this.walkSourceContents(function(e,t){n.setSourceContent(e,t)}),{code:t.code,map:n}},t.SourceNode=r}])}),!function(e,t){"function"==typeof define&&define.amd?define("stackframe",[],t):"object"==typeof exports?module.exports=t():e.StackFrame=t()}(this,function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}function t(e,t,n,r,i){void 0!==e&&this.setFunctionName(e),void 0!==t&&this.setArgs(t),void 0!==n&&this.setFileName(n),void 0!==r&&this.setLineNumber(r),void 0!==i&&this.setColumnNumber(i)}return t.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(e){this.functionName=String(e)},getArgs:function(){return this.args},setArgs:function(e){if("[object Array]"!==Object.prototype.toString.call(e))throw new TypeError("Args must be an Array");this.args=e},getFileName:function(){return this.fileName},setFileName:function(e){this.fileName=String(e)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(t){if(!e(t))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(t)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(t){if(!e(t))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(t)},toString:function(){var t=this.getFunctionName()||"{anonymous}",n="("+(this.getArgs()||[]).join(",")+")",r=this.getFileName()?"@"+this.getFileName():"",i=e(this.getLineNumber())?":"+this.getLineNumber():"",s=e(this.getColumnNumber())?":"+this.getColumnNumber():"";return t+n+r+i+s}},t});var SourceMap=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var r;r=function(e,t,r){function i(e){var t=e;"string"==typeof e&&(t=JSON.parse(e.replace(/^\)\]\}'/,"")));var n=s.getArg(t,"version"),r=s.getArg(t,"sources"),i=s.getArg(t,"names",[]),o=s.getArg(t,"sourceRoot",null),a=s.getArg(t,"sourcesContent",null),f=s.getArg(t,"mappings"),l=s.getArg(t,"file",null);if(n!=this._version)throw new Error("Unsupported version: "+n);r=r.map(s.normalize),this._names=u.fromArray(i,!0),this._sources=u.fromArray(r,!0),this.sourceRoot=o,this.sourcesContent=a,this._mappings=f,this.file=l}var s=n(1),o=n(2),u=n(3).ArraySet,a=n(4);i.fromSourceMap=function(e){var t=Object.create(i.prototype);return t._names=u.fromArray(e._names.toArray(),!0),t._sources=u.fromArray(e._sources.toArray(),!0),t.sourceRoot=e._sourceRoot,t.sourcesContent=e._generateSourcesContent(t._sources.toArray(),t.sourceRoot),t.file=e._file,t.__generatedMappings=e._mappings.toArray().slice(),t.__originalMappings=e._mappings.toArray().slice().sort(s.compareByOriginalPositions),t},i.prototype._version=3,Object.defineProperty(i.prototype,"sources",{get:function(){return this._sources.toArray().map(function(e){return null!=this.sourceRoot?s.join(this.sourceRoot,e):e},this)}}),i.prototype.__generatedMappings=null,Object.defineProperty(i.prototype,"_generatedMappings",{get:function(){return this.__generatedMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__generatedMappings}}),i.prototype.__originalMappings=null,Object.defineProperty(i.prototype,"_originalMappings",{get:function(){return this.__originalMappings||(this.__generatedMappings=[],this.__originalMappings=[],this._parseMappings(this._mappings,this.sourceRoot)),this.__originalMappings}}),i.prototype._nextCharIsMappingSeparator=function(e){var t=e.charAt(0);return";"===t||","===t},i.prototype._parseMappings=function(e,t){for(var n,r=1,i=0,o=0,u=0,f=0,l=0,c=e,h={};c.length>0;)if(";"===c.charAt(0))r++,c=c.slice(1),i=0;else if(","===c.charAt(0))c=c.slice(1);else{if(n={},n.generatedLine=r,a.decode(c,h),n.generatedColumn=i+h.value,i=n.generatedColumn,c=h.rest,c.length>0&&!this._nextCharIsMappingSeparator(c)){if(a.decode(c,h),n.source=this._sources.at(f+h.value),f+=h.value,c=h.rest,0===c.length||this._nextCharIsMappingSeparator(c))throw new Error("Found a source, but no line and column");if(a.decode(c,h),n.originalLine=o+h.value,o=n.originalLine,n.originalLine+=1,c=h.rest,0===c.length||this._nextCharIsMappingSeparator(c))throw new Error("Found a source and line, but no column");a.decode(c,h),n.originalColumn=u+h.value,u=n.originalColumn,c=h.rest,c.length>0&&!this._nextCharIsMappingSeparator(c)&&(a.decode(c,h),n.name=this._names.at(l+h.value),l+=h.value,c=h.rest)}this.__generatedMappings.push(n),"number"==typeof n.originalLine&&this.__originalMappings.push(n)}this.__generatedMappings.sort(s.compareByGeneratedPositions),this.__originalMappings.sort(s.compareByOriginalPositions)},i.prototype._findMapping=function(e,t,n,r,i){if(e[n]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+e[n]);if(e[r]<0)throw new TypeError("Column must be greater than or equal to 0, got "+e[r]);return o.search(e,t,i)},i.prototype.computeColumnSpans=function(){for(var e=0;e<this._generatedMappings.length;++e){var t=this._generatedMappings[e];if(e+1<this._generatedMappings.length){var n=this._generatedMappings[e+1];if(t.generatedLine===n.generatedLine){t.lastGeneratedColumn=n.generatedColumn-1;continue}}t.lastGeneratedColumn=1/0}},i.prototype.originalPositionFor=function(e){var t={generatedLine:s.getArg(e,"line"),generatedColumn:s.getArg(e,"column")},n=this._findMapping(t,this._generatedMappings,"generatedLine","generatedColumn",s.compareByGeneratedPositions);if(n>=0){var r=this._generatedMappings[n];if(r.generatedLine===t.generatedLine){var i=s.getArg(r,"source",null);return null!=i&&null!=this.sourceRoot&&(i=s.join(this.sourceRoot,i)),{source:i,line:s.getArg(r,"originalLine",null),column:s.getArg(r,"originalColumn",null),name:s.getArg(r,"name",null)}}}return{source:null,line:null,column:null,name:null}},i.prototype.sourceContentFor=function(e){if(!this.sourcesContent)return null;if(null!=this.sourceRoot&&(e=s.relative(this.sourceRoot,e)),this._sources.has(e))return this.sourcesContent[this._sources.indexOf(e)];var t;if(null!=this.sourceRoot&&(t=s.urlParse(this.sourceRoot))){var n=e.replace(/^file:\/\//,"");if("file"==t.scheme&&this._sources.has(n))return this.sourcesContent[this._sources.indexOf(n)];if((!t.path||"/"==t.path)&&this._sources.has("/"+e))return this.sourcesContent[this._sources.indexOf("/"+e)]}throw new Error('"'+e+'" is not in the SourceMap.')},i.prototype.generatedPositionFor=function(e){var t={source:s.getArg(e,"source"),originalLine:s.getArg(e,"line"),originalColumn:s.getArg(e,"column")};null!=this.sourceRoot&&(t.source=s.relative(this.sourceRoot,t.source));var n=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions);if(n>=0){var r=this._originalMappings[n];return{line:s.getArg(r,"generatedLine",null),column:s.getArg(r,"generatedColumn",null),lastColumn:s.getArg(r,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},i.prototype.allGeneratedPositionsFor=function(e){var t={source:s.getArg(e,"source"),originalLine:s.getArg(e,"line"),originalColumn:1/0};null!=this.sourceRoot&&(t.source=s.relative(this.sourceRoot,t.source));var n=[],r=this._findMapping(t,this._originalMappings,"originalLine","originalColumn",s.compareByOriginalPositions);if(r>=0)for(var i=this._originalMappings[r];i&&i.originalLine===t.originalLine;)n.push({line:s.getArg(i,"generatedLine",null),column:s.getArg(i,"generatedColumn",null),lastColumn:s.getArg(i,"lastGeneratedColumn",null)}),i=this._originalMappings[--r];return n.reverse()},i.GENERATED_ORDER=1,i.ORIGINAL_ORDER=2,i.prototype.eachMapping=function(e,t,n){var r,o=t||null,u=n||i.GENERATED_ORDER;switch(u){case i.GENERATED_ORDER:r=this._generatedMappings;break;case i.ORIGINAL_ORDER:r=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var a=this.sourceRoot;r.map(function(e){var t=e.source;return null!=t&&null!=a&&(t=s.join(a,t)),{source:t,generatedLine:e.generatedLine,generatedColumn:e.generatedColumn,originalLine:e.originalLine,originalColumn:e.originalColumn,name:e.name}}).forEach(e,o)},t.SourceMapConsumer=i}.call(t,n,t,e),void 0===r||!(e.exports=r)},function(e,t,n){var r;r=function(e,t,n){function r(e,t,n){if(t in e)return e[t];if(3===arguments.length)return n;throw new Error('"'+t+'" is a required argument.')}function i(e){var t=e.match(d);return t?{scheme:t[1],auth:t[2],host:t[3],port:t[4],path:t[5]}:null}function s(e){var t="";return e.scheme&&(t+=e.scheme+":"),t+="//",e.auth&&(t+=e.auth+"@"),e.host&&(t+=e.host),e.port&&(t+=":"+e.port),e.path&&(t+=e.path),t}function o(e){var t=e,n=i(e);if(n){if(!n.path)return e;t=n.path}for(var r,o="/"===t.charAt(0),u=t.split(/\/+/),a=0,f=u.length-1;f>=0;f--)r=u[f],"."===r?u.splice(f,1):".."===r?a++:a>0&&(""===r?(u.splice(f+1,a),a=0):(u.splice(f,2),a--));return t=u.join("/"),""===t&&(t=o?"/":"."),n?(n.path=t,s(n)):t}function u(e,t){""===e&&(e="."),""===t&&(t=".");var n=i(t),r=i(e);if(r&&(e=r.path||"/"),n&&!n.scheme)return r&&(n.scheme=r.scheme),s(n);if(n||t.match(v))return t;if(r&&!r.host&&!r.path)return r.host=t,s(r);var u="/"===t.charAt(0)?t:o(e.replace(/\/+$/,"")+"/"+t);return r?(r.path=u,s(r)):u}function a(e,t){""===e&&(e="."),e=e.replace(/\/$/,"");var n=i(e);return"/"==t.charAt(0)&&n&&"/"==n.path?t.slice(1):0===t.indexOf(e+"/")?t.substr(e.length+1):t}function f(e){return"$"+e}function l(e){return e.substr(1)}function c(e,t){var n=e||"",r=t||"";return(n>r)-(r>n)}function h(e,t,n){var r;return(r=c(e.source,t.source))?r:(r=e.originalLine-t.originalLine)?r:(r=e.originalColumn-t.originalColumn,r||n?r:(r=c(e.name,t.name))?r:(r=e.generatedLine-t.generatedLine,r?r:e.generatedColumn-t.generatedColumn))}function p(e,t,n){var r;return(r=e.generatedLine-t.generatedLine)?r:(r=e.generatedColumn-t.generatedColumn,r||n?r:(r=c(e.source,t.source))?r:(r=e.originalLine-t.originalLine)?r:(r=e.originalColumn-t.originalColumn,r?r:c(e.name,t.name)))}t.getArg=r;var d=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/,v=/^data:.+\,.+$/;t.urlParse=i,t.urlGenerate=s,t.normalize=o,t.join=u,t.relative=a,t.toSetString=f,t.fromSetString=l,t.compareByOriginalPositions=h,t.compareByGeneratedPositions=p}.call(t,n,t,e),void 0===r||!(e.exports=r)},function(e,t,n){var r;r=function(e,t,n){function r(e,t,n,i,s){var o=Math.floor((t-e)/2)+e,u=s(n,i[o],!0);return 0===u?o:u>0?t-o>1?r(o,t,n,i,s):o:o-e>1?r(e,o,n,i,s):0>e?-1:e}t.search=function(e,t,n){return 0===t.length?-1:r(-1,t.length,e,t,n)}}.call(t,n,t,e),void 0===r||!(e.exports=r)},function(e,t,n){var r;r=function(e,t,r){function i(){this._array=[],this._set={}}var s=n(1);i.fromArray=function(e,t){for(var n=new i,r=0,s=e.length;s>r;r++)n.add(e[r],t);return n},i.prototype.add=function(e,t){var n=this.has(e),r=this._array.length;(!n||t)&&this._array.push(e),n||(this._set[s.toSetString(e)]=r)},i.prototype.has=function(e){return Object.prototype.hasOwnProperty.call(this._set,s.toSetString(e))},i.prototype.indexOf=function(e){if(this.has(e))return this._set[s.toSetString(e)];throw new Error('"'+e+'" is not in the set.')},i.prototype.at=function(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)},i.prototype.toArray=function(){return this._array.slice()},t.ArraySet=i}.call(t,n,t,e),void 0===r||!(e.exports=r)},function(e,t,n){var r;r=function(e,t,r){function i(e){return 0>e?(-e<<1)+1:(e<<1)+0}function s(e){var t=1===(1&e),n=e>>1;return t?-n:n}var o=n(5),u=5,a=1<<u,f=a-1,l=a;t.encode=function(e){var t,n="",r=i(e);do t=r&f,r>>>=u,r>0&&(t|=l),n+=o.encode(t);while(r>0);return n},t.decode=function(e,t){var n,r,i=0,a=e.length,h=0,p=0;do{if(i>=a)throw new Error("Expected more digits in base 64 VLQ value.");r=o.decode(e.charAt(i++)),n=!!(r&l),r&=f,h+=r<<p,p+=u}while(n);t.value=s(h),t.rest=e.slice(i)}}.call(t,n,t,e),void 0===r||!(e.exports=r)},function(e,t,n){var r;r=function(e,t,n){var r={},i={};"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("").forEach(function(e,t){r[e]=t,i[t]=e}),t.encode=function(e){if(e in i)return i[e];throw new TypeError("Must be between 0 and 63: "+e)},t.decode=function(e){if(e in r)return r[e];throw new TypeError("Not a valid base 64 digit: "+e)}}.call(t,n,t,e),void 0===r||!(e.exports=r)}]);!function(e,t){"function"==typeof define&&define.amd?define("stacktrace-gps",["source-map","stackframe"],t):"object"==typeof exports?module.exports=t(require("source-map/lib/source-map/source-map-consumer"),require("stackframe")):e.StackTraceGPS=t(e.SourceMap,e.StackFrame)}(this,function(e,t){function n(){for(var e,t=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],r=0;r<t.length;r++)try{return e=t[r](),n=t[r],e}catch(i){}}function r(e,t,r){var i=n();i.open("get",e),i.onerror=r,i.onreadystatechange=function(){if(4===i.readyState){if(i.status>=200&&i.status<400)return t(i.responseText);r(new Error("Unable to retrieve "+e))}},i.send()}function i(e,t,n){for(var r,i,s,o=/function\s+([^(]*?)\s*\(([^)]*)\)/,u=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,a=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f=e.split("\n"),l="",c=Math.min(t,20),h=0;c>h;++h)if(r=f[t-h-1],s=r.indexOf("//"),s>=0&&(r=r.substr(0,s)),r){if(l=r+l,i=u.exec(l),i&&i[1])return i[1];if(i=o.exec(l),i&&i[1])return i[1];if(i=a.exec(l),i&&i[1])return i[1]}return void 0}function s(){if("function"!=typeof Object.defineProperty||"function"!=typeof Object.create)throw new Error("Unable to consume source maps in older browsers")}function o(e){if("object"!=typeof e)throw new TypeError("Given StackFrame is not an object");if("string"!=typeof e.fileName)throw new TypeError("Given file name is not a String");if("number"!=typeof e.lineNumber||e.lineNumber%1!==0||e.lineNumber<1)throw new TypeError("Given line number must be a positive integer");if("number"!=typeof e.columnNumber||e.columnNumber%1!==0||e.columnNumber<0)throw new TypeError("Given column number must be a non-negative integer");return!0}function u(e){var t=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)$/.exec(e);if(t&&t[1])return t[1];throw new Error("sourceMappingURL not found")}function a(n,r,i,s){var o=(new e.SourceMapConsumer(n)).originalPositionFor({line:i,column:s});return new t(o.name,r,o.source,o.line,o.column)}return function f(e){return this instanceof f?(e=e||{},this.sourceCache=e.sourceCache||{},this.ajax=r,this._atob=function(e){if(window&&window.atob)return window.atob(e);if("undefined"!=typeof Buffer)return(new Buffer(e,"base64")).toString("utf-8");throw new Error("No base64 decoder available")},this._get=function(t){return new Promise(function(n,r){var i="data:"===t.substr(0,5);if(this.sourceCache[t])n(this.sourceCache[t]);else if(e.offline&&!i)r(new Error("Cannot make network requests in offline mode"));else if(i){var s="application/json;base64";if(t.substr(5,s.length)!==s)r(new Error("The encoding of the inline sourcemap is not supported"));else{var o="data:".length+s.length+",".length,u=t.substr(o),a=this._atob(u);this.sourceCache[t]=a,n(a)}}else this.ajax(t,function(e){this.sourceCache[t]=e,n(e)}.bind(this),r)}.bind(this))},this.pinpoint=function(e){return new Promise(function(t,n){this.getMappedLocation(e).then(function(e){function n(){t(e)}this.findFunctionName(e).then(t,n)["catch"](n)}.bind(this),n)}.bind(this))},this.findFunctionName=function(e){return new Promise(function(n,r){o(e),this._get(e.fileName).then(function(r){var s=i(r,e.lineNumber,e.columnNumber);n(new t(s,e.args,e.fileName,e.lineNumber,e.columnNumber))},r)}.bind(this))},void (this.getMappedLocation=function(e){return new Promise(function(t,n){s(),o(e);var r=e.fileName;this._get(r).then(function(i){var s=u(i);"/"!==s[0]&&(s=r.substring(0,r.lastIndexOf("/")+1)+s),this._get(s).then(function(n){var r=e.lineNumber,i=e.columnNumber;t(a(n,e.args,r,i))},n)["catch"](n)}.bind(this),n)["catch"](n)}.bind(this))})):new f(e)}}),function(e,t){"function"==typeof define&&define.amd?define("stack-generator",["stackframe"],t):"object"==typeof exports?module.exports=t(require("stackframe")):e.StackGenerator=t(e.StackFrame)}(this,function(e){return{backtrace:function(t){var n=[],r=10;"object"==typeof t&&"number"==typeof t.maxStackSize&&(r=t.maxStackSize);for(var i=arguments.callee;i&&n.length<r;){var s=[].slice.call(i.arguments);/function(?:\s+([\w$]+))+\s*\(/.test(i.toString())?n.push(new e(RegExp.$1||void 0,s)):n.push(new e(void 0,s));try{i=i.caller}catch(o){break}}return n}}}),function(e,t){"function"==typeof define&&define.amd?define("error-stack-parser",["stackframe"],t):"object"==typeof exports?module.exports=t(require("stackframe")):e.ErrorStackParser=t(e.StackFrame)}(this,function(e){var t=/(^|@)\S+\:\d+/,n=/\s+at .*(\S+\:\d+|\(native\))/;return{parse:function(e){if("undefined"!=typeof e.stacktrace||"undefined"!=typeof e["opera#sourceloc"])return this.parseOpera(e);if(e.stack&&e.stack.match(n))return this.parseV8OrIE(e);if(e.stack&&e.stack.match(t))return this.parseFFOrSafari(e);throw new Error("Cannot parse given Error object")},extractLocation:function(e){if(-1===e.indexOf(":"))return[e];var t=e.replace(/[\(\)\s]/g,"").split(":"),n=t.pop(),r=t[t.length-1];if(!isNaN(parseFloat(r))&&isFinite(r)){var i=t.pop();return[t.join(":"),i,n]}return[t.join(":"),n,void 0]},parseV8OrIE:function(t){return t.stack.split("\n").filter(function(e){return!!e.match(n)},this).map(function(t){var n=t.replace(/^\s+/,"").split(/\s+/).slice(1),r=this.extractLocation(n.pop()),i=n[0]&&"Anonymous"!==n[0]?n[0]:void 0;return new e(i,void 0,r[0],r[1],r[2],t)},this)},parseFFOrSafari:function(n){return n.stack.split("\n").filter(function(e){return!!e.match(t)},this).map(function(t){var n=t.split("@"),r=this.extractLocation(n.pop()),i=n.shift()||void 0;return new e(i,void 0,r[0],r[1],r[2],t)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)/i,r=t.message.split("\n"),i=[],s=2,o=r.length;o>s;s+=2){var u=n.exec(r[s]);u&&i.push(new e(void 0,void 0,u[2],u[1],void 0,r[s]))}return i},parseOpera10:function(t){for(var n=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,r=t.stacktrace.split("\n"),i=[],s=0,o=r.length;o>s;s+=2){var u=n.exec(r[s]);u&&i.push(new e(u[3]||void 0,void 0,u[2],u[1],void 0,r[s]))}return i},parseOpera11:function(n){return n.stack.split("\n").filter(function(e){return!!e.match(t)&&!e.match(/^Error created at/)},this).map(function(t){var n,r=t.split("@"),i=this.extractLocation(r.pop()),s=r.shift()||"",o=s.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;s.match(/\(([^\)]*)\)/)&&(n=s.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var u=void 0===n||"[arguments not available]"===n?void 0:n.split(",");return new e(o,u,i[0],i[1],i[2],t)},this)}}}),function(e,t){"function"==typeof define&&define.amd?define("stacktrace",["error-stack-parser","stack-generator","stacktrace-gps"],t):"object"==typeof exports?module.exports=t(require("error-stack-parser"),require("stack-generator"),require("stacktrace-gps")):e.StackTrace=t(e.ErrorStackParser,e.StackGenerator,e.StackTraceGPS)}(this,function(e,t,n){function r(e,t){var n={};return[e,t].forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}),n}function i(e){return e.stack||e["opera#sourceloc"]}var s={filter:function(e){return-1===(e.functionName||"").indexOf("StackTrace$$")&&-1===(e.functionName||"").indexOf("ErrorStackParser$$")&&-1===(e.functionName||"").indexOf("StackTraceGPS$$")&&-1===(e.functionName||"").indexOf("StackGenerator$$")}};return{get:function(e){try{throw new Error}catch(t){return i(t)?this.fromError(t,e):this.generateArtificially(e)}},fromError:function(t,i){return i=r(s,i),new Promise(function(r){var s=e.parse(t);"function"==typeof i.filter&&(s=s.filter(i.filter)),r(Promise.all(s.map(function(e){return new Promise(function(t){function r(n){t(e)}(new n(i)).pinpoint(e).then(t,r)["catch"](r)})})))}.bind(this))},generateArtificially:function(e){e=r(s,e);var n=t.backtrace(e);return"function"==typeof e.filter&&(n=n.filter(e.filter)),Promise.resolve(n)},instrument:function(e,t,n,r){if("function"!=typeof e)throw new Error("Cannot instrument non-function object");if("function"==typeof e.__stacktraceOriginalFn)return e;var s=function(){try{this.get().then(t,n)["catch"](n),e.apply(r||this,arguments)}catch(s){throw i(s)&&this.fromError(s).then(t,n)["catch"](n),s}}.bind(this);return s.__stacktraceOriginalFn=e,s},deinstrument:function(e){if("function"!=typeof e)throw new Error("Cannot de-instrument non-function object");return"function"==typeof e.__stacktraceOriginalFn?e.__stacktraceOriginalFn:e},report:function(e,t){return new Promise(function(n,r){var i=new XMLHttpRequest;i.onerror=r,i.onreadystatechange=function(){4===i.readyState&&(i.status>=200&&i.status<400?n(i.responseText):r(new Error("POST to "+t+" failed with status: "+i.status)))},i.open("post",t),i.setRequestHeader("Content-Type","application/json"),i.send(JSON.stringify({stack:e}))})}}}),define("common/rawDataModel",["backbone"],function(e){var t=e.Model.extend({constructor:function(t,n){this.rawData=t;var r=Array.prototype.slice.call(arguments,1);e.Model.prototype.constructor.apply(this,r),this._processRawValues(),this._processReaders(),this._processWrites(),this.set=this._set},toJSON:function(){var e=this,t=_.keys(this.readers),n={};return this.attributes&&(n=_.reduce(this.attributes,function(t,n,r,i){return r!=="model"&&r!="collection"&&(t[r]=e.get(r)),t},{})),n},_processRawValues:function(){this.readers=this.readers||{},this.writers=this.writers||{};if(this.rawValues)for(var e in this.rawValues)if(e){var t=this.rawValues[e];t&&(this.readers[e]=t.getValue,this.writers[e]=t.setValue)}},_bindSetVal:function(e,t){_.isFunction(t)?this.set(e,_.bind(t,this)):this.set(e,t)},_processReaders:function(){if(this.readers)for(var e in this.readers)if(e){var t=this.readers[e];this[t]?this._bindSetVal(e,this[t]):this._bindSetVal(e,t)}},_processWrites:function(){if(this.writers)for(var e in this.writers)if(e){var t=this.writers[e];this[t]&&(t=this[t]),this.on("change:"+e,_.bind(t,this))}},_set:function(t,n,r){if(t==null)return this;var i;typeof t=="object"?(i=t,r=n):(i={})[t]=n;var s={};for(var o in i)o&&(this.readers[o]?this.trigger("change:"+o,this,i[o]):s[o]=i[o]);e.Model.prototype.set.call(this,s,r)},get:function(){var t=e.Model.prototype.get.call(this,Array.prototype.slice.call(arguments));return _.isFunction(t)?t.call(this):t}}),n=function(e){function t(e){return e.split(".")}function n(e,t){if(t){for(var n=0;n<e.length-1;n++){var r=e[n];if(!t[r])return null;t=t[r]}return{val:t,prop:e[e.length-1]}}return null}return function(e){return{getValue:function(){var t=n(e,this.rawData);return t&&t.val&&t.prop?t.val[t.prop]:null},setValue:function(t,r){var i=n(e,this.rawData);i&&i.val&&i.prop&&(i.val[i.prop]=r)}}}(t(e))};return{Model:t,Value:n}}),define("common/communityModel",["require","common/rawDataModel","common/enums","common/handlebars/helpers/formatDateHelper"],function(e){var t=e("common/rawDataModel"),n=e("common/enums"),r=e("common/handlebars/helpers/formatDateHelper"),i=t.Model.extend({rawValues:{key:new t.Value("key"),farmKey:new t.Value("farmKey"),title:new t.Value("title"),deliveryHourStart:new t.Value("deliveryHourStart"),deliveryHourEnd:new t.Value("deliveryHourEnd"),deliveryDays:new t.Value("deliveryDays"),memberCount:new t.Value("memberCount"),region:new t.Value("region"),lat:new t.Value("lat"),lng:new t.Value("lng"),distance:new t.Value("distance"),isPrivate:new t.Value("isPrivate"),instructions:new t.Value("instructions"),doNotAcceptOrders:new t.Value("doNotAcceptOrders")},readers:{pickupSiteUrl:function(){return this.rawData.url},address:function(){return this.rawData.publicAddress?this.rawData.publicAddress:this.rawData.shortAddress.replace("^\\d+","")+", "+this.rawData.city},marker:function(){return this.rawData.marker},isPending:function(){return this.rawData.status===n.EnumStatus.Pending},isRelaunch:function(){return this.rawData.status===n.EnumStatus.Relaunch},isGoalNotReached:function(){return this.get("isRelaunchGoalNotReached")||this.get("isIncubateGoalNotReached")},isIncubateGoalNotReached:function(){return this.rawData.isIncubate&&this._isGoalNotReached()},isRelaunchGoalNotReached:function(){return this.get("isRelaunch")&&this._isGoalNotReached()},incubateNeededOrderCount:function(){return this.rawData.minCapacity},missingOrderCount:function(){if(this.get("isGoalNotReached"))return this.rawData.minCapacity-this.rawData.orderCount},orderCount:function(){return this.rawData.orderCount}},_isGoalNotReached:function(){return this.rawData.orderCount<this.rawData.minCapacity&&!this.get("isPending")}});return i}),define("common/marketModel",["require","common/rawDataModel","common/dataService","common/dataUtils","common/enums","common/utils","common/globals","common/communityModel"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/dataUtils"),i=e("common/enums"),s=e("common/utils"),o=e("common/globals"),u=e("common/communityModel"),a,f=t.Model.extend({initialize:function(){this.synchData()},synchData:function(){this.rawData=n.getMarketData(),this.rawData?(this.rawData.urls=n.serverData.urls,a=n.getSharesMap(),this._communityModel=new u(this.rawData.pickupSite)):this._communityModel={get:function(){}}},rawValues:{order:new t.Value("orderData"),previousOrderData:new t.Value("previousOrderData"),currentCouponKey:t.Value("subscription.currentCouponKey"),subscriptionKey:new t.Value("subscription.key"),hasToken:new t.Value("subscription.key"),member:new t.Value("member"),memberCommunities:new t.Value("memberCommunities"),isOrganizer:new t.Value("isOrganizer"),communityName:new t.Value("pickupSite.title"),nextDeliveryDate:new t.Value("nextDeliveryDate"),regionNextDeliveryDate:new t.Value("regionNextDeliveryDate"),orderLock:new t.Value("orderLock"),urls:new t.Value("urls"),isMarketPage:new t.Value("isMarketPage"),itemsChanged:new t.Value("itemsChanged"),shouldShowLogin:new t.Value("shouldShowLogin")},readers:{coupon:r.getCoupon,couponId:r.getCouponId,itemCount:"getItemCount",total:"getOrderTotal",totalDue:"getTotalDue",hasTotalDue:"getHasTotalDue",isOrderDirty:"getIsOrderDirty",disableOrderButton:"getDisableOrderButton",couponShare:"getCouponShare",couponActive:"getCouponActive",couponValue:"getCouponValue",couponIsFixedAmount:"getCouponIsFixedAmount",couponDiscount:"getCouponDiscount",isCouponAppliedNow:"getIsCouponAppliedNow",credit:"getCredit",discount:"getDiscount",isValidRegion:"getIsValidRegion",invalidRegionTitle:"getInvalidRegionTitle",discountAmount:(new t.Value("subscription.discount")).getValue,totalDeliveries:(new t.Value("subscription.totalDeliveries")).getValue,isRecipientDiscountFixed:(new t.Value("subscription.isReferralDiscountFixed")).getValue,minimumOrderCouponId:(new t.Value("minimumOrderCoupon.id")).getValue,minimumOrderCouponExpirationDate:(new t.Value("minimumOrderCoupon.expirationDate")).getValue,minimumOrderCouponDiscount:(new t.Value("minimumOrderCoupon.discount")).getValue,minimumOrderCouponMinimumOrder:(new t.Value("minimumOrderCoupon.minimumOrder")).getValue,hasRecipientDiscount:"getHasRecipientDiscount",recipientDiscountOutOfTotal:"getRecipientDiscountOutOfTotal",disableEdit:"getDisableEdit",recipientDiscount:(new t.Value("subscription.referralDiscount")).getValue,referralInstanceSet:(new t.Value("subscription.referralInstanceSet")).getValue,recipientDiscountValue:"getRecipientDiscountValue",referredBy:(new t.Value("referredBy")).getValue,isAutoCouponApplied:(new t.Value("autoCouponApplied")).getValue,onceSchedule:(new t.Value("onceSchedule")).getValue,isOrderHasSavedItems:"getIsOrderHasSavedItems",isOrderCanceled:"getIsOrderCanceled",shouldShowProducerShare:r.shouldShowProducerShare,isPending:"getIsPending",isIncubateGoalNotReached:"getIsIncubateGoalNotReached",isRelaunchGoalNotReached:"getIsRelaunchGoalNotReached",incubateNeededOrderCount:"getIncubateNeededOrderCount",missingOrderCount:"getMissingOrderCount",isRelaunch:"getIsRelaunch",isGoalNotReached:"getIsGoalNotReached",pickupSiteUrl:"getPickupSiteUrl",howItWorksPath:"getHowItWorksPath",doNotAcceptOrders:"getDoNotAcceptOrders",isMoreThanWeekToCutoff:"getIsMoreThanWeekToCutoff",storeOpenDate:"getStoreOpenDate",nextOrderWindowOpenDate:"getNextOrderWindowOpenDate",firstName:(new t.Value("organizer.firstName")).getValue,lastName:(new t.Value("organizer.lastName")).getValue,organizerEmail:(new t.Value("organizer.email")).getValue,pickupSite:"getPickupSite",senderReferral:(new t.Value("senderReferral")).getValue,featuresFlags:(new t.Value("featuresFlags")).getValue,hasPaymentIssue:"getHasPaymentIssue",memberType:r.getMemberType,isMemberTypeExistAndNotOrganizer:function(){return r.isMemberTypeExist()&&!this.get("isOrganizer")},hasOrders:function(){return this.get("memberType")==i.MemberType.Existing},memberCommunityName:"getMemberCommunityName",shareLink:r.getShareLink,referralLink:r.getReferralLink,isDeliveryHoldLocked:(new t.Value("orderLock.isDeliveryHoldLocked")).getValue,minCapacity:(new t.Value("minCapacity")).getValue,orderDataBeforeSubmission:(new t.Value("orderDataBeforeSubmission")).getValue,orderExceptions:(new t.Value("orderExceptions")).getValue,isSubscriptionForCurrentPickupSite:(new t.Value("isSubscriptionForCurrentPickupSite")).getValue,isAllowToSwitchCommunity:"getIsAllowToSwitchCommunity",isSwitchToSameDeliveryDay:(new t.Value("isSwitchToSameDeliveryDay")).getValue,isLoginOptimizedFlow:(new t.Value("isLoginOptimizedFlow")).getValue,homePageCouponCode:(new t.Value("homePageCouponCode")).getValue,hadSubscription:"getHadSubscription",hasActiveSubscriptionForOtherPickupSite:"getHasActiveSubscriptionForOtherPickupSite",previousOrderMap:"getPreviousOrderMap",getMemberKey:"getMemberKey",shouldDisplayPostalDelivery:"shouldDisplayPostalDelivery",organizerYearCommission:"getOrganizerCommision",shouldDisplayMinimumOrder:r.shouldDisplayMinimumOrder,shouldDisplayMultiValueDiscount:r.shouldDisplayMultiValueDiscount},getIsValidRegion:function(){return this.rawData.region==="NY"},getInvalidRegionTitle:function(){return this.rawData.region==="NY"?"":this.rawData.region==="SF"?"Bay Area":"Seattle area"},getCouponIsFixedAmount:function(){return this.rawData.subscription&&this.rawData.subscription.coupon&&this.rawData.subscription.coupon.isFixedAmount},getCouponDiscount:function(){return this.rawData.subscription&&this.rawData.subscription.coupon&&this.rawData.subscription.coupon.discount},getIsCouponAppliedNow:function(){return this.rawData.subscription&&this.rawData.subscription.coupon&&this.rawData.subscription.coupon.isAppliedNow},getItemCount:function(){var e=0,t=this.get("order");return t&&t.forEach(function(t){var n=a[t.shareKey];n&&n.status!==i.ShareStatus.TEMPORALLY_UNAVAILABLE&&(t.isRefundShare||(e+=t.quantity))}),e},getOrderTotal:function(){return r.getOrderTotal()},getHasTotalDue:function(){return this.get("discount")||this.get("credit")||this.get("couponActive")||this.get("hasRecipientDiscount")},getIsOrderDirty:function(){return o.data.isOrderDirty()},getDisableOrderButton:function(){return!this.get("isOrderDirty")||this.get("disableEdit")},getTotalBeforeRecipient:function(){var e=this.get("total"),t=this.get("discount")||0,n=this.get("couponValue"),r=this.get("credit")||0,i=e-t-r-n;return i},calculateRecipientDiscount:function(e){if(this.get("hasOrders"))return 0;var t=this.get("recipientDiscount")||0;if(t){var n=this.get("isRecipientDiscountFixed");n||(t=e*t/100)}return t},getTotalDue:function(){var e=this.getTotalBeforeRecipient(),t=this.calculateRecipientDiscount(e);return e-=t,e>0?e:0},getRecipientDiscountValue:function(){var e=this.getTotalBeforeRecipient(),t=this.calculateRecipientDiscount(e);return t>0?t:0},getCouponActive:function(){return r.isCouponActive()},getCouponValue:function(){return r.getCouponValue()},getCredit:function(){var e=this.rawData.subscription;if(e)return e.balance>0?e.balance:0},getCouponShare:function(){var e=this.get("coupon");if(e&&e.key){var t=a[e.couponTarget];if(t)return t}return null},isCouponValid:r.isCouponValid,getDiscount:function(){return r.getDiscount()},getHasRecipientDiscount:function(){return((this.rawData.subscription||{}).previousOrders||[]).length==0&&this.get("recipientDiscount")},getRecipientDiscountOutOfTotal:function(){if(((this.rawData.subscription||{}).previousOrders||[]).length==0){var e=this.get("recipientDiscount");if(e){if(this.get("isRecipientDiscountFixed"))return e;var t=this.get("total");if(t)return t*e/100}}return null},getDisableEdit:function(){return this.rawData.orderLock.isOrderLocked},applyCoupon:r.applyCoupon,removeCoupon:r.removeCoupon,getIsOrderHasSavedItems:function(){return o.data.isOrderHasSavedItems},getIsOrderCanceled:function(){return o.data.isOrderCanceled},getIsPending:function(){return this._communityModel.get("isPending")},getIsRelaunch:function(){return this._communityModel.get("isRelaunch")},getIsGoalNotReached:function(){return this._communityModel.get("isGoalNotReached")},getIsIncubateGoalNotReached:function(){return this._communityModel.get("isIncubateGoalNotReached")},getIsRelaunchGoalNotReached:function(){return this._communityModel.get("isRelaunchGoalNotReached")},getIncubateNeededOrderCount:function(){return this._communityModel.get("incubateNeededOrderCount")},getMissingOrderCount:function(){return this._communityModel.get("missingOrderCount")},getOrderCount:function(){return this._communityModel.get("orderCount")},getPickupSiteUrl:function(){return this._communityModel.get("pickupSiteUrl")},getHowItWorksPath:function(){return"/"+this.get("urls").howItWorks+"/"+this.get("pickupSiteUrl")},getDoNotAcceptOrders:function(){return this._communityModel.get("doNotAcceptOrders")},getMemberCommunityName:function(){var e=this.get("memberCommunities");if(this.get("member")&&e&&e.length>0)return e[0].title},getIsMoreThanWeekToCutoff:function(){return!this.rawData.orderLock.isStoreClosed&&this.rawData.orderLock.hoursRemainingForStoreClose/24>7},getStoreOpenDate:function(){return s.addDays(this.get("nextDeliveryDate"),1)},getNextOrderWindowOpenDate:function(){return s.addDays(this.get("nextDeliveryDate"),-7)},getHasPaymentIssue:function(){return f.hasPaymentIssue(this.rawData)},getIsAllowToSwitchCommunity:function(){return this.rawData.isAllowToSwitchCommunity&&!this.get("hasPaymentIssue")},getHadSubscription:function(){return!this.get("isSubscriptionForCurrentPickupSite")&&this.get("member")&&this.get("member").hasSubscription},getHasActiveSubscriptionForOtherPickupSite:function(){var e=this.get("memberCommunities");return!this.get("isSubscriptionForCurrentPickupSite")&&this.get("member")&&e&&e.length>0},getPreviousOrderMap:function(){return _.reduce(this.get("previousOrderData"),function(e,t){return e[t.shareKey]=t,e},{})},getPickupSite:function(){var e=this.rawData.pickupSite;if(this.rawData.subscription||!e.publicAddress)e.publicAddress=e.streetAddress,e.lat=e.privateLat,e.lng=e.privateLng;return e},getMemberKey:function(){if(this.rawData.member)return this.rawData.member.key},isGroupBuyingDisplayedAlready:r.isGroupBuyingDisplayedAlready,shouldDisplayGroupBuying:function(){if(r.shouldDisplayGroupBuying()){var e=this.getOrderCount()||0;return this.get("orderLock").isOrderLocked&&e<15?!1:!0}},setGroupBuyingSessionStorage:r.setGroupBuyingSessionStorage,isPostalDeliveryDisplayedAlready:r.isPostalDeliveryDisplayedAlready,shouldDisplayPostalDelivery:r.shouldDisplayPostalDelivery,shouldDisplayMinimumOrder:r.shouldDisplayMinimumOrder,setPostalDeliverySessionStorage:r.setPostalDeliverySessionStorage,shouldDisplaySchoolWelcome:function(){if(this.rawData.pickupSite.communityType==="SCHOOL"&&r.shouldDisplaySchoolWelcome())return!0},ignoreFavoritesPopOver:r.ignoreFavoritesPopOver,getOrganizerCommision:function(){return this.rawData.pickupSite.organizerYearCommission}});return f.hasPaymentIssue=function(e){e=e||n.getMarketData();if(e){var t=e.orderLock||{};return t.isOrderLocked&&t.lockReason===i.EnumOrderLockReason.AdminHoldPaymentIssue}},f}),define("common/memberCheckpoint",["require","common/globals","common/globalMessage","common/enums","common/marketModel"],function(e){var t=e("common/globals"),n=e("common/globalMessage"),r=e("common/enums"),i=e("common/marketModel"),s=function(e){var s=new i,o=s.get("orderLock"),u,a={},f=function(){};if(o&&o.isOrderLocked&&!o.isStoreClosed){a.isDismissible=!1;if(s.get("hasPaymentIssue"))u=!0,t.eventBus.trigger("analytics:pageEvent","Hold Page Viewed"),f=function(){t.eventBus.trigger("analytics:pageEvent","Navigate to payment"),t.eventBus.trigger("flow:header:reactivate-subscription")};else if(o.lockReason==r.EnumOrderLockReason.AdminHold||o.lockReason==r.EnumOrderLockReason.SubscriptionCanceled)u=!0,f=function(){t.eventBus.trigger("contactUs")};e||_.defer(function(){n.show(o.lockText,n.AlertType.warning,a).on("link:clicked",f)})}return u},o=function(){return s(!0)};return{handle:s,isBlocked:o}}),window._mapsLoaded=$.Deferred(),window.gmapsLoaded=function(e){delete window.gmapsLoaded,_mapsLoaded.resolve()},define("common/gmapsDone",["https://maps.google.com/maps/api/js?v=3&libraries=geometry&callback=gmapsLoaded"],function(e){return window._mapsLoaded.done}),define("common/maps",["common/gmapsDone"],function(e){var t=function(t){e(t)},n=function(e,t){var t=_.defaults(t||{},{zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!1,panControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.TOP_LEFT}}),n=new google.maps.Map(e,t),r;this.onMapLoaded=function(e){google.maps.event.addListenerOnce(n,"idle",function(){google.maps.event.trigger(n,"resize"),e()})},this.addMarker=function(e,t,r){return new google.maps.Marker({position:t,map:n,title:e,icon:r})},this.resizeMap=function(){google.maps.event.trigger(n,"resize")},this.setCenter=function(e){n.setCenter(e)},this.getDistance=function(e){return google.maps.geometry.spherical.computeDistanceBetween(n.getCenter(),e)},this.addListener=function(e,t){google.maps.event.addListener(n,e,t)},this.getMapObj=function(){return n},this.setInfoWindow=function(e,t,i,s){r||(r=new google.maps.InfoWindow({maxWidth:9999}),s&&google.maps.event.addListener(r,"closeclick",function(){s()})),google.maps.event.addListener(t,"click",function(){r.setContent(typeof e=="function"?e():e),r.open(n,t),i&&i(t)})},this.closeInfoWindow=function(){r&&r.close()}},r=function(e,t,n){var r=new google.maps.Geocoder;r.geocode({address:e,region:"US"},function(e,r){r==google.maps.GeocoderStatus.OK&&e&&e.length>0?t.call(n,e[0].geometry.location.lat(),e[0].geometry.location.lng()):t.call(n,0,0)})},i=function(e,t){var n=new google.maps.Geocoder,r,i=function(e,s){var o;if(s==google.maps.GeocoderStatus.OK&&e&&e.length>0){o={lat:e[0].geometry.location.lat(),lng:e[0].geometry.location.lng()},e[0].address_components.forEach(function(e){var t;e.types.indexOf("country")>-1?t="country":e.types.indexOf("administrative_area_level_1")>-1?t="state":e.types.indexOf("locality")>-1?t="city":e.types.indexOf("administrative_area_level_2")>-1&&o.city==undefined?t="city":e.types.indexOf("street_address")>-1?t="street":e.types.indexOf("route")>-1&&o.street==undefined?t="street":e.types.indexOf("neighborhood")>-1?t="neighborhood":e.types.indexOf("street_number")>-1?t="streetNo":e.types.indexOf("postal_code")>-1&&(t="zip"),t&&(o[t]=e.short_name)});if(o.zip==undefined&&!r){r=!0,n.geocode({latLng:o},i);return}o.country!="US"&&(o={})}else o={};t(o)};n.geocode({address:e,region:"US"},i)};return{setReadyCallback:t,Map:n,geocodeRequest:r,geocodeRequestDetailed:i}}),define("modules/communityModal/communityModalTemplateHelpers",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){var t=parseInt(e.substr(0,2)),n=parseInt(e.substr(2)),r=t<12?"am":"pm";return t-=t>12?12:0,t+(n==0?"":":"+n)+r},r=function(e,t,r){return e+"s, "+n(t)+"-"+n(r)};t.registerHelper("communityModal:weeklyPickupTime",r)}),define("hbs!common/handlebars/partials/organizerImage",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<div class="organizer-image">\r\n	<img src="/staticResource/resources/cmnt-champion-',(o=n.pickupSiteUrl)?o=o.call(t,{hash:{}}):(o=t&&t.pickupSiteUrl,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'.jpg"> \r\n	<span class="frame"/>\r\n</div>\r\n',s});return t.registerPartial("organizerImage",n),n}),define("common/handlebars/helpers/formatHourHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){if(e){var t=parseInt(e.substr(0,2)),n=parseInt(e.substr(2)),r=t<12?"am":"pm";return t-=t>12?12:0,t+(n==0?"":":"+n)+r}};return t.registerHelper("formatHourHelper",n),n}),define("common/handlebars/helpers/marketHeader_formatTimeRemainingHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){var t;return e==0?"Less than hour":e==1?"One hour":e<24?e+" hours":(t=Math.ceil(e/24),t==1?"One day":t+" days")};return t.registerHelper("marketHeader_formatTimeRemainingHelper",n),n}),define("hbs!common/handlebars/partials/communityInfoItems",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/formatHourHelper","common/handlebars/helpers/marketHeader_formatTimeRemainingHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\r\n					<div class="title">Order closed</div>\r\n					<div class="text">',s={hash:{}},r+=l((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s):f.call(e,"formatDateHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s)))+"</div>\r\n				",r}function d(e,t){var r="",i,s;return r+='\r\n					<div class="title">Order by Midnight, ',s={hash:{}},r+=l((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%a, %b %d",s):f.call(e,"formatDateHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%a, %b %d",s)))+'</div>\r\n					<div class="text">',s={hash:{}},r+=l((i=n.marketHeader_formatTimeRemainingHelper||e&&e.marketHeader_formatTimeRemainingHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.hoursRemainingForStoreClose),s):f.call(e,"marketHeader_formatTimeRemainingHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.hoursRemainingForStoreClose),s)))+" left</div>\r\n				",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<div class="info-items">\r\n	<div class="delivery-details-item pickup-on">\r\n		<div class="row">\r\n			<div class="col-xs-2">\r\n				<i></i>\r\n			</div>\r\n			<div class="col-xs-10">\r\n				<div class="title">Next Pickup Time</div>\r\n				<div class="text">',a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.nextDeliveryDate,"%a, %b %d",a):f.call(t,"formatDateHelper",t&&t.nextDeliveryDate,"%a, %b %d",a)))+", ",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a):f.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a)))+"-",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a):f.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a)))+'</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="delivery-details-item order-by">\r\n		<div class="row">\r\n			<div class="col-xs-2">\r\n				<i></i>\r\n			</div>\r\n			<div class="col-xs-10">\r\n				',u=n["if"].call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.isStoreClosed),{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i)});if(u||u===0)s+=u;return s+='\r\n			</div>\r\n		</div>\r\n	</div>\r\n	<div class="delivery-details-item community">\r\n		<div class="row">\r\n			<div class="col-xs-2">\r\n				<i></i>\r\n			</div>\r\n			<div class="col-xs-10">\r\n				<div class="title">Delivery Location</div>\r\n				<div class="text">'+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.publicAddress),typeof o===h?o.apply(t):o))+"</div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>\r\n",s});return t.registerPartial("communityInfoItems",n),n}),define("common/handlebars/helpers/fullNameHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e,t){return e+" "+t};return t.registerHelper("fullNameHelper",n),n}),define("common/handlebars/helpers/gtHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e,t,n){if(e>t)return n.fn(this)};return t.registerHelper("gtHelper",n),n}),define("hbs!modules/communityModal/communityModalTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","hbs!common/handlebars/partials/communityInfoItems","common/handlebars/helpers/fullNameHelper","common/handlebars/helpers/gtHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+='\r\n					<div class="stripe-title arrowed">',(i=n.missingOrderCount)?i=i.call(e,{hash:{}}):(i=e&&e.missingOrderCount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+" more order",o={hash:{},inverse:c.noop,fn:c.program(2,d,t)},s=(i=n.gtHelper||e&&e.gtHelper,i?i.call(e,e&&e.missingOrderCount,1,o):h.call(e,"gtHelper",e&&e.missingOrderCount,1,o));if(s||s===0)r+=s;return r+=" needed to launch</div>\r\n				",r}function d(e,t){return"s"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="community-modal">\r\n	<div class="container">\r\n		<div class="row">\r\n			<div class="organizer col-sm-3">\r\n				',o=c.invokePartial(r.organizerImage,"organizerImage",t,n,r);if(o||o===0)s+=o;s+='\r\n				<div class="visible-xs">\r\n					<p class="welcome">Welcome to our community!</p>\r\n					<h2 class="community-title">'+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</h2>\r\n				</div>\r\n				<div class="organizer-title">Organizer</div>\r\n				<h3 class="name">',a={hash:{}},s+=l((o=n.fullNameHelper||t&&t.fullNameHelper,o?o.call(t,t&&t.firstName,t&&t.lastName,a):h.call(t,"fullNameHelper",t&&t.firstName,t&&t.lastName,a)))+'</h3>\r\n				<a class="email" href="mailto:',(u=n.organizerEmail)?u=u.call(t,{hash:{}}):(u=t&&t.organizerEmail,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'">',(u=n.organizerEmail)?u=u.call(t,{hash:{}}):(u=t&&t.organizerEmail,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</a>\r\n			</div>\r\n			<div class="col-sm-4">\r\n				<div class="hidden-xs">\r\n					<p class="welcome">Welcome to our community!</p>\r\n					<h2 class="community-title">'+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+"</h2>\r\n				</div>\r\n				",u=n["if"].call(t,t&&t.isGoalNotReached,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(u||u===0)s+=u;s+="\r\n				",u=c.invokePartial(r.communityInfoItems,"communityInfoItems",t,n,r);if(u||u===0)s+=u;return s+='\r\n			</div>\r\n			<div class="col-sm-5">\r\n				<div class="map-canvas"></div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>',s});return n}),define("modules/communityModal/communityModalView",["require","marionette","common/maps","common/utils","modules/communityModal/communityModalTemplateHelpers","hbs!modules/communityModal/communityModalTemplate"],function(e){var t=e("marionette"),n=e("common/maps"),r=e("common/utils");e("modules/communityModal/communityModalTemplateHelpers");var i=e("hbs!modules/communityModal/communityModalTemplate"),s=t.ItemView.extend({template:i,ui:{mapHook:".map-canvas",organizerImage:".organizer-image>img"},onShow:function(){n.setReadyCallback(function(){var e=this.model.get("pickupSite"),t=new n.Map(this.ui.mapHook[0]),r={lat:e.lat,lng:e.lng};t.onMapLoaded(function(){t.addMarker(e.title,r),t.setCenter(r)})}.bind(this)),r.handleImageLoad(this.ui.organizerImage)}});return s}),define("modules/communityModal/communityModalModule",["require","marionette","common/globals","common/utils","common/nav","common/dataService","common/modal/modal","common/marketModel","modules/communityModal/communityModalView"],function(e){function p(e,t){var r,i;if(e){r="drawer opened";var o=s.getMarketData();i=o&&o.pickupSite&&o.pickupSite.title?o.pickupSite.title:""}else r="drawer closed",i=t?"from drawer":"click out of the drawer";n.eventBus.trigger("analytics:event","Community-market",r,i)}function d(){var e=r.deparam();e.modal&&(delete e.modal,i.navigate(i.PageEnum.Market,{trigger:!1},$.param(e)))}var t=e("marionette"),n=e("common/globals"),r=e("common/utils"),i=e("common/nav"),s=e("common/dataService"),o=e("common/modal/modal"),u=e("common/marketModel"),a=e("modules/communityModal/communityModalView"),f=t.Controller.extend({getView:function(){return new a({model:new u})}}),l,c,h;return{toggle:function(e,t){var n,s={isDrawer:!r.clientViewPort.isXs(),closeCallback:function(){t.removeClass("open"),d()}};e=e||!t.hasClass("open"),t.toggleClass("open",e);var u;if(e){l=l||new f,n=l.getView(),_.defer(function(){var e=o.show(n,s);e.on("closeClicked",function(){p(!1,!0),e.off(),u&&u.off()})}),c=t,h=n,p(!0),u=$("body").on("click",function(e){c.has(e.target).length==0&&$(e.target).closest(".modal-dialog").length==0&&o.hasView(h)&&(o.close(),c.removeClass("open"),p(!1,!1),u.off(),d())});var a=location.search!=""?r.deparam():{};a.modal="community",i.navigate(i.PageEnum.Market,{trigger:!1},$.param(a))}else o.close(),d()}}}),define("common/handlebars/helpers/header_processCommunityNameHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){var t="",n;return e&&(t=e.replace("street","St,"),n=t.indexOf("-"),n!=-1&&(t=t.substring(0,n))),t};return t.registerHelper("header_processCommunityNameHelper",n),n}),define("common/handlebars/helpers/currencyHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e,t,n){var r=function(e){return n===!0?"<span class='decorated-price'>"+e+"</span>":e},i=typeof t=="boolean"?t:!1,s="";if(e!=undefined&&_.isNumber(e)){var o=e.toFixed(2);if(i&&o.indexOf(".00")===o.length-3)o=o.substr(0,o.length-3);else{var u=o.indexOf(".");u>=0&&(s=r(o.substr(u,o.length-1)),o=o.substr(0,u)+s)}if(e<0){var a=o.substr(1,o.length);return window.optimizlyHideDollarSign?"-"+a:r("-$")+a}return window.optimizlyHideDollarSign?o:r("$")+o}};return t.registerHelper("currencyHelper",n),n}),define("common/handlebars/helpers/discountHelper",["require","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e){var t=e("hbs/handlebars"),n=e("common/handlebars/helpers/currencyHelper"),r=function(e,t,r){return t?n(e,r):e+"%"};return t.registerHelper("discountHelper",r),r}),define("hbs!modules/header/headerTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/header_processCommunityNameHelper","common/handlebars/helpers/gtHelper","common/handlebars/helpers/discountHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return'\n										<span class="incubated">Launching</span>\n									'}function d(e,t){var r="",i,s;r+='\n						<li class="user-menu dropdown open-xs">\n							<a class="dropdown-toggle" data-toggle="dropdown">\n								<span class="text">'+l((i=(i=e&&e.member,i==null||i===!1?i:i.firstName),typeof i===f?i.apply(e):i))+'</span>\n								<span class="caret hidden-xs"></span>\n							</a>\n							<ul class="dropdown-menu" role="menu">\n								<li class="divider visible-xs"></li>\n								',s=n["if"].call(e,e&&e.memberCommunities,{hash:{},inverse:c.program(21,C,t),fn:c.program(4,v,t)});if(s||s===0)r+=s;return r+='\n								<li>\n									<a class="logout">\n										<i></i>Log Out\n									</a>\n								</li>\n							</ul>\n						</li>\n					',r}function v(e,t){var r="",i,s,o;r+="\n									\n									<!--",i=n["if"].call(e,e&&e.isOrganizer,{hash:{},inverse:c.noop,fn:c.program(5,m,t)});if(i||i===0)r+=i;r+='-->\n									<li>\n                                        <a class="account-info" >\n											<i></i>My Account\n										</a>\n									</li>\n									',o={hash:{},inverse:c.noop,fn:c.program(7,g,t)},s=(i=n.gtHelper||e&&e.gtHelper,i?i.call(e,(i=e&&e.memberCommunities,i==null||i===!1?i:i.length),1,o):h.call(e,"gtHelper",(i=e&&e.memberCommunities,i==null||i===!1?i:i.length),1,o));if(s||s===0)r+=s;r+="\n									",s=n["if"].call(e,e&&e.hasOrders,{hash:{},inverse:c.noop,fn:c.program(10,b,t)});if(s||s===0)r+=s;r+='\n									<li>\n										<a class="order-history">\n											<i></i>Order History\n										</a>\n									</li>\n									',s=n.unless.call(e,e&&e.isOrganizer,{hash:{},inverse:c.noop,fn:c.program(13,E,t)});if(s||s===0)r+=s;r+="\n									",s=n["if"].call(e,e&&e.senderReferral,{hash:{},inverse:c.noop,fn:c.program(16,x,t)});if(s||s===0)r+=s;r+='\n									<div class="hidden-xs">\n										<li class="divider"></li>\n										<li class="dropdown-header">Spread The Word:</li>\n										<li>\n											<a class="share-facebook" data-analytics-category="header" data-analytics-action="share clicked">\n												<i></i>Facebook\n											</a>\n										</li>\n										<li>\n											<a class="share-twitter" data-analytics-category="header" data-analytics-action="share clicked">\n												<i></i>Twitter\n											</a>\n										</li>\n                                        ',s=n.unless.call(e,e&&e.isMemberTypeExistAndNotOrganizer,{hash:{},inverse:c.noop,fn:c.program(19,N,t)});if(s||s===0)r+=s;return r+='\n										<li class="divider"></li>\n									</div>\n								',r}function m(e,t){var n="",r;return n+='-->\n										<!--<li>-->\n											<!--<a class="organizer-dashboard" href="'+l((r=(r=e&&e.urls,r==null||r===!1?r:r.organizerDashboard),typeof r===f?r.apply(e):r))+'" target="_blank">-->\n												<!--<i></i>Organizer Tools-->\n											<!--</a>-->\n										<!--</li>-->\n									<!--',n}function g(e,t){var r="",i;r+='\n										<li class="divider"></li>\n										',i=n.each.call(e,e&&e.memberCommunities,{hash:{},inverse:c.noop,fn:c.program(8,y,t)});if(i||i===0)r+=i;return r+='\n										<li class="divider"></li>\n									',r}function y(e,t){var r="",i;return r+='\n											<li>\n												<a href="',(i=n.url)?i=i.call(e,{hash:{}}):(i=e&&e.url,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</a>\n											</li>\n										",r}function b(e,t){var r="",i;r+='\n										<li>\n											<a class="reorder" ',i=n["if"].call(e,e&&e.hasPaymentIssue,{hash:{},inverse:c.noop,fn:c.program(11,w,t)});if(i||i===0)r+=i;return r+=">\n												<i></i>Reorder from Past Orders\n											</a>\n										</li>\n									",r}function w(e,t){return"disabled"}function E(e,t){var r="",i;r+='\n										<li>\n											<a class="manage-deliveries"',i=n["if"].call(e,e&&e.isDeliveryHoldLocked,{hash:{},inverse:c.noop,fn:c.program(14,S,t)});if(i||i===0)r+=i;return r+='\n											   data-analytics-category="header"\n											   data-analytics-action="manage deliveries button pressed">\n												<i></i>Manage Deliveries\n											</a>\n										</li>\n									',r}function S(e,t){return" disabled"}function x(e,t){var r="",i,s,o;r+='\n										<li class="visible-xs visible-sm">\n											<a class="sender-referral" ',i=n["if"].call(e,e&&e.hasPaymentIssue,{hash:{},inverse:c.noop,fn:c.program(11,w,t)});if(i||i===0)r+=i;r+=' data-analytics-category="referral" data-analytics-action="Referral row clicked">\n												<i></i>Invite a Friend - Give ',o={hash:{}},r+=l((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,(i=e&&e.senderReferral,i==null||i===!1?i:i.recipientDiscount),(i=e&&e.senderReferral,i==null||i===!1?i:i.isRecipientDiscountFixed),!0,o):h.call(e,"discountHelper",(i=e&&e.senderReferral,i==null||i===!1?i:i.recipientDiscount),(i=e&&e.senderReferral,i==null||i===!1?i:i.isRecipientDiscountFixed),!0,o)))+"\n												",s=n.unless.call(e,(i=e&&e.senderReferral,i==null||i===!1?i:i.isRecipientDiscountFixed),{hash:{},inverse:c.noop,fn:c.program(17,T,t)});if(s||s===0)r+=s;return r+="\n											</a>\n										</li>\n									",r}function T(e,t){return" Discount"}function N(e,t){return'\n										<li>\n											<a class="share-email" data-analytics-category="header" data-analytics-action="share clicked">\n												<i></i>Email\n											</a>\n										</li>\n                                        '}function C(e,t){var r="",i,s;r+="\n								\n									",s=n["if"].call(e,(i=e&&e.member,i==null||i===!1?i:i.farms),{hash:{},inverse:c.noop,fn:c.program(22,k,t)});if(s||s===0)r+=s;return r+="\n								",r}function k(e,t){var r="",i,s;r+="\n										",s=n.each.call(e,(i=e&&e.member,i==null||i===!1?i:i.farms),{hash:{},inverse:c.noop,fn:c.program(23,L,t)});if(s||s===0)r+=s;return r+='\n										<li class="divider"></li>\n									',r}function L(e,t){var r="",i;return r+='\n											<li>\n												<a href="',(i=n.accountUrl)?i=i.call(e,{hash:{}}):(i=e&&e.accountUrl,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'">\n													<i></i>',(i=n.name)?i=i.call(e,{hash:{}}):(i=e&&e.name,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"\n												</a>\n											</li>\n										",r}function A(e,t){var r="",i;r+='\n						\n						<li class="hidden-xs">\n							<a class="login simple-link">Log In</a>\n						</li>\n						',i=n.unless.call(e,e&&e.isLoginOptimizedFlow,{hash:{},inverse:c.noop,fn:c.program(26,O,t)});if(i||i===0)r+=i;r+='\n						<li class="dropdown visible-xs open-xs">\n							<ul class="dropdown-menu" role="menu">\n								<li>\n									<a class="login">Log In</a>\n								</li>\n								',i=n.unless.call(e,e&&e.isLoginOptimizedFlow,{hash:{},inverse:c.noop,fn:c.program(28,M,t)});if(i||i===0)r+=i;return r+="\n							</ul>\n						</li>\n					",r}function O(e,t){return'\n							<li class="hidden-xs hidden-sm">\n								<a class="sign-up simple-link"\n								   data-analytics-category="header"\n								   data-analytics-action="create account button clicked">Sign Up</a>\n							</li>\n						'}function M(e,t){return'\n									<li>\n										<a class="sign-up"\n										   data-analytics-category="header"\n										   data-analytics-action="create account button clicked">Sign Up</a>\n									</li>\n								'}function _(e,t){return"three-tabs"}function D(e,t){var r="",i;r+="has-items ",i=n.unless.call(e,e&&e.isOrderDirty,{hash:{},inverse:c.noop,fn:c.program(33,P,t)});if(i||i===0)r+=i;return r}function P(e,t){return"saved"}function H(e,t){var r="",i;return r+='\n									<span class="item-count">',(i=n.itemCount)?i=i.call(e,{hash:{}}):(i=e&&e.itemCount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</span>\n								",r}function B(e,t){var n="",r;return n+='\n                    <li class="three-tabs">\n                        <a class="nav-option organizer-dashboard" href="'+l((r=(r=e&&e.urls,r==null||r===!1?r:r.organizerDashboard),typeof r===f?r.apply(e):r))+'">\n                            <div>\n                                <i class="hidden-xs"></i>\n                                <span class="text">Organizer<br class="hidden-xs"/> Tools</span>\n                            </div>\n                        </a>\n                    </li>\n                ',n}function j(e,t){var r="",i;r+='\n					<li class="hidden-xs hidden-sm">\n						<a class="sender-referral nav-option" ',i=n["if"].call(e,e&&e.hasPaymentIssue,{hash:{},inverse:c.noop,fn:c.program(11,w,t)});if(i||i===0)r+=i;return r+=' data-analytics-category="referral" data-analytics-action="Referral row clicked">\n							<div>\n								<i></i>\n								<span class="text">Invite</span>\n							</div>\n						</a>\n					</li>\n				',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="navbar-wrapper">\n	<div class="navbar navbar-fixed-top" role="navigation">\n		<div class="container">\n			<div class="navbar-header">\n				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">\n					<span class="sr-only">Toggle navigation</span>\n					<span class="icon-bar"></span>\n					<span class="icon-bar"></span>\n					<span class="icon-bar"></span>\n				</button>\n				<a class="navbar-brand" href="/" target="_blank">Farmigo</a>\n				<div id="header-search-region" class="header-search visible-xs"></div>\n				<ul class="nav navbar-nav">\n					<li class="community dropdown">\n						<a class="dropdown-toggle">\n							<div class="hidden-xs">\n								<div>\n									Community:\n									',o=n["if"].call(t,t&&t.isGoalNotReached,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='\n								</div>\n								<span class="name">',(o=n.communityName)?o=o.call(t,{hash:{}}):(o=t&&t.communityName,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span>\n								<span class="caret"></span>\n							</div>\n							<div class="visible-xs">\n								<span class="name">',a={hash:{}},s+=l((o=n.header_processCommunityNameHelper||t&&t.header_processCommunityNameHelper,o?o.call(t,t&&t.communityName,a):h.call(t,"header_processCommunityNameHelper",t&&t.communityName,a)))+'</span>\n								<i class="info">i</i>\n							</div>\n						</a>\n					</li>\n				</ul>\n				<!--<div class="share-search hidden-xs"></div>-->\n			</div>\n			<div class="navbar-collapse collapse">\n				<ul class="nav navbar-nav navbar-right">\n					',u=n["if"].call(t,t&&t.member,{hash:{},inverse:c.program(25,A,i),fn:c.program(3,d,i)});if(u||u===0)s+=u;s+='\n					<li class="learn-more dropdown">\n						<a class="dropdown-toggle" data-toggle="dropdown">Learn More <span class="caret"></span></a>\n						<ul class="dropdown-menu" role="menu">\n							<li>\n								<a class="faq"\n                                   href="'+l((o=(o=t&&t.urls,o==null||o===!1?o:o.faq),typeof o===f?o.apply(t):o))+'"\n                                   target="_blank"\n                                   data-analytics-category="header"\n                                   data-analytics-action="help - faq">Help</a>\n							</li>\n							<li>\n								<a class="producer-standards"\n								   href="'+l((o=(o=t&&t.urls,o==null||o===!1?o:o.producerStandards),typeof o===f?o.apply(t):o))+'"\n								   target="_blank"\n								   data-analytics-category="header"\n								   data-analytics-action="help - producer standards">Producer Standards</a>\n							</li>\n						</ul>\n					</li>\n				</ul>\n			</div>\n			<ul class="main-nav nav navbar-nav navbar-right">\n				<li class="',u=n["if"].call(t,t&&t.isOrganizer,{hash:{},inverse:c.noop,fn:c.program(30,_,i)});if(u||u===0)s+=u;s+='">\n					<a class="market nav-option" ',u=n["if"].call(t,t&&t.hasPaymentIssue,{hash:{},inverse:c.noop,fn:c.program(11,w,i)});if(u||u===0)s+=u;s+='>\n						<div>\n							<i class="hidden-xs"></i>\n							<span class="text">Market</span>\n						</div>\n					</a>\n				</li>\n                <li class="order-tab-wrapper ',u=n["if"].call(t,t&&t.isOrganizer,{hash:{},inverse:c.noop,fn:c.program(30,_,i)});if(u||u===0)s+=u;s+='">\n					<a class="order nav-option ',u=n["if"].call(t,t&&t.itemCount,{hash:{},inverse:c.noop,fn:c.program(32,D,i)});if(u||u===0)s+=u;s+='" ',u=n["if"].call(t,t&&t.hasPaymentIssue,{hash:{},inverse:c.noop,fn:c.program(11,w,i)});if(u||u===0)s+=u;s+=">\n						<div>\n							<i>\n								",u=n["if"].call(t,t&&t.itemCount,{hash:{},inverse:c.noop,fn:c.program(35,H,i)});if(u||u===0)s+=u;s+='\n							</i>\n							<span class="text">My Bag</span>\n						</div>\n					</a>\n				</li>\n                ',u=n["if"].call(t,t&&t.isOrganizer,{hash:{},inverse:c.noop,fn:c.program(37,B,i)});if(u||u===0)s+=u;s+="\n				",u=n["if"].call(t,t&&t.senderReferral,{hash:{},inverse:c.noop,fn:c.program(39,j,i)});if(u||u===0)s+=u;return s+="\n			</ul>\n\n		</div>\n	</div>\n</div>",s});return n}),define("common/localStorage",[],function(){return{setItem:function(e,t){try{return window.localStorage.setItem(e,t)}catch(n){return null}},getItem:function(e){try{return window.localStorage.getItem(e)}catch(t){return null}}}}),define("hbs!common/popover/popoverTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return'\r\n		<button type="button" class="close">\r\n			<span aria-hidden="true">&times;</span>\r\n			<span class="sr-only">Close</span>\r\n		</button>\r\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="popover ',(o=n.className)?o=o.call(t,{hash:{}}):(o=t&&t.className,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'" role="tooltip">\r\n	<div class="arrow"></div>\r\n	',o=n["if"].call(t,t&&t.hasClose,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\r\n	<div class="popover-content"></div>\r\n</div>',s});return n}),define("common/popover/popover",["backbone","marionette","common/localStorage","hbs!common/popover/popoverTemplate"],function(e,t,n,r){var i=t.ItemView.extend({template:r}),s=function(t,r,s){var o=_.defaults(s||{},{placement:"bottom",html:!0}),u=new i({model:new e.Model({className:o.className,hasClose:s.trigger!="hover"&&s.hasClose!=0})});u.render(),o.template=u.$el.html(),o.content=r.el,t.popover(o),t.on("shown.bs.popover",function(){o.avoidReRender||r.render()}),$("body").on("click",".popover .close",function(){f()});var a="popover_"+s.key;s.isShow&&!(s.isOnceDuringSession&&sessionStorage[a]||s.isOnce&&localStorage[a])&&t.popover("show"),s.isDismissible!=0&&$("body").on("click",function(e){t.has(e.target).length==0&&$(".popover").has(e.target).length==0&&f()});var f=function(){t.popover("hide"),s.isOnceDuringSession&&sessionStorage.setItem(a,!0),s.isOnce&&n.setItem(a,!0),s.onOk&&s.onOk()};return{hide:f}};return{create:s}}),define("modules/referral/referralModel",["require","common/rawDataModel","common/dataService","common/enums"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/enums"),i=t.Model.extend({readers:{senderReferral:(new t.Value("senderReferral")).getValue,recipientDiscount:(new t.Value("subscription.referralDiscount")).getValue,isRecipientDiscountFixed:(new t.Value("subscription.isReferralDiscountFixed")).getValue,referredBy:(new t.Value("referredBy")).getValue,address:(new t.Value("pickupSite.shortAddress")).getValue,area:"getArea",communityName:(new t.Value("pickupSite.title")).getValue,region:(new t.Value("region")).getValue},getArea:function(){return this.rawData.region=="NY"?"NYC":"SFB"}}),s;return i.canBeRecipient=function(){var e=n.getMarketData(),t=e.subscription||{};return!(e.member||{}).hasDeliveries&&(!t.key||t.key&&!t.referralInstance)},i.setIsRecipient=function(e){s=e},i.isRecipient=function(){return s},i}),define("hbs!modules/referral/referralSenderModalTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/discountHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return" off"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<h1>Share the joy of good food!</h1>\r\n<section class="share-section">\r\n	<p class="intro">Give your friends ',a={hash:{}},s+=l((o=n.discountHelper||t&&t.discountHelper,o?o.call(t,(o=t&&t.senderReferral,o==null||o===!1?o:o.recipientDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isRecipientDiscountFixed),!0,a):f.call(t,"discountHelper",(o=t&&t.senderReferral,o==null||o===!1?o:o.recipientDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isRecipientDiscountFixed),!0,a))),u=n.unless.call(t,(o=t&&t.senderReferral,o==null||o===!1?o:o.isRecipientDiscountFixed),{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(u||u===0)s+=u;return s+=" to try Farmigo and you'll <em>receive ",a={hash:{}},s+=l((o=n.discountHelper||t&&t.discountHelper,o?o.call(t,(o=t&&t.senderReferral,o==null||o===!1?o:o.senderDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isSenderDiscountFixed),!0,a):f.call(t,"discountHelper",(o=t&&t.senderReferral,o==null||o===!1?o:o.senderDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isSenderDiscountFixed),!0,a)))+'</em> when they pick up their first order.</p>\r\n	<div id="referral-sender-share-region"></div>\r\n</section>\r\n<section class="counters-section">\r\n	<ul class="clearfix">\r\n		<li>Friends Who Ordered <em>'+l((o=(o=t&&t.senderReferral,o==null||o===!1?o:o.invitedCount),typeof o===h?o.apply(t):o))+"</em></li>\r\n		<li>Rewards Received <em>",a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,(o=t&&t.senderReferral,o==null||o===!1?o:o.earnedValue),a):f.call(t,"currencyHelper",(o=t&&t.senderReferral,o==null||o===!1?o:o.earnedValue),a)))+"</em></li>\r\n	</ul>\r\n</section>\r\n",s});return n}),define("hbs!modules/sharing/sharingTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return"\r\n	<p>Your link to share:</p>\r\n"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this,a="function",f=this.escapeExpression;o=n["if"].call(t,t&&t.isSenderReferral,{hash:{},inverse:u.noop,fn:u.program(1,l,i)});if(o||o===0)s+=o;return s+='\r\n<input type="text" class="share-link" value="',(o=n.sharingLink)?o=o.call(t,{hash:{}}):(o=t&&t.sharingLink,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'" readonly>\r\n<div class="share-buttons clearfix">\r\n    <a class="button email" target="_blank" href="',(o=n.emailUrl)?o=o.call(t,{hash:{}}):(o=t&&t.emailUrl,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'" data-analytics-action="share clicked">Send an Email</a>\r\n    <button class="button share twitter" data-analytics-action="share clicked"></button>\r\n    <button class="button share facebook" data-analytics-action="share clicked"></button>\r\n</div>\r\n',s});return n}),define("hbs!common/share/emailTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatHourHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+="Hey!\n\nHave you heard of Farmigo? It’s an online farmer’s market where you can buy amazing food direct from local farmers and producers -- everything from pasta and cheese to fresh vegetables and seafood. Basically, you get to skip the hassle of the supermarket and support small businesses and your community while you’re at it.\n\nInterested? There’s a Farmigo pickup spot at "+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.shortAddress),typeof o===f?o.apply(t):o))+", delivering every week on "+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryDays),typeof o===f?o.apply(t):o))+", between ",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a)))+"-",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a)))+". Since you’re my friend, just use the code Local20 to get 20% off of your first order!\n\n",(u=n.shareLink)?u=u.call(t,{hash:{}}):(u=t&&t.shareLink,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u),s});return n}),define("hbs!common/share/incubateEmailTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatHourHelper","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+="Hey!\n\nHave you heard of Farmigo? It’s an online farmer’s market where you can buy amazing food direct from local farmers and producers -- everything from pasta and cheese to fresh vegetables and seafood. Basically, you get to skip the hassle of the supermarket and support small businesses and your community while you’re at it.\n\nInterested? There’s a Farmigo pickup spot at "+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.shortAddress),typeof o===f?o.apply(t):o))+", delivering every week on "+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryDays),typeof o===f?o.apply(t):o))+", between ",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a)))+"-",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a)))+". We need 10 orders by midnight on ",a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%b, %d",a):c.call(t,"formatDateHelper",(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%b, %d",a)))+" to launch!\nSince you’re my friend, just use the code Local20 to get 20% off of your first order! If enough of us get behind it, we can create a Farmigo community and bring farm-to-neighborhood food to "+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.city),typeof o===f?o.apply(t):o))+"!\n\n",(u=n.shareLink)?u=u.call(t,{hash:{}}):(u=t&&t.shareLink,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u),s});return n}),define("common/handlebars/helpers/capitalizeHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){return e=e||"",e.slice(0,1).toUpperCase()+e.slice(1)};return t.registerHelper("capitalizeHelper",n),n}),define("hbs!common/share/referralEmailTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/discountHelper","common/handlebars/helpers/capitalizeHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+="Hi there,\n\nHave you heard of Farmigo? It's an online farmer's market, which lets you order incredibly fresh food directly from local farms, bakers, butchers, fishermen, and more. I've been ordering my groceries from them and it's been fantastic!\n\nFarmigo puts a lot of effort into finding only the best farms and businesses to work with, so the food is the highest quality possible, super nutritious and farmed or made sustainably. Plus, it's an easy way to support our local economy and small businesses! And of course, everything is crazy delicious.\n\nI thought you might be interested, so I'm sending you a code to get ",a={hash:{}},s+=l((o=n.discountHelper||t&&t.discountHelper,o?o.call(t,(o=t&&t.senderReferral,o==null||o===!1?o:o.recipientDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isRecipientDiscountFixed),!0,a):f.call(t,"discountHelper",(o=t&&t.senderReferral,o==null||o===!1?o:o.recipientDiscount),(o=t&&t.senderReferral,o==null||o===!1?o:o.isRecipientDiscountFixed),!0,a)))+" off your first order. Try it once, taste everything, and I'm sure you'll fall in love with it...just like I have!\n\nHere's the code:\n",(u=n.referralLink)?u=u.call(t,{hash:{}}):(u=t&&t.referralLink,u=typeof u===c?u.call(t,{hash:{}}):u),s+=l(u)+"\n\nLet me know if you have any questions, I'm happy to talk. Hope you enjoy!\n\nBest,\n",a={hash:{}},s+=l((o=n.capitalizeHelper||t&&t.capitalizeHelper,o?o.call(t,(o=t&&t.member,o==null||o===!1?o:o.firstName),a):f.call(t,"capitalizeHelper",(o=t&&t.member,o==null||o===!1?o:o.firstName),a)))+" ",a={hash:{}},s+=l((o=n.capitalizeHelper||t&&t.capitalizeHelper,o?o.call(t,(o=t&&t.member,o==null||o===!1?o:o.lastName),a):f.call(t,"capitalizeHelper",(o=t&&t.member,o==null||o===!1?o:o.lastName),a))),s});return n}),define("hbs!common/share/groupBuyingEmailTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+="Hey -- Thought you might be interested in this great new food kick I’m on.  If we can get 15 orders each week in this local farm buying group, everyone will get 10% off their order.  The more folks that order, the more savings we can get buying from local farms as a group.\n\nLink: ",(o=n.shareLink)?o=o.call(t,{hash:{}}):(o=t&&t.shareLink,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"\n\nFarmigo is an online farmer’s market.   Just place your order online and pickup once a week (with me!)  Give it a try!\n\nEnjoy!\n",s});return n}),define("modules/sharing/sharingModel",["require","backbone","common/enums","common/rawDataModel","common/marketModel","common/dataService","common/globals","common/dataUtils","hbs!common/share/emailTemplate","hbs!common/share/incubateEmailTemplate","hbs!common/share/referralEmailTemplate","hbs!common/share/groupBuyingEmailTemplate","common/handlebars/helpers/discountHelper"],function(e){var t=e("backbone"),n=e("common/enums"),r=e("common/rawDataModel"),i=e("common/marketModel"),s=e("common/dataService"),o=e("common/globals"),u=e("common/dataUtils"),a=e("hbs!common/share/emailTemplate"),f=e("hbs!common/share/incubateEmailTemplate"),l=e("hbs!common/share/referralEmailTemplate"),c=e("hbs!common/share/groupBuyingEmailTemplate"),h=e("common/handlebars/helpers/discountHelper"),p={Regular:"Regular",Incubate:"Incubate",Referral:"Referral",GroupBuying:"GroupBuying"},d={Regular:"Join me in eating deliciously local! Skip the supermarket + support farms! Get 20% off 1st orders w/code LOCAL20",Incubate:"Join me in eating deliciously local! Skip the supermarket + support farms! Get 20% off 1st orders w/code LOCAL20.",Referral:"Join me in eating deliciously local! Skip the supermarket + support farms! Get %referral% using my link"},v=r.Model.extend({rawValues:{sharingLink:new r.Value("sharingLink")},readers:{memberType:u.getMemberType,member:(new r.Value("member")).getValue,pickupSite:(new r.Value("pickupSite")).getValue,senderReferral:(new r.Value("senderReferral")).getValue,isOrganizer:(new r.Value("isOrganizer")).getValue,shareLink:u.getShareLink,referralLink:u.getReferralLink,shareType:"getShareType",twitterMessage:"getTwitterMessage",isIncubateGoalNotReached:u.getIsGoalNotReached,emailContent:"getEmailContent",groupBuyingEmailContent:"getGroupBuyingEmailContent",emailUrl:"getEmailUrl"},getShareType:function(){return this.get("isIncubateGoalNotReached")?p.Incubate:this.get("memberType")===n.MemberType.New||this.get("isOrganizer")?p.Regular:p.Referral},getTwitterMessage:function(){var e=this.get("shareType"),t=d[e];if(e==p.Referral){var n=this.get("senderReferral");t=t.replace("%referral%",h(n.recipientDiscount,n.isRecipientDiscountFixed,!0))}return t},getGroupBuyingEmailContent:function(){return this.getEmailUrl(this.getEmailContent(p.GroupBuying))},getEmailContent:function(e){e=e||this.get("shareType");var t,n={shareLink:this.get("shareLink"),referralLink:this.get("referralLink"),senderReferral:this.get("senderReferral"),member:this.get("member")},r="Join Me in Eating Deliciously Local!";if(e===p.Regular||!n.senderReferral)t=a;e===p.Incubate&&(t=f);if(e===p.Referral&&n.senderReferral){t=l;var i=h(n.senderReferral.recipientDiscount,n.senderReferral.isRecipientDiscountFixed,!0);r="Get "+i+" off farm-fresh groceries from Farmigo!"}return e===p.GroupBuying&&(t=c),{body:t(n),subject:r}},getEmailUrl:function(e){e=e||this.get("emailContent");var t="mailto:";return t+="?subject="+encodeURIComponent(e.subject),t+="&body="+encodeURIComponent(e.body),t}});return v.Type=p,v}),define("common/share/share",["require","hbs/handlebars","common/marketModel","hbs!common/share/emailTemplate","modules/sharing/sharingModel","common/dataService","hbs!common/share/incubateEmailTemplate","hbs!common/share/referralEmailTemplate","hbs!common/share/groupBuyingEmailTemplate","common/handlebars/helpers/discountHelper","common/enums","common/globals"],function(e){function w(){var e=v().get("shareType");if(e!=p.Referral)return;c.eventBus.trigger("analytics:event","referral","Referral shared from update order page",e)}var t=e("hbs/handlebars"),n=e("common/marketModel"),r=e("hbs!common/share/emailTemplate"),i=e("modules/sharing/sharingModel"),s=e("common/dataService"),o=e("hbs!common/share/incubateEmailTemplate"),u=e("hbs!common/share/referralEmailTemplate"),a=e("hbs!common/share/groupBuyingEmailTemplate"),f=e("common/handlebars/helpers/discountHelper"),l=e("common/enums"),c=e("common/globals"),h="Join Me in Eating Deliciously Local!",p={Regular:"Regular",Incubate:"Incubate",Referral:"Referral",GroupBuying:"GroupBuying"},d={facebook:{name:"welcome share",medium:"facebook",source:"organizer"},twitter:{name:"welcome share",medium:"twitter",source:"organizer"}},v=function(){return new i(s.getMarketData())},m=function(){w("facebook");var t=v(),n=t.get("shareType")===p.Referral?t.get("referralLink"):t.get("shareLink");window.open("http://www.facebook.com/sharer/sharer.php?u="+n,"facebook_share","height=320, width=640, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no")},g=function(){w("tweet");var t=v(),n=t.get("shareType")===p.Referral?t.get("referralLink"):t.get("shareLink"),r=t.get("twitterMessage"),i="https://twitter.com/share?url="+encodeURIComponent(n)+"&text="+encodeURIComponent(r);window.open(i,"tweeter","height=420, width=640, toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no")},y=function(e,t,n,r){var i=e+"?"+"utm_source="+r+"&utm_medium="+t+"&utm_campaign="+n;return i},b=function(){w("email");var e=v(),t=600,n=e.get("emailUrl");window.open(n,"email","left="+($(window).width()-t)/2+", top=50, width="+t+", height=500")};return{shareWithFacebook:m,sendTweet:g,email:b,type:p}}),define("modules/sharing/sharingView",["require","marionette","hbs!modules/sharing/sharingTemplate","common/utils","common/share/share","modules/sharing/sharingModel","common/dataService"],function(e){var t=e("marionette"),n=e("hbs!modules/sharing/sharingTemplate"),r=e("common/utils"),i=e("common/share/share"),s=e("modules/sharing/sharingModel"),o=e("common/dataService"),u=t.ItemView.extend({template:n,ui:{shareLink:".share-link"},events:{"click button.email":"_onEmailClicked","click button.share.facebook":"_onFacebookShare","click button.share.twitter":"_onTwitterShare"},onRender:function(){r.makeAutoSelect(this.ui.shareLink)},onShow:function(){this.ui.shareLink.focus()},_onEmailClicked:function(){this.trigger("email")},_onFacebookShare:function(){i.shareWithFacebook(),this.trigger("facebookShare")},_onTwitterShare:function(){i.sendTweet(),this.trigger("twitterShare")}});return{newView:function(e){var t=new s(_.extend({sharingLink:e},o.getMarketData()));return new u({model:t})}}}),define("modules/referral/referralSenderModalView",["require","marionette","hbs!modules/referral/referralSenderModalTemplate","modules/sharing/sharingView","common/share/share"],function(e){var t=e("marionette"),n=e("hbs!modules/referral/referralSenderModalTemplate"),r=e("modules/sharing/sharingView"),i=e("common/share/share"),s=t.LayoutView.extend({template:n,regions:{share:"#referral-sender-share-region"},onRender:function(){var e=r.newView(this.model.get("senderReferral").shareLink);this.share.show(e)}});return s}),define("common/handlebars/helpers/versionHelper",["require","hbs/handlebars","common/dataService"],function(e){var t=e("hbs/handlebars"),n=e("common/dataService"),r=function(){return n.serverData.version};return t.registerHelper("versionHelper",r),r}),define("hbs!modules/referral/referralRecipientModalTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/discountHelper","common/handlebars/helpers/versionHelper","common/handlebars/helpers/header_processCommunityNameHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div class="recipient-banner-top">\n	<div class="row">\n		<div class="col-md-7">\n			<h2>Your friend <span class="referred-by">',(o=n.referredBy)?o=o.call(t,{hash:{}}):(o=t&&t.referredBy,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span> just sent you some amazing local food. You must be really special!</h2>\n			<!--<h2><span class="referred-by">',(o=n.referredBy)?o=o.call(t,{hash:{}}):(o=t&&t.referredBy,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+"</span> invites you to try the freshest local products from ",(o=n.area)?o=o.call(t,{hash:{}}):(o=t&&t.area,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'-area farmers & artisans.</h2>-->\n			<p class="intro">Here\'s how it works:</p>\n		</div>\n		<div class="col-md-4 col-md-offset-1 recipient-discount-circle center">\n			<p class="recipient-discount-text1">You get a</p>\n			<p class="recipient-discount-value">',a={hash:{}},s+=l((o=n.discountHelper||t&&t.discountHelper,o?o.call(t,t&&t.recipientDiscount,t&&t.isRecipientDiscountFixed,!0,a):c.call(t,"discountHelper",t&&t.recipientDiscount,t&&t.isRecipientDiscountFixed,!0,a)))+'</p>\n			<!--<p class="recipient-discount-text1">gift credit</p>-->\n			<p class="recipient-discount-text2">gift credit thanks to your friend ',(u=n.referredBy)?u=u.call(t,{hash:{}}):(u=t&&t.referredBy,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'!</p>\n		</div>\n	</div>\n	<div class="row">\n		<div class="col-md-6">\n			<div class="how-it-works-block clearfix">\n				<div class="media">\n					<div class="pull-left">\n						<img class="media-object comp" src="/site/farmigo.com/images/home/how1.svg?version=',a={hash:{}},s+=l((o=n.versionHelper||t&&t.versionHelper,o?o.call(t,1,a):c.call(t,"versionHelper",1,a)))+'">\n					</div>\n					<div class="media-body how-it-works-step center">\n						<p class="how-it-works-step-no">1</p>\n						<p class="how-it-works-step-text">Place your order online</p>\n					</div>\n				</div>\n			</div>\n		</div>\n		<div class="col-md-6">\n			<div class="how-it-works-block clearfix">\n				<div class="media">\n					<div class="pull-left">\n						<img class="media-object" src="/site/farmigo.com/images/home/how2.svg?version=',a={hash:{}},s+=l((o=n.versionHelper||t&&t.versionHelper,o?o.call(t,1,a):c.call(t,"versionHelper",1,a)))+'">\n					</div>\n					<div class="media-body how-it-works-step center">\n                        <p class="how-it-works-step-no">2</p>\n						<p class="how-it-works-step-text">Pick up in your local community</p>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n<div class="recipient-banner-bottom">\n	<div class="row start-shopping-pre">\n		<div class="col-md-12">\n			<p class="center">To start shopping choose your pick-up location:</p>\n		</div>\n	</div>\n	<div class="row start-shopping">\n		<div class="col-md-6">\n			<button class="button big start-shopping-default-community btn-block" data-dismiss="modal">\n				<p class="start-shopping-title" ellipsis>',a={hash:{}},s+=l((o=n.header_processCommunityNameHelper||t&&t.header_processCommunityNameHelper,o?o.call(t,t&&t.communityName,a):c.call(t,"header_processCommunityNameHelper",t&&t.communityName,a)))+'</p>\n				<p class="start-shopping-text" ellipsis>',(u=n.address)?u=u.call(t,{hash:{}}):(u=t&&t.address,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</p>\n			</button>\n		</div>\n		<div class="col-md-6">\n			<button class="button big start-shopping-choose-community btn-block">\n				<p class="start-shopping-title">Another Community</p>\n				<p class="start-shopping-text">Browse over 100 pick-up spots</p>\n			</button>\n		</div>\n	</div>\n</div>\n\n\n',s});return n}),define("modules/referral/referralRecipientModalView",["require","marionette","common/globals","hbs!modules/referral/referralRecipientModalTemplate","common/modal/modal","common/utils"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("hbs!modules/referral/referralRecipientModalTemplate"),i=e("common/modal/modal"),s=e("common/utils"),o=t.ItemView.extend({template:r,events:{"click .start-shopping-choose-community":"chooseCommunity"},onRender:function(){var e=this;setTimeout(function(){s.handleEllipsis(e.$el)},1e3)},chooseCommunity:function(){this.trigger("chooseCommunity")}});return o}),define("modules/share/shareModel",["require","backbone","common/enums","common/rawDataModel","common/rawDataModel","common/marketModel","common/dataService","common/globals","common/dataUtils"],function(e){var t=e("backbone"),n=e("common/enums"),r=e("common/rawDataModel"),r=e("common/rawDataModel"),i=e("common/marketModel"),s=e("common/dataService"),o=e("common/globals"),u=e("common/dataUtils"),a,f=new i;o.eventBus.on("dataUpdated",function(){f.synchData()});var l=r.Model.extend({idAttribute:"sample_ID",rawValues:{key:new r.Value("key"),quantity:new r.Value("quantity"),title:new r.Value("title"),tags:new r.Value("tags"),description:new r.Value("description"),unit:new r.Value("unit"),unitQuantity:new r.Value("unitQuantity"),imageURL:new r.Value("imageURL"),isNonLocal:new r.Value("isNonLocal"),isSoldOut:new r.Value("isSoldOut"),bundleComponents:new r.Value("bundleComponents"),categoryKey:new r.Value("categoryKey"),subCategoryKey:new r.Value("subCategoryKey"),promotedNewMemberDiscount:new r.Value("promotedNewMemberDiscount"),promotedExistReferralMemberDiscount:new r.Value("promotedExistReferralMemberDiscount"),hideProducerLink:new r.Value("hideProducerLink"),isSmallDesktop:new r.Value("isSmallDesktop"),singleItem:new r.Value("singleItem"),badges:new r.Value("badges"),servingSize:new r.Value("servingSize"),servingUnit:new r.Value("servingUnit"),crossSellingItemsKeys:new r.Value("crossSellingItemsKeys")},readers:{dsId:(new r.Value("id")).getValue,maxPerMember:(new r.Value("maxPerMember")).getValue,isTempUnavailable:function(){return this.rawData.status==n.ShareStatus.TEMPORALLY_UNAVAILABLE},producerKey:(new r.Value("producerKey")).getValue,producerId:(new r.Value("producerId")).getValue,producerTitle:"getProducerTitle",marketProducerName:(new r.Value("marketProducerName")).getValue,producerImageUrl:"getImageUrl",producerDescription:"getDescription",producer:"getProducer",isAutoCouponApplied:u.isAutoCouponApplied,isBundle:"getIsBundle",isValuePack:(new r.Value("isValuePack")).getValue,previousPrice:(new r.Value("previousPrice")).getValue,volumeDiscounts:"getVolumeDiscounts",pricePerServingUnit:"getPricePerServingUnit",hasActiveVolumeDiscount:"hasActiveVolumeDiscount",canAddShare:function(){return!f.get("orderLock").isOrderLocked&&f.get("pickupSite").status!=n.EnumStatus.Pending&&!this.get("isTempUnavailable")&&!this.get("isSoldOut")},isCutOff:function(){return f.get("orderLock").isOrderLocked},memberDiscount:function(){return this.get("isTempUnavailable")||this.get("isSoldOut")?0:f.get("isLoginOptimizedFlow")||f.get("hasOrders")||u.getHasReferral()||u.isAutoCouponApplied()?this.get("promotedExistReferralMemberDiscount"):this.get("promotedNewMemberDiscount")},hasDiscount:function(){return this.get("previousPrice")||this.get("memberDiscount")||this.get("hasActiveVolumeDiscount")},hasActiveVolumeDiscount:function(){var e=this.get("volumeDiscounts"),t;if(e&&e.length){var n=this.get("quantity");for(var r=0;r<e.length;r++)n>=e[r].numberOfItems&&(t=e[r])}return t},discountPrice:function(){return this.get("previousPrice")||this.get("priceBeforeDiscount")},priceBeforeDiscount:function(){return this.rawData.price},price:function(){var e,t=this.get("hasActiveVolumeDiscount");if(t){e=t.value;var n=t.isFixed?this.get("priceBeforeDiscount")-e:this.get("priceBeforeDiscount")*(100-e)/100;return n}return e=this.get("memberDiscount")||0,this.get("priceBeforeDiscount")*(100-e)/100},hasOrders:function(){return f.get("hasOrders")}},getProducerTitle:function(){return(this.get("producer")||{}).title},getImageUrl:function(){return(this.get("producer")||{}).imageUrl},getDescription:function(){return(this.get("producer")||{}).description},getProducer:function(){var e=s.getMarketData("producers");return e[this.get("producerKey")]},getIsBundle:function(){return this.rawData.itemType==="Bundle"},getVolumeDiscounts:function(){return u.getVolumeDiscounts(this.rawData.volumeDiscounts,this.get("maxPerMember"))},getPricePerServingUnit:function(){var e=parseFloat(this.rawData.pricePerServingUnit),t=this.get("hasActiveVolumeDiscount");return t&&t.value&&e&&(e=e*(100-t.value)/100),e}});return l}),define("common/mixpanel",["require","common/dataService","common/marketModel","modules/share/shareModel","common/globals"],function(e){var t=e("common/dataService"),n=e("common/marketModel"),r=e("modules/share/shareModel"),i=e("common/globals"),s=function(e){mixpanel.register({"Registration Path":e}),mixpanel.people.set_once({"Member path":e})},o=function(){var e=new n,i;e.get("isCouponAppliedNow")&&(i=e.get("coupon"),i.couponType=="Voucher"?f(i.voucherCampaignName):i.isSingleUse?u():a(i.id)),e.get("order").forEach(function(n){var i=t.getSharesMap(),s;e.get("previousOrderMap")[n.shareKey]||(s=new r(i[n.shareKey]),s.get("memberDiscount")>0&&l(s.get("title")))})},u=function(){mixpanel.register({"Discount Used":"Single use Coupon"}),mixpanel.people.increment("Single use Coupon Used")},a=function(e){mixpanel.register({"Discount Used":"Coupon"}),mixpanel.people.append("Coupons",e),mixpanel.people.increment("Coupon Used")},f=function(e){mixpanel.register({"Discount Used":"Voucher"}),mixpanel.people.append("Vouchers",e),mixpanel.people.increment("Voucher Used")},l=function(e){mixpanel.register({"Discount Used":"Promoted Item"}),mixpanel.people.append("Promoted Items",e),mixpanel.people.increment("Promoted Items Purchased")},c=function(e){var n=t.getMarketData(),r="New";n.member&&(mixpanel.identify(n.member.email),window.__insp&&(window.__insp.push(["identify",n.member.email]),window.__insp.push(["tagSession",{email:n.member.email}])),n.subscription?n.subscription.isCanceled?r="Cancelled":r="Existing":r="Partial"),mixpanel.register({"Member Type":r}),i.eventBus.trigger("analytics:set","dimension6",r),n.member&&i.eventBus.trigger("analytics:event","Login",e?"login-cookie":"login-successful","market")},h=function(e){mixpanel.identify(e)},p=function(e,t){mixpanel.track(e,t)},d=function(e){mixpanel.register(e)};return{setRegistrationPath:s,trackDiscounts:o,trackMemberLogin:c,identify:h,track:p,register:d}}),define("modules/referral/referralModule",["require","jquery","marionette","common/globals","common/utils","common/modal/modal","common/popover/popover","common/nav","common/dataService","modules/referral/referralModel","modules/referral/referralSenderModalView","modules/referral/referralRecipientModalView","common/mixpanel"],function(e){var t=e("jquery"),n=e("marionette"),r=e("common/globals"),i=e("common/utils"),s=e("common/modal/modal"),o=e("common/popover/popover"),u=e("common/nav"),a=e("common/dataService"),f=e("modules/referral/referralModel"),l=e("modules/referral/referralSenderModalView"),c=e("modules/referral/referralRecipientModalView"),h=e("common/mixpanel"),p=n.Controller.extend({initialize:function(){this._isCanShowSenderModal=!0,this.listenTo(r.eventBus,{"header:rendered":this._rerenderSenderPopover})},showSenderModal:function(e,t,n){if(!t||this._isCanShowSenderModal)this._senderOptions={className:"sender-referral-modal",isShow:!0,isAuto:t,isOnce:!n,key:"senderReferral"},this._model=new f(a.getMarketData()),i.clientViewPort.isXs()||i.clientViewPort.isSm()?s.show(this._getSenderView(),this._senderOptions):(this._senderLinkSelector=e,this._renderSenderPopover())},hideSenderModal:function(){i.clientViewPort.isXs()||i.clientViewPort.isSm()?s.close():this._popoverInstance&&this._popoverInstance.hide(),this._isCanShowSenderModal=!1},_renderSenderPopover:function(){var e=this._getSenderView();e.render(),this._popoverInstance=o.create(t(this._senderLinkSelector),e,this._senderOptions)},_rerenderSenderPopover:function(){this._model=new f(a.getMarketData()),this._model.get("senderReferral")&&this._senderLinkSelector&&!i.clientViewPort.isXs()&&(this._senderOptions.isShow=!1,this._renderSenderPopover())},_getSenderView:function(){return new l({model:this._model})},setGotRecipient:function(){this._isGotRecipientModal=!0},showRecipientModal:function(e){var n=this,e=this.ifShouldShowRecipientModal,i=a.getReferralInstance();f.setIsRecipient(e||i),(e||i)&&f.canBeRecipient()&&!(a.getMarketData("subscription")||{}).referralDiscount&&(i||this.setGotRecipient(),a.setReferralInstance(e||i).done(function(){h.setRegistrationPath("Referral Program"),r.eventBus.trigger("referral:recipient:got-discount");if(!i){var e=t.cookie("source");r.eventBus.trigger("analytics:pageView","market/referral-recipient-modal"),r.eventBus.trigger("analytics:heap:track","Referral - Recipient modal view",{source:e});var o=new c({model:new f(a.getMarketData())});s.show(o,{className:"recipient-referral-modal",closeCallback:function(){this._isGotRecipientModal&&r.eventBus.trigger("referral:recipient:closeModal")}.bind(n)}),o.on({chooseCommunity:function(){var e=a.getMarketData("pickupSite").zipCode;u.navigate(u.PageEnum.ChooseCommunity,undefined,u.PageParam.Location+"="+e),n._isGotRecipientModal=!1,s.close()}})}}))},ifShouldShowRecipientModal:function(){var e=u.getParams(),t=e[u.PageParam.ReferralInstanceKey];return t},isGotRecipientModal:function(){return this._isGotRecipientModal}}),d;return{getInstance:function(){return d===undefined&&(d=new p),d}}}),define("hbs!modules/manageDeliveries/manageDeliveriesTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="manage-deliveries">\n	<div class="header">\n		<h2 class="title">Manage Deliveries</h2>\n		<p class="message">Let us know in which dates you don\'t want to get your deliveries</p>\n	</div>\n	<form role="form" id="manage-deliveries-form">\n		<div class="row">\n			<div class="form-group">\n				<div class="hold validatable" data-hold-index="1"  data-parsley-validate-if-empty\n					 data-parsley-holddates="1" data-parsley-holdperiod="1" data-parsley-holdoverlap="1">\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="from form-control" placeholder="From"\n								   data-date-autoclose="true" data-field-name="from1"\n								   data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.from1,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.from1,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="to form-control" placeholder="To"\n								   data-date-autoclose="true" data-field-name="to1"\n								   data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.to1,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.to1,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-2">\n						<a class="remove-button"><span class="sr-only">Delete</span></a>\n					</div>\n				</div>\n			</div>\n		</div>\n		<div class="row">\n			<div class="form-group">\n				<div class="hold validatable" data-hold-index="2"  data-parsley-validate-if-empty\n					 data-parsley-holddates="2" data-parsley-holdperiod="2" data-parsley-holdoverlap="2">\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="from form-control" placeholder="From" data-date-autoclose="true" data-field-name="from2" data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.from2,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.from2,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="to form-control" placeholder="To" data-date-autoclose="true" data-field-name="to2" data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.to2,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.to2,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-2">\n						<a class="remove-button"><span class="sr-only">Delete</span></a>\n					</div>\n				</div>\n			</div>\n		</div>\n		<div class="row">\n			<div class="form-group">\n				<div class="hold validatable" data-hold-index="3"  data-parsley-validate-if-empty\n					 data-parsley-holddates="3" data-parsley-holdperiod="3" data-parsley-holdoverlap="3">\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="from form-control" placeholder="From" data-date-autoclose="true" data-field-name="from3" data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.from3,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.from3,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-5">\n						<div class="form-group">\n							<input type="text" class="to form-control" placeholder="To" data-date-autoclose="true" data-field-name="to3" data-date-format="M dd, yyyy" value="',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.to3,"%b %d, %Y",u):a.call(t,"formatDateHelper",t&&t.to3,"%b %d, %Y",u)))+'">\n						</div>\n					</div>\n					<div class="col-sm-2">\n						<a class="remove-button"><span class="sr-only">Delete</span></a>\n					</div>\n				</div>\n			</div>\n		</div>\n\n		<div class="row">\n			<div class="pull-right">\n				<div class="col-sm-12">\n					<button class="button light cancel" data-dismiss="modal">Cancel</button>\n					<button class="button user submit" loading-animation type="button" disabled>Save</button>\n				</div>\n			</div>\n		</div>\n	</form>\n</div>',s});return n}),!function(e){typeof define=="function"&&define.amd?define("parsley",["jquery"],e):e(jQuery)}(function(e){"undefined"==typeof e&&"undefined"!=typeof window.jQuery&&(e=window.jQuery);var t={attr:function(e,t,n){var r,i={},s=this.msieversion(),o=new RegExp("^"+t,"i");if("undefined"==typeof e||"undefined"==typeof e[0])return{};for(var u in e[0].attributes){r=e[0].attributes[u];if("undefined"!=typeof r&&null!==r&&(!s||s>=8||r.specified)&&o.test(r.name)){if("undefined"!=typeof n&&(new RegExp(n+"$","i")).test(r.name))return!0;i[this.camelize(r.name.replace(t,""))]=this.deserializeValue(r.value)}}return"undefined"==typeof n?i:!1},setAttr:function(e,t,n,r){e[0].setAttribute(this.dasherize(t+n),String(r))},get:function(e,t){var n=0,r=(t||"").split(".");while(this.isObject(e)||this.isArray(e)){e=e[r[n++]];if(n===r.length)return e}return undefined},hash:function(e){return String(Math.random()).substring(2,e?e+2:9)},isArray:function(e){return Object.prototype.toString.call(e)==="[object Array]"},isObject:function(e){return e===Object(e)},deserializeValue:function(t){var n;try{return t?t=="true"||(t=="false"?!1:t=="null"?null:isNaN(n=Number(t))?/^[\[\{]/.test(t)?e.parseJSON(t):t:n):t}catch(r){return t}},camelize:function(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})},dasherize:function(e){return e.replace(/::/g,"/").replace(/([A-Z]+)([A-Z][a-z])/g,"$1_$2").replace(/([a-z\d])([A-Z])/g,"$1_$2").replace(/_/g,"-").toLowerCase()},msieversion:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");return t>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)?parseInt(e.substring(t+5,e.indexOf(".",t)),10):0}},n={namespace:"data-parsley-",inputs:"input, textarea, select, .validatable",excluded:"input[type=button], input[type=submit], input[type=reset], input[type=hidden]",priorityEnabled:!0,uiEnabled:!0,validationThreshold:3,focus:"first",trigger:!1,errorClass:"parsley-error",successClass:"parsley-success",classHandler:function(e){},errorsContainer:function(e){},errorsWrapper:'<ul class="parsley-errors-list"></ul>',errorTemplate:"<li></li>"},r=function(){};r.prototype={asyncSupport:!1,actualizeOptions:function(){return this.options=this.OptionsFactory.get(this),this},validateThroughValidator:function(e,t,n){return window.ParsleyValidator.validate.apply(window.ParsleyValidator,[e,t,n])},subscribe:function(t,n){return e.listenTo(this,t.toLowerCase(),n),this},unsubscribe:function(t){return e.unsubscribeTo(this,t.toLowerCase()),this},reset:function(){if("ParsleyForm"!==this.__class__)return e.emit("parsley:field:reset",this);for(var t=0;t<this.fields.length;t++)e.emit("parsley:field:reset",this.fields[t]);e.emit("parsley:form:reset",this)},destroy:function(){if("ParsleyForm"!==this.__class__){this.$element.removeData("Parsley"),this.$element.removeData("ParsleyFieldMultiple"),e.emit("parsley:field:destroy",this);return}for(var t=0;t<this.fields.length;t++)this.fields[t].destroy();this.$element.removeData("Parsley"),e.emit("parsley:form:destroy",this)}},function(e){var t=function(e){return this.__class__="Validator",this.__version__="0.5.8",this.options=e||{},this.bindingKey=this.options.bindingKey||"_validatorjsConstraint",this};t.prototype={constructor:t,validate:function(e,t,n){if("string"!=typeof e&&"object"!=typeof e)throw new Error("You must validate an object or a string");return"string"==typeof e||o(e)?this._validateString(e,t,n):this.isBinded(e)?this._validateBindedObject(e,t):this._validateObject(e,t,n)},bind:function(e,t){if("object"!=typeof e)throw new Error("Must bind a Constraint to an object");return e[this.bindingKey]=new n(t),this},unbind:function(e){return"undefined"==typeof e._validatorjsConstraint?this:(delete e[this.bindingKey],this)},isBinded:function(e){return"undefined"!=typeof e[this.bindingKey]},getBinded:function(e){return this.isBinded(e)?e[this.bindingKey]:null},_validateString:function(e,t,n){var s,u=[];o(t)||(t=[t]);for(var a=0;a<t.length;a++){if(!(t[a]instanceof i))throw new Error("You must give an Assert or an Asserts array to validate a string");s=t[a].check(e,n),s instanceof r&&u.push(s)}return u.length?u:!0},_validateObject:function(e,t,r){if("object"!=typeof t)throw new Error("You must give a constraint to validate an object");return t instanceof n?t.check(e,r):(new n(t)).check(e,r)},_validateBindedObject:function(e,t){return e[this.bindingKey].check(e,t)}},t.errorCode={must_be_a_string:"must_be_a_string",must_be_an_array:"must_be_an_array",must_be_a_number:"must_be_a_number",must_be_a_string_or_array:"must_be_a_string_or_array"};var n=function(e,t){this.__class__="Constraint",this.options=t||{},this.nodes={};if(e)try{this._bootstrap(e)}catch(n){throw new Error("Should give a valid mapping object to Constraint",n,e)}return this};n.prototype={constructor:n,check:function(e,t){var n,r={};for(var u in this.options.strict?this.nodes:e)if(this.options.strict?this.has(u,e):this.has(u)){n=this._check(u,e[u],t);if(o(n)&&n.length>0||!o(n)&&!s(n))r[u]=n}else if(this.options.strict)try{(new i).HaveProperty(u).validate(e)}catch(a){r[u]=a}return s(r)?!0:r},add:function(e,t){if(t instanceof i||o(t)&&t[0]instanceof i)return this.nodes[e]=t,this;if("object"==typeof t&&!o(t))return this.nodes[e]=t instanceof n?t:new n(t),this;throw new Error("Should give an Assert, an Asserts array, a Constraint",t)},has:function(e,t){return t="undefined"!=typeof t?t:this.nodes,"undefined"!=typeof t[e]},get:function(e,t){return this.has(e)?this.nodes[e]:t||null},remove:function(e){var t=[];for(var n in this.nodes)n!==e&&(t[n]=this.nodes[n]);return this.nodes=t,this},_bootstrap:function(e){if(e instanceof n)return this.nodes=e.nodes;for(var t in e)this.add(t,e[t])},_check:function(e,t,r){if(this.nodes[e]instanceof i)return this._checkAsserts(t,[this.nodes[e]],r);if(o(this.nodes[e]))return this._checkAsserts(t,this.nodes[e],r);if(this.nodes[e]instanceof n)return this.nodes[e].check(t,r);throw new Error("Invalid node",this.nodes[e])},_checkAsserts:function(e,t,n){var r,i=[];for(var s=0;s<t.length;s++)r=t[s].check(e,n),"undefined"!=typeof r&&!0!==r&&i.push(r);return i}};var r=function(e,t,n){this.__class__="Violation";if(!(e instanceof i))throw new Error("Should give an assertion implementing the Assert interface");this.assert=e,this.value=t,"undefined"!=typeof n&&(this.violation=n)};r.prototype={show:function(){var e={assert:this.assert.__class__,value:this.value};return this.violation&&(e.violation=this.violation),e},__toString:function(){return"undefined"!=typeof this.violation&&(this.violation='", '+this.getViolation().constraint+" expected was "+this.getViolation().expected),this.assert.__class__+' assert failed for "'+this.value+this.violation||""},getViolation:function(){var e,t;for(e in this.violation)t=this.violation[e];return{constraint:e,expected:t}}};var i=function(e){return this.__class__="Assert",this.__parentClass__=this.__class__,this.groups=[],"undefined"!=typeof e&&this.addGroup(e),this};i.prototype={construct:i,check:function(e,t){if(t&&!this.hasGroup(t))return;if(!t&&this.hasGroups())return;try{return this.validate(e,t)}catch(n){return n}},hasGroup:function(e){return o(e)?this.hasOneOf(e):"Any"===e?!0:this.hasGroups()?-1!==this.groups.indexOf(e):"Default"===e},hasOneOf:function(e){for(var t=0;t<e.length;t++)if(this.hasGroup(e[t]))return!0;return!1},hasGroups:function(){return this.groups.length>0},addGroup:function(e){return o(e)?this.addGroups(e):(this.hasGroup(e)||this.groups.push(e),this)},removeGroup:function(e){var t=[];for(var n=0;n<this.groups.length;n++)e!==this.groups[n]&&t.push(this.groups[n]);return this.groups=t,this},addGroups:function(e){for(var t=0;t<e.length;t++)this.addGroup(e[t]);return this},HaveProperty:function(e){return this.__class__="HaveProperty",this.node=e,this.validate=function(e){if("undefined"==typeof e[this.node])throw new r(this,e,{value:this.node});return!0},this},Blank:function(){return this.__class__="Blank",this.validate=function(e){if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(""!==e.replace(/^\s+/g,"").replace(/\s+$/g,""))throw new r(this,e);return!0},this},Callback:function(e){this.__class__="Callback",this.arguments=Array.prototype.slice.call(arguments),1===this.arguments.length?this.arguments=[]:this.arguments.splice(0,1);if("function"!=typeof e)throw new Error("Callback must be instanciated with a function");return this.fn=e,this.validate=function(e){var t=this.fn.apply(this,[e].concat(this.arguments));if(!0!==t)throw new r(this,e,{result:t});return!0},this},Choice:function(e){this.__class__="Choice";if(!o(e)&&"function"!=typeof e)throw new Error("Choice must be instanciated with an array or a function");return this.list=e,this.validate=function(e){var t="function"==typeof this.list?this.list():this.list;for(var n=0;n<t.length;n++)if(e===t[n])return!0;throw new r(this,e,{choices:t})},this},Collection:function(e){return this.__class__="Collection",this.constraint="undefined"!=typeof e?new n(e):!1,this.validate=function(e,n){var i,u=new t,a=0,f={},l=this.groups.length?this.groups:n;if(!o(e))throw new r(this,array,{value:t.errorCode.must_be_an_array});for(var c=0;c<e.length;c++)i=this.constraint?u.validate(e[c],this.constraint,l):u.validate(e[c],l),s(i)||(f[a]=i),a++;return s(f)?!0:f},this},Count:function(e){return this.__class__="Count",this.count=e,this.validate=function(e){if(!o(e))throw new r(this,e,{value:t.errorCode.must_be_an_array});var n="function"==typeof this.count?this.count(e):this.count;if(isNaN(Number(n)))throw new Error("Count must be a valid interger",n);if(n!==e.length)throw new r(this,e,{count:n});return!0},this},Email:function(){return this.__class__="Email",this.validate=function(e){var n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(!n.test(e))throw new r(this,e);return!0},this},Eql:function(e){this.__class__="Eql";if("undefined"==typeof e)throw new Error("Equal must be instanciated with an Array or an Object");return this.eql=e,this.validate=function(e){var t="function"==typeof this.eql?this.eql(e):this.eql;if(!u.eql(t,e))throw new r(this,e,{eql:t});return!0},this},EqualTo:function(e){this.__class__="EqualTo";if("undefined"==typeof e)throw new Error("EqualTo must be instanciated with a value or a function");return this.reference=e,this.validate=function(e){var t="function"==typeof this.reference?this.reference(e):this.reference;if(t!==e)throw new r(this,e,{value:t});return!0},this},GreaterThan:function(e){this.__class__="GreaterThan";if("undefined"==typeof e)throw new Error("Should give a threshold value");return this.threshold=e,this.validate=function(e){if(""===e||isNaN(Number(e)))throw new r(this,e,{value:t.errorCode.must_be_a_number});if(this.threshold>=e)throw new r(this,e,{threshold:this.threshold});return!0},this},GreaterThanOrEqual:function(e){this.__class__="GreaterThanOrEqual";if("undefined"==typeof e)throw new Error("Should give a threshold value");return this.threshold=e,this.validate=function(e){if(""===e||isNaN(Number(e)))throw new r(this,e,{value:t.errorCode.must_be_a_number});if(this.threshold>e)throw new r(this,e,{threshold:this.threshold});return!0},this},InstanceOf:function(e){this.__class__="InstanceOf";if("undefined"==typeof e)throw new Error("InstanceOf must be instanciated with a value");return this.classRef=e,this.validate=function(e){if(1!=e instanceof this.classRef)throw new r(this,e,{classRef:this.classRef});return!0},this},IPv4:function(){return this.__class__="IPv4",this.validate=function(e){var n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(!n.test(e))throw new r(this,e);return!0},this},Length:function(e){this.__class__="Length";if(!e.min&&!e.max)throw new Error("Lenth assert must be instanciated with a { min: x, max: y } object");return this.min=e.min,this.max=e.max,this.validate=function(e){if("string"!=typeof e&&!o(e))throw new r(this,e,{value:t.errorCode.must_be_a_string_or_array});if("undefined"!=typeof this.min&&this.min===this.max&&e.length!==this.min)throw new r(this,e,{min:this.min,max:this.max});if("undefined"!=typeof this.max&&e.length>this.max)throw new r(this,e,{max:this.max});if("undefined"!=typeof this.min&&e.length<this.min)throw new r(this,e,{min:this.min});return!0},this},LessThan:function(e){this.__class__="LessThan";if("undefined"==typeof e)throw new Error("Should give a threshold value");return this.threshold=e,this.validate=function(e){if(""===e||isNaN(Number(e)))throw new r(this,e,{value:t.errorCode.must_be_a_number});if(this.threshold<=e)throw new r(this,e,{threshold:this.threshold});return!0},this},LessThanOrEqual:function(e){this.__class__="LessThanOrEqual";if("undefined"==typeof e)throw new Error("Should give a threshold value");return this.threshold=e,this.validate=function(e){if(""===e||isNaN(Number(e)))throw new r(this,e,{value:t.errorCode.must_be_a_number});if(this.threshold<e)throw new r(this,e,{threshold:this.threshold});return!0},this},Mac:function(){return this.__class__="Mac",this.validate=function(e){var n=/^(?:[0-9A-F]{2}:){5}[0-9A-F]{2}$/i;if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(!n.test(e))throw new r(this,e);return!0},this},NotNull:function(){return this.__class__="NotNull",this.validate=function(e){if(null===e||"undefined"==typeof e)throw new r(this,e);return!0},this},NotBlank:function(){return this.__class__="NotBlank",this.validate=function(e){if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(""===e.replace(/^\s+/g,"").replace(/\s+$/g,""))throw new r(this,e);return!0},this},Null:function(){return this.__class__="Null",this.validate=function(e){if(null!==e)throw new r(this,e);return!0},this},Range:function(e,t){this.__class__="Range";if("undefined"==typeof e||"undefined"==typeof t)throw new Error("Range assert expects min and max values");return this.min=e,this.max=t,this.validate=function(e){try{return"string"==typeof e&&isNaN(Number(e))||o(e)?(new i).Length({min:this.min,max:this.max}).validate(e):(new i).GreaterThanOrEqual(this.min).validate(e)&&(new i).LessThanOrEqual(this.max).validate(e),!0}catch(t){throw new r(this,e,t.violation)}return!0},this},Regexp:function(e,n){this.__class__="Regexp";if("undefined"==typeof e)throw new Error("You must give a regexp");return this.regexp=e,this.flag=n||"",this.validate=function(e){if("string"!=typeof e)throw new r(this,e,{value:t.errorCode.must_be_a_string});if(!(new RegExp(this.regexp,this.flag)).test(e))throw new r(this,e,{regexp:this.regexp,flag:this.flag});return!0},this},Required:function(){return this.__class__="Required",this.validate=function(e){if("undefined"==typeof e)throw new r(this,e);try{"string"==typeof e?(new i).NotNull().validate(e)&&(new i).NotBlank().validate(e):!0===o(e)&&(new i).Length({min:1}).validate(e)}catch(t){throw new r(this,e)}return!0},this},Unique:function(e){return this.__class__="Unique","object"==typeof e&&(this.key=e.key),this.validate=function(e){var n,i=[];if(!o(e))throw new r(this,e,{value:t.errorCode.must_be_an_array});for(var s=0;s<e.length;s++){n="object"==typeof e[s]?e[s][this.key]:e[s];if("undefined"==typeof n)continue;if(-1!==i.indexOf(n))throw new r(this,e,{value:n});i.push(n)}return!0},this}},e.Assert=i,e.Validator=t,e.Violation=r,e.Constraint=n,Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>1&&(r=Number(arguments[1]),r!=r?r=0:r!==0&&r!=Infinity&&r!=-Infinity&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1});var s=function(e){for(var t in e)return!1;return!0},o=function(e){return Object.prototype.toString.call(e)==="[object Array]"},u={eql:function(e,t){if(e===t)return!0;if("undefined"!=typeof Buffer&&Buffer.isBuffer(e)&&Buffer.isBuffer(t)){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():typeof e!="object"&&typeof t!="object"?e==t:this.objEquiv(e,t)},isUndefinedOrNull:function(e){return e===null||typeof e=="undefined"},isArguments:function(e){return Object.prototype.toString.call(e)=="[object Arguments]"},keys:function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},objEquiv:function(e,t){if(this.isUndefinedOrNull(e)||this.isUndefinedOrNull(t))return!1;if(e.prototype!==t.prototype)return!1;if(this.isArguments(e))return this.isArguments(t)?eql(pSlice.call(e),pSlice.call(t)):!1;try{var n=this.keys(e),r=this.keys(t),i,s;if(n.length!==r.length)return!1;n.sort(),r.sort();for(s=n.length-1;s>=0;s--)if(n[s]!=r[s])return!1;for(s=n.length-1;s>=0;s--){i=n[s];if(!this.eql(e[i],t[i]))return!1}return!0}catch(o){return!1}}};"function"==typeof define&&define.amd&&define("validator",[],function(){return e})}("undefined"==typeof exports?this["undefined"!=typeof validatorjs_ns?validatorjs_ns:"Validator"]={}:exports);var i=function(e,t){this.__class__="ParsleyValidator",this.Validator=Validator,this.locale="en",this.init(e||{},t||{})};i.prototype={init:function(t,n){this.catalog=n;for(var r in t)this.addValidator(r,t[r].fn,t[r].priority,t[r].requirementsTransformer);e.emit("parsley:validator:init")},setLocale:function(e){if("undefined"==typeof this.catalog[e])throw new Error(e+" is not available in the catalog");return this.locale=e,this},addCatalog:function(e,t,n){return"object"==typeof t&&(this.catalog[e]=t),!0===n?this.setLocale(e):this},addMessage:function(e,t,n){return"undefined"==typeof this.catalog[e]&&(this.catalog[e]={}),this.catalog[e][t.toLowerCase()]=n,this},validate:function(e,t,n){return(new this.Validator.Validator).validate.apply(new Validator.Validator,arguments)},addValidator:function(t,n,r,i){return this.validators[t.toLowerCase()]=function(t){return e.extend((new Validator.Assert).Callback(n,t),{priority:r,requirementsTransformer:i})},this},updateValidator:function(e,t,n,r){return this.addValidator(e,t,n,r)},removeValidator:function(e){return delete this.validators[e],this},getErrorMessage:function(e){var t;return"type"===e.name?t=this.catalog[this.locale][e.name][e.requirements]:t=this.formatMessage(this.catalog[this.locale][e.name],e.requirements),""!==t?t:this.catalog[this.locale].defaultMessage},formatMessage:function(e,t){if("object"==typeof t){for(var n in t)e=this.formatMessage(e,t[n]);return e}return"string"==typeof e?e.replace(new RegExp("%s","i"),t):""},validators:{notblank:function(){return e.extend((new Validator.Assert).NotBlank(),{priority:2})},required:function(){return e.extend((new Validator.Assert).Required(),{priority:512})},type:function(t){var n;switch(t){case"email":n=(new Validator.Assert).Email();break;case"range":case"number":n=(new Validator.Assert).Regexp("^-?(?:\\d+|\\d{1,3}(?:,\\d{3})+)?(?:\\.\\d+)?$");break;case"integer":n=(new Validator.Assert).Regexp("^-?\\d+$");break;case"digits":n=(new Validator.Assert).Regexp("^\\d+$");break;case"alphanum":n=(new Validator.Assert).Regexp("^\\w+$","i");break;case"url":n=(new Validator.Assert).Regexp("(https?:\\/\\/)?(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*)","i");break;default:throw new Error("validator type `"+t+"` is not supported")}return e.extend(n,{priority:256})},pattern:function(t){var n="";return!/^\/.*\/(?:[gimy]*)$/.test(t)||(n=t.replace(/.*\/([gimy]*)$/,"$1"),t=t.replace(new RegExp("^/(.*?)/"+n+"$"),"$1")),e.extend((new Validator.Assert).Regexp(t,n),{priority:64})},minlength:function(t){return e.extend((new Validator.Assert).Length({min:t}),{priority:30,requirementsTransformer:function(){return"string"==typeof t&&!isNaN(t)?parseInt(t,10):t}})},maxlength:function(t){return e.extend((new Validator.Assert).Length({max:t}),{priority:30,requirementsTransformer:function(){return"string"==typeof t&&!isNaN(t)?parseInt(t,10):t}})},length:function(t){return e.extend((new Validator.Assert).Length({min:t[0],max:t[1]}),{priority:32})},mincheck:function(e){return this.minlength(e)},maxcheck:function(e){return this.maxlength(e)},check:function(e){return this.length(e)},min:function(t){return e.extend((new Validator.Assert).GreaterThanOrEqual(t),{priority:30,requirementsTransformer:function(){return"string"==typeof t&&!isNaN(t)?parseInt(t,10):t}})},max:function(t){return e.extend((new Validator.Assert).LessThanOrEqual(t),{priority:30,requirementsTransformer:function(){return"string"==typeof t&&!isNaN(t)?parseInt(t,10):t}})},range:function(t){return e.extend((new Validator.Assert).Range(t[0],t[1]),{priority:32,requirementsTransformer:function(){for(var e=0;e<t.length;e++)t[e]="string"==typeof t[e]&&!isNaN(t[e])?parseInt(t[e],10):t[e];return t}})},equalto:function(t){return e.extend((new Validator.Assert).EqualTo(t),{priority:256,requirementsTransformer:function(){return e(t).length?e(t).val():t}})}}};var s=function(e){this.__class__="ParsleyUI"};s.prototype={listen:function(){return e.listen("parsley:form:init",this,this.setupForm),e.listen("parsley:field:init",this,this.setupField),e.listen("parsley:field:validated",this,this.reflow),e.listen("parsley:form:validated",this,this.focus),e.listen("parsley:field:reset",this,this.reset),e.listen("parsley:form:destroy",this,this.destroy),e.listen("parsley:field:destroy",this,this.destroy),this},reflow:function(e){if("undefined"==typeof e._ui||!1===e._ui.active)return;var t=this._diff(e.validationResult,e._ui.lastValidationResult);e._ui.lastValidationResult=e.validationResult,e._ui.validatedOnce=!0,this.manageStatusClass(e),this.manageErrorsMessages(e,t),this.actualizeTriggers(e),(t.kept.length||t.added.length)&&"undefined"==typeof e._ui.failedOnce&&this.manageFailingFieldTrigger(e)},getErrorsMessages:function(e){if(!0===e.validationResult)return[];var t=[];for(var n=0;n<e.validationResult.length;n++)t.push(this._getErrorMessage(e,e.validationResult[n].assert));return t},manageStatusClass:function(e){!0===e.validationResult?this._successClass(e):e.validationResult.length>0?this._errorClass(e):this._resetClass(e)},manageErrorsMessages:function(t,n){if("undefined"!=typeof t.options.errorsMessagesDisabled)return;if("undefined"!=typeof t.options.errorMessage)return n.added.length||n.kept.length?(0===t._ui.$errorsWrapper.find(".parsley-custom-error-message").length&&t._ui.$errorsWrapper.append(e(t.options.errorTemplate).addClass("parsley-custom-error-message")),t._ui.$errorsWrapper.addClass("filled").find(".parsley-custom-error-message").html(t.options.errorMessage)):t._ui.$errorsWrapper.removeClass("filled").find(".parsley-custom-error-message").remove();for(var r=0;r<n.removed.length;r++)this.removeError(t,n.removed[r].assert.name,!0);for(r=0;r<n.added.length;r++)this.addError(t,n.added[r].assert.name,undefined,n.added[r].assert,!0);for(r=0;r<n.kept.length;r++)this.updateError(t,n.kept[r].assert.name,undefined,n.kept[r].assert,!0)},addError:function(t,n,r,i,s){t._ui.$errorsWrapper.addClass("filled").append(e(t.options.errorTemplate).addClass("parsley-"+n).html(r||this._getErrorMessage(t,i))),!0!==s&&this._errorClass(t)},updateError:function(e,t,n,r,i){e._ui.$errorsWrapper.addClass("filled").find(".parsley-"+t).html(n||this._getErrorMessage(e,r)),!0!==i&&this._errorClass(e)},removeError:function(e,t,n){e._ui.$errorsWrapper.removeClass("filled").find(".parsley-"+t).remove(),!0!==n&&this.manageStatusClass(e)},focus:function(e){if(!0===e.validationResult||"none"===e.options.focus)return e._focusedField=null;e._focusedField=null;for(var t=0;t<e.fields.length;t++)if(!0!==e.fields[t].validationResult&&e.fields[t].validationResult.length>0&&"undefined"==typeof e.fields[t].options.noFocus){if("first"===e.options.focus)return e._focusedField=e.fields[t].$element,e._focusedField.focus();e._focusedField=e.fields[t].$element}return null===e._focusedField?null:e._focusedField.focus()},_getErrorMessage:function(e,t){var n=t.name+"Message";return"undefined"!=typeof e.options[n]?window.ParsleyValidator.formatMessage(e.options[n],t.requirements):window.ParsleyValidator.getErrorMessage(t)},_diff:function(e,t,n){var r=[],i=[];for(var s=0;s<e.length;s++){var o=!1;for(var u=0;u<t.length;u++)if(e[s].assert.name===t[u].assert.name){o=!0;break}o?i.push(e[s]):r.push(e[s])}return{kept:i,added:r,removed:n?[]:this._diff(t,e,!0).added}},setupForm:function(t){t.$element.on("submit.Parsley",!1,e.proxy(t.onSubmitValidate,t));if(!1===t.options.uiEnabled)return;t.$element.attr("novalidate","")},setupField:function(t){var n={active:!1};if(!1===t.options.uiEnabled)return;n.active=!0,t.$element.attr(t.options.namespace+"id",t.__id__),n.$errorClassHandler=this._manageClassHandler(t),n.errorsWrapperId="parsley-id-"+("undefined"!=typeof t.options.multiple?"multiple-"+t.options.multiple:t.__id__),n.$errorsWrapper=e(t.options.errorsWrapper).attr("id",n.errorsWrapperId),n.lastValidationResult=[],n.validatedOnce=!1,n.validationInformationVisible=!1,t._ui=n,this._insertErrorWrapper(t),this.actualizeTriggers(t)},_manageClassHandler:function(t){if("string"==typeof t.options.classHandler&&e(t.options.classHandler).length)return e(t.options.classHandler);var n=t.options.classHandler(t);return"undefined"!=typeof n&&n.length?n:"undefined"==typeof t.options.multiple||t.$element.is("select")?t.$element:t.$element.parent()},_insertErrorWrapper:function(t){var n;if("string"==typeof t.options.errorsContainer){if(e(t.options.errorsContainer).length)return e(t.options.errorsContainer).append(t._ui.$errorsWrapper);window.console&&window.console.warn&&window.console.warn("The errors container `"+t.options.errorsContainer+"` does not exist in DOM")}else"function"==typeof t.options.errorsContainer&&(n=t.options.errorsContainer(t));return"undefined"!=typeof n&&n.length?n.append(t._ui.$errorsWrapper):"undefined"==typeof t.options.multiple?t.$element.after(t._ui.$errorsWrapper):t.$element.parent().after(t._ui.$errorsWrapper)},actualizeTriggers:function(t){var n=this;t.options.multiple?e("["+t.options.namespace+'multiple="'+t.options.multiple+'"]').each(function(){e(this).off(".Parsley")}):t.$element.off(".Parsley");if(!1===t.options.trigger)return;var r=t.options.trigger.replace(/^\s+/g,"").replace(/\s+$/g,"");if(""===r)return;t.options.multiple?e("["+t.options.namespace+'multiple="'+t.options.multiple+'"]').each(function(){e(this).on(r.split(" ").join(".Parsley ")+".Parsley",!1,e.proxy("function"==typeof t.eventValidate?t.eventValidate:n.eventValidate,t))}):t.$element.on(r.split(" ").join(".Parsley ")+".Parsley",!1,e.proxy("function"==typeof t.eventValidate?t.eventValidate:this.eventValidate,t))},eventValidate:function(e){if((new RegExp("key")).test(e.type)&&!this._ui.validationInformationVisible&&this.getValue().length<=this.options.validationThreshold)return;this._ui.validatedOnce=!0,this.validate()},manageFailingFieldTrigger:function(t){t._ui.failedOnce=!0,t.options.multiple&&e("["+t.options.namespace+'multiple="'+t.options.multiple+'"]').each(function(){if(!(new RegExp("change","i")).test(e(this).parsley().options.trigger||""))return e(this).on("change.ParsleyFailedOnce",!1,e.proxy(t.validate,t))});if(t.$element.is("select")&&!(new RegExp("change","i")).test(t.options.trigger||""))return t.$element.on("change.ParsleyFailedOnce",!1,e.proxy(t.validate,t));if(!(new RegExp("keyup","i")).test(t.options.trigger||""))return t.$element.on("keyup.ParsleyFailedOnce",!1,e.proxy(t.validate,t))},reset:function(t){t.$element.off(".Parsley"),t.$element.off(".ParsleyFailedOnce");if("undefined"==typeof t._ui)return;if("ParsleyForm"===t.__class__)return;t._ui.$errorsWrapper.children().each(function(){e(this).remove()}),this._resetClass(t),t._ui.validatedOnce=!1,t._ui.lastValidationResult=[],t._ui.validationInformationVisible=!1},destroy:function(e){this.reset(e);if("ParsleyForm"===e.__class__)return;"undefined"!=typeof e._ui&&e._ui.$errorsWrapper.remove(),delete e._ui},_successClass:function(e){e._ui.validationInformationVisible=!0,e._ui.$errorClassHandler.removeClass(e.options.errorClass).addClass(e.options.successClass)},_errorClass:function(e){e._ui.validationInformationVisible=!0,e._ui.$errorClassHandler.removeClass(e.options.successClass).addClass(e.options.errorClass)},_resetClass:function(e){e._ui.$errorClassHandler.removeClass(e.options.successClass).removeClass(e.options.errorClass)}};var o=function(n,r,i,s){this.__class__="OptionsFactory",this.__id__=t.hash(4),this.formOptions=null,this.fieldOptions=null,this.staticOptions=e.extend(!0,{},n,r,i,{namespace:s})};o.prototype={get:function(e){if("undefined"==typeof e.__class__)throw new Error("Parsley Instance expected");switch(e.__class__){case"Parsley":return this.staticOptions;case"ParsleyForm":return this.getFormOptions(e);case"ParsleyField":case"ParsleyFieldMultiple":return this.getFieldOptions(e);default:throw new Error("Instance "+e.__class__+" is not supported")}},getFormOptions:function(n){return this.formOptions=t.attr(n.$element,this.staticOptions.namespace),e.extend({},this.staticOptions,this.formOptions)},getFieldOptions:function(n){return this.fieldOptions=t.attr(n.$element,this.staticOptions.namespace),null===this.formOptions&&"undefined"!=typeof n.parent&&(this.formOptions=this.getFormOptions(n.parent)),e.extend({},this.staticOptions,this.formOptions,this.fieldOptions)}};var u=function(n,r){this.__class__="ParsleyForm",this.__id__=t.hash(4);if("OptionsFactory"!==t.get(r,"__class__"))throw new Error("You must give an OptionsFactory instance");this.OptionsFactory=r,this.$element=e(n),this.validationResult=null,this.options=this.OptionsFactory.get(this)};u.prototype={onSubmitValidate:function(t){return this.validate(undefined,undefined,t),!1===this.validationResult&&t instanceof e.Event&&(t.stopImmediatePropagation(),t.preventDefault()),this},validate:function(t,n,r){this.submitEvent=r,this.validationResult=!0;var i=[];this._refreshFields(),e.emit("parsley:form:validate",this);for(var s=0;s<this.fields.length;s++){if(t&&t!==this.fields[s].options.group)continue;i=this.fields[s].validate(n),!0!==i&&i.length>0&&this.validationResult&&(this.validationResult=!1)}return e.emit("parsley:form:validated",this),this.validationResult},isValid:function(e,t){this._refreshFields();for(var n=0;n<this.fields.length;n++){if(e&&e!==this.fields[n].options.group)continue;if(!1===this.fields[n].isValid(t))return!1}return!0},_refreshFields:function(){return this.actualizeOptions()._bindFields()},_bindFields:function(){var e=this;return this.fields=[],this.fieldsMappedById={},this.$element.find(this.options.inputs).each(function(){var t=new window.Parsley(this,{},e);("ParsleyField"===t.__class__||"ParsleyFieldMultiple"===t.__class__)&&!t.$element.is(t.options.excluded)&&"undefined"==typeof e.fieldsMappedById[t.__class__+"-"+t.__id__]&&(e.fieldsMappedById[t.__class__+"-"+t.__id__]=t,e.fields.push(t))}),this}};var a=function(n,r,i,s,o){if(!(new RegExp("ParsleyField")).test(t.get(n,"__class__")))throw new Error("ParsleyField or ParsleyFieldMultiple instance expected");if("function"!=typeof window.ParsleyValidator.validators[r]&&"Assert"!==window.ParsleyValidator.validators[r](i).__parentClass__)throw new Error("Valid validator expected");var u=function(e,n){return"undefined"!=typeof e.options[n+"Priority"]?e.options[n+"Priority"]:t.get(window.ParsleyValidator.validators[n](i),"priority")||2};return s=s||u(n,r),"function"==typeof window.ParsleyValidator.validators[r](i).requirementsTransformer&&(i=window.ParsleyValidator.validators[r](i).requirementsTransformer()),e.extend(window.ParsleyValidator.validators[r](i),{name:r,requirements:i,priority:s,groups:[s],isDomConstraint:o||t.attr(n.$element,n.options.namespace,r)})},f=function(n,r,i){this.__class__="ParsleyField",this.__id__=t.hash(4),this.$element=e(n),"undefined"!=typeof i?(this.parent=i,this.OptionsFactory=this.parent.OptionsFactory,this.options=this.OptionsFactory.get(this)):(this.OptionsFactory=r,this.options=this.OptionsFactory.get(this)),this.constraints=[],this.constraintsByName={},this.validationResult=[],this._bindConstraints()};f.prototype={validate:function(t){return this.value=this.getValue(),e.emit("parsley:field:validate",this),e.emit("parsley:field:"+(this.isValid(t,this.value)?"success":"error"),this),e.emit("parsley:field:validated",this),this.validationResult},isValid:function(e,t){this.refreshConstraints();var n=this._getConstraintsSortedPriorities();t=t||this.getValue();if(0===t.length&&!this._isRequired()&&"undefined"==typeof this.options.validateIfEmpty&&!0!==e)return this.validationResult=[];if(!1===this.options.priorityEnabled)return!0===(this.validationResult=this.validateThroughValidator(t,this.constraints,"Any"));for(var r=0;r<n.length;r++)if(!0!==(this.validationResult=this.validateThroughValidator(t,this.constraints,n[r])))return!1;return!0},getValue:function(){var e;return"undefined"!=typeof this.options.value?e=this.options.value:e=this.$element.val(),"undefined"==typeof e||null===e?"":!0===this.options.trimValue?e.replace(/^\s+|\s+$/g,""):e},refreshConstraints:function(){return this.actualizeOptions()._bindConstraints()},addConstraint:function(e,t,n,r){e=e.toLowerCase();if("function"==typeof window.ParsleyValidator.validators[e]){var i=new a(this,e,t,n,r);"undefined"!==this.constraintsByName[i.name]&&this.removeConstraint(i.name),this.constraints.push(i),this.constraintsByName[i.name]=i}return this},removeConstraint:function(e){for(var t=0;t<this.constraints.length;t++)if(e===this.constraints[t].name){this.constraints.splice(t,1);break}return this},updateConstraint:function(e,t,n){return this.removeConstraint(e).addConstraint(e,t,n)},_bindConstraints:function(){var e=[];for(var t=0;t<this.constraints.length;t++)!1===this.constraints[t].isDomConstraint&&e.push(this.constraints[t]);this.constraints=e;for(var n in this.options)this.addConstraint(n,this.options[n]);return this._bindHtml5Constraints()},_bindHtml5Constraints:function(){(this.$element.hasClass("required")||this.$element.attr("required"))&&this.addConstraint("required",!0,undefined,!0),"string"==typeof this.$element.attr("pattern")&&this.addConstraint("pattern",this.$element.attr("pattern"),undefined,!0),"undefined"!=typeof this.$element.attr("min")&&"undefined"!=typeof this.$element.attr("max")?this.addConstraint("range",[this.$element.attr("min"),this.$element.attr("max")],undefined,!0):"undefined"!=typeof this.$element.attr("min")?this.addConstraint("min",this.$element.attr("min"),undefined,!0):"undefined"!=typeof this.$element.attr("max")&&this.addConstraint("max",this.$element.attr("max"),undefined,!0);var e=this.$element.attr("type");return"undefined"==typeof e?this:"number"===e?this.addConstraint("type","integer",undefined,!0):(new RegExp(e,"i")).test("email url range")?this.addConstraint("type",e,undefined,!0):this},_isRequired:function(){return"undefined"==typeof this.constraintsByName.required?!1:!1!==this.constraintsByName.required.requirements},_getConstraintsSortedPriorities:function(){var e=[];for(var t=0;t<this.constraints.length;t++)-1===e.indexOf(this.constraints[t].priority)&&e.push(this.constraints[t].priority);return e.sort(function(e,t){return t-e}),e}};var l=function(){this.__class__="ParsleyFieldMultiple"};l.prototype={addElement:function(e){return this.$elements.push(e),this},refreshConstraints:function(){var t;this.constraints=[];if(this.$element.is("select"))return this.actualizeOptions()._bindConstraints(),this;for(var n=0;n<this.$elements.length;n++){if(!e("html").has(this.$elements[n]).length){this.$elements.splice(n,1);continue}t=this.$elements[n].data("ParsleyFieldMultiple").refreshConstraints().constraints;for(var r=0;r<t.length;r++)this.addConstraint(t[r].name,t[r].requirements,t[r].priority,t[r].isDomConstraint)}return this},getValue:function(){if("undefined"!=typeof this.options.value)return this.options.value;if(this.$element.is("input[type=radio]"))return e("["+this.options.namespace+'multiple="'+this.options.multiple+'"]:checked').val()||"";if(this.$element.is("input[type=checkbox]")){var t=[];return e("["+this.options.namespace+'multiple="'+this.options.multiple+'"]:checked').each(function(){t.push(e(this).val())}),t.length?t:[]}return this.$element.is("select")&&null===this.$element.val()?[]:this.$element.val()},_init:function(e){return this.$elements=[this.$element],this.options.multiple=e,this}};var c=e({}),h={};e.listen=function(e){"undefined"==typeof h[e]&&(h[e]=[]);if("function"==typeof arguments[1])return h[e].push({fn:arguments[1]});if("object"==typeof arguments[1]&&"function"==typeof arguments[2])return h[e].push({fn:arguments[2],ctxt:arguments[1]});throw new Error("Wrong parameters")},e.listenTo=function(e,t,n){"undefined"==typeof h[t]&&(h[t]=[]);if(!(e instanceof f||e instanceof u))throw new Error("Must give Parsley instance");if("string"!=typeof t||"function"!=typeof n)throw new Error("Wrong parameters");h[t].push({instance:e,fn:n})},e.unsubscribe=function(e,t){if("undefined"==typeof h[e])return;if("string"!=typeof e||"function"!=typeof t)throw new Error("Wrong arguments");for(var n=0;n<h[e].length;n++)if(h[e][n].fn===t)return h[e].splice(n,1)},e.unsubscribeTo=function(e,t){if("undefined"==typeof h[t])return;if(!(e instanceof f||e instanceof u))throw new Error("Must give Parsley instance");for(var n=0;n<h[t].length;n++)if("undefined"!=typeof h[t][n].instance&&h[t][n].instance.__id__===e.__id__)return h[t].splice(n,1)},e.unsubscribeAll=function(e){if("undefined"==typeof h[e])return;delete h[e]},e.emit=function(e,t){if("undefined"==typeof h[e])return;for(var n=0;n<h[e].length;n++){if("undefined"==typeof h[e][n].instance){h[e][n].fn.apply("undefined"!=typeof h[e][n].ctxt?h[e][n].ctxt:c,Array.prototype.slice.call(arguments,1));continue}if(!(t instanceof f||t instanceof u))continue;if(h[e][n].instance.__id__===t.__id__){h[e][n].fn.apply(c,Array.prototype.slice.call(arguments,1));continue}if(h[e][n].instance instanceof u&&t instanceof f)for(var r=0;r<h[e][n].instance.fields.length;r++)if(h[e][n].instance.fields[r].__id__===t.__id__){h[e][n].fn.apply(c,Array.prototype.slice.call(arguments,1));continue}}},e.subscribed=function(){return h},window.ParsleyConfig=window.ParsleyConfig||{},window.ParsleyConfig.i18n=window.ParsleyConfig.i18n||{},window.ParsleyConfig.i18n.en=e.extend(window.ParsleyConfig.i18n.en||{},{defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",number:"This value should be a valid number.",integer:"This value should be a valid integer.",digits:"This value should be digits.",alphanum:"This value should be alphanumeric."},notblank:"This value should not be blank.",required:"This value is required.",pattern:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or fewer.",length:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or fewer.",check:"You must select between %s and %s choices.",equalto:"This value should be the same."}),"undefined"!=typeof window.ParsleyValidator&&window.ParsleyValidator.addCatalog("en",window.ParsleyConfig.i18n.en,!0);var p=function(n,r,i){this.__class__="Parsley",this.__version__="2.0.3",this.__id__=t.hash(4);if("undefined"==typeof n)throw new Error("You must give an element");if("undefined"!=typeof i&&"ParsleyForm"!==i.__class__)throw new Error("Parent instance must be a ParsleyForm instance");return this.init(e(n),r,i)};p.prototype={init:function(e,r,i){if(!e.length)throw new Error("You must bind Parsley on an existing element.");this.$element=e;if(this.$element.data("Parsley")){var s=this.$element.data("Parsley");return"undefined"!=typeof i&&(s.parent=i),s}return this.OptionsFactory=new o(n,t.get(window,"ParsleyConfig")||{},r,this.getNamespace(r)),this.options=this.OptionsFactory.get(this),this.$element.is("form")||t.attr(this.$element,this.options.namespace,"validate")&&!this.$element.is(this.options.inputs)?this.bind("parsleyForm"):this.$element.is(this.options.inputs)&&!this.$element.is(this.options.excluded)?this.isMultiple()?this.handleMultiple(i):this.bind("parsleyField",i):this},isMultiple:function(){return this.$element.is("input[type=radio], input[type=checkbox]")&&"undefined"==typeof this.options.multiple||this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple")},handleMultiple:function(n){var r=this,i,s,o;this.options=e.extend(this.options,n?n.OptionsFactory.get(n):{},t.attr(this.$element,this.options.namespace)),this.options.multiple?s=this.options.multiple:"undefined"!=typeof this.$element.attr("name")&&this.$element.attr("name").length?s=i=this.$element.attr("name"):"undefined"!=typeof this.$element.attr("id")&&this.$element.attr("id").length&&(s=this.$element.attr("id"));if(this.$element.is("select")&&"undefined"!=typeof this.$element.attr("multiple"))return this.bind("parsleyFieldMultiple",n,s||this.__id__);if("undefined"==typeof s)return window.console&&window.console.warn&&window.console.warn("To be binded by Parsley, a radio, a checkbox and a multiple select input must have either a name or a multiple option.",this.$element),this;s=s.replace(/(:|\.|\[|\]|\$)/g,""),"undefined"!=typeof i&&e('input[name="'+i+'"]').each(function(){e(this).is("input[type=radio], input[type=checkbox]")&&e(this).attr(r.options.namespace+"multiple",s)});if(e("["+this.options.namespace+"multiple="+s+"]").length)for(var u=0;u<e("["+this.options.namespace+"multiple="+s+"]").length;u++)if("undefined"!=typeof e(e("["+this.options.namespace+"multiple="+s+"]").get(u)).data("Parsley")){o=e(e("["+this.options.namespace+"multiple="+s+"]").get(u)).data("Parsley"),this.$element.data("ParsleyFieldMultiple")||(o.addElement(this.$element),this.$element.attr(this.options.namespace+"id",o.__id__));break}return this.bind("parsleyField",n,s,!0),o||this.bind("parsleyFieldMultiple",n,s)},getNamespace:function(e){return"undefined"!=typeof this.$element.data("parsleyNamespace")?this.$element.data("parsleyNamespace"):"undefined"!=typeof t.get(e,"namespace")?e.namespace:"undefined"!=typeof t.get(window,"ParsleyConfig.namespace")?window.ParsleyConfig.namespace:n.namespace},bind:function(n,i,s,o){var a;switch(n){case"parsleyForm":a=e.extend(new u(this.$element,this.OptionsFactory),new r,window.ParsleyExtend)._bindFields();break;case"parsleyField":a=e.extend(new f(this.$element,this.OptionsFactory,i),new r,window.ParsleyExtend);break;case"parsleyFieldMultiple":a=e.extend(new f(this.$element,this.OptionsFactory,i),new r,new l,window.ParsleyExtend)._init(s);break;default:throw new Error(n+"is not a supported Parsley type")}return"undefined"!=typeof s&&t.setAttr(this.$element,this.options.namespace,"multiple",s),"undefined"!=typeof o?(this.$element.data("ParsleyFieldMultiple",a),a):((new RegExp("ParsleyF","i")).test(a.__class__)&&(this.$element.data("Parsley",a),e.emit("parsley:"+("parsleyForm"===n?"form":"field")+":init",a)),a)}},e.fn.parsley=e.fn.psly=function(t){if(this.length>1){var n=[];return this.each(function(){n.push(e(this).parsley(t))}),n}if(!e(this).length){window.console&&window.console.warn&&window.console.warn("You must bind Parsley on an existing element.");return}return new p(this,t)},window.ParsleyUI="function"==typeof t.get(window,"ParsleyConfig.ParsleyUI")?(new window.ParsleyConfig.ParsleyUI).listen():(new s).listen(),"undefined"==typeof window.ParsleyExtend&&(window.ParsleyExtend={}),"undefined"==typeof window.ParsleyConfig&&(window.ParsleyConfig={}),window.Parsley=window.psly=p,window.ParsleyUtils=t,window.ParsleyValidator=new i(window.ParsleyConfig.validators,window.ParsleyConfig.i18n),!1!==t.get(window,"ParsleyConfig.autoBind")&&e(document).ready(function(){e("[data-parsley-validate]").length&&e("[data-parsley-validate]").parsley()})}),define("common/validation",["require","parsley"],function(e){var t=e("parsley"),n={errorClass:"has-error",errorsWrapper:"<div></div>",errorTemplate:'<span class="error-msg"></span>',classHandler:function(e){return e.$element.closest(".form-group")}};window.ParsleyValidator.addValidator("phone",function(e,t){var n=e.replace(/[\(\)\.\-\ ]/g,"");return n.length==10&&!isNaN(n)&&e!=""?!0:!1}).addMessage("en","phone","Please enter a valid phone number"),window.ParsleyValidator.addValidator("zipCode",function(e){var t=/^\d{5}(-\d{4})?$/;return t.test(e)}).addMessage("en","zipCode","Please enter a valid zip code"),window.ParsleyConfig.i18n.en.length="Value length should be between %s and %s characters.";var r=function(e){var t={};return e.forEach(function(e){var n=e.$element.data("fieldName"),r=e.$element.attr("type");n&&(r!=="checkbox"?t[n]=e.value:t[n]=e.$element.is(":checked"))}),t},i=function(e,t){var i=null,s=$(e).parsley(_.extend(n,t));return s.validate()&&(i=r(s.fields),s.destroy()),i},s=function(e,t,r){var i=$(e).parsley(n);window.ParsleyUI.addError(i,t,r)},o=function(e,t){e.parsley(n).validate(t)};return{validateForm:i,addError:s,validateElement:o}}),define("modules/manageDeliveries/manageDeliveriesView",["require","marionette","hbs!modules/manageDeliveries/manageDeliveriesTemplate","common/modal/modal","common/validation","common/utils","datepicker","parsley","common/handlebars/helpers/formatDateHelper"],function(e){var t=e("marionette"),n=e("hbs!modules/manageDeliveries/manageDeliveriesTemplate"),r=e("common/modal/modal"),i=e("common/validation"),s=e("common/utils");e("datepicker");var o=e("parsley"),u=e("common/handlebars/helpers/formatDateHelper"),a="Your hold dates overlap",f="'To' date is earlier than 'From' date",l="Please select both 'From' and 'To' dates",c=/^(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d\d), (\d\d\d\d)$/,h=function(e){var t=c.exec(e);if(t){var n=t[1],r=t[2],i=t[3];n=_.indexOf(u.Dates.abbreviatedMonths,n);if(n>-1)return n=s.pad(n+1,2),i+"-"+n+"-"+r}return null},p=function(e){return!e||isNaN(e)?null:e},d=function(e,t){var n=e.find(t).datepicker("getDate");return p(n)},v=function(e){var t=$("#manage-deliveries-form .hold[data-hold-index='"+e+"']");return{startDate:d(t,".from"),endDate:d(t,".to")}},m=function(e){return!e.startDate&&!e.endDate},g=function(e){return!!e.startDate&&!!e.endDate};window.ParsleyValidator.addValidator("holddates",function(e,t){var n=v(t);return g(n)||m(n)},22).addMessage("en","holddates",l).addValidator("holdperiod",function(e,t){var n=v(t);return!g(n)||n.startDate<=n.endDate},22).addMessage("en","holdperiod",f).addValidator("holdoverlap",function(e,t){var n=v(t),r=!0;if(g(n))for(var i=1;i<t&&r;i++){var s=v(i);g(s)&&(r=n.endDate<s.startDate||n.startDate>s.endDate)}return r},22).addMessage("en","holdoverlap",a);var y=t.ItemView.extend({template:n,events:{"click button.submit:not([disabled])":"onSubmit","click a.remove-button:not([disabled])":"removeHoldPeriod"},initialize:function(){this.listenTo(this,"render",_.bind(this.renderDatePicker,this))},renderDatePicker:function(){var e=this.model,t=this,n=new Date;if(e.get("isStoreClosed")){var r=e.get("regionNextDeliveryDate"),i=s.addDays(s.parseFromServerDate(r),1,{clone:!0});n=s.maxDate(n,i)}this.$(".hold").each(function(i,o){var u=$(o).find(".from"),a=$(o).find(".to"),f=e.get(u.data("fieldName")),l=e.get(a.data("fieldName")),c=!1;if(e.get("isStoreClosed")){var h=e.get(u.data("fieldName")),p=l;h&&p&&(c=h<=r&&p>=r)}if(c)u.attr("disabled",""),a.attr("disabled",""),$(o).find(".remove-button").attr("disabled","");else{var d={startDate:n,multidateSeparator:"#"};if(l){var p=s.parseFromServerDate(l);p>=n&&(d.endDate=p)}var v={startDate:d.startDate,multidateSeparator:"#"},m=u.datepicker(d),g=a.datepicker(v);m.on("changeDate",_.bind(t.changeDate,this)),g.on("changeDate",_.bind(t.changeDate,this))}})},changeDate:function(e){var t=$(e.currentTarget),n=t.closest(".hold");this.submittedOnce&&i.validateElement(n);var r=p(t.datepicker("getDate"));t.hasClass("from")?n.find(".to").datepicker("setStartDate",r||new Date):n.find(".from").datepicker("setEndDate",r),$(".manage-deliveries button.submit").removeAttr("disabled")},onSubmit:function(){this.submittedOnce=!0;var e=i.validateForm("#manage-deliveries-form");if(e){var t=[];for(var n=1;n<4;n++){var r=e["from"+n],s=e["to"+n];r&&s&&t.push({startDate:h(r),endDate:h(s)})}this.trigger("submit",t)}},removeHoldPeriod:function(e){var t=$(e.currentTarget),n=t.closest(".hold");n.find(".to").val(null),n.find(".from").val(null),$(".manage-deliveries button.submit").removeAttr("disabled")}});return y}),define("modules/manageDeliveries/manageDeliveriesModel",["require","common/rawDataModel","common/dataService"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=function(e){return s(e,"startDate")},i=function(e){return s(e,"endDate")},s=function(e,t){var n=e,r=t;return function(){var e=(this.rawData.subscription||{}).vacations||[];return e.length>=n?(e[n-1]||{})[r]:null}},o=t.Model.extend({readers:{from1:r(1),from2:r(2),from3:r(3),to1:i(1),to2:i(2),to3:i(3),isStoreClosed:(new t.Value("orderLock.isStoreClosed")).getValue,regionNextDeliveryDate:(new t.Value("regionNextDeliveryDate")).getValue}});return{getInstance:function(){return new o(n.getMarketData())}}}),define("modules/manageDeliveries/manageDeliveriesModule",["require","marionette","common/globals","common/nav","common/utils","common/modal/modal","modules/manageDeliveries/manageDeliveriesView","modules/manageDeliveries/manageDeliveriesModel","common/dataService"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/nav"),i=e("common/utils"),s=e("common/modal/modal"),o=e("modules/manageDeliveries/manageDeliveriesView"),u=e("modules/manageDeliveries/manageDeliveriesModel"),a=e("common/dataService"),f=t.Controller.extend({show:function(){var e=location.search!=""?i.deparam():{};e.modal="deliveries",r.navigate(r.PageEnum.Market,{trigger:!1},$.param(e));var t=new o({model:u.getInstance()});this.listenTo(t,{submit:function(e){a.updateHoldPeriods(e).then(function(){n.eventBus.trigger("analytics:pageEvent","order","manage deliveries edited")}).then(a.loadMarketData).then(function(){s.close()})}}),s.show(t,{className:"manage-deliveries-modal",closeCallback:function(){var e=i.deparam();e.modal&&(delete e.modal,r.navigate(r.PageEnum.Market,{trigger:!0},$.param(e)))}})}}),l;return{getInstance:function(){return l?l:l=new f}}}),define("hbs!modules/header/headerSearchTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="search">\n	<a class="search-toggle"><i></i></a>\n    <div class="form" role="form">\n        <div class="search-input-wrapper">\n            <input type="text" class="search-input form-control" placeholder="Search"/>\n        </div>\n        <button class="search-btn button lettuce">&#10004;</button>\n        <div id="suggestions-region"></div>\n    </div>\n</div>\n'});return n}),define("common/handlebars/helpers/orHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(){var e=[].slice.apply(arguments),t=e.pop(),n;for(n=0;n<e.length;++n)if(e[n])return t.fn(this)};return t.registerHelper("orHelper",n),n}),define("common/handlebars/helpers/markBoldHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e,t){return e=e.replace(new RegExp(t,"gi"),"<b>"+t+"</b>"),e};return t.registerHelper("markBoldHelper",n),n}),define("hbs!modules/search/suggestionsTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/orHelper","common/handlebars/helpers/markBoldHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function d(e,t){var r="",i,s;r+='\n        <h3 class="heading">PRODUCTS (',(i=n.totalshares)?i=i.call(e,{hash:{}}):(i=e&&e.totalshares,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+")</h3>\n        <hr>\n        ",i=n["if"].call(e,e&&e.keywordsShares,{hash:{},inverse:c.noop,fn:c.programWithDepth(2,v,t,e)});if(i||i===0)r+=i;r+="\n        ",s={hash:{},inverse:c.noop,fn:c.programWithDepth(5,g,t,e)},(i=n.shares)?i=i.call(e,s):(i=e&&e.shares,i=typeof i===f?i.call(e,s):i),n.shares||(i=h.call(e,i,s));if(i||i===0)r+=i;return r+="\n    ",r}function v(e,t,r){var i="",s,o,u;i+="\n            <span>"+l((s=r&&r.searchText,typeof s===f?s.apply(e):s))+":</span>\n            ",u={hash:{},inverse:c.noop,fn:c.program(3,m,t)},(o=n.keywordsShares)?o=o.call(e,u):(o=e&&e.keywordsShares,o=typeof o===f?o.call(e,u):o),n.keywordsShares||(o=h.call(e,o,u));if(o||o===0)i+=o;return i+="\n        ",i}function m(e,t){var r="",i;return r+='\n                <div><a class="item-title" key="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</a></div>\n            ",r}function g(e,t,r){var i="",s,o,u;i+='\n            <div><a class="item-title" key="',(s=n.id)?s=s.call(e,{hash:{}}):(s=e&&e.id,s=typeof s===f?s.call(e,{hash:{}}):s),i+=l(s)+'">',u={hash:{}},o=(s=n.markBoldHelper||e&&e.markBoldHelper,s?s.call(e,e&&e.title,r&&r.searchText,u):p.call(e,"markBoldHelper",e&&e.title,r&&r.searchText,u));if(o||o===0)i+=o;return i+="</a></div>\n        ",i}function y(e,t){var r="",i,s;r+='\n        <h3 class="heading">TAGS (',(i=n.totaltags)?i=i.call(e,{hash:{}}):(i=e&&e.totaltags,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+")</h3>\n        <hr>\n        ",s={hash:{},inverse:c.noop,fn:c.programWithDepth(8,b,t,e)},(i=n.tags)?i=i.call(e,s):(i=e&&e.tags,i=typeof i===f?i.call(e,s):i),n.tags||(i=h.call(e,i,s));if(i||i===0)r+=i;return r+="\n    ",r}function b(e,t,r){var i="",s,o,u;i+='\n            <div><a class="tag-title" id="',(s=n.id)?s=s.call(e,{hash:{}}):(s=e&&e.id,s=typeof s===f?s.call(e,{hash:{}}):s),i+=l(s)+'">',u={hash:{}},o=(s=n.markBoldHelper||e&&e.markBoldHelper,s?s.call(e,e&&e.title,r&&r.searchText,u):p.call(e,"markBoldHelper",e&&e.title,r&&r.searchText,u));if(o||o===0)i+=o;return i+="</a></div>\n        ",i}function w(e,t){var r="",i,s;r+='\n        <h3 class="heading">PRODUCERS (',(i=n.totalproducers)?i=i.call(e,{hash:{}}):(i=e&&e.totalproducers,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+")</h3>\n        <hr>\n        ",s={hash:{},inverse:c.noop,fn:c.programWithDepth(11,E,t,e)},(i=n.producers)?i=i.call(e,s):(i=e&&e.producers,i=typeof i===f?i.call(e,s):i),n.producers||(i=h.call(e,i,s));if(i||i===0)r+=i;return r+="\n    ",r}function E(e,t,r){var i="",s,o,u;i+='\n            <div><a class="producer-title" key="',(s=n.id)?s=s.call(e,{hash:{}}):(s=e&&e.id,s=typeof s===f?s.call(e,{hash:{}}):s),i+=l(s)+'">',u={hash:{}},o=(s=n.markBoldHelper||e&&e.markBoldHelper,s?s.call(e,e&&e.title,r&&r.searchText,u):p.call(e,"markBoldHelper",e&&e.title,r&&r.searchText,u));if(o||o===0)i+=o;return i+="</a></div>\n        ",i}function S(e,t){var r="",i;return r+='\n        <div><a class="all-results-link">See all ',(i=n.totalNumber)?i=i.call(e,{hash:{}}):(i=e&&e.totalNumber,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+" results</a></div>\n    ",r}function x(e,t){return'\n        <p class="no-results">No results</p>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<div class="suggestions">\n    ',a={hash:{},inverse:c.noop,fn:c.program(1,d,i)},u=(o=n.orHelper||t&&t.orHelper,o?o.call(t,t&&t.shares,t&&t.keywordsShares,a):p.call(t,"orHelper",t&&t.shares,t&&t.keywordsShares,a));if(u||u===0)s+=u;s+="\n    ",u=n["if"].call(t,t&&t.tags,{hash:{},inverse:c.noop,fn:c.program(7,y,i)});if(u||u===0)s+=u;s+="\n    ",u=n["if"].call(t,t&&t.producers,{hash:{},inverse:c.noop,fn:c.program(10,w,i)});if(u||u===0)s+=u;s+="\n    ",u=n["if"].call(t,t&&t.hasMore,{hash:{},inverse:c.noop,fn:c.program(13,S,i)});if(u||u===0)s+=u;s+="\n    ",u=n["if"].call(t,t&&t.totalNumber,{hash:{},inverse:c.program(15,x,i),fn:c.noop});if(u||u===0)s+=u;return s+="\n</div>\n\n",s});return n}),define("modules/search/suggestionsView",["require","marionette","common/globals","hbs!modules/search/suggestionsTemplate","common/nav","common/utils"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("hbs!modules/search/suggestionsTemplate"),i=e("common/nav"),s=e("common/utils"),o=t.LayoutView.extend({template:r,events:{"click a.all-results-link":"_onSeeAllResultsClick","click a.item-title":"_goToItem","click a.producer-title":"_goToProducer","click .tag-title":"_goToTag"},initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.listenTo(this,"updateSuggestions",function(){this.render()})},_onSeeAllResultsClick:function(e){e.stopPropagation(),this.moduleEventBus.trigger("search:seeAllResultsClick",this.model.get("searchText"))},_goToTag:function(e){var t=e.currentTarget,r=t.text;this.moduleEventBus.trigger("search:close"),$(window).scrollTop(0),n.eventBus.trigger("analytics:event","Community-search","Search result clicked","(tag) "+r,0,!0),n.data.setLastCategories("Tags from Search Tab Text",r),i.navigate(i.PageEnum.Market,{preventPageEventAnalitics:!0},"tag="+t.getAttribute("id"))},_goToItem:function(e){var t=e.currentTarget,r=this.model.get("searchText");n.eventBus.trigger("analytics:event","Community-search","Search value entered",r,0,!0),n.eventBus.trigger("analytics:event","Community-search","Search result clicked","(product) "+t.text,0,!0),n.eventBus.trigger("analytics:event","Community-search","Product search combination",r+"/"+t.text,0,!0),this.moduleEventBus.trigger("search:close");var s=t.getAttribute("key");i.navigate(i.PageEnum.Market,null,"item="+s)},_goToProducer:function(e){var t=e.currentTarget;this.moduleEventBus.trigger("search:close");var r=t.getAttribute("key");n.eventBus.trigger("analytics:event","Community-search","Search result clicked","(producer) "+t.text,0,!0),i.navigate(i.PageEnum.Market,null,"producer="+r)}});return o}),define("modules/search/suggestionsModule",["require","marionette","common/globals","common/dataService","common/nav","common/utils","modules/search/suggestionsView"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/dataService"),i=e("common/nav"),s=e("common/utils"),o=e("modules/search/suggestionsView"),u=s.clientViewPort.isXs()?3:4,a=t.Controller.extend({initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.region=e.region,this.moduleEventBus.on("search:keyup",this._onKeyUp.bind(this)),this.moduleEventBus.on("search:searchClick",this._onSearchClick.bind(this)),this.moduleEventBus.on("search:seeAllResultsClick",this._onSeeAllResultsClick.bind(this))},show:function(){var e=new o({model:new Backbone.Model({totalNumber:1}),moduleEventBus:this.moduleEventBus});this.region.show(e)},_onKeyUp:function(e,t){(e.keyCode!==27||e.keyCode!==8)&&e.stopPropagation(),t=t.toLowerCase().trim(),e.keyCode===13&&t!==""?(n.eventBus.trigger("analytics:event","Community-search","search button clicked",t,0,!0),this._search(t)):this._setSuggestions(t)},_search:function(e){var e=e.toLowerCase().trim();if(e!==""){var t=this.region.currentView&&this.region.currentView.model.get("totalNumber")==1;if(t){this._goDirectlyToSingleResult();return}this.moduleEventBus.trigger("search:close"),e=encodeURIComponent(e.replace(/&+/g,";AMP;")),i.navigate(i.PageEnum.Market,{preventPageEventAnalitics:!0},"search="+e)}},_onSearchClick:function(e){n.eventBus.trigger("analytics:event","Community-search","search button clicked",e,0,!0),this._search(e)},_onSeeAllResultsClick:function(e){n.eventBus.trigger("analytics:event","Community-search","see all results clicked",e,0,!0),this._search(e)},_setSuggestions:function(e){_.defer(function(){var t,n=this.region.currentView;if(n)if(e==="")this._resetSuggestions(n);else{var r=this._filterResults(n,"shares",e),i=this._filterResults(n,"tags",e),s=this._filterResults(n,"producers",e);t=r+i+s;var o=r>u||i>u||s>u?!0:!1;n.model.set("totalNumber",t>0?t:undefined),n.model.set("hasMore",o),n.model.set("searchText",e),n.trigger("updateSuggestions")}}.bind(this))},_resetSuggestions:function(e){e.model.set("hasMore",!1),e.model.set("shares",undefined),e.model.set("keywordsShares",undefined),e.model.set("tags",undefined),e.model.set("producers",undefined),e.trigger("updateSuggestions")},_filterResults:function(e,t,n){var i=r.getMarketData(t);if(t==="shares"){i=_.values(r.getMarketData("sharesMap")).filter(function(e){return e.subCategories&&e.subCategories.length});var s=[];i=_.filter(i,function(e){return n&&n[0]!=="#"&&e.keywords.indexOf(n)>-1?(s.push(e),!1):e.title.toLowerCase().indexOf(n)>-1}),e.model.set("total"+t,i.length+s.length);var o=s.slice(0,u);return o=o.sort(function(e,t){return t.usageCount>e.usageCount}),e.model.set("keywordsShares",o.length>0?o:undefined),e.model.set(t,i.length>0?i.slice(0,u-o.length).sort(function(e,t){return t.usageCount>e.usageCount}):undefined),i.length+s.length}return i=_.filter(i,function(e){return e.title.toLowerCase().indexOf(n)>-1}),e.model.set("total"+t,i.length),e.model.set(t,i.slice(0,u)),i.length},_goDirectlyToSingleResult:function(){var e;this.region.currentView.model.get("totalshares")>0?e="item="+this.region.currentView.model.get("shares")[0].id:this.region.currentView.model.get("totalproducers")>0?e="producer="+this.region.currentView.model.get("producers")[0].id:this.region.currentView.model.get("totaltags")>0&&(e="tag="+this.region.currentView.model.get("tags")[0].id),this.moduleEventBus.trigger("search:close"),i.navigate(i.PageEnum.Market,null,e)}});return a}),define("modules/header/headerSearchView",["require","marionette","common/globals","common/utils","hbs!modules/header/headerSearchTemplate","common/dataService","common/nav","modules/search/suggestionsModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/utils"),i=e("hbs!modules/header/headerSearchTemplate"),s=e("common/dataService"),o=e("common/nav"),u=e("modules/search/suggestionsModule"),a=t.LayoutView.extend({initialize:function(){this.moduleEventBus=new n.EventAggregator},template:i,ui:{input:"input.search-input",search:".search",searchToggle:".search-toggle"},regions:{suggestions:"#suggestions-region"},events:{"keyup input.search-input":"_onKeyUp","blur input.search-input":"_onBlur","click .search-toggle":"_onToggleSearch","click .search-btn":"_onSearchClick"},onShow:function(){_.defer(function(){var e=$(".form").width();$(".search-input-wrapper").width(e-44)})},onRender:function(){this.suggestionsModule=new u({region:this.suggestions,moduleEventBus:this.moduleEventBus}),this.suggestionsModule.show(),this.moduleEventBus.on("search:close",this._toggleSearch.bind(this))},_onKeyUp:function(e){var t=this.ui.input.val();this.moduleEventBus.trigger("search:keyup",e,t)},_onBlur:function(){(!this.ui.input.val()||this.ui.input.val()&&this.ui.input.val().trim()=="")&&this._toggleSearch()},_onToggleSearch:function(){n.eventBus.trigger("analytics:event","Community-header","Search clicked (mobile)","",0,!0),this._toggleSearch()},_toggleSearch:function(e){this.ui.search.toggleClass("open",e),this.ui.search.hasClass("open")?this.ui.input.focus():this.ui.input.blur()},_onSearchClick:function(){this.moduleEventBus.trigger("search:searchClick",this.ui.input.val())}});return a}),define("modules/header/headerView",["require","marionette","common/nav","common/globals","common/utils","modules/communityModal/communityModalModule","hbs!modules/header/headerTemplate","modules/referral/referralModule","common/share/share","modules/manageDeliveries/manageDeliveriesModule","modules/header/headerSearchView"],function(e){var t=e("marionette"),n=e("common/nav"),r=e("common/globals"),i=e("common/utils"),s=e("modules/communityModal/communityModalModule"),o=e("hbs!modules/header/headerTemplate"),u=e("modules/referral/referralModule"),a=e("common/share/share"),f=e("modules/manageDeliveries/manageDeliveriesModule"),l=e("modules/header/headerSearchView"),c=t.LayoutView.extend({template:o,regions:{headerSearch:"#header-search-region"},events:{"click a.market:not([disabled])":"_onMarket","click a.order:not([disabled]), a.current-order:not([disabled])":"_onOrder","click a.account-info":"_onAccount","click a.order-history":"_onHistory","click a.reorder:not([disabled])":"_onReOrder","click .community a":"_onToggleCommunityInfo","click a.login":"_onLogin","click a.sign-up":"_onSignUp","click a.logout":"_onLogout","click a.share-twitter":"_onShareTwitter","click a.share-facebook":"_onShareFacebook","click a.share-email":"_onShareEmail","click a.organizer-dashboard":"_onOrganizerDashboard","click a.manage-deliveries:not([disabled])":"_onManageDeliveries","click .dropdown-menu a.sender-referral":"_onSenderReferral","click a.sender-referral.nav-option":"_onSenderReferralNotDropDown","click .navbar-collapse a:not(.dropdown-toggle)":"_collapseNavbar","click .navbar-collapse a.dropdown-toggle":"_onDropdownToggleClicked","click .navbar-brand":"_onLogoClick"},ui:{communityInfoToggle:".community",orderLink:"a.order",navbarToggle:".navbar-toggle",navbarCollapse:".navbar-collapse"},initialize:function(){i.clientViewPort.isXs()&&($(window).on("click",function(e){this._isNavbarExpanded()&&$(e.target).closest(this.ui.navbarCollapse).length==0&&$(e.target).closest(this.ui.navbarToggle).length==0&&this._collapseNavbar()}.bind(this)),this.listenTo(r.eventBus,{"sharesLayout:searchResultPage":function(){this.$(".active").removeClass("active"),this.$(".nav-option.market").addClass("unselected"),$(".search-toggle").addClass("active")}}))},onRender:function(){var e=this._selectedOption;i.clientViewPort.isXs()&&this.headerSearch.show(new l({model:new Backbone.Model})),e&&this.selectOption(e),r.eventBus.trigger("header:rendered")},onShow:function(){},selectOption:function(e){var t=this.$(".nav-option."+e.path);t.length||(t=this.$(".simple-link."+e.path)),t&&(this.$(".active").removeClass("active"),t.addClass("active"),this._selectedOption=e),i.clientViewPort.isXs()&&$(".search-toggle").removeClass("active")},showCommunityInfo:function(){this._toggleCommunityInfo(!0)},_onMarket:function(){r.eventBus.trigger("analytics:event","Community-header","Market clicked","",0,!0),r.eventBus.trigger("flow:header:market")},_onOrder:function(){r.eventBus.trigger("analytics:event","Community-header","Order clicked","",0,!0),r.eventBus.trigger("flow:header:order")},_onAccount:function(){r.eventBus.trigger("flow:header:account")},_onHistory:function(){r.eventBus.trigger("flow:header:history")},_onToggleCommunityInfo:function(){r.eventBus.trigger("analytics:event","Community-header","Community name clicked","",0,!0),this._toggleCommunityInfo()},_toggleCommunityInfo:function(e){s.toggle(e,this.ui.communityInfoToggle)},_onShareFacebook:function(){a.shareWithFacebook()},_onShareTwitter:function(){a.sendTweet()},_onShareEmail:function(){a.email()},_onLogin:function(){r.eventBus.trigger("analytics:event","Community-header","Login clicked","",0,!0),r.eventBus.trigger("flow:header:login")},_onLogout:function(){r.eventBus.trigger("flow:header:logout")},_onSignUp:function(){r.eventBus.trigger("flow:header:signup")},_onReOrder:function(){r.eventBus.trigger("flow:menu:reorder")},_onOrganizerDashboard:function(){r.eventBus.trigger("analytics:event","Community-header","Organizer tools clicked")},_onManageDeliveries:function(){f.getInstance().show()},_onSenderReferral:function(){u.getInstance().showSenderModal()},_onSenderReferralNotDropDown:function(){this.referralDisplayedAlready?u.getInstance()._rerenderSenderPopover():(this.referralDisplayedAlready=!0,u.getInstance().showSenderModal("header a.sender-referral",!0,!0))},_isNavbarExpanded:function(){return this.ui.navbarCollapse.hasClass("in")},_collapseNavbar:function(){this.ui.navbarCollapse.collapse("hide")},_onDropdownToggleClicked:function(e){var t=$(e.target).offset().top-this.$el.height()-$(window).scrollTop();this.ui.navbarCollapse.velocity({scrollTop:t})},_onLogoClick:function(){r.eventBus.trigger("analytics:event","Community-header","Farmigo logo clicked","",0,!0)}});return c}),define("hbs!modules/header/orderPopover/orderPopoverTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){return"\r\n			Confirm Order\r\n		"}function p(e,t){return"\r\n			Review Order\r\n		"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="rows"></div>\r\n<div class="total-section">\r\n	Order Total:\r\n	<span class="total pull-right">',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):f.call(t,"currencyHelper",t&&t.total,a)))+'</span>\r\n</div>\r\n<span class="separator"/>\r\n<footer><div class="actions clearfix">\r\n	<a class="shopping pull-left"><span class="arrow"/>Continue Shopping</a>\r\n	<a class="checkout button pull-right">\r\n		',u=n["if"].call(t,t&&t.isOrderDirty,{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+="\r\n	</a>\r\n</div></footer>\r\n",s});return n}),define("common/handlebars/helpers/quantityHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e){return e===1?"":e<1?e.toString().replace("0"," "):e?e+" ":""};return t.registerHelper("quantityHelper",n),n}),define("hbs!modules/header/orderPopover/orderItemPopoverTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/quantityHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div class="col-xs-3">\r\n	<div class="picture">\r\n		<img alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'" src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\r\n	</div>\r\n</div>\r\n<div class="details col-xs-7">\r\n	<p class="title"><b>',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+" (",a={hash:{}},s+=l((o=n.quantityHelper||t&&t.quantityHelper,o?o.call(t,t&&t.unitQuantity,a):c.call(t,"quantityHelper",t&&t.unitQuantity,a))),(u=n.unit)?u=u.call(t,{hash:{}}):(u=t&&t.unit,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+')</b></p>\r\n	<p class="qty">Quantity: ',(u=n.quantity)?u=u.call(t,{hash:{}}):(u=t&&t.quantity,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</p>\r\n</div>\r\n<div class="details col-xs-2">\r\n	<p class="price">',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):c.call(t,"currencyHelper",t&&t.total,a)))+"</p>\r\n</div>\r\n",s});return n}),define("modules/header/orderPopover/orderPopoverView",["require","marionette","hbs!modules/header/orderPopover/orderPopoverTemplate","hbs!modules/header/orderPopover/orderItemPopoverTemplate"],function(e){var t=e("marionette"),n=e("hbs!modules/header/orderPopover/orderPopoverTemplate"),r=e("hbs!modules/header/orderPopover/orderItemPopoverTemplate"),i=t.ItemView.extend({template:r,className:function(){var e="row";return this.model.get("isTempUnavailable")&&(e+=" temp-unavailable"),e}}),s=t.CompositeView.extend({template:n,childView:i,childViewContainer:".rows",events:{"click .shopping":"_onMarket","click .checkout":"_onOrder"},_onMarket:function(e){this.trigger("market"),e.stopPropagation()},_onOrder:function(e){this.trigger("order"),e.stopPropagation()}});return s}),define("modules/order/orderModel",["require","common/rawDataModel","common/dataService","common/globals","common/utils","common/enums","common/dataUtils"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/globals"),i=e("common/utils"),s=e("common/enums"),o=e("common/dataUtils"),u,a=t.Model.extend({initialize:function(){this._synchData(),this.listenTo(r.eventBus,"dataUpdated",function(){this._synchData()})},_synchData:function(){this.rawData=n.getMarketData(),u=n.getSharesMap()},rawValues:{nextDeliveryDate:new t.Value("nextDeliveryDate"),currentCouponKey:new t.Value("subscription.currentCouponKey"),order:new t.Value("orderData")},readers:{orderItems:"getOrderItems",hasItems:"getHasItems",isOrderHasSavedItems:"getIsOrderHasSavedItems",subscriptionKey:(new t.Value("subscription.key")).getValue,hasToken:(new t.Value("subscription.hasToken")).getValue,isThirdVariation:"getIsThirdVariation",shouldEmptyOrder:"getShouldEmptyOrder"},getOrderItems:function(){return _.filter(this.rawData.orderData,function(e){return u[e.shareKey]?!0:!1})},getShouldEmptyOrder:function(){return this.get("orderItems").length===1&&this.get("subscriptionKey")&&this.get("isOrderHasSavedItems")},getHasItems:function(){return this.get("orderItems").length>0},getIsOrderHasSavedItems:function(){return r.data.isOrderHasSavedItems},updateOrderItem:function(e){var t=this._updateOrderItem(e);r.eventBus.trigger("shareChanged",e)},updateMultipleOrderItems:function(e){if(!e||e.length===0)return;_.each(e,_.bind(function(e){this._updateOrderItem(e)},this)),r.eventBus.trigger("shareChanged")},_updateOrderItem:function(e){var t=this.get("order");t||(t=[],this.set("order",t));var n=_.findWhere(t,{shareKey:e.shareKey}),i=u[e.shareKey];if(n){var s=i.itemType==="Bundle";s&&this.updateItemsInBundleQuantity(i,e.quantity-n.quantity),n.price=e.price,n.quantity=e.quantity}else n={orderDeliveryDate:e.orderDeliveryDate,price:e.price,quantity:e.quantity||1,scheduleKey:e.scheduleKey,shareKey:e.shareKey,extraProperties:e.extraProperties},t.push(n),this.updateItemsInBundleQuantity(i,e.quantity),t.length===1&&r.eventBus.trigger("analytics:pageView","add-first-item");r.data.setOrder(t)},updateItemsInBundleQuantity:function(e,t){var n=r.data.itemsInBundleQuantityMap;_.each(e.bundleComponents,function(e){var r=n[e.itemKey];r?n[e.itemKey]=r+e.quantity*t:n[e.itemKey]=e.quantity*t})},updateOrderItemFrequency:function(e,t){var n=this.get("order");if(n){var i=_.findWhere(n,{shareKey:e});i&&(i.scheduleKey=t.key,i.orderDeliveryDate=t.rawNextDelivery)}r.data.setOrder(n),r.eventBus.trigger("shareChanged",i)},removeOrderItem:function(e){var t=this.get("order");if(t){var n=_.findWhere(t,{shareKey:e});n&&this.updateItemsInBundleQuantity(u[e],-n.quantity),i.spliceByProperty(t,"shareKey",e),r.data.setOrder(t)}r.eventBus.trigger("shareChanged",e)},emptyOrder:function(){this.unset("order"),n.triggerDataUpdated()},getIsThirdVariation:function(){return o.getOrderVariation()==="third-variation"}});return a}),define("modules/order/orderTable/orderItemModel",["require","common/rawDataModel","common/dataService","common/dataUtils","common/globals","common/enums","common/itemType"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/dataUtils"),i=e("common/globals"),s=e("common/enums"),o=e("common/itemType"),u=["One-time","Weekly"],a,f=t.Model.extend({initialize:function(){this._synchData(),this.listenTo(i.eventBus,"dataUpdated",function(){this._synchData()})},_synchData:function(){a=n.getSharesMap();var e=a[this.rawData.shareKey];e&&(this.rawData=_.extend({},e,this.rawData))},rawValues:{addedToOrder:new t.Value("addedToOrder")},readers:{key:(new t.Value("key")).getValue,id:(new t.Value("id")).getValue,title:(new t.Value("title")).getValue,shareKey:(new t.Value("shareKey")).getValue,itemType:(new t.Value("itemType")).getValue,scheduleKey:(new t.Value("scheduleKey")).getValue,imageUrl:(new t.Value("imageURL")).getValue,price:"getPrice",reorderPrice:"getReorderPrice",quantity:(new t.Value("quantity")).getValue,unit:(new t.Value("unit")).getValue,unitQuantity:(new t.Value("unitQuantity")).getValue,orderDeliveryDate:(new t.Value("orderDeliveryDate")).getValue,isOrderLocked:(new t.Value("isOrderLocked")).getValue,total:"getTotal",frequency:"getFrequency",frequencies:"getFrequencies",disableEdit:"getDisableEdit",canAddShare:"canAddShare",disableRemove:"getDisableRemove",disableReorder:"getDisableReorder",disableReorderAdd:"getDisableReorderAdd",isTempUnavailable:"getIsTempUnavailable",isUnavailable:"getIsUnavailable",isSoldOut:(new t.Value("isSoldOut")).getValue,maxAllowedItems:"getMaxItems",isPromotedItemWithDiscount:"getIsPromotedItemWithDiscount",promotedNewMemberDiscount:(new t.Value("promotedNewMemberDiscount")).getValue,promotedExistReferralMemberDiscount:(new t.Value("promotedExistReferralMemberDiscount")).getValue,subscriptionDiscount:(new t.Value("subscriptionDiscount")).getValue,highlightItemInOrder:(new t.Value("extraProperties.highlightItemInOrder")).getValue,promotionDiscount:"getPromotionDiscount",isCutOff:"isCutOff",hasDiscount:"hasDiscount",discountPrice:"discountPrice",hasActiveVolumeDiscount:"hasActiveVolumeDiscount",priceBeforeDiscount:"priceBeforeDiscount",volumeDiscounts:"getVolumeDiscounts",categoryOrder:"getCategoryOrder",isCategoryTitle:(new t.Value("isCategoryTitle")).getValue},writers:{quantity:function(e,t){this.rawData.quantity=t}},getVolumeDiscounts:function(){return r.getVolumeDiscounts(this.rawData.volumeDiscounts,this.get("maxAllowedItems"))},getTotal:function(){return r.getItemTotal(this.rawData)},getFrequency:function(){var e=_.findWhere(this.rawData.schedules,{key:this.rawData.scheduleKey});return e&&!this.getIsTempUnavailable()?e.title:""},getFrequencies:function(){var e=this.getFrequency();return _.map(u,function(t){return{title:t,selected:t===e}})},getDisableRemove:function(){return n.getMarketData("orderLock").isOrderLocked},getDisableEdit:function(){return n.getMarketData("orderLock").isOrderLocked||this.get("isTempUnavailable")||this.get("isUnavailable")},canAddShare:function(){return!n.getMarketData("orderLock").isOrderLocked&&n.getMarketData("pickupSite").status!=s.EnumStatus.Pending&&!this.get("isTempUnavailable")&&!this.get("isUnavailable")&&!this.get("isSoldOut")},getDisableReorder:function(){return this.get("disableEdit")||this.get("addedToOrder")||this.get("isSoldOut")},getDisableReorderAdd:function(){return n.getMarketData("orderLock").isOrderLocked||this.get("isTempUnavailable")||this.get("isUnavailable")||this.get("isSoldOut")||this.get("addedToOrder")},getIsTempUnavailable:function(){return this.rawData.status==="TEMPORALLY_UNAVAILABLE"},getIsUnavailable:function(){return this.rawData.status==="UNAVAILABLE"},getMaxItems:function(){if(this.get("itemType")===o.Bundle){var e=n.getMarketData().orderData,t=_.map(this.rawData.bundleComponents,function(t){var n=a[t.itemKey],r=i.data.itemsInBundleQuantityMap[t.itemkey]||0,s=0;if(e){var o=_.findWhere(e,{shareKey:t.itemKey});o&&(s=o.quantity)}return n?n.maxPerMember-r-s:0});return t.push(this.rawData.maxPerMember),_.max([_.min(t),this.rawData.savedOrderQuantity])}var r=i.data.itemsInBundleQuantityMap[this.get("key")]||0;return this.rawData.maxPerMember-r},getIsPromotedItemWithDiscount:function(){var e=this.get("promotionDiscount");return e},getIsPromotedItem:function(){return this.rawData.isPromotedItem},getPromotionDiscount:function(){return r.getPromotionDiscount(this.rawData)},getPrice:function(){return r.getItemPrice(this.rawData)},getReorderPrice:function(){var e=this.get("promotionDiscount")||0;return this.rawData.price*(100-e)/100},isCutOff:function(){return n.getMarketData("orderLock").isOrderLocked},discountPrice:function(){return this.get("priceBeforeDiscount")},priceBeforeDiscount:function(){var e=a[this.get("key")];return a[this.get("key")]?e.price:this.get("price")},hasActiveVolumeDiscount:function(){var e=this.rawData.volumeDiscounts,t;if(e&&e.length){var n=this.get("quantity");for(var r=0;r<e.length;r++)n>=e[r].numberOfItems&&(t=e[r])}return t},hasDiscount:function(){return this.get("isPromotedItemWithDiscount")||this.get("volumeDiscounts")},getCategoryOrder:function(){if(this.rawData.isCategoryTitle)return this.rawData.categoryOrder;var e=[],t=this.rawData.subCategories,r=n.getMarketData("categories");return _.each(r,function(n){if(n.layout&&n.layout.name!=="SEASONAL"){var r=_.pluck(n.subCategories,"key"),i=_.intersection(r,t);i.length>0&&e.push(n.order)}}),_.min(e)}});return f}),define("modules/header/orderPopover/orderPopoverModule",["require","backbone","marionette","common/globals","common/nav","common/popover/popover","modules/header/orderPopover/orderPopoverView","common/marketModel","modules/order/orderModel","modules/order/orderTable/orderItemModel"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/nav"),s=e("common/popover/popover"),o=e("modules/header/orderPopover/orderPopoverView"),u=e("common/marketModel"),a=e("modules/order/orderModel"),f=e("modules/order/orderTable/orderItemModel"),l=t.Collection.extend({model:f}),c=n.Controller.extend({initialize:function(e){this._options=e,this.listenTo(r.eventBus,{"header:rendered":this.renderPopover,route:function(t){t==i.PageEnum.Order?$(e.linkSelector).popover("destroy"):this.renderPopover()}})},renderPopover:function(){var e=$(this._options.linkSelector),t=new u,n=new a,i=new o({model:t,collection:new l(n.get("orderItems"))});i.render(),s.create(e,i,{trigger:"hover",delay:400,className:"order-popover",container:e}),i.on({market:function(){r.eventBus.trigger("flow:header:market"),e.popover("hide")},order:function(){r.eventBus.trigger("flow:header:order")}}),e.on("shown.bs.popover",function(){i.setElement(i.el)})}});return c}),define("hbs!modules/header/orderPopover/creditPopoverTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="row">\r\n <div class="col-xs-3">\r\n     <div class="credit-icon"></div>\r\n </div>\r\n  <div class="col-xs-9 text-wrapper">\r\n      You\'ve got <b>',u={hash:{}},s+=f((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.credit,u):a.call(t,"currencyHelper",t&&t.credit,u)))+'</b> credit in your account!\r\n  </div>\r\n</div>\r\n<div class="button-wrapper">\r\n    <button class="button ok got-it">Got it</button>\r\n</div>\r\n',s});return n}),define("modules/header/orderPopover/creditPopoverModule",["require","marionette","common/globals","common/nav","common/popover/popover","common/marketModel","hbs!modules/header/orderPopover/creditPopoverTemplate","modules/header/orderPopover/orderPopoverModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/nav"),i=e("common/popover/popover"),s=e("common/marketModel"),o=e("hbs!modules/header/orderPopover/creditPopoverTemplate"),u=e("modules/header/orderPopover/orderPopoverModule"),a=t.ItemView.extend({template:o,events:{"click .got-it":"_closePopover"},_closePopover:function(e){this.trigger("closePopover"),e.stopPropagation()}}),f=t.Controller.extend({initialize:function(e){this._options=e,this.listenTo(n.eventBus,{route:function(t){t==r.PageEnum.Order&&$(e.linkSelector).popover("destroy")}})},renderPopover:function(){var e=$(this._options.linkSelector),t=this._options.selector,n=new s,r=new a({model:n});r.render();var o=i.create(e,r,{className:"credit-popover",container:e,placement:t?"top":"bottom",avoidReRender:!0,isShow:!0,isAuto:!0,isDismissible:!0,hasClose:!1});r.on({closePopover:function(){o.hide()}}),e.on("shown.bs.popover",function(){r.setElement(r.el)}),e.on("hidden.bs.popover",function(){(new u({linkSelector:"header a.order"})).renderPopover()})}});return f}),define("modules/header/headerModule",["require","marionette","common/globals","common/dataService","common/utils","common/nav","common/marketModel","common/memberCheckpoint","modules/header/headerView","modules/header/orderPopover/orderPopoverModule","modules/header/orderPopover/creditPopoverModule","modules/referral/referralModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/dataService"),i=e("common/utils"),s=e("common/nav"),o=e("common/marketModel"),u=e("common/memberCheckpoint"),a=e("modules/header/headerView"),f=e("modules/header/orderPopover/orderPopoverModule"),l=e("modules/header/orderPopover/creditPopoverModule"),c=e("modules/referral/referralModule"),h,p=!1,d=t.Controller.extend({initialize:function(e){this.region=e.region},show:function(){var e=function(){setTimeout(function(){var e=Object.keys(s.getParams()).some(function(e){return s.PROMOTIONAL_PARAMS.lastIndexOf(e)!=-1});!e&&h.model.get("senderReferral")&&!h.model.get("hasPaymentIssue")&&!h.model.shouldDisplayGroupBuying()&&!h.model.isGroupBuyingDisplayedAlready()&&(!h.model.shouldDisplayPostalDelivery()||!!h.model.isPostalDeliveryDisplayedAlready())&&h.model.ignoreFavoritesPopOver()&&(c.getInstance().showSenderModal("header a.sender-referral",!0),p=!localStorage.popover_senderReferral)},300)};h?this.stopListening(h):this.listenTo(n.eventBus,{route:function(e){h.selectOption(e),u.handle()},dataUpdated:function(){h.model.synchData(),h.render(),this._isMemberJustLoggedIn&&(e(),this._isMemberJustLoggedIn=!1)},login:function(){this._isMemberJustLoggedIn=!0},shareChanged:function(){h.render()},"header:showCommunityInfo":function(){h.showCommunityInfo()}}),h=new a({model:new o}),this.region.show(h);if(!h.model.get("hasPaymentIssue")){var t=r.getMarketData("nextDeliveryDate");setTimeout(function(){h.model.getCredit()>0&&localStorage.showedCreditPopover!==t&&!i.isMobile()&&!p?(localStorage.showedCreditPopover=t,(new l({linkSelector:".order-tab-wrapper"})).renderPopover()):(new f({linkSelector:"header a.order"})).renderPopover()},400)}e()},getOrderLink:function(){return h.ui.orderLink},getHeight:function(){return h.$el.height()}}),v;return{getInstance:function(e){return v===undefined&&(v=new d(e)),v}}}),define("common/handlebars/helpers/pluralNounHelper",["require","hbs/handlebars"],function(e){var t=e("hbs/handlebars"),n=function(e,t){return e+(t>1?"s":"")};return t.registerHelper("pluralNounHelper",n),n}),define("hbs!modules/marketPanels/marketHeaderTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/pluralNounHelper","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/formatHourHelper","common/handlebars/helpers/marketHeader_formatTimeRemainingHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"order-saved"}function d(e,t){return"order-canceled"}function v(e,t){return"order-dirty"}function m(e,t){var r="",i,s;return r+='\n				<div class="stripe-title arrowed">\n					',(i=n.missingOrderCount)?i=i.call(e,{hash:{}}):(i=e&&e.missingOrderCount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+" more ",s={hash:{}},r+=l((i=n.pluralNounHelper||e&&e.pluralNounHelper,i?i.call(e,"order",e&&e.missingOrderCount,s):c.call(e,"pluralNounHelper","order",e&&e.missingOrderCount,s)))+' needed to launch<span class="hidden-xs"> this community</span>.<i class="tooltip-anchor hidden-xs"></i>\n				</div>\n			',r}function g(e,t){var r="",i,s;return r+="\n							Order closed <em>",s={hash:{}},r+=l((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s):c.call(e,"formatDateHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s)))+"</em>\n						",r}function y(e,t){var r="",i;r+="\n							",i=n["if"].call(e,e&&e.isMoreThanWeekToCutoff,{hash:{},inverse:h.program(14,w,t),fn:h.program(12,b,t)});if(i||i===0)r+=i;return r+="\n						",r}function b(e,t){var r="",i,s;return r+="\n								Order by Midnight, <em>",s={hash:{}},r+=l((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%b %d",s):c.call(e,"formatDateHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%b %d",s)))+"</em>\n							",r}function w(e,t){var r="",i,s;return r+="\n								<em>",s={hash:{}},r+=l((i=n.marketHeader_formatTimeRemainingHelper||e&&e.marketHeader_formatTimeRemainingHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.hoursRemainingForStoreClose),s):c.call(e,"marketHeader_formatTimeRemainingHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.hoursRemainingForStoreClose),s)))+'</em> left<span class="hidden-sm"> to order</span>\n							',r}function E(e,t){var r="",i,s;r+="\n					",s=n["if"].call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.isStoreClosed),{hash:{},inverse:h.program(17,S,t),fn:h.noop});if(s||s===0)r+=s;return r+="\n				",r}function S(e,t){var r="",i;r+="\n						",i=n["if"].call(e,e&&e.isMoreThanWeekToCutoff,{hash:{},inverse:h.program(18,x,t),fn:h.noop});if(i||i===0)r+=i;return r+="\n					",r}function x(e,t){return'\n                            <div class="postal-delivery-button">\n                                Try out home delivery!\n                            </div>\n						'}function T(e,t){var r="",i;r+='\n					<div class="delivery-details-item order-status pull-right-sm">\n						<i></i>\n						<div class="title">\n							',i=n["if"].call(e,e&&e.isOrderDirty,{hash:{},inverse:h.program(24,k,t),fn:h.program(21,N,t)});if(i||i===0)r+=i;return r+="\n						</div>\n					</div>\n				",r}function N(e,t){var r="",i;r+="\n								Order not yet confirmed.\n								",i=n["if"].call(e,e&&e.isMarketPage,{hash:{},inverse:h.noop,fn:h.program(22,C,t)});if(i||i===0)r+=i;return r+="\n							",r}function C(e,t){return'\n									<a class="confirm-order-link">Confirm <span class="hidden-xs">your order</span> &raquo;</a>\n								'}function k(e,t){var r="",i;r+="\n								",i=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:h.program(27,A,t),fn:h.program(25,L,t)});if(i||i===0)r+=i;return r+="\n							",r}function L(e,t){return"\n									Order successfully placed\n								"}function A(e,t){return"\n									Order canceled\n								"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<section class="market-header">\n	<div class="info-items ',o=n["if"].call(t,t&&t.isOrderHasSavedItems,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t&&t.isOrderCanceled,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t&&t.isOrderDirty,{hash:{},inverse:h.noop,fn:h.program(5,v,i)});if(o||o===0)s+=o;s+='">\n		<div class="container">\n			',o=n["if"].call(t,t&&t.isGoalNotReached,{hash:{},inverse:h.noop,fn:h.program(7,m,i)});if(o||o===0)s+=o;s+='\n			<div class="clearfix">\n				<div class="delivery-details-item pickup-on pull-left-sm">\n					<i></i>\n					<div class="title">\n						<span class="hidden-sm">Pickup on </span><em>',a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.nextDeliveryDate,"%b %d",a):c.call(t,"formatDateHelper",t&&t.nextDeliveryDate,"%b %d",a)))+" at ",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a)))+"-",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a):c.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a)))+'</em> -\n						<a class="map-link">location</a>\n					</div>\n				</div>\n\n				<div class="delivery-details-item order-by pull-left-sm">\n					<i></i>\n					<div class="title">\n						',u=n["if"].call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.isStoreClosed),{hash:{},inverse:h.program(11,y,i),fn:h.program(9,g,i)});if(u||u===0)s+=u;s+="\n					</div>\n				</div>\n\n				",u=n["if"].call(t,t&&t.shouldDisplayPostalDelivery,{hash:{},inverse:h.noop,fn:h.program(16,E,i)});if(u||u===0)s+=u;s+="\n\n				",u=n["if"].call(t,t&&t.isShowOrderStatus,{hash:{},inverse:h.noop,fn:h.program(20,T,i)});if(u||u===0)s+=u;return s+="\n			</div>\n		</div>\n	</div>\n</section>\n",s});return n}),define("hbs!modules/postalDelivery/deliveryFormTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function u(e,t){return'\n    <iframe class="pull-left" src="https://docs.google.com/forms/d/11kKwtsvDUl-gztYmwcc1hi-Wvj0oIDvOgszb1vR_NLg/viewform?embedded=true"\n            width="100%" height="1500" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>\n'}function a(e,t){return'\n    <iframe class="pull-left" src="https://docs.google.com/forms/d/1tYO48-jn4CnDW23fsm8-z7RnrsmS_LBQVheoJ2a4uAo/viewform?embedded=true"\n            width="100%" height="1500" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,o=this;return s=n["if"].call(t,t&&t.isProduction,{hash:{},inverse:o.program(3,a,i),fn:o.program(1,u,i)}),s||s===0?s:""});return n}),define("modules/postalDelivery/deliveryFormView",["require","marionette","hbs!modules/postalDelivery/deliveryFormTemplate","common/dataService"],function(e){var t=e("marionette"),n=e("hbs!modules/postalDelivery/deliveryFormTemplate"),r=e("common/dataService"),i=t.LayoutView.extend({template:n,initialize:function(){this.model.set("isProduction",r.isProduction)}});return i}),define("modules/marketPanels/marketHeaderView",["require","marionette","common/globals","common/utils","hbs!modules/marketPanels/marketHeaderTemplate","common/handlebars/helpers/formatDateHelper","common/modal/modal","modules/postalDelivery/deliveryFormView"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/utils"),i=e("hbs!modules/marketPanels/marketHeaderTemplate"),s=e("common/handlebars/helpers/formatDateHelper"),o=e("common/modal/modal"),u=e("modules/postalDelivery/deliveryFormView"),a=t.LayoutView.extend({template:i,events:{"click .map-link":"_onOpenCommunityModal","click .confirm-order-link":"_onOrder","click .postal-delivery-button":"openDeliveryForm"},ui:{tooltipAnchor:".tooltip-anchor"},onBeforeRender:function(){var e=this.model;e.set("isShowOrderStatus",e.get("isOrderDirty")&&!r.clientViewPort.isXs()||!e.get("isOrderDirty")&&(e.get("isOrderHasSavedItems")||e.get("isOrderCanceled")))},onRender:function(){var e;this.model.get("isGoalNotReached")&&(e="This community is "+(this.model.get("isRelaunchGoalNotReached")?"re-launching its deliveries":"launching its first delivery")+""+". It must reach a minimum of "+this.model.get("pickupSite").minCapacity+" orders by "+s(this.model.get("orderLock").storeCloseDate,"%A")+" night.",this.ui.tooltipAnchor.tooltip({title:e,placement:"bottom"}))},_onOpenCommunityModal:function(){n.eventBus.trigger("header:showCommunityInfo")},_onOrder:function(e){n.eventBus.trigger("analytics:event","Community-market","Confirm order clicked","",0,!0),n.eventBus.trigger("flow:header:order")},openDeliveryForm:function(){n.eventBus.trigger("analytics:event","Community-market","Info header - Try home delivery clicked","",0,!0);var e=new u({model:new Backbone.Model});o.show(e,{className:"experiment-modal delivery-form-modal",isDisallowCloseByRoute:!0,isAuto:!0})}});return a}),define("hbs!modules/marketPanels/checkoutPanelTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+="\r\n                ",i=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:f.noop,fn:f.program(2,p,t)});if(i||i===0)r+=i;return r+="\r\n            ",r}function p(e,t){var r="",i;r+='\r\n                    <button class="button light cancel-order-changes" loading-animation ',i=n["if"].call(e,e&&e.disableOrderButton,{hash:{},inverse:f.noop,fn:f.program(3,d,t)});if(i||i===0)r+=i;return r+=">\r\n                        Cancel\r\n                    </button>\r\n                ",r}function d(e,t){return"disabled"}function v(e,t){var r;return r=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:f.noop,fn:f.program(6,m,t)}),r||r===0?r:""}function m(e,t){return"small"}function g(e,t){return"\r\n					Confirm Order\r\n				"}function y(e,t){var r="",i;r+="\r\n					",i=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:f.program(13,w,t),fn:f.program(11,b,t)});if(i||i===0)r+=i;return r+="\r\n				",r}function b(e,t){return"\r\n						Update Order\r\n					"}function w(e,t){return"\r\n						Place order\r\n					"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression;s+='<section>\r\n	<div class="panel-container">\r\n		<div>\r\n			Total: <em>',a={hash:{}},s+=c((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.totalDue,a):l.call(t,"currencyHelper",t&&t.totalDue,a)))+"</em>\r\n		</div>\r\n		<div>\r\n            ",u=n.unless.call(t,t&&t.isMarketPage,{hash:{},inverse:f.noop,fn:f.program(1,h,i)});if(u||u===0)s+=u;s+='\r\n\r\n    <button class="button checkout ',u=n.unless.call(t,t&&t.isMarketPage,{hash:{},inverse:f.noop,fn:f.program(5,v,i)});if(u||u===0)s+=u;s+='" loading-animation>\r\n				',u=n["if"].call(t,t&&t.isMarketPage,{hash:{},inverse:f.program(10,y,i),fn:f.program(8,g,i)});if(u||u===0)s+=u;return s+="\r\n			</button>\r\n		</div>\r\n	</div>\r\n</section>\r\n",s});return n}),define("modules/marketPanels/checkoutPanelView",["require","marionette","common/dataService","common/globals","hbs!modules/marketPanels/checkoutPanelTemplate","common/handlebars/helpers/formatDateHelper"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("common/globals"),i=e("hbs!modules/marketPanels/checkoutPanelTemplate"),s=e("common/handlebars/helpers/formatDateHelper"),o=t.LayoutView.extend({template:i,events:{"click .checkout":"_onOrder","click .cancel-order-changes":"_onCancel"},ui:{checkoutPanel:".checkout-panel",tooltipAnchor:".tooltip-anchor"},_onOrder:function(e){this.model.get("isMarketPage")?(r.eventBus.trigger("analytics:event","Community-market","Confirm order clicked","",0,!0),r.eventBus.trigger("flow:header:order")):r.eventBus.trigger("checkout","panelClick")},_onCancel:function(){return r.eventBus.trigger("analytics:event","Community-order","cancel clicked (bottom)"),n.loadMarketData()}});return o}),define("hbs!modules/communityModal/promotions/minimumOrderTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<div class="minimum-order">\n    <div class="top-img"></div>\n    <h1 class="title">Spend $',(o=n.minimumOrder)?o=o.call(t,{hash:{}}):(o=t&&t.minimumOrder,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+', <span class="save">save $',(o=n.discount)?o=o.call(t,{hash:{}}):(o=t&&t.discount,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'!</span></h1>\n    <p class="description">It couldn\'t be simpler! From now until ',(o=n.expirationDate)?o=o.call(t,{hash:{}}):(o=t&&t.expirationDate,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+', redeem coupon code <span class="coupon">',(o=n.minimumOrderCoupon)?o=o.call(t,{hash:{}}):(o=t&&t.minimumOrderCoupon,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"</span>\n        at checkout for <b>$",(o=n.discount)?o=o.call(t,{hash:{}}):(o=t&&t.discount,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+" off</b> your order of $",(o=n.minimumOrder)?o=o.call(t,{hash:{}}):(o=t&&t.minimumOrder,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+' or more.\n    </p>\n    <div class="button-wrapper">\n        <button class="button shop">Shop now and save</button>\n    </div>\n    <p class="bottom-text">Only one coupon can be used per order.</p>\n</div>\n',s});return n}),define("modules/communityModal/promotions/minimumOrderModule",["require","marionette","common/utils","common/globals","common/modal/modal","common/dataService","hbs!modules/communityModal/promotions/minimumOrderTemplate"],function(e){var t=e("marionette"),n=e("common/utils"),r=e("common/globals"),i=e("common/modal/modal"),s=e("common/dataService"),o=e("hbs!modules/communityModal/promotions/minimumOrderTemplate"),u=t.ItemView.extend({template:o,events:{"click .shop":function(){this.trigger("minimumOrder:shopClicked")}},initialize:function(){r.eventBus.trigger("analytics:event","Community-market","Promotion popup - opened","$"+this.model.get("discount")+" off $"+this.model.get("minimumOrder"),0,!1)}});return{show:function(e){var t=s.getMarketData("minimumOrderCoupon")||{},r=new Backbone.Model({});r.set("minimumOrderCoupon",t.id),r.set("expirationDate",dateFormat(n.parseFromServerDate(t.expirationDate),"mmmm dS")),r.set("discount",t.discount),r.set("minimumOrder",t.minimumOrder);var o=new u({model:r}),a=i.show(o,{className:"experiment-modal",isDisallowCloseByRoute:!0,isAuto:e,isOnce:!0,key:"minimum_order"});o.on("minimumOrder:shopClicked",function(){i.close()})}}}),define("hbs!modules/multiValueDiscount/multiValueDiscountTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='Coupon: <b class="coupon-code lettuce">',(i=n.couponCode)?i=i.call(e,{hash:{}}):(i=e&&e.couponCode,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</b>",r}function d(e,t){return"Spend more, save more!"}function v(e,t){var r="",i;r+='\n                        <span class="discount-point" style="left:',(i=n.width)?i=i.call(e,{hash:{}}):(i=e&&e.width,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'%"><span class="value">$',(i=n.value)?i=i.call(e,{hash:{}}):(i=e&&e.value,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'</span><img class="success-image',i=n["if"].call(e,e&&e.goalReached,{hash:{},inverse:c.noop,fn:c.program(6,m,t)});if(i||i===0)r+=i;return r+='" src="/site/market/images/check.svg" alt="success"></span>\n                    ',r}function m(e,t){return" goal-reached"}function g(e,t){var r="",i;return r+='\n            <div class="goal-reached-message tooltip fade bottom in">\n                <div class="tooltip-arrow"></div>\n                <div class="tooltip-inner">\n                    <button type="button" class="close"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>\n                    <span class="lettuce">Woohoo!</span> Use coupon code <b class="coupon-code lettuce">',(i=n.couponCode)?i=i.call(e,{hash:{}}):(i=e&&e.couponCode,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</b> for $"+l((i=(i=e&&e.coupon,i==null||i===!1?i:i.discount),typeof i===f?i.apply(e):i))+" off.\n                </div>\n            </div>\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='    <div class="flex-container">\n        <div class="flex-item coupon-call-to-action">',o=n["if"].call(t,t&&t.isCouponActive,{hash:{},inverse:c.program(3,d,i),fn:c.program(1,p,i)});if(o||o===0)s+=o;s+='</div>\n        <div class="flex-item fill-space progress-container">\n            <div class="progress">\n                <div class="progress-bar progress-bar-success" role="progressbar" style="width: ',(o=n.normalizedOrderTotal)?o=o.call(t,{hash:{}}):(o=t&&t.normalizedOrderTotal,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'%">\n                    ',o=n.each.call(t,t&&t.discountPoints,{hash:{},inverse:c.noop,fn:c.program(5,v,i)});if(o||o===0)s+=o;s+='\n\n                    <span class="value-tooltip">',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.orderTotal,a):h.call(t,"currencyHelper",t&&t.orderTotal,a)))+'</span>\n                </div>\n\n            </div>\n        </div>\n        <div class="learn-more-container flex-item flex-container center">\n            <img class="discount-image " src="/site/market/images/discount_Icon_Small.svg" alt="learn more">\n            ',u=n["if"].call(t,t&&t.showGoalReachedTooltip,{hash:{},inverse:c.noop,fn:c.program(8,g,i)});if(u||u===0)s+=u;return s+='\n            <a class="learn-more">Learn more <span class="arrow"></span></a>\n        </div>\n        <div class="question-mark learn-more">?</div>\n    </div>\n',s});return n}),define("hbs!modules/multiValueDiscount/multiValueDiscountPopupTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+="\n                <p>Spend <b>$",(i=n.minimumOrder)?i=i.call(e,{hash:{}}):(i=e&&e.minimumOrder,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'+</b> and get <b><span class="lettuce">$',(i=n.discount)?i=i.call(e,{hash:{}}):(i=e&&e.discount,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+" off</span></b> your order.</p>\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="multi-discount-popup">\n    <div class="top-img"></div>\n    <div>\n        <div>\n            <p class="title"><b>Spend more, <span class="lettuce">save more!</span></b></p>\n\n            ',o=n.each.call(t,t&&t.coupons,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n\n            <a class="button shop lettuce">Shop now!</a>\n        </div>\n        <div class="bottom-msg">\n            <p><b>OFFER DETAILS</b></p>\n            <p>As soon as you hit the minimum, we’ll share a coupon code with you — use that code at checkout to receive\n                your discount! The discount adjusts automatically based on how much you’ve spent. This offer cannot be\n                combined with other coupons.</p>\n        </div>\n    </div>\n</div>\n',s});return n}),define("modules/multiValueDiscount/multiValueDiscountModule",["require","common/enums","common/globals","marionette","common/rawDataModel","hbs!modules/multiValueDiscount/multiValueDiscountTemplate","hbs!modules/multiValueDiscount/multiValueDiscountPopupTemplate","common/modal/modal","common/dataService","common/dataUtils","common/dataUtils/couponDataUtils"],function(e){var t=e("common/enums"),n=e("common/globals"),r=e("marionette"),i=e("common/rawDataModel"),s=e("hbs!modules/multiValueDiscount/multiValueDiscountTemplate"),o=e("hbs!modules/multiValueDiscount/multiValueDiscountPopupTemplate"),u=e("common/modal/modal"),a=e("common/dataService"),f=e("common/dataUtils"),l=e("common/dataUtils/couponDataUtils"),c=i.Model.extend({rawValues:{hideTooltip:new i.Value("hideTooltip")},readers:{showGoalReachedTooltip:"showGoalReachedTooltip",orderTotal:f.getOrderTotal,nestedCoupons:(new i.Value("multiValueCoupon.nestedCoupons")).getValue,couponCode:(new i.Value("multiValueCoupon.id")).getValue,coupon:"getCoupon",isCouponActive:"getIsCouponActive",discountPoints:"getDiscountPoints",maxDiscountPoint:"getMaxDiscountPoint",normalizedOrderTotal:"getNormalizedOrderTotal"},showGoalReachedTooltip:function(){return this.get("isCouponActive")&&!this.get("hideTooltip")},getCoupon:function(){var e=this.get("orderTotal"),t=_.sortBy(this.get("nestedCoupons"),function(e){return-e.minimumOrder});for(var n=0,r=t.length;n<r;n++){var i=t[n];if(e>i.minimumOrder)return i}return 0},getIsCouponActive:function(){var e=this.get("orderTotal"),t=this.get("nestedCoupons"),n=_.min(_.pluck(t,"minimumOrder"));return e>=n},getDiscountPoints:function(){var e=this.get("orderTotal"),t=this.getMaxDiscountPoint(),n=this.get("nestedCoupons");return n.map(function(n){return{width:n.minimumOrder*100/t,value:n.minimumOrder,goalReached:e>=n.minimumOrder}})},getNormalizedOrderTotal:function(){var e=this.getMaxDiscountPoint(),t=this.get("orderTotal");return t>e&&(t=e),t*100/e},getMaxDiscountPoint:function(){var e=this.get("nestedCoupons"),t=_.max(_.pluck(e,"minimumOrder"));return t+3}}),h=r.ItemView.extend({template:s,events:{"click .learn-more":"showPopup","click button.close":"closeTooltip"},initialize:function(){this.listenTo(n.eventBus,{shareChanged:this.render,totalChanged:this.render},this),this.model.get("isCouponActive")&&this.model.set("hideTooltip",!0)},onRender:function(){if(this.model.get("showGoalReachedTooltip")){var e=this.model.get("coupon");n.eventBus.trigger("analytics:event","Community-market","Promotion popup - reached amount","staggered coupon - "+this.model.get("couponCode"))}this.model.get("isCouponActive")||this.model.set("hideTooltip",!1)},showPopup:function(){d(!0,!0)},closeTooltip:function(){this.model.set("hideTooltip",!0),this.render()}}),p=r.ItemView.extend({template:o,events:{"click .shop":"close"},onRender:function(){var e=this.model.get("coupon");n.eventBus.trigger("analytics:event","Community-market","Promotion popup - opened","staggered coupon - "+this.model.get("couponCode"))},close:function(){this.trigger("close-modal")}}),d=function(e,t){var n=a.getMarketData("multiValueCoupon")||{},r=new Backbone.Model({});r.set({coupons:n.nestedCoupons,couponCode:n.id});var i=new p({model:r}),s=u.show(i,{className:"experiment-modal",isDisallowCloseByRoute:!0,isAuto:e,isOnce:t?!1:!0,key:"multi_coupon"});i.on("close-modal",function(){u.close(),i.off()})};return{getPanelView:function(e){return new h({model:new c(e)})},showPopup:d}}),define("modules/marketPanels/marketPanelsModule",["require","marionette","common/globals","common/globalMessage","common/nav","common/utils","common/dataUtils","common/handlebars/helpers/formatDateHelper","common/marketModel","modules/marketPanels/marketHeaderView","modules/marketPanels/checkoutPanelView","common/handlebars/helpers/discountHelper","modules/communityModal/promotions/minimumOrderModule","modules/multiValueDiscount/multiValueDiscountModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/globalMessage"),i=e("common/nav"),s=e("common/utils"),o=e("common/dataUtils"),u=e("common/handlebars/helpers/formatDateHelper"),a=e("common/marketModel"),f=e("modules/marketPanels/marketHeaderView"),l=e("modules/marketPanels/checkoutPanelView"),c=e("common/handlebars/helpers/discountHelper"),h=e("modules/communityModal/promotions/minimumOrderModule"),p=e("modules/multiValueDiscount/multiValueDiscountModule"),d=t.Controller.extend({initialize:function(){this.listenTo(n.eventBus,{route:function(e){e==i.PageEnum.Market||e==i.PageEnum.Order?this._show(e):this._hide()},"referral:recipient:got-discount":function(){this._isGotRecipientDiscount=!0,this._showRecipientMessage()},dataUpdated:function(){this._renderView(!0),this._handleMultiCouponVisibility()},shareChanged:function(){this._renderView(),this._handleMultiCouponVisibility()},"change-subscription:order-updated":function(){this._handleMultiCouponVisibility()},orderDirty:function(e){this._renderView()}})},_handleMultiCouponVisibility:function(){var e=r.getKey(),t=e==="multiCoupon",n=m.get("shouldDisplayMultiValueDiscount");n&&!t&&e!=="paymentProcessed"&&this._showAppropriateGlobalMessage(),t&&!n&&r.hide()},_show:function(e){m=new a,m.set("isMarketPage",e==i.PageEnum.Market),g=new f({model:m}),this.options.marketHeaderRegion.show(g),s.clientViewPort.isXs()&&(this._isCheckoutPanelVisible=!0,this.options.checkoutPanelRegion.hasView()&&!y.isDestroyed?(y.model=m,y.render()):(y=new l({model:m}),this.options.checkoutPanelRegion.show(y)),this._handleCheckoutPanelVisibility()),this._showAppropriateGlobalMessage()},_hide:function(){this.options.marketHeaderRegion.empty(),this._isCheckoutPanelVisible=!1,this._handleCheckoutPanelVisibility()},_renderView:function(e){m=m||new a,e&&m.synchData(),this.options.marketHeaderRegion.hasView()&&g.render(),this.options.checkoutPanelRegion.hasView()&&y&&(y.render(),this._handleCheckoutPanelVisibility(!0))},_handleCheckoutPanelVisibility:function(){this.options.checkoutPanelRegion.$el.toggleClass("visible",this._isCheckoutPanelVisible&&m.get("isOrderDirty"))},_showAppropriateGlobalMessage:function(){var e=g.model.get("orderLock"),t=g.model.get("senderReferral"),i,a,f;if(e.isStoreClosed)r.show(e.lockText,r.AlertType.warning,{isDismissible:!1});else if(o.isAutoCouponApplied())r.show("Your "+c(g.model.get("couponDiscount"),g.model.get("couponIsFixedAmount"),!0)+" discount has been applied. Complete your order and enjoy!",r.AlertType.success,{isOnceDuringSession:!0,key:r.KEYS.AutoCouponApplied});else if(this._isGotRecipientDiscount)this._showRecipientMessage();else if(e.isPostponedDelivery)i="<em>Heads up!</em> You are ordering for pick-up on <em>"+u(g.model.get("nextDeliveryDate"),"%A, %B %d")+"</em>. Orders for this "+g.model.get("pickupSite").deliveryDays+" are closed.",s.clientViewPort.isXs()||(i+=' <span class="tooltip-anchor"></span>'),f=r.show(i,r.AlertType.info,{isDismissible:!1}),s.clientViewPort.isXs()||(a="Orders for the pick-up day, "+u(g.model.get("regionNextDeliveryDate"),"%B %d")+", are already sent to our producers and are currently being prepared, but you can go ahead and order for the next pick-up on "+u(g.model.get("nextDeliveryDate"),"%B %d")+".",f.$el.find(".tooltip-anchor").tooltip({title:a,placement:"bottom",trigger:"hover click"}));else{if(r.getKey()==="paymentProcessed")return;m.get("shouldDisplayMultiValueDiscount")?this._showMultiCouponView():m.shouldDisplayMinimumOrder()?(r.show("Redeem coupon code <b>"+m.get("minimumOrderCouponId")+"</b> at checkout for $"+m.get("minimumOrderCouponDiscount")+" off your order of $"+m.get("minimumOrderCouponMinimumOrder")+'+ <a><span class="tooltip-anchor"></span></a>',r.AlertType.success,{isDismissible:!1,className:"minimum-order-alert"}).on("link:clicked",function(){n.eventBus.trigger("analytics:event","Community-market / Community-order","Promotion banner -  details clicked","$"+m.get("minimumOrderCouponDiscount")+" off $"+m.get("minimumOrderCouponMinimumOrder"),0,!1),h.show(!1)}),n.eventBus.trigger("analytics:event","Community-market","Promotion banner shown","$"+m.get("minimumOrderCouponDiscount")+" off $"+m.get("minimumOrderCouponMinimumOrder"),0,!1)):n.model.get("mergeCouponErrorMessage")&&(r.show(n.model.get("mergeCouponErrorMessage"),r.AlertType.warning),n.model.set("mergeCouponErrorMessage",""))}},_showRecipientMessage:function(){var e=g.model.get("recipientDiscount"),t=g.model.get("referredBy"),i;if(e&&t){i="You got a "+c(e,g.model.get("isRecipientDiscountFixed"),!0)+" gift credit for your first order, thanks to your friend "+t+"!",r.show(i,r.AlertType.success,{isOnceDuringSession:!0,key:"gotRecipientDiscount"});var s=m.get("order");s&&s.length&&m.get("referralInstanceSet")&&(n.data.setIsOrderDirty(!0),g.render())}},_showMultiCouponView:function(){var e=p.getPanelView(m.rawData);r.show(e,r.AlertType.untyped,{isOnceDuringSession:!1,key:"multiCoupon",isMessageView:!0,isDismissible:!1,className:"multi-value-discount",parentClassName:"multi-value-discount-container"})}}),v,m,g,y;return{getInstance:function(e){return v===undefined&&(v=new d(e)),v}}}),define("modules/helpTab/helpTabModel",["require","common/rawDataModel","common/marketModel","common/dataService","common/nav"],function(e){var t=e("common/rawDataModel"),n=e("common/marketModel"),r=e("common/dataService"),i=e("common/nav"),s="http://help.farmigo.com/hc/en-us/articles/",o,u=t.Model.extend({initialize:function(){this._marketModel=new n(this.rawData)},synchData:function(){this._marketModel.synchData()},readers:{links:function(){var e=n.hasPaymentIssue()?"PaymentIssue":i.getPageName(),t=o.LinkIds[e],u,a=[];if(t)return Array.isArray(t)?u=t:r.serverData.memberKey?u=t.Member:(u=t.NoMember,u==undefined&&(u=this.get("isGoalNotReached")?t.Incubating:t.Delivering)),u.forEach(function(e){var t=o.Links[e];t.path&&(t.url=s+t.path,a.push(t))}),a},isGoalNotReached:function(){return this._marketModel.get("isGoalNotReached")},urls:function(){return r.serverData.urls}}});return{getInstance:function(){var e=new $.Deferred;return $.getJSON("/staticResource/resources/helpTabData.json").done(function(t){o=t,e.resolve(new u)}),e}}}),define("hbs!modules/helpTab/helpTabTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n				<li>\n					<a href="'+a((r=e&&e.url,typeof r===u?r.apply(e):r))+'" target="_blank">'+a((r=e&&e.question,typeof r===u?r.apply(e):r))+"</a>\n				</li>\n			",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="help-tab">\n	<div class="help-links">\n		<ul class="links dynamic">\n			',o=n.each.call(t,t&&t.links,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n		</ul>\n		<ul class="links fixed">\n			<li>\n				<a class="browse-faq" href="'+a((o=(o=t&&t.urls,o==null||o===!1?o:o.faq),typeof o===u?o.apply(t):o))+'" target="_blank">Browse FAQ</a>\n			</li>\n			<li>\n				<a class="contact" href="'+a((o=(o=t&&t.urls,o==null||o===!1?o:o.contact),typeof o===u?o.apply(t):o))+'" target="_blank">Contact Support</a>\n			</li>\n		</ul>\n	</div>\n	<a class="help-toggle">\n		<span class="text">Help</span>\n		<i></i>\n	</a>\n</div>',s});return n}),define("modules/helpTab/helpTabModule",["require","marionette","common/globals","common/nav","common/utils","modules/helpTab/helpTabModel","hbs!modules/helpTab/helpTabTemplate"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/nav"),i=e("common/utils"),s=e("modules/helpTab/helpTabModel"),o=e("hbs!modules/helpTab/helpTabTemplate"),u,a,f=t.ItemView.extend({template:o,events:{"click a.help-toggle":"_onHelpToggle","click .links a":"_onLinkClicked"},ui:{helpTab:".help-tab"},_onHelpToggle:function(){var e=this.ui.helpTab.hasClass("open");this.ui.helpTab.toggleClass("open"),this._track(e?"Help tab closed":"Help tab opened")},_onLinkClicked:function(e){var t=$(e.currentTarget);this.ui.helpTab.removeClass("open"),t.hasClass("browse-faq")?this._track("Browse FAQ clicked"):t.hasClass("contact")?this._track("Contact support clicked"):this._track("FAQ clicked",t.text())},_track:function(e,t){n.eventBus.trigger("analytics:pageEvent","help",e,r.getPage().path+(t?" - "+t:""))}}),l=t.Controller.extend({initialize:function(e){this.region=e.region},show:function(){!i.clientViewPort.isXs()&&!1&&s.getInstance().then(function(e){a=new f({model:e}),this.region.show(a),this.listenTo(n.eventBus,{route:function(e){a.render()},dataUpdated:function(){a.model.synchData(),a.render()}})}.bind(this))}});return{getInstance:function(e){return u=u||new l(e)}}}),define("hbs!modules/communityCheckpoint/communityOnHoldTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/fullNameHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var i="",s,o,c;i+='\n	<h1 class="heading">Hang on a second!</h1>\n	<div class="notes">\n		<p>Hey there!</p>\n		<p>\n			Our community is on hold for now. The next delivery will be on <em>',c={hash:{}},i+=a((s=n.formatDateHelper||e&&e.formatDateHelper,s?s.call(e,e&&e.nextDeliveryDate,"%B %d",c):u.call(e,"formatDateHelper",e&&e.nextDeliveryDate,"%B %d",c)))+"</em>.\n			Mark your calendar for <em>",c={hash:{}},i+=a((s=n.formatDateHelper||e&&e.formatDateHelper,s?s.call(e,e&&e.nextOrderWindowOpenDate,"%B %d",c):u.call(e,"formatDateHelper",e&&e.nextOrderWindowOpenDate,"%B %d",c)))+'</em> to get your order in!\n		</p>\n		<p>If you have any questions, feel free to contact me. In the meantime, you can also find another community near you.</p>\n		<p>Thanks!</p>\n	</div>\n	<div class="organizer">\n		<div class="vcenter">\n			',o=f.invokePartial(r.organizerImage,"organizerImage",e,n,r);if(o||o===0)i+=o;return i+='\n		</div>\n		<div class="organizer-details vcenter">\n			<div class="organizer-title">Organizer</div>\n			<h3 class="name">',c={hash:{}},i+=a((s=n.fullNameHelper||e&&e.fullNameHelper,s?s.call(e,e&&e.firstName,e&&e.lastName,c):u.call(e,"fullNameHelper",e&&e.firstName,e&&e.lastName,c)))+'</h3>\n			<a class="email" href="mailto:',(o=n.organizerEmail)?o=o.call(e,{hash:{}}):(o=e&&e.organizerEmail,o=typeof o===l?o.call(e,{hash:{}}):o),i+=a(o)+'">',(o=n.organizerEmail)?o=o.call(e,{hash:{}}):(o=e&&e.organizerEmail,o=typeof o===l?o.call(e,{hash:{}}):o),i+=a(o)+'</a>\n		</div>\n	</div>\n	<button class="find-another button big lettuce">Find another community near you</button>\n',i}function h(e,t){var r="",i;return r+='\n	<h1 class="heading">Summer Break</h1>\n	<div class="notes">\n		<p>Hey there!</p>\n		<p>\n			Our community is on hold for now through the summer.  But don’t fret!  Your favorite farmers and producers are still selling their amazing products at local markets throughout the ',(i=n.invalidRegionTitle)?i=i.call(e,{hash:{}}):(i=e&&e.invalidRegionTitle,i=typeof i===l?i.call(e,{hash:{}}):i),r+=a(i)+"\n		</p>\n		<p>Thanks!</p>\n	</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this,l="function";o=n["if"].call(t,t&&t.getIsValidRegion,{hash:{},inverse:f.program(3,h,i),fn:f.program(1,c,i)});if(o||o===0)s+=o;return s+="\n",s});return n}),define("modules/communityCheckpoint/communityOnHoldView",["require","marionette","hbs!modules/communityCheckpoint/communityOnHoldTemplate","common/utils"],function(e){var t=e("marionette"),n=e("hbs!modules/communityCheckpoint/communityOnHoldTemplate"),r=e("common/utils"),i=t.LayoutView.extend({template:n,events:{"click .find-another":"_onFindAnother"},ui:{organizerImage:".organizer-image>img"},onShow:function(){r.handleImageLoad(this.ui.organizerImage)},_onFindAnother:function(){this.trigger("findAnother")}});return i}),define("hbs!modules/communityCheckpoint/switchCommunityTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","hbs!common/handlebars/partials/communityInfoItems","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/fullNameHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"\n		Here's what you need to know about this pickup:\n	"}function h(e,t){var r="",i;r+="\n		",i=n["if"].call(e,e&&e.hasPaymentIssue,{hash:{},inverse:l.program(6,d,t),fn:l.program(4,p,t)});if(i||i===0)r+=i;return r+="\n	",r}function p(e,t){var r="",i;return r+="\n			Your account is on hold due to a payment failure, so if you want to switch to <em>",(i=n.communityName)?i=i.call(e,{hash:{}}):(i=e&&e.communityName,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</em> you’ll have to return to <em>",(i=n.memberCommunityName)?i=i.call(e,{hash:{}}):(i=e&&e.memberCommunityName,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</em> and update your credit card information.\n		",r}function d(e,t){var r="",i,s,o;return r+="\n			You’ve got an order being delivered to <em>",(i=n.memberCommunityName)?i=i.call(e,{hash:{}}):(i=e&&e.memberCommunityName,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</em> on ",o={hash:{}},r+=a((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,e&&e.nextDeliveryDate,"%A, %b %d",o):f.call(e,"formatDateHelper",e&&e.nextDeliveryDate,"%A, %b %d",o)))+", so if you want to switch to <em>",(s=n.communityName)?s=s.call(e,{hash:{}}):(s=e&&e.communityName,s=typeof s===u?s.call(e,{hash:{}}):s),r+=a(s)+"</em> you’ll have to wait until ",o={hash:{}},r+=a((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,e&&e.storeOpenDate,"%A, %b %d",o):f.call(e,"formatDateHelper",e&&e.storeOpenDate,"%A, %b %d",o)))+" to do so.\n		",r}function v(e,t){var i="",s,o,c;i+='\n	<div class="community-info">\n		<div class="row">\n			<div class="organizer col-sm-5">\n				',s=l.invokePartial(r.organizerImage,"organizerImage",e,n,r);if(s||s===0)i+=s;i+='\n				<div class="organizer-title">Organizer</div>\n				<h3 class="name">',c={hash:{}},i+=a((s=n.fullNameHelper||e&&e.fullNameHelper,s?s.call(e,e&&e.firstName,e&&e.lastName,c):f.call(e,"fullNameHelper",e&&e.firstName,e&&e.lastName,c)))+'</h3>\n				<a class="email" href="mailto:',(o=n.organizerEmail)?o=o.call(e,{hash:{}}):(o=e&&e.organizerEmail,o=typeof o===u?o.call(e,{hash:{}}):o),i+=a(o)+'">',(o=n.organizerEmail)?o=o.call(e,{hash:{}}):(o=e&&e.organizerEmail,o=typeof o===u?o.call(e,{hash:{}}):o),i+=a(o)+'</a>\n			</div>\n			<div class="col-sm-7">\n				',o=l.invokePartial(r.communityInfoItems,"communityInfoItems",e,n,r);if(o||o===0)i+=o;i+="\n			</div>\n		</div>\n	</div>\n	",o=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:l.noop,fn:l.program(9,m,t)});if(o||o===0)i+=o;return i+="\n",i}function m(e,t){var r="",i;return r+='\n		<p class="has-order-note"><i></i> If you switch your pickup location, <em>your cart will be emptied. Are you sure you want to switch your pickup location to ',(i=n.communityName)?i=i.call(e,{hash:{}}):(i=e&&e.communityName,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'?</em> </p>\n		<div class="approve checkbox">\n			<label>\n				<input type="checkbox">I understand that by switching to this community, my cart will be emptied.\n			</label>\n		</div>\n	',r}function g(e,t){return'\n		<button class="switch button big pull-left-xs" loading-animation>Yes, switch<span class="hidden-xs"> me over</span></button>\n	'}function y(e,t){return"pull-right-xs"}function b(e,t){return"No, go back"}function w(e,t){return"Return to my community"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<h1 class="heading">Heads up!</h1>\n<p class="notes">\n	<em>',(o=n.communityName)?o=o.call(t,{hash:{}}):(o=t&&t.communityName,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"</em> is not your pickup location!\n	",o=n["if"].call(t,t&&t.isAllowToSwitchCommunity,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;s+="\n</p>\n",o=n["if"].call(t,t&&t.isAllowToSwitchCommunity,{hash:{},inverse:l.noop,fn:l.program(8,v,i)});if(o||o===0)s+=o;s+='\n<div class="actions clearfix">\n	',o=n["if"].call(t,t&&t.isAllowToSwitchCommunity,{hash:{},inverse:l.noop,fn:l.program(11,g,i)});if(o||o===0)s+=o;s+='\n	<button class="back button big ',o=n["if"].call(t,t&&t.isAllowToSwitchCommunity,{hash:{},inverse:l.noop,fn:l.program(13,y,i)});if(o||o===0)s+=o;s+='" loading-animation>',o=n["if"].call(t,t&&t.isAllowToSwitchCommunity,{hash:{},inverse:l.program(17,w,i),fn:l.program(15,b,i)});if(o||o===0)s+=o;return s+="</button>\n</div>\n",s});return n}),define("modules/communityCheckpoint/switchCommunityView",["require","marionette","hbs!modules/communityCheckpoint/switchCommunityTemplate","common/utils"],function(e){var t=e("marionette"),n=e("hbs!modules/communityCheckpoint/switchCommunityTemplate"),r=e("common/utils"),i=t.LayoutView.extend({template:n,events:{"click .switch:not([disabled])":"_onSwitch","click .back:not([disabled])":"_onBack","change .approve input":"_onApprove"},ui:{switchButton:".switch",approveCheckbox:".approve input",organizerImage:".organizer-image>img"},onRender:function(){this.model.get("isOrderHasSavedItems")&&this._enableSwitchButton(!1)},onShow:function(){r.handleImageLoad(this.ui.organizerImage)},_onSwitch:function(){this.trigger("switch")},_onBack:function(){this.trigger("backToOrigin")},_onApprove:function(){this._enableSwitchButton(this.ui.approveCheckbox.is(":checked"))},_enableSwitchButton:function(e){e?this.ui.switchButton.removeAttr("disabled"):this.ui.switchButton.attr("disabled","")}});return i}),define("hbs!modules/communityModal/organizer/organizerWelcomeTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","common/handlebars/helpers/fullNameHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a=this,f="function",l=this.escapeExpression,c=n.helperMissing;s+='<div>\n	<div class="row">\n		<div class="organizer-image-col col-xs-3">\n			',o=a.invokePartial(r.organizerImage,"organizerImage",t,n,r);if(o||o===0)s+=o;return s+='\n		</div>\n		<div class="col-xs-9">\n			<h2 class="heading">Welcome to our community!</h2>\n			<p class="promotion-text">So glad you decided to join our Farmigo community! If you have any questions, feel free to email me at <a href="mailto:',(o=n.organizerEmail)?o=o.call(t,{hash:{}}):(o=t&&t.organizerEmail,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'">',(o=n.organizerEmail)?o=o.call(t,{hash:{}}):(o=t&&t.organizerEmail,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</a></p>\n			<div class="organizer">\n				<span class="name">',u={hash:{}},s+=l((o=n.fullNameHelper||t&&t.fullNameHelper,o?o.call(t,t&&t.firstName,t&&t.lastName,u):c.call(t,"fullNameHelper",t&&t.firstName,t&&t.lastName,u)))+'</span>\n				<p class="title">Community Organizer<span class="hidden-xs">,</span><br class="visible-xs"/> '+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</p>\n			</div>\n            <button class="button shop">Start shopping!</button>\n		</div>\n	</div>\n</div>',s});return n}),define("modules/communityModal/organizer/organizerWelcomeModule",["require","marionette","common/utils","common/globals","common/modal/modal","common/marketModel","hbs!modules/communityModal/organizer/organizerWelcomeTemplate"],function(e){var t=e("marionette"),n=e("common/utils"),r=e("common/globals"),i=e("common/modal/modal"),s=e("common/marketModel"),o=e("hbs!modules/communityModal/organizer/organizerWelcomeTemplate"),u=t.ItemView.extend({template:o,events:{"click .shop":function(){var e=(new Date).getTime(),t=(e-this.model.get("start"))/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window - closed","Start shopping clicked",Math.ceil(t),!0),this.trigger("organizerWelcome:shopClicked")}},ui:{organizerImage:".organizer-image>img"},onRender:function(){n.handleImageLoad(this.ui.organizerImage)}}),a=t.Controller.extend({getView:function(){return new u({model:new s})}}),f;return{show:function(){var e;f=f||new a,e=f.getView();var t=!1,n=(new Date).getTime();e.model.set("start",n);var s=i.show(e,{className:"organizer-welcome",isDisallowCloseByRoute:!0,isAuto:!0,isOnce:!0,key:"organizerWelcome_"+e.model.get("pickupSiteUrl"),closeCallback:function(){if(!t){var e=(new Date).getTime(),i=(e-n)/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window - closed","background clicked",Math.ceil(i),!0)}}});e.on("organizerWelcome:shopClicked",function(){t=!0,i.close()}),s&&(r.eventBus.trigger("analytics:event","Community-market","Welcome window - opened","",0,!0),s.on("closeClicked",function(){t=!0;var e=(new Date).getTime(),i=(e-n)/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window - closed","x icon clicked",Math.ceil(i),!0)}))}}}),define("hbs!modules/communityModal/school/schoolWelcomeTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","common/handlebars/helpers/fullNameHelper","common/handlebars/helpers/formatHourHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\n            <div class="top-img"></div>\n            <div class="goal-wrap">\n                <div class="top">\n                    This school year we\'ve raised...<br>\n                    <span class="goal-amount">$',(i=n.organizerYearCommission)?i=i.call(e,{hash:{}}):(i=e&&e.organizerYearCommission,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'</span>\n                </div>\n                <div class="bottom">\n                    <b>In 2015:</b> <br>\n                    Schools raised over <span>$40,000</span> with Farmigo.\n                </div>\n            </div>\n        ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div>\n	<div class="row">\n		<div class="organizer-image-col col-xs-3">\n			',o=c.invokePartial(r.organizerImage,"organizerImage",t,n,r);if(o||o===0)s+=o;s+='\n		</div>\n		<div class="col-xs-9">\n			<h2 class="heading">Welcome to our community!</h2>\n			<p class="promotion-text">So glad you decided to join our Farmigo community! If you have any questions, feel free to email me at <a href="mailto:',(o=n.organizerEmail)?o=o.call(t,{hash:{}}):(o=t&&t.organizerEmail,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'">',(o=n.organizerEmail)?o=o.call(t,{hash:{}}):(o=t&&t.organizerEmail,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</a></p>\n			<div class="organizer">\n				<span class="name">',a={hash:{}},s+=l((o=n.fullNameHelper||t&&t.fullNameHelper,o?o.call(t,t&&t.firstName,t&&t.lastName,a):h.call(t,"fullNameHelper",t&&t.firstName,t&&t.lastName,a)))+'</span>\n				<p class="title">Community Organizer<span class="hidden-xs">,</span><br class="visible-xs"/> '+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'</p>\n			</div>\n		</div>\n	</div>\n    <div class="school-info">\n        <h2 class="heading">Every dollar you spend contributes to our school fundraiser!</h2>\n        ',u=n["if"].call(t,t&&t.displayRaisedAmount,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(u||u===0)s+=u;return s+='\n        <h2 class="heading">Want to help '+l((o=(o=t&&t.pickupSite,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'?</h2>\n        <button class="button shop">Start shopping now!</button>\n    </div>\n    <div class="bottom-description">\n        <h2 class="heading">Farmigo brings you closer to local farmers and foodmakers</h2>\n        <ul>\n            <li>\n                <figure>\n                    <img src="/site/farmigo.com/images/start/how1.svg">\n                    <figcaption>\n                        <p>Buy fresh, local groceries online</p>\n                    </figcaption>\n                </figure>\n            </li>\n            <li>\n                <figure>\n                    <img src="/site/farmigo.com/images/start/organizers-do2.svg">\n                    <figcaption>\n                        <p>Pick up on Wednesday between ',a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a):h.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourStart),a)))+" and ",a={hash:{}},s+=l((o=n.formatHourHelper||t&&t.formatHourHelper,o?o.call(t,(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a):h.call(t,"formatHourHelper",(o=t&&t.pickupSite,o==null||o===!1?o:o.deliveryHourEnd),a)))+' at our school</p>\n                    </figcaption>\n                </figure>\n            </li>\n            <li>\n                <figure>\n                    <img src="/site/farmigo.com/images/start/benefit-box.svg">\n                    <figcaption>\n                        <p>Bring home healthy and delicious food the whole family will love</p>\n                    </figcaption>\n                </figure>\n            </li>\n        </ul>\n    </div>\n</div>',s});return n}),define("modules/communityModal/school/schoolWelcomeModule",["require","marionette","common/utils","common/globals","common/modal/modal","common/marketModel","hbs!modules/communityModal/school/schoolWelcomeTemplate"],function(e){var t=e("marionette"),n=e("common/utils"),r=e("common/globals"),i=e("common/modal/modal"),s=e("common/marketModel"),o=e("hbs!modules/communityModal/school/schoolWelcomeTemplate"),u=t.ItemView.extend({template:o,events:{"click .shop":function(){var e=(new Date).getTime(),t=(e-this.model.get("start"))/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window (fundraiser) - closed","Start shopping clicked",Math.ceil(t),!0),this.trigger("schoolWelcome:shopClicked")}},ui:{organizerImage:".organizer-image>img"},onRender:function(){n.handleImageLoad(this.ui.organizerImage)}}),a=t.Controller.extend({getView:function(){return new u({model:new s})}}),f;return{show:function(){var e;f=f||new a,e=f.getView();var t=!1,n=(new Date).getTime();e.model.set("start",n);var s=e.model.getOrganizerCommision();e.model.set("displayRaisedAmount",s>200);var o=i.show(e,{className:"organizer-welcome school-welcome",isDisallowCloseByRoute:!0,isAuto:!0,isOnce:!0,key:"schoolWelcome_"+e.model.get("pickupSiteUrl"),closeCallback:function(){if(!t){var e=(new Date).getTime(),i=(e-n)/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window (fundraiser) - closed","background clicked",Math.ceil(i),!0)}}});e.on("schoolWelcome:shopClicked",function(){t=!0,i.close()}),o&&(r.eventBus.trigger("analytics:event","Community-market","Welcome window (fundraiser) - opened","",0,!0),o.on("closeClicked",function(){t=!0;var e=(new Date).getTime(),i=(e-n)/1e3;r.eventBus.trigger("analytics:event","Community-market","Welcome window (fundraiser) - closed","x icon clicked",Math.ceil(i),!0)}))}}}),define("hbs!modules/groupBuying/groupBuyingTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"success"}function h(e,t){return"success-wrap"}function p(e,t){return'\n                    <p class="title">Join Our Shared Harvest!</p>\n                '}function d(e,t){var r="",i;r+='\n                    <div class="status">\n                        ',i=n["if"].call(e,e&&e.isMadeTarget,{hash:{},inverse:f.program(10,m,t),fn:f.program(8,v,t)});if(i||i===0)r+=i;return r+='\n                    </div>\n                    <div class="status-bar">\n                        <div class="progress">\n                            <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="',(i=n.ordersPercentage)?i=i.call(e,{hash:{}}):(i=e&&e.ordersPercentage,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'" aria-valuemin="0" aria-valuemax="100" style="width: ',(i=n.ordersPercentage)?i=i.call(e,{hash:{}}):(i=e&&e.ordersPercentage,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'%"></div>\n                        </div>\n                    </div>\n                ',r}function v(e,t){var r="",i;return r+="\n                            ",(i=n.orderCount)?i=i.call(e,{hash:{}}):(i=e&&e.orderCount,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+" orders this week!\n                        ",r}function m(e,t){var r="",i,s,o;r+="\n                            ",(i=n.missingOrders)?i=i.call(e,{hash:{}}):(i=e&&e.missingOrders,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+" more order",o={hash:{},inverse:f.noop,fn:f.program(11,g,t)},s=(i=n.gtHelper||e&&e.gtHelper,i?i.call(e,e&&e.missingOrders,1,o):l.call(e,"gtHelper",e&&e.missingOrders,1,o));if(s||s===0)r+=s;return r+=" to go\n                        ",r}function g(e,t){return"s"}function y(e,t){return'\n                    <p class="sub-title">Let\'s keep it  up! Invite your friends!</p>\n                    <p class="help-us"></p>\n                '}function b(e,t){var r="",i;r+="\n                    ",i=n["if"].call(e,e&&e.hideProgressBar,{hash:{},inverse:f.program(18,E,t),fn:f.program(16,w,t)});if(i||i===0)r+=i;return r+='\n                    <p class="help-us">Help us achieve our goal so we can all save on our food!</p>\n                ',r}function w(e,t){return'\n                        <p class="status">  if we get 15 orders a week, everyone gets <b>10%</b> off!</p>\n                    '}function E(e,t){return'\n                        <p class="sub-title">for us to get <b>10% off</b> our orders next week!</p>\n                    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;s+='<div class="group-buying">\n    <div class="top-img ',o=n["if"].call(t,t&&t.isMadeTarget,{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;s+='"></div>\n        <div class="',o=n["if"].call(t,t&&t.isMadeTarget,{hash:{},inverse:f.noop,fn:f.program(3,h,i)});if(o||o===0)s+=o;s+='">\n            <div class="default-state">\n                ',o=n["if"].call(t,t&&t.isMadeTarget,{hash:{},inverse:f.program(5,p,i),fn:f.noop});if(o||o===0)s+=o;s+="\n                ",o=n["if"].call(t,t&&t.hideProgressBar,{hash:{},inverse:f.program(7,d,i),fn:f.noop});if(o||o===0)s+=o;s+="\n                ",o=n["if"].call(t,t&&t.isMadeTarget,{hash:{},inverse:f.program(15,b,i),fn:f.program(13,y,i)});if(o||o===0)s+=o;return s+='\n\n                <div class="community-link">',(o=n.shareLink)?o=o.call(t,{hash:{}}):(o=t&&t.shareLink,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</div>\n                <a class="button invite" target="_blank">Invite your friends</a>\n            </div>\n            <div class="bottom-msg">\n                <p><b>What is this?</b></p>\n                <p>Eat better, buy together! We\'re part of a special promotion to activate group buying from local farms. For a limited time only, if we get 15 orders in one week everyone gets 10% off their order the following week.</p>\n            </div>\n        </div>\n</div>\n',s});return n}),define("modules/groupBuying/groupBuyingView",["require","marionette","hbs!modules/groupBuying/groupBuyingTemplate","common/dataService","modules/sharing/sharingModel"],function(e){var t=e("marionette"),n=e("hbs!modules/groupBuying/groupBuyingTemplate"),r=e("common/dataService"),i=e("modules/sharing/sharingModel"),s=15,o=t.LayoutView.extend({template:n,events:{"click .invite":"onInviteCLick"},initialize:function(){var e=this.model.getOrderCount()||0;this.model.set("isMadeTarget",e>=s);var t=s-e;this.model.set("missingOrders",t),this.model.set("orderCount",e),this.model.set("ordersPercentage",e*100/s),this.model.get("orderLock").isPostponedDelivery&&(this.model.set("hideProgressBar",!0),this.model.set("isMadeTarget",!1)),this._isEmailState=!1},onInviteCLick:function(e){if(!this._isEmailState){this.$el.find(".help-us").text("Your link to share:"),this.$el.find(".invite").text("Email"),this.$el.find(".community-link").css("display","block");var t=(new i(r.getMarketData())).get("groupBuyingEmailContent"),n=document.getElementsByClassName("invite");return n.length&&(n[0].href=t),this._isEmailState=!0,!1}}});return o}),define("hbs!modules/postalDelivery/postalDeliveryTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="postal-delivery">\n    <div class="top-img delivery"></div>\n    <div class="default-state">\n        <p class="title">Farm-to-doorstep with home delivery!</p>\n        <div class="description-wrap">\n            <p class="description">\n				Let us take one thing off your weekly to-do list: for a <b>$4.99</b> delivery fee, get your groceries delivered right to your door.\n            </p>\n            <p> Interested?</p>\n        </div>\n        <a class="button try" target="_blank">I WANT DELIVERY</a>\n    </div>\n    <div class="bottom-msg">\n        <p><b>Why are we "testing" home delivery?</b></p>\n        <p>You love our Community-based model, and so do we! But life happens, and we all have days (or weeks!) when we need something that fits into our busy lives. Whenever we ask our members what would make things easier, the option for home delivery comes up again and again. This test is our way of exploring how to add delivery as an option to the Community pick-up experience, without sacrificing any of the great benefits it provides. Basically: for the month of May, you can pick up your food or have your items delivered — it\'s all up to you!\n            <br><br>\n            Questions or feedback? Don’t hesitate to get in touch!\n        </p>\n    </div>\n</div>\n'});return n}),define("modules/postalDelivery/postalDeliveryView",["require","marionette","hbs!modules/postalDelivery/postalDeliveryTemplate","common/globals"],function(e){var t=e("marionette"),n=e("hbs!modules/postalDelivery/postalDeliveryTemplate"),r=e("common/globals"),i=t.LayoutView.extend({template:n,events:{"click .try":"openDeliveryForm"},onShow:function(){r.eventBus.trigger("analytics:event","Community-market","Home delivery window - opened","Automatic",0,!0)},openDeliveryForm:function(){var e=(new Date).getTime(),t=(e-this.model.get("start"))/1e3;r.eventBus.trigger("analytics:event","Community-market","Home delivery window - Try clicked","",Math.ceil(t),!0),this.trigger("openDeliveryForm")}});return i}),define("hbs!modules/favorites/favoritesDescriptionTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="row favorites-popover-wrapper">\n    <div class="col-xs-3 vcenter"><div class="favorites-icon"></div>\n    </div>\n    <div class="col-xs-8 vcenter"><span>Ordering your favorites just got easier! Browse and order from a list of your top items this month.</span>\n    </div>\n</div>\n'});return n}),define("modules/favorites/favoritesDescriptionModule",["require","marionette","hbs!modules/favorites/favoritesDescriptionTemplate","common/dataService","common/popover/popover"],function(e){var t=e("marionette"),n=e("hbs!modules/favorites/favoritesDescriptionTemplate"),r=e("common/dataService"),i=e("common/popover/popover"),s=t.LayoutView.extend({template:n}),o=t.Controller.extend({getView:function(){return new s({model:new Backbone.Model({})})}}),u;return{show:function(){u=u||new o;var e=u.getView();e.render(),_.defer(function(){var t={className:"favorites-popover",isShow:!0,isAuto:!0,isOnce:!0,key:"favorites"},n=$(".favorites-category").parent().parent();i.create(n,e,t)})}}}),define("modules/communityCheckpoint/communityCheckpointModule",["require","marionette","common/mixpanel","common/nav","common/utils","common/modal/modal","common/globals","common/dataService","common/marketModel","common/memberCheckpoint","modules/order/orderModel","modules/communityCheckpoint/communityOnHoldView","modules/communityCheckpoint/switchCommunityView","modules/communityModal/organizer/organizerWelcomeModule","modules/communityModal/school/schoolWelcomeModule","modules/referral/referralModule","modules/groupBuying/groupBuyingView","modules/postalDelivery/postalDeliveryView","modules/postalDelivery/deliveryFormView","modules/favorites/favoritesDescriptionModule","modules/communityModal/promotions/minimumOrderModule","modules/multiValueDiscount/multiValueDiscountModule"],function(e){var t=e("marionette"),n=e("common/mixpanel"),r=e("common/nav"),i=e("common/utils"),s=e("common/modal/modal"),o=e("common/globals"),u=e("common/dataService"),a=e("common/marketModel"),f=e("common/memberCheckpoint"),l=e("modules/order/orderModel"),c=e("modules/communityCheckpoint/communityOnHoldView"),h=e("modules/communityCheckpoint/switchCommunityView"),p=e("modules/communityModal/organizer/organizerWelcomeModule"),d=e("modules/communityModal/school/schoolWelcomeModule"),v=e("modules/referral/referralModule"),m=e("modules/groupBuying/groupBuyingView"),g=e("modules/postalDelivery/postalDeliveryView"),y=e("modules/postalDelivery/deliveryFormView"),b=e("modules/favorites/favoritesDescriptionModule"),w=e("modules/communityModal/promotions/minimumOrderModule"),E=e("modules/multiValueDiscount/multiValueDiscountModule"),S="Switch community popup",x,T,N=function(e){var t=i.parseFromServerDate(e);return Math.ceil((t.getTime()-(new Date).getTime())/864e5)},C=t.Controller.extend({handle:function(){var e=this,t,C=function(e){this._isModalClosed=!1;var t=function(n){!this._isModalClosed&&(e==undefined||n.path===e.path)&&(s.close(),this._isModalClosed=!0),o.eventBus.off("route",t)};o.eventBus.once("route",_.bind(t,this))},k=function(){var e=T.get("memberCommunities")[0];n.track(S,{action:"canceled"}),o.eventBus.trigger("communitySelected",{pickupSiteUrl:e.url,pickupSiteKey:e.key,farmKey:e.farmKey}),o.eventBus.trigger("analytics:event","account",L(!1)),C()},L=function(e){return(e?"switching community confirmed":"switching community canceled")+" / "+(T.get("isOrderHasSavedItems")?"order with items":"order empty")},A=function(){T.setGroupBuyingSessionStorage(),x=new m({model:T}),s.show(x,{className:"experiment-modal",isDisallowCloseByRoute:!0,isAuto:!0})},O=function(){T.setPostalDeliverySessionStorage();var e=!1,t=(new Date).getTime();x=new g({model:new Backbone.Model({start:t})}),x.on("openDeliveryForm",function(){s.close(),M()});var n=s.show(x,{className:"experiment-modal",isDisallowCloseByRoute:!0,isAuto:!0,closeCallback:function(){if(!e){var n=(new Date).getTime(),r=(n-t)/1e3;o.eventBus.trigger("analytics:event","Community-market","Home delivery window - closed","background clicked",Math.ceil(r),!0)}}});n.on("closeClicked",function(){e=!0;var n=(new Date).getTime(),r=(n-t)/1e3;o.eventBus.trigger("analytics:event","Community-market","Home delivery window - closed","x icon clicked",Math.ceil(r),!0)}),C()},M=function(){var e=new y({model:new Backbone.Model});s.show(e,{className:"experiment-modal delivery-form-modal",isDisallowCloseByRoute:!0,isAuto:!0})},D=function(){T=new a;if(T.get("doNotAcceptOrders")&&!f.isBlocked())x=new c({model:T}),x.on("findAnother",function(){var e=u.getMarketData("pickupSite").zipCode;r.navigate(r.PageEnum.ChooseCommunity,{replace:!0},r.PageParam.Location+"="+e),s.close(),o.eventBus.trigger("analytics:event","long term hold","find another community clicked",t)}),s.show(x,{className:"community-on-hold-modal",isDisallowClose:!0}),C(r.PageEnum.ChooseCommunity),t=N(T.get("nextDeliveryDate")),o.eventBus.trigger("analytics:event","long term hold","hold message is presented",t);else if(T.get("hasActiveSubscriptionForOtherPickupSite"))x=new h({model:T}),x.on({"switch":function(){var e;(new l).emptyOrder(),u.changeSubscription().then(u.loadMarketData).done(function(){s.close(),n.track(S,{action:"approved"})}),e=T.get("isGoalNotReached")?"delivering to incubating":T.get("isSwitchToSameDeliveryDay")?"same delivery day":"different delivery day",o.eventBus.trigger("analytics:event","account",L(!0),e)},backToOrigin:k}),s.show(x,{className:"switch-community-modal",isDisallowClose:!0}),C(r.PageEnum.ChooseCommunity),n.track(S,{cartState:T.get("isOrderHasSavedItems")?"empty":"items on cart"});else{if(T.get("shouldShowLogin"))return;if(T.get("shouldDisplayMultiValueDiscount"))E.showPopup(!0,!1);else if(T.shouldDisplayMinimumOrder())w.show(!0);else if(v.getInstance().ifShouldShowRecipientModal()){var m=v.getInstance();T.shouldDisplayGroupBuying()&&o.eventBus.on("referral:recipient:closeModal",function(){A()}),m.showRecipientModal()}else T.shouldDisplayGroupBuying()?e._isModalClosed?A():setTimeout(function(){A()},300):T.shouldDisplayPostalDelivery()&&!T.isPostalDeliveryDisplayedAlready()?e._isModalClosed?O():setTimeout(function(){O()},300):T.get("member")==undefined&&T.shouldDisplaySchoolWelcome()?setTimeout(function(){v.getInstance().isGotRecipientModal()||d.show()},1):T.get("member")==undefined?setTimeout(function(){v.getInstance().isGotRecipientModal()||p.show()},1):T.get("member")&&!i.clientViewPort.isXs()&&b.show()}};D(),f.isBlocked()&&o.eventBus.on("loggedOut paymentReactivated",D)}}),k;return{handle:function(){return k=k||new C,k.handle()}}}),define("hbs!modules/mobileAppMessage/mobileAppMessageViewTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/versionHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="app-message-container">\n    <img src="/site/market/images/mobile_promotion_logo.svg?version=',u={hash:{}},s+=f((o=n.versionHelper||t&&t.versionHelper,o?o.call(t,1,u):a.call(t,"versionHelper",1,u)))+'">\n    <a class="button btn-block big white square open-app" href="https://itunes.apple.com/app/apple-store/id1017742501?pt=1768701&ct=mobile%20promotion&mt=8">Open in the Farmigo App</a>\n    <button class="button btn-block big ghost square open-site">Continue to mobile site</button>\n    <p class="dont-show"><label for="dont-show"><input id="dont-show" type="checkbox"/>Don’t show me this page again</label></p>\n</div>\n',s});return n}),define("modules/mobileAppMessage/mobileAppMessageView",["require","marionette","hbs!modules/mobileAppMessage/mobileAppMessageViewTemplate","common/globals","common/localStorage"],function(e){var t=e("marionette"),n=e("hbs!modules/mobileAppMessage/mobileAppMessageViewTemplate"),r=e("common/globals"),i=e("common/localStorage"),s=t.LayoutView.extend({template:n,className:"mobile-app-message",events:{"click .open-app":"goToApp","click .open-site":"closeMessage"},ui:{dontShow:"#dont-show"},goToApp:function(){r.eventBus.trigger("analytics:event","Mobile-App-Message","Open App clicked")},closeMessage:function(){r.eventBus.trigger("analytics:event","Mobile-App-Message","Continue to mobile site clicked");var e=this.ui.dontShow.is(":checked");e&&i.setItem("mobileAppMessageShown",!0),this.destroy()}});return s}),define("modules/mobileAppMessage/mobileAppMessageModule",["require","common/localStorage","common/globals","common/utils","modules/mobileAppMessage/mobileAppMessageView","common/dataService"],function(e){var t=e("common/localStorage"),n=e("common/globals"),r=e("common/utils"),i=e("modules/mobileAppMessage/mobileAppMessageView"),s=e("common/dataService");return{show:function(e){var o=t.getItem("mobileAppMessageShown");return s.getMarketData("isLoginOptimizedFlow")&&r.isIphone()&&(!o||o===null)?(n.eventBus.trigger("analytics:event","Mobile-App-Message","Mobile app message shown"),e.show(new i),!0):!1}}}),define("flow/sequences/headerLoginSequence",["require","common/globals","common/dataService","common/dataUtils","common/nav","common/mixpanel","modules/communityModal/promotions/minimumOrderModule"],function(e){var t=e("common/globals"),n=e("common/dataService"),r=e("common/dataUtils"),i=e("common/nav"),s=e("common/mixpanel"),o=e("modules/communityModal/promotions/minimumOrderModule"),u=function(e){this.mode=e;if(!i.PageEnum[e])throw Exception("Mode "+e+" is unsupported at header login sequence");this.listener=new t.EventAggregator,this.init=function(){this.listener.listenTo(t.eventBus,{login:function(){n.loadMarketData(!0).done(function(){s.trackMemberLogin(!1),t.eventBus.trigger("app:login-finished",n.getMarketData()),window.history.back(),_.defer(function(){r.shouldDisplayMinimumOrder()&&o.show(!0)})})},"signup:done":function(){window.history.back()},forgotPassword:function(){i.navigate(i.PageEnum.ForgotPassword)},changePassword:function(){i.navigate(i.PageEnum.ChangePassword)},"changePassword:done":function(){n.loadMarketData(!0).done(function(){i.navigate(i.PageEnum.Market)})}})},this.init(),this.start=function(){i.navigate(i.PageEnum[e])},this.close=function(){this.listener.stopListening()}};return u}),define("flow/sequences/checkoutSequence",["require","jquery","common/globals","common/dataService","common/marketModel","common/nav","common/utils","common/dataUtils","common/mixpanel","common/confirmationModal/confirmationModal"],function(e){var t=e("jquery"),n=e("common/globals"),r=e("common/dataService"),i=e("common/marketModel"),s=e("common/nav"),o=e("common/utils"),u=e("common/dataUtils"),a=e("common/mixpanel"),f=e("common/confirmationModal/confirmationModal"),l="Orders for this {0}'s delivery need to be placed before midnight on {1}.",c="Please come back to place your next order between {0} and {1} midnight.",h="Please place your order for the next week.",p=s.PageParam.Checkout+"=true",d=function(){function e(){var e=r.getMarketData(),t,n,i,u,a=o.formatToServerDate(new Date),p=e.orderLock.storeCloseDate;if(a>p){var d=e.nextDeliveryDate,v=a>d;return v?t="Oops, something went wrong.<br/>Please add items to your order again.":(n=o.formatWeekdayFromServerDate(p),i=o.formatWeekdayFromServerDate(d),u=o.formatWeekdayFromServerDate(o.addDays(d,1)),t=l.replace("{0}",i).replace("{1}",n)+"<br/>"+((e.subscription||{}).key?c.replace("{0}",u).replace("{1}",n):h)),f.show(t,{onOk:function(){var e=r.getMarketData();return e.orderData=[],r.loadMarketData().then(function(){s.navigate(s.PageEnum.Market)})}}),!0}return!1}function d(){var e=new i,o=n.data.isOrderHasSavedItems,f=e.get("hadSubscription")||!o;if(o)var l=u.getOrderTotal(e.get("previousOrderMap"));var c=e.get("previousOrderData"),h=_.some(e.get("order"),function(e){return e.extraProperties&&e.extraProperties.highlightItemInOrder});r.changeSubscription(u.getPrivateCommunityReason(),f,a.trackDiscounts).then(function(){var e=r.getMarketData().isSubscriptionForCurrentPickupSite?o?"order-change":"order-update":"order-rejoin",u=t.cookie("source");n.eventBus.trigger("analytics:pageView",e,u);var a=new i,f=a.get("total");if(o){var p=f-l,d=p>0?"Increased":"Decreased",v="Order changed",m=a.get("order");h&&(v+=" (with upsell item)");var g=parseInt(p*100)}else{var y=a.get("totalDeliveries")?a.get("totalDeliveries")+1:1;if(y===1)var v="First order created",d=a.get("itemCount");else var g=parseInt(f*100),v="New order created",d=y}n.eventBus.trigger("analytics:event","Transactions",v,d,g);var m=a.get("order"),b=_.filter(m,function(e){var t=_.findWhere(c,{shareKey:e.shareKey});if(!t||t&&t.quantity!==e.quantity)return!0});a.set("itemsChanged",b),s.navigate(s.PageEnum.ThankYou)})}this.listener=new n.EventAggregator,this.init=function(){this.listener.listenTo(n.eventBus,{login:function(){r.loadMarketData(!0).done(function(){a.trackMemberLogin(!1),n.eventBus.trigger("app:login-finished",r.getMarketData()),s.navigate(s.PageEnum.Order)})},"signup:done":function(){n.eventBus.trigger("analytics:pageView","payment"),s.navigate(s.PageEnum.Payment,null,p)},paymentDetails:function(o){if(!e()){var f=r.getMarketData("subscription")||{};f.key?r.createToken(o).done(d):(o.privateCommunityReason=u.getPrivateCommunityReason(),r.createSubscription(o,a.trackDiscounts,!0).done(function(){var e=t.cookie("source");n.eventBus.trigger("analytics:pageView","thank-you",e);var r=new i,o="First order created",a=r.get("itemCount"),f=parseInt(r.get("total")*100);n.eventBus.trigger("analytics:event","Transactions",o,a,f),window.optimizely=window.optimizely||[],window.optimizely.push(["trackEvent","First order created",{revenue:f}]),u.cleanup(),s.navigate(s.PageEnum.ThankYou)}))}},changePassword:function(){s.navigate(s.PageEnum.ChangePassword)},"changePassword:done":function(){r.loadMarketData(!0).done(function(){s.navigate(s.PageEnum.Order)})},forgotPassword:function(){s.navigate(s.PageEnum.ForgotPassword)}})},this.init(),this.start=function(){var t;if(r.isLoggedIn()){if(!e()){var o=r.getMarketData("subscription")||{};o.key&&o.hasToken?d():(n.eventBus.trigger("analytics:pageView","payment"),s.navigate(s.PageEnum.Payment,null,p))}}else t=(new i).get("isLoginOptimizedFlow"),s.navigate(t?s.PageEnum.Login:s.PageEnum.SignUp,null,p)},this.close=function(){this.listener.stopListening()}};return d}),define("flow/sequences/reactivateSubscriptionSequence",["require","common/globals","common/globalMessage","common/dataService","common/nav","common/glassPane/glassPane"],function(e){var t=e("common/globals"),n=e("common/globalMessage"),r=e("common/dataService"),i=e("common/nav"),s=e("common/glassPane/glassPane");return function(e){this.listener=new t.EventAggregator,this.init=function(){this.listener.listenTo(t.eventBus,{paymentDetails:function(e){r.createToken(e).then(function(){return r.pay(!0)}).then(r.reactivateSubscription).then(function(){n.showSuccess("Your payment processed successfully",{key:"paymentProcessed"})}).then(r.loadMarketData).then(function(){i.navigate(i.PageEnum.Market),t.eventBus.trigger("paymentReactivated")}).fail(function(){t.eventBus.trigger("analytics:pageEvent","Payment failure")})}})},this.init(),this.start=function(){s.getInstance({isDefault:!0}).hide("paymentIssue"),t.eventBus.trigger("analytics:pageView","payment"),i.navigate(i.PageEnum.Payment,null,i.PageParam.ReactivateSubscription+"=true")},this.close=function(){this.listener.stopListening()}}}),define("flow/sequences/changeDetailsFromAccountSequence",["require","common/globals","common/dataService","common/nav"],function(e){var t=e("common/globals"),n=e("common/dataService"),r=e("common/nav"),i={Payment:1,Password:2},s=function(e){this.listener=new t.EventAggregator,this.mode=e,this.init=function(){this.listener.listenTo(t.eventBus,{paymentDetails:function(e){n.createToken(e).then(function(){window.history.back()})},"paymentCanceled changePassword:cancel changePassword:done":function(){window.history.back()}})},this.init(),this.start=function(){this.mode==i.Payment?r.navigate(r.PageEnum.Payment,{replace:!1},r.PageParam.ChangePaymentDetails+"=true"):r.navigate(r.PageEnum.ChangePassword,{replace:!1},r.PageParam.AccountChangePassword+"=true")},this.close=function(){this.listener.stopListening()}};return s.Mode=i,s}),define("flow/sequences/optimizedLoginSequence",["require","common/globals","common/dataService","common/marketModel","common/nav"],function(e){var t=e("common/globals"),n=e("common/dataService"),r=e("common/marketModel"),i=e("common/nav"),s=function(){this.listener=new t.EventAggregator,this.init=function(){var e=new r;e.set("shouldShowLogin",!1);var s=this;this.listener.listenTo(t.eventBus,{login:function(){n.loadMarketData(!0).done(function(){t.eventBus.trigger("app:login-finished",n.getMarketData()),s.close(),window.history.back()})},forgotPassword:function(){i.navigate(i.PageEnum.ForgotPassword)}})},this.init(),this.start=function(){},this.close=function(){this.listener.stopListening()}};return s}),define("flow/flowController",["require","common/globals","common/nav","marionette","flow/sequences/headerLoginSequence","flow/sequences/checkoutSequence","flow/sequences/reactivateSubscriptionSequence","flow/sequences/changeDetailsFromAccountSequence","flow/sequences/optimizedLoginSequence","common/dataService"],function(e){var t=e("common/globals"),n=e("common/nav"),r=e("marionette"),i=e("flow/sequences/headerLoginSequence"),s=e("flow/sequences/checkoutSequence"),o=e("flow/sequences/reactivateSubscriptionSequence"),u=e("flow/sequences/changeDetailsFromAccountSequence"),a=e("flow/sequences/optimizedLoginSequence"),f=e("common/dataService"),l=r.Controller.extend({sequences:[],initialize:function(){this.listenTo(t.eventBus,{"flow:header:login":_.wrap(this.headerLogin,this.onNavFlow),"flow:header:signup":_.wrap(this.headerSignup,this.onNavFlow),"flow:header:market":_.wrap(this.headerMarket,this.onNavFlow),"flow:header:order":_.wrap(this.headerOrder,this.onNavFlow),"flow:header:account":_.wrap(this.headerAccount,this.onNavFlow),"flow:header:history":_.wrap(this.headerHistory,this.onNavFlow),"flow:header:logout":_.wrap(this.headerLogout,this.onNavFlow),"flow:header:reactivate-subscription":_.wrap(this.headerReactivateSubscription,this.onNavFlow)}),this.listenTo(t.eventBus,{"flow:menu:reorder":_.wrap(this.menuReorder,this.onNavFlow)}),this.listenTo(t.eventBus,{"flow:router:login":this.routerLogin,"flow:router:optimizedLogin":this.optimizedLogin,"flow:router:forgotPassword flow:router:changePassword":this.routerPassword,"flow:router:signup":this.routerSignup,"flow:router:signup-checkout flow:router:payment-checkout":this.routerCheckout,"flow:router:thankyou":this.endSequence,"flow:router:payment-reactivate":this.routerReactivate,"flow:router:payment-changeDetails flow:router:changePassword-fromAccount":this.routerChangePaymentDetails}),this.listenTo(t.eventBus,{"flow:order:checkout":_.wrap(this.orderCheckout,this.onNavFlow)}),this.listenTo(t.eventBus,{"flow:account:changePassword":_.wrap(this.accountChangePassword,this.onNavFlow),"flow:account:paymentDetails":_.wrap(this.accountPaymentDetails,this.onNavFlow)}),this.listenTo(t.eventBus,{"flow:change-password:done":_.wrap(this.headerMarket,this.onNavFlow)})},endSequence:function(){this.sequence&&_.isFunction(this.sequence.close)&&this.sequence.close(),this.sequence=null},startSequence:function(){this.sequence&&_.isFunction(this.sequence.start)&&this.sequence.start()},onNavFlow:function(e){this.endSequence(),e.call(this),this.startSequence()},routerCheckout:function(){if(!this.sequence||!(this.sequence instanceof s))this.endSequence(),_.defer(_.bind(this.headerOrder,this))},routerReactivate:function(){if(!this.sequence||!(this.sequence instanceof o))this.endSequence(),_.defer(_.bind(this.headerMarket,this))},routerChangePaymentDetails:function(){if(!this.sequence||!(this.sequence instanceof u))this.endSequence(),_.defer(_.bind(this.headerAccount,this))},routerPassword:function(){(!this.sequence||!(this.sequence instanceof i))&&n.navigate(n.PageEnum.Login)},routerLogin:function(){this.routerLoginSignup("Login")},optimizedLogin:function(){this.sequence=new a},routerSignup:function(){this.routerLoginSignup("SignUp")},routerLoginSignup:function(e){if(f.isLoggedIn())this.endSequence(),n.navigate(n.PageEnum.Market);else if(!this.sequence||!(this.sequence instanceof i))this.endSequence(),this.sequence=new i(e)},headerLogin:function(){this.sequence=new i("Login")},headerSignup:function(){this.sequence=new i("SignUp")},headerOrder:function(){n.navigate(n.PageEnum.Order,null,n.PageParam.IsForceNotRequireLogin+"=true")},headerAccount:function(){n.navigate(n.PageEnum.Account)},headerHistory:function(){n.navigate(n.PageEnum.History)},headerLogout:function(){n.navigate(n.PageEnum.Logout)},headerMarket:function(){n.navigate(n.PageEnum.Market)},headerReactivateSubscription:function(){this.sequence=new o},orderCheckout:function(){this.sequence=new s},menuReorder:function(){n.navigate(n.PageEnum.Reorder)},accountChangePassword:function(){this.sequence=new u(u.Mode.Password)},accountPaymentDetails:function(){this.sequence=new u(u.Mode.Payment)}}),c;return{start:function(){c&&c.stop(),c=new l}}}),define("common/intercom",["require","common/globals","common/utils"],function(e){var t=e("common/globals"),n=e("common/utils"),r=t.eventBus,i=window.INTERCOM_APP_ID,s=function(e){var t=e?e.previousOrders:null;if(_.isArray(t)&&t.length){var r=_.pluck(t,"date");return{total_deliveries:e.totalDeliveries,first_delivery:e.firstDeliveryDate,last_delivery:n.formatToRegularDate(r.reduce(function(e,t){return e>t?e:t}))}}return{total_deliveries:0}},o=function(e){var t=e.member,r=e.pickupSite,o=_.extend({app_id:i,email:t.email,user_id:t.email,key:t.key,name:t.firstName+" "+t.lastName,community:e.pickupSite.title,region:e.region,communityType:r.communityType,deliveryDay:r.deliveryDays},s(e.subscription));return!n.clientViewPort.isSm()&&!n.clientViewPort.isXs()&&(o.widget={activator:"#IntercomDefaultWidget"}),o},u=function(e){if(window.Intercom){var t=o(e);window.Intercom("boot",t)}},a=function(){window.Intercom&&window.Intercom("shutdown")},f=function(){window.Intercom&&window.Intercom("update")};return{init:function(){r.on("app:login-finished",u),r.on("new-account-created",u),r.on("app:login-by-cookie",u),r.on("app:logout",a)}}}),function(){function e(n,r){function s(e,t){return function(){return e.apply(t,arguments)}}var i;r=r||{},this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.touchBoundary=r.touchBoundary||10,this.layer=n,this.tapDelay=r.tapDelay||200;if(e.notNeeded(n))return;var o=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"],u=this;for(var a=0,f=o.length;a<f;a++)u[o[a]]=s(u[o[a]],u);t&&(n.addEventListener("mouseover",this.onMouse,!0),n.addEventListener("mousedown",this.onMouse,!0),n.addEventListener("mouseup",this.onMouse,!0)),n.addEventListener("click",this.onClick,!0),n.addEventListener("touchstart",this.onTouchStart,!1),n.addEventListener("touchmove",this.onTouchMove,!1),n.addEventListener("touchend",this.onTouchEnd,!1),n.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(n.removeEventListener=function(e,t,r){var i=Node.prototype.removeEventListener;e==="click"?i.call(n,e,t.hijacked||t,r):i.call(n,e,t,r)},n.addEventListener=function(e,t,r){var i=Node.prototype.addEventListener;e==="click"?i.call(n,e,t.hijacked||(t.hijacked=function(e){e.propagationStopped||t(e)}),r):i.call(n,e,t,r)}),typeof n.onclick=="function"&&(i=n.onclick,n.addEventListener("click",function(e){i(e)},!1),n.onclick=null)}var t=navigator.userAgent.indexOf("Android")>0,n=/iP(ad|hone|od)/.test(navigator.userAgent),r=n&&/OS 4_\d(_\d)?/.test(navigator.userAgent),i=n&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),s=navigator.userAgent.indexOf("BB10")>0;e.prototype.needsClick=function(e){switch(e.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(e.disabled)return!0;break;case"input":if(n&&e.type==="file"||e.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(e.className)},e.prototype.needsFocus=function(e){switch(e.nodeName.toLowerCase()){case"textarea":return!0;case"select":return!t;case"input":switch(e.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!e.disabled&&!e.readOnly;default:return/\bneedsfocus\b/.test(e.className)}},e.prototype.sendClick=function(e,t){var n,r;document.activeElement&&document.activeElement!==e&&document.activeElement.blur(),r=t.changedTouches[0],n=document.createEvent("MouseEvents"),n.initMouseEvent(this.determineEventType(e),!0,!0,window,1,r.screenX,r.screenY,r.clientX,r.clientY,!1,!1,!1,!1,0,null),n.forwardedTouchEvent=!0,e.dispatchEvent(n)},e.prototype.determineEventType=function(e){return t&&e.tagName.toLowerCase()==="select"?"mousedown":"click"},e.prototype.focus=function(e){var t;n&&e.setSelectionRange&&e.type.indexOf("date")!==0&&e.type!=="time"&&e.type!=="month"?(t=e.value.length,e.setSelectionRange(t,t)):e.focus()},e.prototype.updateScrollParent=function(e){var t,n;t=e.fastClickScrollParent;if(!t||!t.contains(e)){n=e;do{if(n.scrollHeight>n.offsetHeight){t=n,e.fastClickScrollParent=n;break}n=n.parentElement}while(n)}t&&(t.fastClickLastScrollTop=t.scrollTop)},e.prototype.getTargetElementFromEventTarget=function(e){return e.nodeType===Node.TEXT_NODE?e.parentNode:e},e.prototype.onTouchStart=function(e){var t,i,s;if(e.targetTouches.length>1)return!0;t=this.getTargetElementFromEventTarget(e.target),i=e.targetTouches[0];if(n){s=window.getSelection();if(s.rangeCount&&!s.isCollapsed)return!0;if(!r){if(i.identifier&&i.identifier===this.lastTouchIdentifier)return e.preventDefault(),!1;this.lastTouchIdentifier=i.identifier,this.updateScrollParent(t)}}return this.trackingClick=!0,this.trackingClickStart=e.timeStamp,this.targetElement=t,this.touchStartX=i.pageX,this.touchStartY=i.pageY,e.timeStamp-this.lastClickTime<this.tapDelay&&e.preventDefault(),!0},e.prototype.touchHasMoved=function(e){var t=e.changedTouches[0],n=this.touchBoundary;return Math.abs(t.pageX-this.touchStartX)>n||Math.abs(t.pageY-this.touchStartY)>n?!0:!1},e.prototype.onTouchMove=function(e){if(!this.trackingClick)return!0;if(this.targetElement!==this.getTargetElementFromEventTarget(e.target)||this.touchHasMoved(e))this.trackingClick=!1,this.targetElement=null;return!0},e.prototype.findControl=function(e){return e.control!==undefined?e.control:e.htmlFor?document.getElementById(e.htmlFor):e.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},e.prototype.onTouchEnd=function(e){var s,o,u,a,f,l=this.targetElement;if(!this.trackingClick)return!0;if(e.timeStamp-this.lastClickTime<this.tapDelay)return this.cancelNextClick=!0,!0;this.cancelNextClick=!1,this.lastClickTime=e.timeStamp,o=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,i&&(f=e.changedTouches[0],l=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)||l,l.fastClickScrollParent=this.targetElement.fastClickScrollParent),u=l.tagName.toLowerCase();if(u==="label"){s=this.findControl(l);if(s){this.focus(l);if(t)return!1;l=s}}else if(this.needsFocus(l)){if(e.timeStamp-o>100||n&&window.top!==window&&u==="input")return this.targetElement=null,!1;this.focus(l),this.sendClick(l,e);if(!n||u!=="select")this.targetElement=null,e.preventDefault();return!1}if(n&&!r){a=l.fastClickScrollParent;if(a&&a.fastClickLastScrollTop!==a.scrollTop)return!0}return this.needsClick(l)||(e.preventDefault(),this.sendClick(l,e)),!1},e.prototype.onTouchCancel=function(){this.trackingClick=!1,this.targetElement=null},e.prototype.onMouse=function(e){return this.targetElement?e.forwardedTouchEvent?!0:e.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(e.stopImmediatePropagation?e.stopImmediatePropagation():e.propagationStopped=!0,e.stopPropagation(),e.preventDefault(),!1):!0:!0:!0},e.prototype.onClick=function(e){var t;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):e.target.type==="submit"&&e.detail===0?!0:(t=this.onMouse(e),t||(this.targetElement=null),t)},e.prototype.destroy=function(){var e=this.layer;t&&(e.removeEventListener("mouseover",this.onMouse,!0),e.removeEventListener("mousedown",this.onMouse,!0),e.removeEventListener("mouseup",this.onMouse,!0)),e.removeEventListener("click",this.onClick,!0),e.removeEventListener("touchstart",this.onTouchStart,!1),e.removeEventListener("touchmove",this.onTouchMove,!1),e.removeEventListener("touchend",this.onTouchEnd,!1),e.removeEventListener("touchcancel",this.onTouchCancel,!1)},e.notNeeded=function(e){var n,r,i;if(typeof window.ontouchstart=="undefined")return!0;r=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(r){if(!t)return!0;n=document.querySelector("meta[name=viewport]");if(n){if(n.content.indexOf("user-scalable=no")!==-1)return!0;if(r>31&&document.documentElement.scrollWidth<=window.outerWidth)return!0}}if(s){i=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(i[1]>=10&&i[2]>=3){n=document.querySelector("meta[name=viewport]");if(n){if(n.content.indexOf("user-scalable=no")!==-1)return!0;if(document.documentElement.scrollWidth<=window.outerWidth)return!0}}}return e.style.msTouchAction==="none"?!0:!1},e.attach=function(t,n){return new e(t,n)},typeof define=="function"&&typeof define.amd=="object"&&define.amd?define("fastclick",[],function(){return e}):typeof module!="undefined"&&module.exports?(module.exports=e.attach,module.exports.FastClick=e):window.FastClick=e}(),define("common/animation/panningRegion",["require","marionette"],function(e){var t=e("marionette"),n=t.Region.extend({el:"#main-region",initialize:function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=e[Modernizr.prefixed("transition")]},transitionToView:function(e,n){var r=this,i=this.currentView;if(!i||i.isClosed){this.show(e);return}this.stopListening(e,"render"),this.listenTo(e,"render",function(){r.$el.off(r.transEndEventName),r.$el.append(e.el),r.$el.addClass("animated"),r.$el.css("opacity",0),r.$el.on(r.transEndEventName,function(){r.$el.off(r.transEndEventName),r.empty(),r.currentView=e,$(window).scrollTop(0),r.$el.css("opacity",1),e.$el.css("opacity",1),t.triggerMethod.call(e,"show"),t.triggerMethod.call(r,"show",e)})}),e.render()}});return n}),define("app",["require","jquery","common/loadingAnimation","jquery-cookie","modernizr","velocity","common/analytics","boomerang","dateFormat","hammer","stacktrace","marionette","common/globals","common/dataService","common/dataUtils","modules/header/headerModule","modules/marketPanels/marketPanelsModule","modules/helpTab/helpTabModule","modules/communityCheckpoint/communityCheckpointModule","modules/mobileAppMessage/mobileAppMessageModule","flow/flowController","common/utils","common/enums","common/nav","common/mixpanel","common/intercom","common/globalMessage","fastclick","common/animation/panningRegion"],function(e){var t=e("jquery");e("common/loadingAnimation"),e("jquery-cookie"),e("modernizr"),e("velocity"),e("common/analytics"),e("boomerang"),e("dateFormat"),e("hammer");var n=e("stacktrace"),r=e("marionette"),i=e("common/globals"),s=e("common/dataService"),o=e("common/dataUtils"),u=e("modules/header/headerModule"),a=e("modules/marketPanels/marketPanelsModule"),f=e("modules/helpTab/helpTabModule"),l=e("modules/communityCheckpoint/communityCheckpointModule"),c=e("modules/mobileAppMessage/mobileAppMessageModule"),h=e("flow/flowController"),p=e("common/utils"),d=e("common/enums"),v=e("common/nav"),m=e("common/mixpanel"),g=e("common/intercom"),y=e("common/globalMessage"),b=e("fastclick"),w=e("common/animation/panningRegion"),E=new r.Application({root:"/"});E.addRegions({header:"#header-region",marketHeader:"#market-header-region",helpTab:"#help-tab-region",globalMessage:"#global-message-region",checkoutPanel:"#checkout-panel-region",main:w,mobileAppMessage:"#mobile-app-message"});var S=function(){var e=new t.Deferred;u.getInstance({region:E.header}).show(),a.getInstance({marketHeaderRegion:E.marketHeader,checkoutPanelRegion:E.checkoutPanel}),l.handle(),o.applyAutoCoupon(function(t,n){m.trackMemberLogin(!0),t&&m.setRegistrationPath(n?"Email Capture":"Marketing Ad"),window.onbeforeunload=_.bind(function(){if(i.data.isFormDirty)return"You are about to loose the changes you made to your account..."},this);var r=function(e,t){var n=s.getMarketData(),r={order:n.orderData,storeCloseDate:n.orderLock.storeCloseDate,coupon:n.subscription?n.subscription.currentCouponKey:null};s.writeOrderDataToLocalStorage(r.order?r:null),!t&&n.member&&n.member.key&&s.updateSubscriptionDraft(n.nextDeliveryDate)};E.listenTo(i.eventBus,{"change-subscription:order-updated":function(){r(null,!0)},shareChanged:r,totalChanged:r}),c.show(E.mobileAppMessage),e.resolve()}.bind(this));var n=s.getMarketData();g.init(),n.member&&i.eventBus.trigger("app:login-by-cookie",n);if(o.getMemberType()===d.MemberType.Existing&&n.orderLock.isStoreClosed){var r=i.data.isOrderHasSavedItems?"with order":"without order";i.eventBus.trigger("analytics:event","Community-market","Market in cutoff",r)}return e},x=function(){window.Farmigo.initialData=undefined,h.start(),y.init({region:E.globalMessage}),f.getInstance({region:E.helpTab}).show(),v.getPage().isCommunityDependent?S().then(function(){E.trigger("initialize:finish")}):E.trigger("initialize:finish"),E.listenTo(i.eventBus,{communitySelected:function(e){s.serverData.farmKey=e.farmKey,s.serverData.pickupSiteKey=e.pickupSiteKey,s.loadMarketData().then(function(){S().then(function(){v.navigate(v.PageEnum.Market,undefined,undefined,e.pickupSiteUrl)})})}})};E.addInitializer(x),Modernizr.touch&&E.addInitializer(function(){new b(document.body)}),E.on("initialize:finish",function(e){if(location.hostname==="localhost"&&location.pathname.indexOf("jsessionid")>0){var t=location.href,n=t.slice(0,t.indexOf(";"))+t.slice(t.indexOf("?"),t.length);history.replaceState(null,"",n)}Backbone.history&&Backbone.history.start({pushState:p.hasPushState(),root:E.root})});var T=function(){BOOMR.init({beacon_url:"/dispatcher/ClientLoggerService.updateLog"});var e={type:"web",url:location.href},t=s.serverData.memberKey;t&&(e.memberKey=s.serverData.memberKey),s.serverData.farmKey&&s.serverData.farmKey!="null"&&(e.farmKey=s.serverData.farmKey),s.serverData.pickupSiteKey&&s.serverData.pickupSiteKey!="null"&&(e.pickupSiteKey=s.serverData.pickupSiteKey),BOOMR.addVar(e)},N=function(){var e="",t=function(t){var n=t.map(function(e){return e.toString()}).join("\n");e+=n,r(e)},r=function(e){var t=s.serverData.memberKey,n=s.serverData.farmKey,r=s.serverData.pickupSiteKey,i="type=clientException&url="+location.href+"&stackTrace="+e+(n&&n!="null"?"&farmKey="+s.serverData.farmKey:"")+(r&&r!="null"?"&pickupSiteKey="+s.serverData.pickupSiteKey:"")+(t?"&memberKey="+t:""),o=new XMLHttpRequest;o.open("POST","/dispatcher/ClientLoggerService.updateLog",!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(i)},i=function(t){e=t.message+" at file: "+t.fileName+", line"+t.lineNumber+", col: "+t.columnNumber+"\n",r(e)};window.onerror=function(e,s,o,u,a){a||(a={message:e,fileName:s,lineNumber:o,columnNumber:u}),typeof n!="undefined"?n.fromError(a).then(t).catch(i(a)):r(a+" (no stack trace) ")},Farmigo.loggerData?r(Farmigo.loggerData+" (no stack trace) "):""};return T(),N(),E}),define("router",["backbone","marionette","common/globals"],function(e,t,n){var n=require("common/globals"),r=!0,i="";t.AppRouter.prototype.before=function(){},t.AppRouter.prototype.after=function(){},t.AppRouter.prototype.route=function(t,s,o){_.isRegExp(t)||(t=this._routeToRegExp(t)),_.isFunction(s)&&(o=s,s=""),o||(o=this[s]);var u=this;return e.history.route(t,function(a){var f=u._extractParameters(t,a);u.before.apply(u,arguments),r&&o?o.apply(u,f):u.navigate(i,{trigger:!1}),u.after.apply(u,arguments),u.trigger.apply(u,["route:"+s].concat(f)),u.trigger("route",s,f),n.modal.close(undefined,!0),e.history.trigger("route",u,s,f)}),this};var s=t.AppRouter.extend({appRoutes:{"login(/:community)(?:qry)":"goToLogin","sign-up(/:community)(?:qry)":"goToSignUp","forgot-password(/:community)(?:qry)":"goToForgotPassword","change-password(/:community)(?:qry)":"goToChangePassword","market(/:community)(?:qry)":"goToMarket","(?:qry)":"doRoute","order(/:community)(?:qry)":"goToOrder","reorder(/:community)(?:qry)":"goToReOrder","account-info(/:community)(?:qry)":"goToAccount","history(/:community)(?:qry)":"goToHistory","payment(/:community)(?:qry)":"goToPay","thankyou(/:community)(?:qry)":"goToThankYou","map(?:qry)":"goToMap","logout(/:community)(?:qry)":"doLogout"},before:function(e){var t=e.split("/")[0];n.data.isFormDirty&&t!=="change-password"&&t!=="payment"&&t!=="account-info"&&(r=confirm("You are about to loose the changes you made to your account..."),r&&(n.data.isFormDirty=!1,n.eventBus.trigger("accountModel:refresh")))},after:function(){r=!0,i=window.location.pathname+window.location.search}});return{newRouter:function(e){return new s(e)}}}),define("hbs!modules/authentication/authenticationTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="container">\n    <div class="box-container row">\n        <div class="col-md-offset-2 col-md-8">\n            <div id="tabs"></div>\n            <div id="content" class="box-body"></div>\n        </div>\n    </div>\n</div>\n'});return n}),define("hbs!common/Tabs/tabTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\r\n        <div class="category-icon ',(i=n["class"])?i=i.call(e,{hash:{}}):(i=e&&e["class"],i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'" style="background-image: url(',(i=n.iconUrl)?i=i.call(e,{hash:{}}):(i=e&&e.iconUrl,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+')"></div>\r\n	',r}function c(e,t){return"hidden-xs"}function h(e,t){var r;return(r=n.displayTitle)?r=r.call(e,{hash:{}}):(r=e&&e.displayTitle,r=typeof r===u?r.call(e,{hash:{}}):r),r||r===0?r:""}function p(e,t){var r;return(r=n.title)?r=r.call(e,{hash:{}}):(r=e&&e.title,r=typeof r===u?r.call(e,{hash:{}}):r),a(r)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<a data-key="',(o=n.key)?o=o.call(t,{hash:{}}):(o=t&&t.key,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\r\n	',o=n["if"].call(t,t&&t.iconUrl,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\r\n	<span class="tab-title ',o=n["if"].call(t,t&&t.iconUrl,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+='">\r\n        ',o=n["if"].call(t,t&&t.displayTitle,{hash:{},inverse:f.program(7,p,i),fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="\r\n    </span>\r\n</a>",s});return n}),define("hbs!common/Tabs/tabsTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return"stretch"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="container">\n	<div class="nav-tabs-wrapper">\n		<ul class="nav nav-tabs ',o=n["if"].call(t,t&&t.isStretchToFullWidth,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+='"></ul>\n	</div>\n</div>',s});return n}),define("common/Tabs/TabsModule",["require","marionette","hbs!common/Tabs/tabTemplate","hbs!common/Tabs/tabsTemplate"],function(e){var t=e("marionette"),n=e("hbs!common/Tabs/tabTemplate"),r=e("hbs!common/Tabs/tabsTemplate"),i=t.ItemView.extend({template:n,className:function(){return this.model.get("isActive")?"active":""},tagName:"li",events:{"click a:not(.active)":function(){this.trigger("tab:clicked")}}}),s=t.CompositeView.extend({template:r,childView:i,childViewContainer:"ul",ui:{title:".title",categoryIcon:".category-icon",tabTitle:".tab-title"}}),o=t.Controller.extend({getView:function(e,t){t=t||{};var n;return t.selectedCategory&&(n=e.findWhere({key:t.selectedCategory})),n||(n=e.at(0)),n.set("isActive",!0),this._selectedTab=n.get("key"),this._tabsView||(this._tabsView=new s({collection:e,model:new Backbone.Model(t),className:t.className}),this._tabsView.on("childview:tab:clicked",function(e){this.setSelectedTab(e.$("a").data("key")),this.trigger("tab:clicked",this._selectedTab)},this),t.isSameWidth&&_.defer(function(){this._tabsView.$el.find("li").css({width:" "+100/e.length+"%"})}.bind(this))),this._tabsView.model.set("selectedTitle",n.get("title")),this._tabsView},getSelectedTab:function(){return this._selectedTab},setSelectedTab:function(e){this._selectedTab=e,this._tabsView.collection.each(function(e){var t=this._selectedTab==e.get("key");e.set("isActive",t),t&&this._tabsView.model.set("selectedTitle",e.get("title"))},this),this._tabsView.$el.find("li.active").removeClass("active"),this._tabsView.$el.find('li a[data-key="'+this._selectedTab+'"]').parent().addClass("active"),this._tabsView.$el.find("h1.title").text(this._tabsView.model.get("selectedTitle"))}});return o}),define("hbs!modules/authentication/login/loginTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<h1>Please Log In</h1>\n<hr/>\n<form role="form" id="login-form">\n    <button class="button big facebook btn-block" type="button" loading-animation>\n        <span class="image"></span>Log In with Facebook\n    </button>\n    <div class="or-separator">\n        <p>or</p>\n    </div>\n    <div class="form-group">\n        <input type="email" class="email form-control" placeholder="Email" data-field-name="email" required>\n    </div>\n\n    <div class="form-group">\n        <input type="password" class="form-control" placeholder="Password" data-field-name="password" data-parsley-minlength="6" required>\n    </div>\n\n    <div id=\'error-message-region\'></div>\n\n    <button class="button big user login btn-block" type="submit" loading-animation>\n        <span class="image"></span>Log In with Email\n    </button>\n    <div class="forgot-password">\n        <a>Forgot password?</a>\n    </div>\n\n</form>\n\n'});return n}),define("modules/authentication/login/loginView",["require","hbs!modules/authentication/login/loginTemplate","marionette","common/nav","common/validation","common/dataService","common/marketModel","common/alert/alert","common/globals"],function(e){function c(e){var t=e,n=this.errorMessage;return function(e){var r=e.status;if(r===l.Ok.status||r===l.OkExistingForFarm.status){if(e.redirect){window.location.href=e.redirect;return}a.eventBus.trigger("login")}else if(r===l.ChangePassword.status){var i=s.getMarketData();i.member||(i.member={email:t.email}),a.eventBus.trigger("changePassword")}else{var o=l[r].errorMessage;u.show(o,n,u.AlertType.danger)}}}var t=e("hbs!modules/authentication/login/loginTemplate"),n=e("marionette"),r=e("common/nav"),i=e("common/validation"),s=e("common/dataService"),o=e("common/marketModel"),u=e("common/alert/alert"),a=e("common/globals"),f=new o,l={Ok:{status:"Ok",errorMessage:""},Unauthorized:{status:"Unauthorized",errorMessage:""},WrongEmail:{status:"WrongEmail",errorMessage:"Wrong email or password"},WrongPassword:{status:"WrongPassword",errorMessage:"Wrong email or password"},ChangePassword:{status:"ChangePassword",errorMessage:""},EmailSendFailed:{status:"EmailSendFailed",errorMessage:""},OkExistingForFarm:{status:"OkExistingForFarm",errorMessage:""}},h=n.LayoutView.extend({template:t,events:{"click button.login":"onLogin","click button.facebook":"onFacebookLogin","click div.forgot-password a":"onForgotPassword"},ui:{email:".email"},regions:{errorMessage:"#error-message-region"},onLogin:function(e){e.preventDefault();var t=i.validateForm("#login-form");t&&s.login(t.email,t.password).done(c.call(this,t))},onFacebookLogin:function(){function t(t){t.userID&&FB.api("/me",function(t){t.id!=null&&t.email!=null?s.loginWithFacebook(t.id,t.email).done(c.call(e)):(console.log("login - received no email from facebook!"),a.eventBus.trigger("loading:hide"))})}a.eventBus.trigger("loading:show");var e=this,n=FB.getAuthResponse();return n?t.call(e,n):FB.login(function(n){t.call(e,n.authResponse)},{scope:"email"}),!1},onForgotPassword:function(){a.eventBus.trigger("forgotPassword")}});return h}),define("hbs!modules/authentication/forgotPassword/forgotPasswordTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<h1>Forgot Password?</h1>\n<hr/>\n<p>To reset your password, enter your email address and we\'ll send you instructions on how to create a new password.</p>\n<form role="form" id="forgot-password">\n	<div class="form-group">\n		<input type="email" class="form-control" placeholder="Email" data-field-name="email" value="',(o=n.email)?o=o.call(t,{hash:{}}):(o=t&&t.email,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'" required>\n	</div>\n	<div id=\'forgot-password-message-region\'></div>\n	<div class="form-group clearfix">\n		<button class="button big light pull-left cancel">Cancel</button>\n		<button class="button big user pull-right submit">Submit</button>\n	</div>\n</form>\n\n',s});return n}),define("modules/authentication/forgotPassword/forgotPasswordView",["require","marionette","hbs!modules/authentication/forgotPassword/forgotPasswordTemplate","common/validation","common/globals","common/globalMessage","common/dataService","common/enums","common/alert/alert","common/nav"],function(e){var t=e("marionette"),n=e("hbs!modules/authentication/forgotPassword/forgotPasswordTemplate"),r=e("common/validation"),i=e("common/globals"),s=e("common/globalMessage"),o=e("common/dataService"),u=e("common/enums"),a=e("common/alert/alert"),f=e("common/nav"),l=t.LayoutView.extend({template:n,regions:{messages:"#forgot-password-message-region"},events:{"click button.cancel":function(){return window.history.back(),!1},"click button.submit":"submitForgotPassword"},submitForgotPassword:function(){var e=r.validateForm("#forgot-password");return e&&o.forgotPassword(e.email).done(_.bind(function(e){if(e.status==u.EnumSigninStatus.Ok)a.show("We just emailed you a link you can use <br />to reset your password",this.messages,a.AlertType.success);else if(e.status==u.EnumSigninStatus.WrongEmail)a.show("Sorry, but there's no account with that email address",this.messages,a.AlertType.warning);else if(e.status==u.EnumSigninStatus.Unauthorized){var t="Your account was created with Facebook.<br />Please {0}Login with Facebook{1}.";a.show(t.replace("{0}",'<a id="forgot-psw-login-link" >').replace("{1}","</a>"),this.messages),$("#forgot-psw-login-link").click(function(){f.navigate(f.PageEnum.Login)})}else s.showError("Unknown error occurred")},this)),!1}});return l}),define("hbs!modules/authentication/changePassword/changePasswordTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\n		    <button class="button user light pull-left cancel" type="button">Cancel</button>\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<h1>Change Password</h1>\n<hr/>\n<form role="form" id="change-password">\n	<div class="form-group">\n		<input type="password" class="form-control" placeholder="Current Password" data-field-name="password" value="" data-parsley-minlength="6" required>\n	</div>\n	<div class="form-group">\n		<input type="password" class="form-control" id="master-psw" placeholder="New Password" data-field-name="newPassword" value="" data-parsley-minlength="6" required>\n	</div>\n	<div class="form-group">\n		<input type="password" class="form-control" placeholder="Confirm New Password" data-field-name="confirmNewPassword" value="" data-parsley-equalto="#master-psw" required>\n	</div>\n	<div id=\'change-password-message-region\'></div>\n	<div class="form-group clearfix">\n        ',o=n["if"].call(t,t&&t.showCancelButton,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+='\n		<button class="button user pull-right submit">Change Password</button>\n	</div>\n</form>',s});return n}),define("modules/authentication/changePassword/changePasswordView",["require","marionette","hbs!modules/authentication/changePassword/changePasswordTemplate","common/validation","common/globals","common/globalMessage","common/dataService","common/enums","common/alert/alert","common/nav"],function(e){var t=e("marionette"),n=e("hbs!modules/authentication/changePassword/changePasswordTemplate"),r=e("common/validation"),i=e("common/globals"),s=e("common/globalMessage"),o=e("common/dataService"),u=e("common/enums"),a=e("common/alert/alert"),f=e("common/nav"),l=t.LayoutView.extend({template:n,regions:{messages:"#change-password-message-region"},events:{"click button.submit":"changePassword","click button.cancel":"cancel"},initialize:function(e){e.showCancelButton&&this.model.set("showCancelButton",!0)},changePassword:function(){var e=r.validateForm("#change-password");return e&&o.changePassword(e).done(_.bind(function(e){e.status==u.EnumSigninStatus.Ok?(a.show("Password has been changed",this.messages,a.AlertType.success),i.eventBus.trigger("changePassword:done")):e.status==u.EnumSigninStatus.WrongPassword||e.status==u.EnumSigninStatus.Unauthorized?a.show("Email and password don't match",this.messages,a.AlertType.warning):s.showError("Unknown error occurred")},this)),!1},cancel:function(){i.eventBus.trigger("changePassword:cancel")}});return l}),define("hbs!modules/authentication/signUp/signUpLayoutTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\n        <p class="login-link">Already a member? <a>Log in here</a></p>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<h1>Become a Farmigo Member</h1>\n<p class="intro">Please create an account to continue</p>\n<hr/>\n<form role="form" id="sign-up-form">\n	<!-- do not remove id from the button!!!-->\n    <button class="button big facebook btn-block" type="button" id="btn-facebook-sign-up" loading-animation>\n        <span class="image"></span>Sign Up with Facebook\n    </button>\n    <div class="or-separator">\n        <p>or</p>\n    </div>\n    <div id="sign-up-form-region"></div>\n    <div id="error-message-region"></div>\n	<!-- do not remove id from the button!!!-->\n	<button class="button user big email btn-block sign-up" id="btn-email-sign-up" type="button" loading-animation>\n        <span class="image"></span>Sign Up with email\n    </button>\n    ',o=n["if"].call(t,t&&t.isCheckout,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+='\n    <p class="terms small">\n        By clicking \'Sign Up with email\' or \'Sign Up with Facebook\',<br>you confirm that you accept the <a href="/terms" target="_blank">terms of service</a>.\n    </p>\n    <p class="secure">Secure Payments &amp; Privacy Protection</p>\n</form>\n',s});return n}),define("hbs!modules/authentication/signUp/signUpFormTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="row">\n	<div class="col-xs-6">\n		<div class="form-group">\n			<input type="text" class="form-control" placeholder="First Name" data-field-name="firstName" required>\n		</div>\n	</div>\n	<div class="col-xs-6">\n		<div class="form-group">\n			<input type="text" class="form-control" placeholder="Last Name" data-field-name="lastName" required>\n		</div>\n	</div>\n</div>\n\n<div class="form-group">\n    <input type="email" class="email form-control" placeholder="Email" data-field-name="email" required>\n</div>\n\n<div class="form-group">\n    <input id="password" type="password" class="form-control" placeholder="Password" data-field-name="password"\n           data-parsley-minlength="6" data-parsley-minlength-message ="Your password must be at least 6 characters long. Please try again" required>\n</div>\n\n<div class="form-group">\n    <input type="password" class="form-control" placeholder="Confirm Password" data-parsley-equalto="#password" required>\n</div>\n'});return n}),define("modules/authentication/signUp/signUpFormView",["require","hbs!modules/authentication/signUp/signUpFormTemplate","marionette","common/marketModel"],function(e){var t=e("hbs!modules/authentication/signUp/signUpFormTemplate"),n=e("marionette"),r=e("common/marketModel"),i=new r,s=n.ItemView.extend({template:t,ui:{email:".email"}});return s}),define("modules/authentication/signUp/signUpLayout",["require","hbs!modules/authentication/signUp/signUpLayoutTemplate","modules/authentication/signUp/signUpFormView","marionette","backbone","common/validation","common/dataService","common/nav","common/globals","common/alert/alert"],function(e){var t=e("hbs!modules/authentication/signUp/signUpLayoutTemplate"),n=e("modules/authentication/signUp/signUpFormView"),r=e("marionette"),i=e("backbone"),s=e("common/validation"),o=e("common/dataService"),u=e("common/nav"),a=e("common/globals"),f=e("common/alert/alert"),l=r.LayoutView.extend({template:t,regions:{signUpForm:"#sign-up-form-region",errorMessage:"#error-message-region"},events:{"click button.email.sign-up":"onSignUpWithEmail","click button.facebook":"onSignUpWithFacebook","click .login-link":"goToLogin"},initialize:function(){var e=this;$("body").on("click",".login-link",function(){e.goToLogin()})},onSignUpWithEmail:function(){if(this.model.get("signUpFormOpened")){var e=this,t=s.validateForm("#sign-up-form");t&&o.signUp(t.firstName,t.lastName,t.email,t.password).done(function(t){t.status==="Failed"&&f.show(t.error,e.errorMessage,f.AlertType.danger),t.key&&a.eventBus.trigger("signup:done")})}else this.model.set("signUpFormOpened",!0),this.signUpForm.show(new n)},onSignUpWithFacebook:function(e){var t=this;if(e.currentTarget.getAttribute("ignore")!=="true"){function n(n){var r=e.currentTarget;r.setAttribute("ignore",!0),n.userID&&(FB.api("/me",function(e){e.id!=null&&e.email!=null?o.signUpWithFacebook(e.first_name,e.last_name,e.email,e.id).done(function(e){e.status==="Failed"&&f.show(e.error,t.errorMessage,f.AlertType.danger),e.member&&a.eventBus.trigger("signup:done")}):console.log("signup - received no email from facebook!")}),r.setAttribute("ignore",!0))}var r=FB.getAuthResponse();r?n.call(t,r):FB.login(function(e){n.call(t,e.authResponse)},{scope:"email"})}},goToLogin:function(){this.trigger("signup-layout:go-to-login")}});return{createLayout:function(e){return new l({model:new i.Model({isCheckout:e})})}}}),define("modules/authentication/authenticationModule",["require","hbs!modules/authentication/authenticationTemplate","marionette","common/Tabs/TabsModule","modules/authentication/login/loginView","modules/authentication/forgotPassword/forgotPasswordView","modules/authentication/changePassword/changePasswordView","modules/authentication/signUp/signUpLayout"],function(e){var t=e("hbs!modules/authentication/authenticationTemplate"),n=e("marionette"),r=e("common/Tabs/TabsModule"),i=e("modules/authentication/login/loginView"),s=e("modules/authentication/forgotPassword/forgotPasswordView"),o=e("modules/authentication/changePassword/changePasswordView"),u=e("modules/authentication/signUp/signUpLayout"),a=Backbone.Model.extend({defaults:{type:"login"}}),f=n.LayoutView.extend({template:t,regions:{tabs:"#tabs",content:"#content"},onShow:function(){var e=this.model.get("type"),t=this.model.get("hideTabs");if(!t){this.tabsController=new r;var n=this.tabsController.getView(new Backbone.Collection([new Backbone.Model({key:"login",title:"Login"}),new Backbone.Model({key:"sign-up",title:"Sign up"})]));this.tabsController.on("tab:clicked",_.bind(this.onTabClicked,this)),this.tabs.show(n),this.showTab(e),this.tabsController.setSelectedTab(e)}else this.showTab(e)},onTabClicked:function(e){this.showTab(e)},showTab:function(e){var t;e==="login"?t=new i:e==="sign-up"?(t=u.createLayout(this.model.get("isCheckout")),this.listenTo(t,"signup-layout:go-to-login",function(){this.tabsController.setSelectedTab("login"),this.showTab("login")},this)):e=="forgotPassword"?t=new s:e=="changePassword"&&(t=new o),this.content.show(t)}}),l=n.Controller.extend({initialize:function(e){this.region=e.region},show:function(e,t,n){var r=new a;e&&r.set({type:e,hideTabs:t,isCheckout:n});var i=new f({model:r});return this.region.show(i),this}});return l}),define("hbs!modules/shares/sharesTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="shares-header"></div>\n<div id="tab-content">\n    <div id="category-layout"></div>\n    <div id="shares"></div>\n</div>\n\n<div id="footer-region"></div>'});return n}),define("hbs!modules/shares/sharesViewTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n    <div class="row" ',i=n["if"].call(e,e&&e.propertyString,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(i||i===0)r+=i;r+='>\n        <div class="shares-title-wrapper">\n            <div class="shares-title-container clearfix">\n                ',i=n["if"].call(e,e&&e.isNonLocal,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(i||i===0)r+=i;r+='\n                <div class="title ',i=n["if"].call(e,e&&e.isNonLocal,{hash:{},inverse:f.program(6,p,t),fn:f.noop});if(i||i===0)r+=i;r+='">\n                    <h3 class="shares-title">',(i=n.sharesTitle)?i=i.call(e,{hash:{}}):(i=e&&e.sharesTitle,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</h3>\n                    ",i=n["if"].call(e,e&&e.producerId,{hash:{},inverse:f.noop,fn:f.program(8,d,t)});if(i||i===0)r+=i;r+="\n                    ",i=n["if"].call(e,e&&e.isNonLocal,{hash:{},inverse:f.noop,fn:f.program(10,v,t)});if(i||i===0)r+=i;return r+="\n                </div>\n            </div>\n        </div>\n    </div>\n",r}function c(e,t){var r;return(r=n.propertyString)?r=r.call(e,{hash:{}}):(r=e&&e.propertyString,r=typeof r===u?r.call(e,{hash:{}}):r),a(r)}function h(e,t){return'<div class="title"><i class="non-local-icon"></i></div>'}function p(e,t){return"col-xs-9 vbottom"}function d(e,t){return'\n                        <a class="read-more title-link">Shop producer »</a>\n                    '}function v(e,t){return' <i class="non-local-tooltip hidden-xs">?</i>'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;o=n["if"].call(t,t&&t.sharesTitle,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\n<div class="shares row"></div>\n',s});return n}),define("hbs!common/handlebars/partials/shareDiscount",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\r\n    <div class="share-label discount">\r\n        <i class="sale-icon"></i>\r\n        <span class="text">',(i=n.memberDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.memberDiscount,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"% off!</span>\r\n    </div>\r\n",r}function c(e,t){return'\r\n    <div class="share-label volume-discount">\r\n        <i class="sale-icon"></i>\r\n        <span class="text">Buy more and save!</span>\r\n    </div>\r\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;o=n["if"].call(t,t&&t.memberDiscount,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="\r\n",o=n["if"].call(t,t&&t.volumeDiscounts,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s});return t.registerPartial("shareDiscount",n),n}),define("hbs!common/handlebars/partials/shareProducerTitle",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;r+="\r\n		",(i=n.marketProducerName)?i=i.call(e,{hash:{}}):(i=e&&e.marketProducerName,i=typeof i===u?i.call(e,{hash:{}}):i);if(i||i===0)r+=i;return r+="\r\n	",r}function c(e,t){var r="",i;return r+="\r\n		",(i=n.producerTitle)?i=i.call(e,{hash:{}}):(i=e&&e.producerTitle,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"\r\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="bottom-title">\r\n	',o=n["if"].call(t,t&&t.marketProducerName,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\r\n	<span class="arrow hidden-xs">&raquo;</span>\r\n</div>\r\n',s});return t.registerPartial("shareProducerTitle",n),n}),define("hbs!common/handlebars/partials/sharePrice",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/quantityHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return"unit-with-serving-size"}function d(e,t){var r="",i,s,o;return r+="\r\n                (",o={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.pricePerServingUnit,0,o):f.call(e,"currencyHelper",e&&e.pricePerServingUnit,0,o)))+" /",(s=n.servingUnit)?s=s.call(e,{hash:{}}):(s=e&&e.servingUnit,s=typeof s===c?s.call(e,{hash:{}}):s),r+=l(s)+")\r\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="price-container">\r\n    <span class="price">\r\n        <em>',a={hash:{}},u=(o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.price,0,!0,a):f.call(t,"currencyHelper",t&&t.price,0,!0,a));if(u||u===0)s+=u;s+='</em>\r\n        <span class="delimiter-char">/</span>\r\n        <span>\r\n            <span class="unit ',u=n["if"].call(t,t&&t.servingSize,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='">',a={hash:{}},s+=l((o=n.quantityHelper||t&&t.quantityHelper,o?o.call(t,t&&t.unitQuantity,a):f.call(t,"quantityHelper",t&&t.unitQuantity,a))),(u=n.unit)?u=u.call(t,{hash:{}}):(u=t&&t.unit,u=typeof u===c?u.call(t,{hash:{}}):u),s+=l(u)+'</span>\r\n        </span>\r\n        <span class="cost-per-serving">\r\n            ',u=n["if"].call(t,t&&t.pricePerServingUnit,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(u||u===0)s+=u;return s+="\r\n        </span>\r\n    </span>\r\n</div>",s});return t.registerPartial("sharePrice",n),n}),define("common/handlebars/helpers/shareImageHelper",["require","hbs/handlebars","common/utils"],function(e){var t=e("hbs/handlebars"),n=e("common/utils"),r=.68,i,s=function(e){if(!e)return"";if(e.indexOf("res.cloudinary.com/farmigo")==-1)return e;var t="upload/c_scale,h_230,q_85,w_338";return e=e.replace("upload",t),e};return t.registerHelper("shareImageHelper",s),s}),define("hbs!modules/share/shareTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/shareDiscount","hbs!common/handlebars/partials/shareProducerTitle","hbs!common/handlebars/partials/sharePrice","common/handlebars/helpers/shareImageHelper","common/handlebars/helpers/orHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function d(e,t){return"temporary-unavailable "}function v(e,t){return"sold-out "}function m(e,t){return"selected"}function g(e,t){return"non-local"}function y(e,t){return"transparent"}function b(e,t){return'\n                            <div class="share-label sold-out"><span>Sold out</span></div>\n                        '}function w(e,t){var i="",s,o;i+="\n                            ",s=c.invokePartial(r.shareDiscount,"shareDiscount",e,n,r);if(s||s===0)i+=s;i+="\n                            ",o={hash:{},inverse:c.noop,fn:c.programWithDepth(14,E,t,e)},(s=n.badges)?s=s.call(e,o):(s=e&&e.badges,s=typeof s===f?s.call(e,o):s),n.badges||(s=h.call(e,s,o));if(s||s===0)i+=s;i+="\n                            ",s=n["if"].call(e,e&&e.isTempUnavailable,{hash:{},inverse:c.noop,fn:c.program(19,T,t)});if(s||s===0)i+=s;return i+="\n                        ",i}function E(e,t,r){var i="",s;i+="\n                                ",s=n["if"].call(e,r&&r.previousPrice,{hash:{},inverse:c.program(17,x,t),fn:c.program(15,S,t)});if(s||s===0)i+=s;return i+="\n                            ",i}function S(e,t){var n="";return n+='\n                                    <div class="share-label discount">\n                                        <i class="sale-icon"></i>\n                                        <span class="text">'+l(typeof e===f?e.apply(e):e)+"</span>\n                                    </div>\n                                ",n}function x(e,t){var n="";return n+='\n                                    <div><span class="share-label custom">'+l(typeof e===f?e.apply(e):e)+"</span></div>\n                                ",n}function T(e,t){return'\n                                <div class="share-label unavailable"><span>Temporarily unavailable</span></div>\n                            '}function N(e,t){var r="",i;r+='\n                        <div class="bundle-items hidden-xs hidden-sm ',i=n["if"].call(e,e&&e.isSmallDesktop,{hash:{},inverse:c.program(22,C,t),fn:c.noop});if(i||i===0)r+=i;return r+='"></div>\n                    ',r}function C(e,t){return"hidden-md"}function k(e,t){return" hidden-producer"}function L(e,t){return"row"}function A(e,t){return" col-xs-10"}function O(e,t){return'\n                               <div class="col-xs-2"></div>\n                           '}function M(e,t){var i="",s;i+='\n                                <a data-automation-id="producer" class="producer-link">\n                                    ',s=c.invokePartial(r.shareProducerTitle,"shareProducerTitle",e,n,r);if(s||s===0)i+=s;return i+="\n                                </a>\n                        ",i}function _(e,t){return'\n                    <i class="non-local-share-icon"></i>\n                '}function D(e,t){var r,i;return i={hash:{}},l((r=n.currencyHelper||e&&e.currencyHelper,r?r.call(e,e&&e.discountPrice,i):p.call(e,"currencyHelper",e&&e.discountPrice,i)))}function P(e,t){return" has-discount"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<div class="items-container ',o=n["if"].call(t,t&&t.isTempUnavailable,{hash:{},inverse:c.noop,fn:c.program(1,d,i)});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.isSoldOut,{hash:{},inverse:c.noop,fn:c.program(3,v,i)});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.quantity,{hash:{},inverse:c.noop,fn:c.program(5,m,i)});if(o||o===0)s+=o;s+='">\n\n        <div class="share ',o=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(7,g,i)});if(o||o===0)s+=o;s+='" data-key="',(o=n.dsId)?o=o.call(t,{hash:{}}):(o=t&&t.dsId,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'">\n            <a>\n                <div class="picture">\n                    <img src="',a={hash:{}},s+=l((o=n.shareImageHelper||t&&t.shareImageHelper,o?o.call(t,t&&t.imageURL,a):p.call(t,"shareImageHelper",t&&t.imageURL,a)))+'" class="share-picture img-responsive ',a={hash:{},inverse:c.noop,fn:c.program(9,y,i)},u=(o=n.orHelper||t&&t.orHelper,o?o.call(t,t&&t.isSoldOut,t&&t.isTempUnavailable,a):p.call(t,"orHelper",t&&t.isSoldOut,t&&t.isTempUnavailable,a));if(u||u===0)s+=u;s+='" alt="Photo of ',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'">\n                    <div class="labels-wrapper">\n                        ',u=n["if"].call(t,t&&t.isSoldOut,{hash:{},inverse:c.program(13,w,i),fn:c.program(11,b,i)});if(u||u===0)s+=u;s+="\n                    </div>\n                    ",u=n["if"].call(t,t&&t.isBundle,{hash:{},inverse:c.noop,fn:c.program(21,N,i)});if(u||u===0)s+=u;s+='\n                </div>\n            </a>\n\n            <div class="details',u=n["if"].call(t,t&&t.hideProducerLink,{hash:{},inverse:c.noop,fn:c.program(24,k,i)});if(u||u===0)s+=u;s+='">\n                <div class="details-top ">\n                    <div  class="details-inner">\n                       <div class="',u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(26,L,i)});if(u||u===0)s+=u;s+='">\n                           <a class="title ',u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(28,A,i)});if(u||u===0)s+=u;s+='">\n                               <span data-automation-id="share-title" class="text">',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+"</span>\n                           </a>\n                           ",u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(30,O,i)});if(u||u===0)s+=u;s+="\n                       </div>\n\n                        ",u=n.unless.call(t,t&&t.hideProducerLink,{hash:{},inverse:c.noop,fn:c.program(32,M,i)});if(u||u===0)s+=u;s+="\n                    </div>\n                </div>\n                ",u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(34,_,i)});if(u||u===0)s+=u;s+='\n                <div data-automation-id="price-before-discount" class="price-before-discount">',u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:c.noop,fn:c.program(36,D,i)});if(u||u===0)s+=u;s+='</div>\n                <div class="row price-and-quantity">\n                    <div data-automation-id="price" class="price',u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:c.noop,fn:c.program(38,P,i)});if(u||u===0)s+=u;s+=' col-sm-8 vcenter-sm">\n                        ',u=c.invokePartial(r.sharePrice,"sharePrice",t,n,r);if(u||u===0)s+=u;return s+='\n                    </div><div data-automation-id="quantity" class="share-quantity col-sm-4 vcenter-sm"></div>\n                </div>\n            </div>\n        </div>\n</div>\n',s});return n}),define("hbs!modules/singleItem/item/singleShareTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/shareDiscount","hbs!common/handlebars/partials/shareProducerTitle","hbs!common/handlebars/partials/sharePrice","common/handlebars/helpers/shareImageHelper","common/handlebars/helpers/orHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function d(e,t){return"temporary-unavailable "}function v(e,t){return"sold-out "}function m(e,t){return"selected"}function g(e,t){return"transparent"}function y(e,t){return'\n                            <div class="share-label sold-out"><span>Sold out</span></div>\n                        '}function b(e,t){var i="",s,o;i+="\n                            ",s=c.invokePartial(r.shareDiscount,"shareDiscount",e,n,r);if(s||s===0)i+=s;i+="\n                            ",o={hash:{},inverse:c.noop,fn:c.programWithDepth(12,w,t,e)},(s=n.badges)?s=s.call(e,o):(s=e&&e.badges,s=typeof s===f?s.call(e,o):s),n.badges||(s=h.call(e,s,o));if(s||s===0)i+=s;i+="\n                            ",s=n["if"].call(e,e&&e.isTempUnavailable,{hash:{},inverse:c.noop,fn:c.program(17,x,t)});if(s||s===0)i+=s;return i+="\n                        ",i}function w(e,t,r){var i="",s;i+="\n                                ",s=n["if"].call(e,r&&r.previousPrice,{hash:{},inverse:c.program(15,S,t),fn:c.program(13,E,t)});if(s||s===0)i+=s;return i+="\n                            ",i}function E(e,t){var n="";return n+='\n                                    <div class="share-label discount">\n                                        <i class="sale-icon"></i>\n                                        <span class="text">'+l(typeof e===f?e.apply(e):e)+"</span>\n                                    </div>\n                                ",n}function S(e,t){var n="";return n+='\n                                    <div><span class="share-label custom">'+l(typeof e===f?e.apply(e):e)+"</span></div>\n                                ",n}function x(e,t){return'\n                                <div class="share-label unavailable"><span>Temporarily unavailable</span></div>\n                            '}function T(e,t){return'id = "non-local"'}function N(e,t){return'\n                                <div class="shares-title-wrapper hidden-xs">\n                                    <div class="shares-title-container">\n                                        <i class="non-local-icon"></i>\n                                        <div>\n                                            <h3 class="item-box shares-title">Beyond our region</h3>\n                                            <i class="non-local-tooltip">?</i>\n                                        </div>\n                                    </div>\n                                </div>\n                            '}function C(e,t){var r="",i;return r+='\n                                    <li role="presentation"><a class="tag" key = ',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+' href="#">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</a></li>\n                                ",r}function k(e,t){return'\n                        <div class="shares-title-wrapper visible-xs">\n                            <div class="shares-title-container">\n                                <div class="title"><i class="non-local-icon"></i></div>\n                                <div class="title">\n                                    <h3 class="item-box shares-title">Beyond Our Region</h3>\n                                    <i class="non-local-tooltip">?</i>\n                                </div>\n                            </div>\n                        </div>\n                    '}function L(e,t){return" has-discount"}function A(e,t){var r,i;return i={hash:{}},l((r=n.currencyHelper||e&&e.currencyHelper,r?r.call(e,e&&e.discountPrice,i):p.call(e,"currencyHelper",e&&e.discountPrice,i)))}function O(e,t){var r="",i;r+=" <div><b>Details: </b>",(i=n.servingSize)?i=i.call(e,{hash:{}}):(i=e&&e.servingSize,i=typeof i===f?i.call(e,{hash:{}}):i);if(i||i===0)r+=i;return r+="</div>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.blockHelperMissing,p=n.helperMissing;s+='<div class="container">\n    <div class="single-share ',o=n["if"].call(t,t&&t.isTempUnavailable,{hash:{},inverse:c.noop,fn:c.program(1,d,i)});if(o||o===0)s+=o;s+="\n        ",o=n["if"].call(t,t&&t.isSoldOut,{hash:{},inverse:c.noop,fn:c.program(3,v,i)});if(o||o===0)s+=o;s+="\n        ",o=n["if"].call(t,t&&t.quantity,{hash:{},inverse:c.noop,fn:c.program(5,m,i)});if(o||o===0)s+=o;s+='">\n        <div class="back-link hidden-xs"><a><i class="back-icon"></i>',(o=n.backButtonText)?o=o.call(t,{hash:{}}):(o=t&&t.backButtonText,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</a></div>\n        <div class="share row">\n            <div class="col-md-5 col-sm-6">\n                <div class="picture">\n                    <img src="',a={hash:{}},s+=l((o=n.shareImageHelper||t&&t.shareImageHelper,o?o.call(t,t&&t.imageURL,a):p.call(t,"shareImageHelper",t&&t.imageURL,a)))+'" class="share-picture img-responsive ',a={hash:{},inverse:c.noop,fn:c.program(7,g,i)},u=(o=n.orHelper||t&&t.orHelper,o?o.call(t,t&&t.isSoldOut,t&&t.isTempUnavailable,a):p.call(t,"orHelper",t&&t.isSoldOut,t&&t.isTempUnavailable,a));if(u||u===0)s+=u;s+='" alt="Photo of ',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'">\n                    <div class="back-link visible-xs"><a><i class="back-icon"></i>back</a></div>\n                    <div class="labels-wrapper">\n                        ',u=n["if"].call(t,t&&t.isSoldOut,{hash:{},inverse:c.program(11,b,i),fn:c.program(9,y,i)});if(u||u===0)s+=u;s+='\n                    </div>\n                </div>\n            </div>\n            <div class="col-md-7 col-sm-6">\n                <div ',u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(19,T,i)});if(u||u===0)s+=u;s+=' class="details">\n                    <div  class="top-details">\n                        <div>\n                            ',u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(21,N,i)});if(u||u===0)s+=u;s+='\n                            <div class="title">',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</div>\n                            <a class="producer-link">\n                                ',u=c.invokePartial(r.shareProducerTitle,"shareProducerTitle",t,n,r);if(u||u===0)s+=u;s+='\n                            </a>\n                            <ul class="nav nav-pills hidden-xs">\n                                ',a={hash:{},inverse:c.noop,fn:c.program(23,C,i)},(u=n.tags)?u=u.call(t,a):(u=t&&t.tags,u=typeof u===f?u.call(t,a):u),n.tags||(u=h.call(t,u,a));if(u||u===0)s+=u;s+="\n                            </ul>\n                        </div>\n                    </div>\n                    ",u=n["if"].call(t,t&&t.isNonLocal,{hash:{},inverse:c.noop,fn:c.program(25,k,i)});if(u||u===0)s+=u;s+='\n                    <div class="bottom-details row">\n\n                        <div class="price',u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:c.noop,fn:c.program(27,L,i)});if(u||u===0)s+=u;s+=' col-sm-8 col-xs-7">\n                            <div data-automation-id="price-before-discount" class="price-before-discount hidden-xs">',u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:c.noop,fn:c.program(29,A,i)});if(u||u===0)s+=u;s+="</div>\n                            ",u=c.invokePartial(r.sharePrice,"sharePrice",t,n,r);if(u||u===0)s+=u;s+='\n                        </div>\n                        <div class="share-quantity col-sm-4 col-xs-5"></div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="inner">\n            <div class="description">\n               ',u=n["if"].call(t,t&&t.servingSize,{hash:{},inverse:c.noop,fn:c.program(31,O,i)});if(u||u===0)s+=u;s+="\n                <div>\n                    ",(u=n.description)?u=u.call(t,{hash:{}}):(u=t&&t.description,u=typeof u===f?u.call(t,{hash:{}}):u);if(u||u===0)s+=u;return s+="\n                </div>\n            </div>\n        </div>\n    </div>\n</div>",s});return n}),define("hbs!modules/share/shareQuantity/shareQuantityTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function f(e,t){var r="",i;r+="\n    ",i=n["if"].call(e,e&&e.quantity,{hash:{},inverse:a.noop,fn:a.program(2,l,t)});if(i||i===0)r+=i;return r+="\n",r}function l(e,t){var r="",i;return r+='\n        <div class="quantity label pull-right">',(i=n.quantity)?i=i.call(e,{hash:{}}):(i=e&&e.quantity,i=typeof i===o?i.call(e,{hash:{}}):i),r+=u(i)+"</div>\n    ",r}function c(e,t){var r="",i;r+="\n    ",i=n["if"].call(e,e&&e.quantity,{hash:{},inverse:a.program(7,p,t),fn:a.program(5,h,t)});if(i||i===0)r+=i;return r+="\n",r}function h(e,t){var r="",i;return r+='\n        <div class="row active-quantity">\n            <div class="col-xs-5 vcenter">\n                <button class="button action-btn sub">&mdash;</button>\n            </div><div class="col-xs-2 vcenter">\n                <div class="quantity ">',(i=n.quantity)?i=i.call(e,{hash:{}}):(i=e&&e.quantity,i=typeof i===o?i.call(e,{hash:{}}):i),r+=u(i)+'</div>\n            </div><div class="col-xs-5 vcenter">\n                <div class="add-tooltip-anchor">\n                    <button class="button action-btn add">&#43;</button>\n                </div>\n            </div>\n        </div>\n    ',r}function p(e,t){var r="",i;r+='\n        <button class="button add-btn add pull-right" ',i=n["if"].call(e,e&&e.canAddShare,{hash:{},inverse:a.program(8,d,t),fn:a.noop});if(i||i===0)r+=i;return r+=">Add</button>\n    ",r}function d(e,t){return'disabled="disabled"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t&&t.isCutOff,{hash:{},inverse:a.program(4,c,i),fn:a.program(1,f,i)}),s||s===0?s:""});return n}),define("modules/share/shareQuantity/shareQuantityView",["require","hbs!modules/share/shareQuantity/shareQuantityTemplate","marionette","common/dataUtils","common/enums","common/utils"],function(e){var t=e("hbs!modules/share/shareQuantity/shareQuantityTemplate"),n=e("marionette"),r=e("common/dataUtils"),i=e("common/enums"),s=e("common/utils"),o=n.LayoutView.extend({template:t,ui:{tooltipAnchor:".add-tooltip-anchor",addBtn:".add",subBtn:".sub"},events:{"click .add-btn":"_onAddclick","click .button.action-btn.add":"_onQuantityAddClick","click .button.action-btn.sub":"_onQuantitySubClick","mouseenter .add-tooltip-anchor":"_showLastOneToolTipOrder"},initialize:function(e){this.quantityAdded=e.quantityAdded},onRender:function(){var e=this.model.get("quantity"),t=this.model.get("minimumQuantity");e>0&&!r.canAddShareToOrder(this.model.get("key"),e)&&(this.quantityAdded?this._addLastOneToolTip():(this.$(".add-tooltip-anchor").tooltip({title:"You just got the last one",placement:"bottom",animation:!0,trigger:"manual"}),this.isTooltipActive=!0),this.ui.addBtn.attr("disabled","")),t&&e<=t&&this.ui.subBtn.attr("disabled","")},onShow:function(){this.listenTo(this,"enableBackAddButton",function(){this.ui.addBtn.removeAttr("disabled")})},_onAddclick:function(){this._addShare(i.ShareActionType.Add)},_onQuantityAddClick:function(){this._addShare(i.ShareActionType.AddQuantity)},_onQuantitySubClick:function(){this.trigger("share-quantity-view:sub")},_addShare:function(e){this.ui.addBtn.attr("disabled",""),this.trigger("share-quantity-view:add",e)},setTooltipWithoutShow:function(){this.$(".add-tooltip-anchor").tooltip({title:"You just got the last one",placement:"bottom",animation:!0,trigger:"manual"}),this.isTooltipActive=!0},_addLastOneToolTip:function(){_.defer(function(){this.setTooltipWithoutShow(),this.$(".add-tooltip-anchor").tooltip("show"),setTimeout(function(){this.$(".add-tooltip-anchor").tooltip("hide")}.bind(this),3e3),this.$(".add").attr("disabled","")}.bind(this))},_showLastOneToolTipOrder:function(){this.isTooltipActive&&(this.$(".add-tooltip-anchor").tooltip("show"),setTimeout(function(){this.$(".add-tooltip-anchor").tooltip("hide")}.bind(this),3e3))}});return o}),define("common/emptyOrderModule",["require","common/dataService","common/globals","common/confirmationModal/confirmationModal","common/handlebars/helpers/formatDateHelper","common/dataUtils","common/marketModel","modules/order/orderModel"],function(e){var t=e("common/dataService"),n=e("common/globals"),r=e("common/confirmationModal/confirmationModal"),i=e("common/handlebars/helpers/formatDateHelper"),s=e("common/dataUtils"),o=e("common/marketModel"),u=e("modules/order/orderModel");return{show:function(e,a){var f=new u;n.eventBus.trigger("analytics:pageView","cancel-order"),r.show("Are you sure you want to cancel your order for "+i(f.get("nextDeliveryDate"),"%A, %B %d")+"?",{okText:'Yes, cancel<span class="hidden-xs"> my order</span>',cancelText:'No, restore<span class="hidden-xs"> my order</span>',onOk:function(){return f.unset("order"),f.unset("currentCouponKey"),n.eventBus.trigger("analytics:pageEvent","Member left - empty order saved"),n.eventBus.trigger("analytics:event","Community-order","Cancel order - confirmed"),n.eventBus.trigger("analytics:event","Transactions","Order changed","Cancelled",s.getOrderTotal((new o).get("previousOrderMap"))),t.changeSubscription()}.bind(this),onCancel:function(){return n.eventBus.trigger("analytics:event","Community-order","Cancel order - restored"),t.loadMarketData()}})}}}),define("hbs!modules/share/bundleItemsTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/shareImageHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n    <img src="',s={hash:{}},r+=f((i=n.shareImageHelper||e&&e.shareImageHelper,i?i.call(e,e&&e.imageURL,s):a.call(e,"shareImageHelper",e&&e.imageURL,s)))+'" class="thumbnail"/>\n',r}function d(e,t){var r="",i;return r+="\n        <b>+",(i=n.moreItems)?i=i.call(e,{hash:{}}):(i=e&&e.moreItems,i=typeof i===l?i.call(e,{hash:{}}):i),r+=f(i)+"</b>\n        <p>more</p>\n    ",r}function v(e,t){var r="",i;return r+="\n        <b>",(i=n.total)?i=i.call(e,{hash:{}}):(i=e&&e.total,i=typeof i===l?i.call(e,{hash:{}}):i),r+=f(i)+"</b>\n        <p>items</p>\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function",c=this,h=n.blockHelperMissing;s+='<div class="bundle-title">\n    <p class="title">See inside the bundle  &raquo;</p>\n</div>\n',u={hash:{},inverse:c.noop,fn:c.program(1,p,i)},(o=n.shares)?o=o.call(t,u):(o=t&&t.shares,o=typeof o===l?o.call(t,u):o),n.shares||(o=h.call(t,o,u));if(o||o===0)s+=o;s+='\n<div class="more">\n    ',o=n["if"].call(t,t&&t.moreItems,{hash:{},inverse:c.program(5,v,i),fn:c.program(3,d,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("modules/share/bundleItemsView",["require","marionette","hbs!modules/share/bundleItemsTemplate"],function(e){var t=e("marionette"),n=e("hbs!modules/share/bundleItemsTemplate"),r=t.LayoutView.extend({template:n});return r}),define("hbs!modules/share/volumeDiscountTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t,r){var i="",s,o,u;i+='\n        <div class="discount-row',o=n["if"].call(e,(s=t,s==null||s===!1?s:s.last),{hash:{},inverse:a.noop,fn:a.program(2,p,t),data:t});if(o||o===0)i+=o;o=n["if"].call(e,r&&r.isCutOff,{hash:{},inverse:a.noop,fn:a.program(4,d,t),data:t});if(o||o===0)i+=o;i+='" data-quantity="',(o=n.numberOfItems)?o=o.call(e,{hash:{},data:t}):(o=e&&e.numberOfItems,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+'">\n            Buy ',(o=n.numberOfItems)?o=o.call(e,{hash:{},data:t}):(o=e&&e.numberOfItems,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+', save <b class="discount-value">',(o=n.value)?o=o.call(e,{hash:{},data:t}):(o=e&&e.value,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o),u={hash:{},inverse:a.program(8,m,t),fn:a.program(6,v,t),data:t},(o=n.isFixed)?o=o.call(e,u):(o=e&&e.isFixed,o=typeof o===f?o.call(e,u):o),n.isFixed||(o=c.call(e,o,u));if(o||o===0)i+=o;return i+="</b>\n        </div>\n    ",i}function p(e,t){return" last"}function d(e,t){return" disabled"}function v(e,t){return"$"}function m(e,t){return"%"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=this,f="function",l=this.escapeExpression,c=n.blockHelperMissing;s+='<div class="volume-discount-tooltip">\n    ',u={hash:{},inverse:a.noop,fn:a.programWithDepth(1,h,i,t),data:i},(o=n.volumeDiscounts)?o=o.call(t,u):(o=t&&t.volumeDiscounts,o=typeof o===f?o.call(t,u):o),n.volumeDiscounts||(o=c.call(t,o,u));if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("modules/share/volumeDiscountView",["require","marionette","hbs!modules/share/volumeDiscountTemplate"],function(e){var t=e("marionette"),n=e("hbs!modules/share/volumeDiscountTemplate"),r=t.LayoutView.extend({template:n});return r}),define("modules/share/shareView",["require","backbone","hbs!modules/share/shareTemplate","hbs!modules/singleItem/item/singleShareTemplate","marionette","common/utils","common/dataUtils","modernizr","modules/header/headerModule","common/globals","common/dataService","modules/share/shareQuantity/shareQuantityView","modules/order/orderModel","common/nav","common/emptyOrderModule","common/enums","modules/share/bundleItemsView","modules/share/volumeDiscountView","common/popover/popover"],function(e){var t=e("backbone"),n=e("hbs!modules/share/shareTemplate"),r=e("hbs!modules/singleItem/item/singleShareTemplate"),i=e("marionette"),s=e("common/utils"),o=e("common/dataUtils");e("modernizr");var u=e("modules/header/headerModule"),a=e("common/globals"),f=e("common/dataService"),l=e("modules/share/shareQuantity/shareQuantityView"),c=e("modules/order/orderModel"),h=e("common/nav"),p=e("common/emptyOrderModule"),d=e("common/enums"),v=e("modules/share/bundleItemsView"),m=e("modules/share/volumeDiscountView"),g=e("common/popover/popover"),y=d.ShareActionType,b={};b[y.Add]="Add Items button pressed",b[y.AddQuantity]="item qty increased",b[y.SubQuantity]="item qty reduced",b[y.OpenProducerPage]="producer info clicked",b[y.OpenProductPage]="item info clicked";var w=i.LayoutView.extend({getTemplate:function(){return this.options.singleItem?r:n},className:function(){if(this.options.singleItem)return;return this.options.page==="landingPage"?s.clientViewPort.isXs()?"item-box col-xs-6 custom":"item-box custom":this.options.sharesPerRow?this.options.sharesPerRow===2?"item-box col-xs-6 col-sm-3 col-md-6":this.options.sharesPerRow===4?"item-box col-xs-6 col-sm-3 col-md-3":this.options.sharesPerRow===6?"item-box col-xs-6 col-sm-4 col-md-2":"item-box item-carousel":"item-box col-xs-6 col-sm-6 col-md-4"},regions:{shareQuantity:".share-quantity",bundleItems:".bundle-items"},events:{"click a.producer-link":"goToProducer","click a.title":"goToItem","click a .picture":"goToItem","click .non-local-share-icon":"triggerTooltip","click .non-local-tooltip":"triggerTooltip","mouseover .non-local-tooltip":"triggerTooltip","mouseenter .picture":"openBundleTitle","mouseleave .share":"closeBundleTitle","mouseover .unit":"onUnitHoverSendAnalytics","click .discount-row":"onDiscountClicked","mouseover .add-btn":"onAddHover","click .volume-discount":"onVolumeDiscountBadgeClick","mouseover .volume-discount":"onVolumeDiscountHover"},ui:{addButton:"button.add",shareImage:".share img.share-picture",nonLocalShareIcon:".non-local-share-icon",nonLocalTooltip:".non-local-tooltip"},initialize:function(e){this.options.singleItem?(this._setCurrentOrderQuantity(),this.model.set("singleItem",!0)):this.model.set("singleItem",!1),this.model.rawData.hideProducerLink=e.hideProducerLink,this.listenTo(this.model,"change:quantity",function(){this.model.set("quantityAdded",!0),this.render()}),this.isLoginOptimizedFlow=e.isLoginOptimizedFlow,s.clientViewPort.isMd()&&!s.isMobile()&&(this.model.rawData.isSmallDesktop=!0)},onRender:function(){var e=this;this._setShareQuantity(),this.model.set("quantityAdded",!1),_.defer(function(){s.handleEllipsis(e.$el)}),this.model.get("isBundle")&&!this.model.get("isValuePack")&&!this.options.singleItem&&!s.clientViewPort.isXs()&&!this.options.hideBundleComponents&&this.setBundleItemsView(),this.renderPopover()},onShow:function(){var e='We always source locally first, but there are a few cases where a very common ingredient isn’t ever made or grown near you. For these items, we strive to give you the most delicious option from producers you’ll be proud to support. You can read our producer standards <a href="/producer-standards" target="_blank">here</a>.';this.ui.nonLocalShareIcon.length>0&&this.ui.nonLocalShareIcon.tooltip({title:e,placement:"bottom",trigger:"manual",html:!0}),this.ui.nonLocalTooltip.length>0&&this.ui.nonLocalTooltip.tooltip({title:e,placement:"bottom",trigger:"manual",html:!0}),this.addServingSizeToolTip()},goToProducer:function(){this._handleAnalytics(y.OpenProducerPage),h.navigate(h.PageEnum.Market,{preventPageEventAnalitics:!0},"producer="+this.model.get("producerId"))},goToItem:function(){this._handleAnalytics(y.OpenProductPage),this.$el.find("[ellipsis]").each(function(){$(this).tooltip("destroy")}),h.navigate(h.PageEnum.Market,null,"item="+this.model.get("dsId"))},_setShareQuantity:function(){var e=this.model;this._shareQuantityView=new l({model:e,quantityAdded:this.model.get("quantityAdded")}),this.shareQuantity.show(this._shareQuantityView),this.listenTo(this._shareQuantityView,{"share-quantity-view:add":function(e){this._addShare(e)}.bind(this),"share-quantity-view:sub":function(){this._subQuantity()}.bind(this)})},_subQuantity:function(){this._handleAnalytics(y.SubQuantity),this.addSubShareQuantity()},_addShare:function(e){!o.canAddShareToOrder(this.model.get("key"),this.model.get("quantity"))||(this._handleAnalytics(e),s.animateElement(this.ui.shareImage,u.getInstance().getOrderLink()).done(function(){this.addSubShareQuantity(!0),this._shareQuantityView.trigger("enableBackAddButton"),o.shouldShowWootric()&&o.setWootric()}.bind(this)))},_handleAnalytics:function(e){this.options.categoryDimensionTitle&&a.data.setLastCategories("",this.options.categoryDimensionTitle),this.options.hideProducerLink?this._triggerAnalyticsEvent(e,"/market/producer"):this.options.shareViewType?this._triggerAnalyticsEvent(e,"/market/product"):this._triggerAnalyticsEvent(e)},_triggerAnalyticsEvent:function(e,t){var n=this._getShareBadgeLabel(),r=this.model.get("volumeDiscounts")?" (volume discount)":"",i=this.getSharePositionInPage(),s=_.extend({},b,this.options.eventActions),o=this.model.get("crossSellingItemsKeys")&&this.model.get("crossSellingItemsKeys").length>0,u=this.options.isCrossSellingItem?" - cross sell items":"";switch(e){case y.Add:var f=this.options.shareViewType===d.ShareViewType.Related?"add related item clicked"+u:s[y.Add];a.eventBus.trigger("analytics:event","Community-market",f,this.model.get("title")+n+r,i,!1,t);break;case y.AddQuantity:a.eventBus.trigger("analytics:event","Community-market",s[y.AddQuantity],this.model.get("title")+n+r,0,!0,t);break;case y.SubQuantity:a.eventBus.trigger("analytics:event","Community-market",s[y.SubQuantity],this.model.get("title")+n+r,0,!0,t);break;case y.OpenProducerPage:a.eventBus.trigger("analytics:event","Community-market",s[y.OpenProducerPage],this.model.getProducerTitle(),i,!0,t);break;case y.OpenProductPage:var e=o?" - cross sell items":"";a.eventBus.trigger("analytics:event","Community-market",s[y.OpenProductPage]+e,this.model.get("title")+n+r,i,!0,t)}},_getShareBadgeLabel:function(){var e="",t=this.model.get("badges");return t&&t.length>0?e=" (Badge: "+t[0]+")":this.model.get("isSoldOut")?e=" (Badge: Sold out)":this.model.get("isTempUnavailable")?e=" (Badge: Temporarily unavailable)":this.model.get("memberDiscount")&&(e=" (Badge: "+this.model.get("memberDiscount")+"% off!)"),e},addSubShareQuantity:function(e,t){var n=new c,r=this.model,i;e?i=r.get("quantity")?r.get("quantity")+1:1:i=r.get("quantity")-1,i=t?t:i,i>0?(r.set("quantity",i),n.updateOrderItem({orderDeliveryDate:r.rawData.schedules[0].rawNextDelivery,price:r.get("price"),quantity:i,scheduleKey:r.rawData.schedules[0].key,shareKey:r.get("key"),extraProperties:this.options.extraProperties})):n.get("shouldEmptyOrder")?p.show():(n.removeOrderItem(r.get("key")),r.set("quantity",0)),this.trigger("addSubShare",this.model.get("key"))},_setCurrentOrderQuantity:function(){var e=_.reduce(f.getMarketData("orderData"),function(e,t){return e[t.shareKey]=t,e},{}),t=e[this.model.get("key")];t?this.model.set("quantity",t.quantity):this.model.set("quantity",0)},triggerTooltip:function(e){var t=$(e.currentTarget);t.tooltip("show"),this.$body=$("body").on("click",function(e){$(e.target).closest(".tooltip").length==0&&$(e.target).closest(".non-local-share-icon").length==0&&$(e.target).closest(".non-local-tooltip").length==0&&(this.$body.off(),t.tooltip("hide"))}.bind(this))},openBundleTitle:function(){!s.clientViewPort.isXs()&&this.model.get("isBundle")&&!this._bundleTitleOpen&&!this.model.get("isValuePack")&&!this.options.hideBundleComponents&&(this._bundleTitleOpen=!0,this.$el.find(".bundle-items").addClass("show"),this.$el.find(".picture .share-picture").addClass("bundle-open-picture"))},closeBundleTitle:function(){!s.clientViewPort.isXs()&&this.model.get("isBundle")&&this._bundleTitleOpen&&(this._bundleTitleOpen=!1,this.$el.find(".bundle-items").removeClass("show"),this.$el.find(".picture .share-picture").removeClass("bundle-open-picture"))},setBundleItemsView:function(){this._bundleTitleOpen=!1;var e=f.getMarketData("sharesMap"),n=this.model.get("bundleComponents"),r=n.length>4?n.length-4:undefined;n=n.slice(0,4),n=_.map(n,function(t){var n=_.find(e,{key:t.itemKey});return n});var i=s.clientViewPort.isMd()&&!s.isMobile()?!0:!1,o=new v({model:new t.Model({shares:n,moreItems:r,total:n.length})});this.bundleItems.show(o)},addServingSizeToolTip:function(){var e=this.model.get("servingSize");!s.isMobile()&&this.shouldDisplayServingSizeToolTip()&&!this.options.singleItem&&this.$el.find(".price-container").tooltip({title:e,placement:"top",trigger:"hover",html:!0})},onUnitHoverSendAnalytics:function(){this.shouldDisplayServingSizeToolTip()&&!this.options.singleItem&&a.eventBus.trigger("analytics:event","Community-market","Item unit hover",this.model.get("title"),0,!0)},shouldDisplayServingSizeToolTip:function(){return this.model.get("servingSize")},getSharePositionInPage:function(){var e=this,t=1,n=$(".share");return _.find(n,function(n,r){$(n).data()&&$(n).data().key==e.model.get("dsId")&&(t=r+1)}),t},renderPopover:function(e,t,n){if(this.model.get("volumeDiscounts")){t=t||150;var r=this.$el.find(n?n:".volume-discount"),i=new m({model:this.model});i.render();var o=g.create(r,i,{trigger:"hover",delay:t,className:n?"discount-wrapper-bottom":"discount-wrapper",container:r,isShow:e,placement:n?"top":"bottom",avoidReRender:!0,isDismissible:!0});e&&!s.isMobile()&&setTimeout(function(){r.popover("hide")},3e3),r.on("shown.bs.popover",function(){$(".nav-carousel").css("visibility","hidden")}),r.on("hidden.bs.popover",function(){$(".nav-carousel").css("visibility","visible")})}},onDiscountClicked:function(e){e.stopPropagation();var t=$(e.currentTarget).data("quantity"),n=f.getMarketData("orderData"),r=this.model.get("key"),i=_.find(n,{shareKey:r});a.eventBus.trigger("analytics:event","Community-market","volume discount offer clicked",this.model.get("title")+" (volume discount)",i?t-i.quantity:t,!1);if(!this.model.get("canAddShare"))return;this.addSubShareQuantity(!0,t)},onAddHover:function(){if(this.model.get("volumeDiscounts")&&!this.addHoverAlready){var e=this.getSharePositionInPage();a.eventBus.trigger("analytics:event","Community-market","volume discount shown - add",this.model.get("title")+" (volume discount)",e,!1),this.addHoverAlready=!0}this.renderPopover(!0,200)},onVolumeDiscountBadgeClick:function(e){e.stopPropagation();if(!this.volumeDiscountBadgeClickedAlready){var t=this.getSharePositionInPage();a.eventBus.trigger("analytics:event","Community-market","volume discount shown - add",this.model.get("title")+" (volume discount)",t,!1),this.volumeDiscountBadgeClickedAlready=!0}this.renderPopover(!0,0)},onVolumeDiscountHover:function(){if(!this.badgeHoverAlready){var e=this.getSharePositionInPage();a.eventBus.trigger("analytics:event","Community-market","volume discount shown - badge",this.model.get("title")+" (volume discount)",e,!1),this.badgeHoverAlready=!0}}});return w}),define("modules/shares/sharesView",["require","marionette","common/globals","common/nav","hbs!modules/shares/sharesViewTemplate","modules/share/shareView","common/utils","common/emptyOrderModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/nav"),i=e("hbs!modules/shares/sharesViewTemplate"),s=e("modules/share/shareView"),o=e("common/utils"),u=e("common/emptyOrderModule"),a=o.clientViewPort.isXs()?4:6,f=t.CompositeView.extend({childView:s,template:i,childViewContainer:".shares",ui:{nonLocalTooltip:".non-local-tooltip"},events:{"mouseover .non-local-tooltip":"triggerTooltip","click .non-local-tooltip":"triggerTooltip","click .title-link":"goToLink","mouseenter .item-box":"onItemMouseIn","mouseleave .item-box":"onItemMouseOut"},childEvents:{addSubShare:"addSubShareTriggered"},initialize:function(e){var t;this.moduleEventBus=e.moduleEventBus,this.listenTo(this.moduleEventBus,{shareChanged:this.onShareChanged}),this.model&&(t=this.model.get("maxShares"),t&&(this._hiddenModels=this.collection.last(this.collection.length-t),this.collection.reset(this.collection.first(t))),this.listenTo(this.model,"change:maxShares",function(){this.collection.add(this._hiddenModels)}))},onShow:function(){if(!o.clientViewPort.isXs()){var e='We always source locally first, but there are a few cases where a very common ingredient isn’t ever made or grown near you. For these items, we strive to give you the most delicious option from producers you’ll be proud to support. You can read our producer standards <a href="/producer-standards" target="_blank">here</a>.';this.ui.nonLocalTooltip.length>0&&this.ui.nonLocalTooltip.tooltip({title:e,placement:"bottom",trigger:"manual",html:!0})}},addSubShareTriggered:function(e,t){this.trigger("sharesView:addSubShare",t)},triggerTooltip:function(){this.ui.nonLocalTooltip.tooltip("show"),this.$body=$("body").on("click",function(e){$(e.target).closest(".tooltip").length==0&&$(e.target).closest(".non-local-tooltip").length==0&&(this.$body.off(),this.ui.nonLocalTooltip.tooltip("hide"))}.bind(this))},goToLink:function(e){var t=this.model.get("producerId"),i=this.model.get("producerTitle");n.eventBus.trigger("analytics:event","Community-market","producer shop clicked",i),r.navigate(r.PageEnum.Market,{preventPageEventAnalitics:!0},"producer="+t)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(!0),this.endBuffering(),setTimeout(_.bind(function(){this.startBuffering(),this.showCollection(!1),this.endBuffering(),this.triggerMethod("buffer:rendered:collection",this)},this),1),this.triggerMethod("render:collection",this))},showCollection:function(e){var t,n=this.model?this.model.get("maxShares"):undefined;this.collection.each(function(r,i){if(n&&i>=n)return;e&&i<=a&&(t=this.getChildView(r),this.addChild(r,t,i)),!e&&i>a&&(t=this.getChildView(r),this.addChild(r,t,i))},this)},onShareChanged:function(e){var t=this.collection.findWhere({key:e.shareKey});t&&t.set("quantity",e.quantity)},onItemMouseIn:function(){this.trigger("sharesView:itemMouseIn")},onItemMouseOut:function(){this.trigger("sharesView:itemMouseOut")}});return f}),define("modules/shares/sharesCollection",["require","common/dataService","modules/share/shareModel"],function(e){var t=e("common/dataService"),n=e("modules/share/shareModel"),r=Backbone.Collection.extend({model:n,updateOrderCount:function(){var e=_.reduce(t.getMarketData("orderData"),function(e,t){return e[t.shareKey]=t,e},{});this.each(function(t){var n=e[t.get("key")];n?t.set("quantity",n.quantity):t.set("quantity",0)})}});return r}),define("hbs!modules/footer/footerTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div id="footer">\n	<div class="container">\n		<div class="col-sm-1">\n            <span class="logo hidden-xs"></span>\n		</div>\n		<nav class="col-sm-8">\n			<ul>\n				<li><a class="about" href="/about">About</a></li>\n				<li><a class="faq" href="'+f((o=(o=t&&t.urls,o==null||o===!1?o:o.faq),typeof o===a?o.apply(t):o))+'" target="_blank">Help</a></li>\n				<li><a class="csa-software" href="'+f((o=(o=t&&t.urls,o==null||o===!1?o:o.csaSoftware),typeof o===a?o.apply(t):o))+'" target="_blank">CSA Software</a></li>\n				<li><a class="jobs" href="/about/jobs">We\'re Hiring!</a></li>\n				<li><a class="producer-standards" href="'+f((o=(o=t&&t.urls,o==null||o===!1?o:o.producerStandards),typeof o===a?o.apply(t):o))+'">Producer Standards</a></li>\n				<li><a class="privacy" href="/privacy">Privacy</a></li>\n				<li><a class="terms" href="/terms">Terms</a></li>\n			</ul>\n			<span class="rights hidden-xs">© ',u={hash:{}},s+=f((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.now,"%Y",u):l.call(t,"formatDateHelper",t&&t.now,"%Y",u)))+' Farmigo, PBC.</span>\n		</nav>\n		<div class="col-sm-3">\n            <div class="follow-us hidden-xs">\n                Follow us on\n                <ul>\n                    <li><a class="facebook" title="Facebook" target="_blank" href="http://www.facebook.com/Farmigo"></a></li>\n                    <li><a class="twitter" title="Twitter" target="_blank" href="http://twitter.com/#!/farmigo"></a></li>\n					<li class="first-in-row"><a class="instagram" title="Instagram" target="_blank" href="https://instagram.com/farmigo/"></a></li>\n					<li><a class="pinterest" title="Pinterest" target="_blank" href="https://www.pinterest.com/farmigo/"></a></li>\n                </ul>\n            </div>\n            <a class="b-corp hidden-xs" href="http://www.bcorporation.net/about" title="B Corp" target="_blank"></a>\n		</div>\n	</div>\n</div>',s});return n}),define("modules/footer/footerModule",["require","marionette","common/dataService","hbs!modules/footer/footerTemplate"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("hbs!modules/footer/footerTemplate"),i=t.ItemView.extend({template:r,model:new Backbone.Model({now:Date.now(),urls:n.serverData.urls})}),s=t.Controller.extend({initialize:function(e){this.region=e.region},show:function(){var e=new i;this.region.show(e)}});return s}),define("hbs!common/select/selectTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n		<span class="label">',(i=n.label)?i=i.call(e,{hash:{}}):(i=e&&e.label,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+":</span>\n	",r}function c(e,t){var r="",i;r+='\n                <option value="',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'" ',i=n["if"].call(e,e&&e.selected,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(i||i===0)r+=i;return r+=">\n					",(i=n.text)?i=i.call(e,{hash:{}}):(i=e&&e.text,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"\n                </option>\n			",r}function h(e,t){return"selected"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="select">\n	',o=n["if"].call(t,t&&t.label,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n	<div class="styled-select">\n        <select>\n			',o=n.each.call(t,t&&t.options,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+="\n        </select>\n	</div>\n</div>\n",s});return n}),define("common/select/selectModule",["require","hbs!common/select/selectTemplate","backbone","marionette"],function(e){var t=e("hbs!common/select/selectTemplate"),n=e("backbone"),r=e("marionette"),i=r.LayoutView.extend({template:t,ui:{nativeSelect:"select"},events:{"click .select":function(){this.ui.nativeSelect.focus()},"change select":function(e){var t=this.ui.nativeSelect.val(),n=e.target.selectedOptions[0].text;this.trigger("selected",t,n)}}});return{getView:function(e){return new i({model:new n.Model(e)})}}}),define("modules/sharesHeader/categoriesModule",["require","marionette","common/globals","common/utils","common/dataService","common/globalMessage","modules/header/headerModule","common/Tabs/TabsModule","common/select/selectModule"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/utils"),i=e("common/dataService"),s=e("common/globalMessage"),o=e("modules/header/headerModule"),u=e("common/Tabs/TabsModule"),a=e("common/select/selectModule"),f,l,c=function(){return o.getInstance().getHeight()+(r.clientViewPort.isXs()||i.serverData.isIos?0:s.getHeight())},h=t.Controller.extend({onDestroy:function(){l&&window.removeEventListener("scroll",l)},getView:function(e,t,i,s){var o,f,l=function(e){var t;this._isFixed&&e!=s&&(t=$(i).offset().top-c()-f.$el.height()+5,$(window).scrollTop(t))}.bind(this),h=function(e,t){l(e),n.eventBus.trigger("analytics:pageEvent","market","category tab clicked",t,0,!0),this.trigger("selected",e)}.bind(this);return r.clientViewPort.isXs()?(o={label:"Category",options:e.map(function(e){return{key:e.key,text:e.title,selected:e.key==t}}.bind(this))},f=a.getView(o),f.on("selected",function(e,t){h(e,t)}.bind(this))):(this._tabs=new u,e.forEach(function(e){var t=e.title.split(" ");t.splice((t.length+1)/2,0,"<br/>");var n=t.slice(0,t.length/2).join(" "),r=t.slice(t.length/2,t.length).join(" ");e.displayTitle=n+r}),f=this._tabs.getView(new Backbone.Collection(e),{isStretchToFullWidth:!0,isShowSelectedTitle:!0,selectedCategory:t,isSameWidth:!0}),this._tabs.on("tab:clicked",function(e){h(e,f.model.get("selectedTitle"))}.bind(this))),n.eventBus.on("subCategory:click",function(){r.clientViewPort.isXs()&&l()}),f},setSelectedCategory:function(e){this._tabs.setSelectedTab(e)},setAutoFixed:function(e,t){if(e&&t){var i=this;this._containingView=e,this._containingRegion=t;if(r.clientViewPort.isXs())this._tabsOffset=e.$el.offset().top;else{this._tabsOffset=e.$el.find(e.ui.tabTitle.selector).offset().top;var s=function(){this._isFixed=!1,setTimeout(this.handleFixedTabs.bind(i),500)}.bind(this);this.listenTo(n.eventBus,{"headerMessage:show":s,"headerMessage:hide":s})}l=this.handleFixedTabs.bind(this),window.addEventListener("scroll",l)}},handleFixedTabs:function(){var e=$(".tabs-static"),t=$(window).scrollTop(),n=c(),i=r.isMobile()&&$("input:focus").length>0,s=n>=this._tabsOffset-t-3&&!i;if(s){this._isFixed||(this._containingRegion.$el.css({position:"fixed",top:n,width:"100%",zIndex:4,boxShadow:"0 2px 4px rgba(0,0,0,0.15)"}),e.length==0&&(e=$('<div class="tabs-static">').css({height:this._containingRegion.$el.height()}),this._containingRegion.$el.after(e)),this._isFixed=!0,r.clientViewPort.isXs()||this._containingView.$el.find(this._containingView.ui.categoryIcon.selector).hide()),f=f?f:$(".favorites-popover").css("top");var o=parseInt($("#categories").css("height"))-5;$(".favorites-popover").css("top",o)}else this._containingRegion.$el.removeAttr("style"),e.length>0&&(e.remove(),$(".favorites-popover").css("top",f)),this._isFixed=!1,r.clientViewPort.isXs()||this._containingView.$el.find(this._containingView.ui.categoryIcon.selector).show()},adjustWidth:function(){r.clientViewPort.isXs()||this.ui.categories.find("li").css({width:" "+100/this._categoriesArr.length+"%"})}});return h}),define("hbs!modules/sharesHeader/subCategoriesTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;r+='\n        <div class="sub-categories">\n            <div class="container hidden-xs">\n                <div class="sub-categories-wrapper clearfix">\n                    <span class="title">Shop:</span>\n                    <ul class="nav nav-pills">\n                        <li class="sub-category" key="all" role="presentation">\n                            <a class="active">All</a>\n                        </li>\n                        ',s={hash:{},inverse:f.noop,fn:f.program(2,h,t)},(i=n.subCategories)?i=i.call(e,s):(i=e&&e.subCategories,i=typeof i===u?i.call(e,s):i),n.subCategories||(i=l.call(e,i,s));if(i||i===0)r+=i;return r+="\n                    </ul>\n                </div>\n            </div>\n        </div>\n    ",r}function h(e,t){var r="",i;return r+='\n                            <li class="sub-category" key=',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+' role="presentation">\n                                <a>',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</a>\n                            </li>\n                        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this,l=n.blockHelperMissing;s+='<div id="sub-categories">\n    ',o=n["if"].call(t,t&&t.subCategories,{hash:{},inverse:f.noop,fn:f.program(1,c,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("modules/sharesHeader/subCategoriesView",["require","marionette","common/dataService","common/globals","hbs!modules/sharesHeader/subCategoriesTemplate"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("common/globals"),i=e("hbs!modules/sharesHeader/subCategoriesTemplate"),s=t.ItemView.extend({template:i,initialize:function(e){this.moduleEventBus=e.moduleEventBus},events:{"click .sub-category":"_onSubCategoryClick"},onShow:function(){this.model.get("subCategoryKey")&&this.setSubCategoryActive(this.model.get("subCategoryKey"))},_onSubCategoryClick:function(e){var t=e.currentTarget.getAttribute("key");this._triggerSubCategoryAnalytics(t),this.setSubCategoryActive(t),this.moduleEventBus.trigger("subCategoriesView:click",t,!0)},setSubCategoryActive:function(e){this.$(".active").removeClass("active");var t=this.$("[key="+e+"] a");t.addClass("active")},_triggerSubCategoryAnalytics:function(e){var t,i,s=n.getMarketData("categories"),o=_.find(s,{key:this.model.get("categoryKey")});if(e!="all"){var u=_.findWhere(o.subCategories,{key:e});u&&(i=u.title)}else i="all";t=o?o.title:"",r.eventBus.trigger("analytics:event","Community-market","sub category clicked",t+"/"+i,0,!0)}});return s}),define("hbs!modules/search/searchTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+='\n                    <li class="tag col-xs-6 ',i=n["if"].call(e,e&&e.isChecked,{hash:{},inverse:a.noop,fn:a.program(2,p,t)});if(i||i===0)r+=i;r+='">\n                        <label>\n                            <input class="vcenter" type="checkbox" data-id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'" ',i=n["if"].call(e,e&&e.isChecked,{hash:{},inverse:a.noop,fn:a.program(2,p,t)});if(i||i===0)r+=i;return r+='/>\n                            <span class="text vcenter">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</span>\n                        </label>\n                    </li>\n                ",r}function p(e,t){return"checked"}function d(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=this,f="function",l=this.escapeExpression,c=n.blockHelperMissing;s+='<div class="full-search container">\n    <div class="search-row row">\n        <div class="tags col-xs-6">\n            <h2 class="title">Try browsing by our most popular tags:</h2>\n            <div class="row">\n                ',u={hash:{},inverse:a.noop,fn:a.program(1,h,i)},(o=n.tags)?o=o.call(t,u):(o=t&&t.tags,o=typeof o===f?o.call(t,u):o),n.tags||(o=c.call(t,o,u));if(o||o===0)s+=o;s+='\n            </div>\n            <button class="search-tags-btn button btn-block lettuce" ',o=n.unless.call(t,t&&t.hasCheckedTags,{hash:{},inverse:a.noop,fn:a.program(4,d,i)});if(o||o===0)s+=o;return s+='>View Products</button>\n        </div>\n        <div class="name-search col-xs-6">\n            <h2 class="title">Search for items in the market:</h2>\n            <div class="search-component form" role="form">\n                <div class="icon-col">\n                    <a class="icon" disabled></a>\n                </div>\n                <div>\n                    <input type="text" class="search-input form-control" placeholder="Search..." autocomplete="off" spellcheck="false">\n                </div>\n                <div class="search-btn-col">\n                    <button class="search-btn button lettuce">&#10004;</button>\n                </div>\n            </div>\n            <div id="suggestions-region"></div>\n        </div>\n    </div>\n\n</div>\n',s});return n}),define("modules/search/searchView",["require","marionette","common/nav","common/utils","common/dataService","common/globals","modules/search/suggestionsModule","hbs!modules/search/searchTemplate"],function(e){var t=e("marionette"),n=e("common/nav"),r=e("common/utils"),i=e("common/dataService"),s=e("common/globals"),o=e("modules/search/suggestionsModule"),u=e("hbs!modules/search/searchTemplate"),a=t.LayoutView.extend({template:u,initialize:function(e){var t=this;this.moduleEventBus=e.moduleEventBus,$(window).on("orientationchange",function(e){var n=t.$el.offset().top+t.$el.height();n-=$(window).scrollTop(),t.$el.closest(".modal-dialog").css("margin-top",n)})},regions:{suggestions:"#suggestions-region"},ui:{input:"input.search-input",searchTagsButton:".search-tags-btn"},events:{"keyup input.search-input":"_onKeyUp","click .search-btn":"_onSearchClick","click .search-tags-btn":"_onSearchTagsClicked","change .tag input":"_onTagClick"},onRender:function(){this.suggestionsModule=new o({region:this.suggestions,moduleEventBus:this.moduleEventBus}),this.suggestionsModule.show(),this.moduleEventBus.on("search:close",this.close.bind(this))},onShow:function(){this.$el.find(".search-input").focus()},onDestroy:function(){this.suggestionsModule.destroy()},close:function(){this.trigger("search:close")},_onTagClick:function(e){var t=$(e.currentTarget),n=t.is(":checked");return this.model.checkTag(t.data("id"),n),this.render(),!1},_onKeyUp:function(e){var t=this.ui.input.val();this.moduleEventBus.trigger("search:keyup",e,t),this.model.uncheckTags()},_onSearchClick:function(){this.moduleEventBus.trigger("search:searchClick",this.ui.input.val())},_triggerAnalytics:function(e,t){s.eventBus.trigger("analytics:event","Community-search",e,t,0,!0)},_onSearchTagsClicked:function(){var e=this.model.get("checkedTags"),t=e.map(function(e){return e.title}),r=e.map(function(e){return e.id});this.trigger("search:close"),$(window).scrollTop(0);var i=t.join();s.eventBus.trigger("analytics:event","Community-search","view products clicked",i,0,!0),s.data.setLastCategories("Tags from Search Tab",i),n.navigate(n.PageEnum.Market,{preventPageEventAnalitics:!0},"tag="+r.join())}});return a}),define("modules/search/searchModule",["require","backbone","marionette","common/utils","common/enums","common/nav","common/dataService","common/rawDataModel","common/modal/modal","modules/search/searchView"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/utils"),i=e("common/enums"),s=e("common/nav"),o=e("common/dataService"),u=e("common/rawDataModel"),a=e("common/modal/modal"),f=e("modules/search/searchView"),l=8,c=u.Model.extend({rawValues:{tags:new u.Value("tags")},readers:{checkedTags:function(){return this.get("tags").filter(function(e){return e.isChecked})},hasCheckedTags:function(){return this.get("checkedTags").length>0}},getTag:function(e){var t=this.get("tags");return _.find(t,function(t){return t.id===e})},checkTag:function(e,t){var n=this.getTag(e);n&&(n.isChecked=t)},uncheckTags:function(){this.get("tags").forEach(function(e){e.isChecked=!1})}}),h=n.Controller.extend({initialize:function(e){this.region=e.region,this.moduleEventBus=e.moduleEventBus},show:function(){var e=location.search!=""?r.deparam():{};e.modal="search",s.navigate(s.PageEnum.Market,{trigger:!1},$.param(e));var t,n=this,i=new f({model:new c({tags:o.getMarketData("tags").slice(0,l)}),moduleEventBus:this.moduleEventBus});this.listenTo(i,"search:close",function(){t.off(),a.close(),n.moduleEventBus.trigger("searchModule:close")}),_.defer(function(){var e={isDrawer:!0,isSearch:!0,closeCallback:function(){t&&t.off()}},r=a.show(i,e);r.on("closeClicked",function(){n.updateUrl(),n.moduleEventBus.trigger("searchModule:close")}),t=$("body").on({click:function(e){$(e.target).closest(".modal-dialog").length==0&&a.hasView(i)&&!$(e.target).hasClass("search-category")&&$(e.target).attr("data-key")!=="search"&&$(e.target).closest('[data-key="search"]').length==0&&(t.off(),a.close(),n.updateUrl(),i.destroy(),n.moduleEventBus.trigger("searchModule:close"))},keyup:function(e){if(e.keyCode===8||e.keyCode===27||e.keyCode===46)t.off(),a.close(),n.updateUrl(),n.moduleEventBus.trigger("searchModule:close")}})})},updateUrl:function(){var e=r.deparam();e.modal&&(delete e.modal,s.navigate(s.PageEnum.Market,{trigger:!1},$.param(e)))}});return h}),define("hbs!modules/sharesHeader/sharesHeaderTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div id="categories"></div>\n<div id="sub-menu"></div>\n'});return n}),define("modules/sharesHeader/sharesHeaderModule",["require","backbone","marionette","common/globals","common/utils","common/dataUtils","common/enums","common/dataService","common/select/selectModule","modules/sharesHeader/categoriesModule","modules/sharesHeader/subCategoriesView","modules/search/searchModule","common/nav","hbs!modules/sharesHeader/sharesHeaderTemplate"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/utils"),s=e("common/dataUtils"),o=e("common/enums"),u=e("common/dataService"),a=e("common/select/selectModule"),f=e("modules/sharesHeader/categoriesModule"),l=e("modules/sharesHeader/subCategoriesView"),c=e("modules/search/searchModule"),h=e("common/nav"),p=e("hbs!modules/sharesHeader/sharesHeaderTemplate"),d="search",v="favorites",m=n.LayoutView.extend({template:p,ui:{tabContent:"#tab-content",categories:"#categories",subCategories:"#sub-categories"},regions:{categories:"#categories",subMenu:"#sub-menu"},initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.listenTo(this.moduleEventBus,{"subCategoriesView:click":function(e,t){this._onSubCategorySelected(e,t)}.bind(this),"category:click":function(e){this.categoriesModule.setSelectedCategory(e),this._onCategorySelected(e)}.bind(this),"searchModule:close":function(){this.isSearchOpen=!1,this.categoriesModule.setSelectedCategory(this.model.get("categoryKey"))}.bind(this)})},onRender:function(){this._setCategories()},onBeforeDestroy:function(){this.categoriesModule.destroy()},_setCategories:function(){var e;this._prepareCategoriesData(),this.categoriesModule=new f,this.categoriesModule.on("selected",this._onCategorySelected.bind(this)),e=this.categoriesModule.getView(this._categoriesArr,this.model.get("categoryKey"),i.clientViewPort.isXs()?this.ui.tabContent.selector:this.ui.subCategories.selector,d),this.categories.show(e),_.defer(function(){this.categoriesModule.setAutoFixed(i.clientViewPort.isXs()?this:e,i.clientViewPort.isXs()?this:this.categories)}.bind(this)),this._setSubCategories()},_prepareCategoriesData:function(){var e,t;this._categoriesArr=u.getMarketData("categories"),this._categoriesArr.sort(function(e,t){return e.order-t.order}),this.model.get("categoryKey")||(this.model.get("subCategoryKey")?this._setCategoryBySubCategory():this.model.set("categoryKey",this.model.get("tag")?d:this._categoriesArr[0].key)),t=this._categoriesArr.filter(function(e){return e.type=="favorites"}).length==0,e=this._categoriesArr.filter(function(e){return e.type=="search"}).length==0,e&&!i.clientViewPort.isXs()&&this._categoriesArr.push({isEmpty:!1,order:100,title:"Find a product",type:"search",key:d,"class":"search-category",iconUrl:"/site/market/images/category/search_icon.svg"});if(t){var n={isEmpty:!1,order:0,title:"My Top Items",type:"favorites",key:v,"class":"favorites-category",iconUrl:"/site/market/images/category/favorites.svg"};this._categoriesArr.splice(1,0,n)}},_setSubCategories:function(){var e,n,r,s=this.model.get("subCategoryKey"),o=this._getCategory().subCategories;this._subCategoriesArr=o,o&&o.sort(function(e,t){return e.order-t.order});if(i.clientViewPort.isXs())if(o&&o.length){var u=_.clone(o,!0);u.unshift({key:"all",title:"All"}),e={label:"Sub-category",options:u.map(function(e){return{key:e.key,text:e.title,selected:e.key==this.model.get("subCategoryKey")}}.bind(this))},n=a.getView(e),n.on("selected",function(e){this._onSubCategorySelected(e)}.bind(this)),this.subMenu.show(n)}else this.subMenu.reset();else n=new l({model:new t.Model({subCategories:o,subCategoryKey:s,categoryKey:this.model.get("categoryKey")}),moduleEventBus:this.moduleEventBus}),this.subMenu.show(n)},_setCategoryBySubCategory:function(){var e=this.model.get("subCategoryKey"),t=_.filter(this._categoriesArr,function(t){var n=_.findWhere(t.subCategories,{key:e});return n?!0:!1});t&&t.length>0&&this.model.set("categoryKey",t[0].key)},_onCategorySelected:function(e){if(e===v)h.navigate(h.PageEnum.Market,{preventPageEventAnalitics:!0},"category=favorites");else if(e!==d){this.model.set("categoryKey",e),this.model.set("subCategoryKey","all"),this._setSubCategories();var t=this.buildQueryString(e);this.moduleEventBus.trigger("sharesHeader:filter-shares",t)}else this.onSearchClick();this._setCategoryToGlobals(e),r.eventBus.trigger("analytics:pageView","market")},_onSubCategorySelected:function(e,t){this.model.set("subCategoryKey",e),e!=="all"&&this._setCategoryBySubCategory();var n=this.buildQueryString(this.model.get("categoryKey"),e);this.moduleEventBus.trigger("sharesHeader:filter-shares",n),!t&&!i.clientViewPort.isXs()&&this.render(),this._setCategoryToGlobals(this.model.get("categoryKey"),e),r.eventBus.trigger("analytics:pageView","market"),r.eventBus.trigger("subCategory:click")},_setCategoryToGlobals:function(e,t){var n,i;n=_.findWhere(this._categoriesArr,{key:e}),t&&t!="all"&&(i=_.findWhere(this._subCategoriesArr,{key:t})),r.data.setLastCategories(n?n.title:undefined,i?i.title:t=="all"?"All":undefined)},onSearchClick:function(){this.isSearchOpen||(this.isSearchOpen=!0,this.searchModule&&this.searchModule.destroy(),this.searchModule=new c({region:this.subMenu,moduleEventBus:this.moduleEventBus}),this.searchModule.show())},buildQueryString:function(e,t){var n="";if(t&&t!=="all"){var r=_.find(this._categoriesArr,{key:e}),i=_.find(r.subCategories,{key:t});n="category="+r.id+"&subCategory="+i.id}else n="category="+this.getCategoryId(e);return n},_getCategory:function(){return _.findWhere(this._categoriesArr,{key:this.model.get("categoryKey")})},getCategoryId:function(e){var t=_.find(this._categoriesArr,{key:e});return t?t.id:""}}),g=n.Controller.extend({initialize:function(e){this.options=e,this.region=e.region},show:function(){var e=new m({model:this.options.filterObj,moduleEventBus:this.options.moduleEventBus});this.region.show(e)}});return g}),define("hbs!modules/shares/categoryLayoutTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return"no-content"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="category-layout container" style="background-image: url(',(o=n.coverImageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.coverImageUrl,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+')">\n    <h1 class="header ',o=n["if"].call(t,t&&t.content,{hash:{},inverse:f.program(1,l,i),fn:f.noop});if(o||o===0)s+=o;return s+='">',(o=n.header)?o=o.call(t,{hash:{}}):(o=t&&t.header,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</h1>\n    <h2 class="content">',(o=n.content)?o=o.call(t,{hash:{}}):(o=t&&t.content,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"</h2>\n</div>\n",s});return n}),define("modules/shares/categoryLayoutView",["require","marionette","common/dataService","common/globals","hbs!modules/shares/categoryLayoutTemplate"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("common/globals"),i=e("hbs!modules/shares/categoryLayoutTemplate"),s=t.ItemView.extend({template:i});return s}),define("hbs!modules/shares/groupedSharesTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+="\n        ",i=n["if"].call(e,e&&e.filterTags,{hash:{},inverse:l.program(5,v,t),fn:l.program(2,p,t)});if(i||i===0)r+=i;return r+="\n    ",r}function p(e,t){var r="",i,s;r+='\n        <div class="results-title">Viewing products by:</div>\n            <ul class="nav nav-pills">\n                ',s={hash:{},inverse:l.noop,fn:l.program(3,d,t)},(i=n.filterTags)?i=i.call(e,s):(i=e&&e.filterTags,i=typeof i===a?i.call(e,s):i),n.filterTags||(i=c.call(e,i,s));if(i||i===0)r+=i;return r+="\n            </ul>\n        ",r}function d(e,t){var r="",i;return r+='\n                    <li role="presentation"><a class="tag" id = ',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+' href="#">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+"</a></li>\n                ",r}function v(e,t){var r="",i;r+="\n            ",i=n["if"].call(e,e&&e.searchTitle,{hash:{},inverse:l.noop,fn:l.program(6,m,t)});if(i||i===0)r+=i;return r+="\n        ",r}function m(e,t){var r="",i;return r+='\n                <div class="results-title">Searching for ',(i=n.searchTitle)?i=i.call(e,{hash:{}}):(i=e&&e.searchTitle,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+" items</div>\n            ",r}function g(e,t){var r="",i;r+='\n        <div class="title">No results ',i=n["if"].call(e,e&&e.searchTitle,{hash:{},inverse:l.noop,fn:l.program(9,y,t)});if(i||i===0)r+=i;return r+=" </div>\n    ",r}function y(e,t){var r="",i;return r+='for "',(i=n.searchTitle)?i=i.call(e,{hash:{}}):(i=e&&e.searchTitle,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+'"',r}function b(e,t){var r="",i;r+='\n        <div id="',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+'" class="shares-section"></div>\n        ',i=n["if"].call(e,e&&e.showMore,{hash:{},inverse:l.noop,fn:l.program(12,w,t)});if(i||i===0)r+=i;return r+="\n    ",r}function w(e,t){var r="",i;return r+='\n            <div class="show-all-link" key="',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+'">\n                <a>See more</a>\n            </div>\n        ',r}function E(e,t){var r="",i,s;r+='\n        <div class="shares-title-container tags row">\n            <div class="title col-xs-9 vbottom">\n                <h3 class="item-box shares-title">Tags</h3>\n            </div><div class="title col-xs-3 vbottom">\n            </div>\n        </div>\n        <ul class="nav nav-pills">\n            ',s={hash:{},inverse:l.noop,fn:l.program(15,S,t)},(i=n.tags)?i=i.call(e,s):(i=e&&e.tags,i=typeof i===a?i.call(e,s):i),n.tags||(i=c.call(e,i,s));if(i||i===0)r+=i;return r+="\n        </ul>\n    ",r}function S(e,t){var r="",i;return r+='\n                <li role="presentation"><a class="tag" id = ',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+' href="#">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+"</a></li>\n            ",r}function x(e,t){var r="",i,s;r+='\n        <div class="shares-title-container producers row">\n            <div class="title col-xs-9 vbottom">\n                <h3 class="item-box shares-title">Producers</h3>\n            </div><div class="title col-xs-3 vbottom">\n        </div>\n        </div>\n        <ul>\n            ',s={hash:{},inverse:l.noop,fn:l.program(18,T,t)},(i=n.producers)?i=i.call(e,s):(i=e&&e.producers,i=typeof i===a?i.call(e,s):i),n.producers||(i=c.call(e,i,s));if(i||i===0)r+=i;return r+="\n        </ul>\n    ",r}function T(e,t){var r="",i;return r+='\n                <li role="presentation"><a class="producer" key = ',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+' href="#">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+"</a></li>\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.blockHelperMissing;s+='<div class="search-result container">\n    ',o=n["if"].call(t,t&&t.foundResults,{hash:{},inverse:l.program(8,g,i),fn:l.program(1,h,i)});if(o||o===0)s+=o;s+="\n    ",u={hash:{},inverse:l.noop,fn:l.program(11,b,i)},(o=n.sharesByCategory)?o=o.call(t,u):(o=t&&t.sharesByCategory,o=typeof o===a?o.call(t,u):o),n.sharesByCategory||(o=c.call(t,o,u));if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.tags,{hash:{},inverse:l.noop,fn:l.program(14,E,i)});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.producers,{hash:{},inverse:l.noop,fn:l.program(17,x,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("modules/shares/groupedSharesView",["require","marionette","common/nav","modules/shares/sharesCollection","modules/shares/sharesView","common/enums","hbs!modules/shares/groupedSharesTemplate"],function(e){var t=e("marionette"),n=e("common/nav"),r=e("modules/shares/sharesCollection"),i=e("modules/shares/sharesView"),s=e("common/enums"),o=e("hbs!modules/shares/groupedSharesTemplate"),u=t.LayoutView.extend({template:o,events:{"click .show-all-link":"_showAll","click .tag":"_onTagClick","click .producer":"_goToProducer"},initialize:function(e){this.options=e,this.moduleEventBus=e.moduleEventBus},onShow:function(){var e=this,t=this.model.get("sharesByCategory");_.map(t,function(t){e.addRegion(t.key,"#"+t.key);var n=this._getSharesCollection(t.shares),r=new Backbone.Model({sharesTitle:t.title,maxShares:this.model.get("maxShares")}),s=new i({collection:n,model:r,moduleEventBus:e.moduleEventBus,childViewOptions:{hideProducerLink:!1}});e.getRegion(t.key).show(s)}.bind(this))},_showAll:function(e){var t=e.currentTarget.getAttribute("key");this.getRegion(t).currentView.model.set("maxShares",undefined),this.$el.find(".show-all-link[key='"+t+"']").css("display","none")},_getSharesCollection:function(e){var t=new r(e);return t.updateOrderCount(),t},_onTagClick:function(e){n.navigate(n.PageEnum.Market,{preventPageEventAnalitics:!0},"tag="+e.currentTarget.getAttribute("id"))},_goToProducer:function(e){var t=e.currentTarget.getAttribute("key");n.navigate(n.PageEnum.Market,null,"producer="+t)}});return u}),define("hbs!modules/landingPage/landingPageTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n        <div id="region-',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'" class="',(i=n.className)?i=i.call(e,{hash:{}}):(i=e&&e.className,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'"></div>\n    ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="container widgets-container">\n    ',o=n.each.call(t,t&&t.widgets,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("common/dataUtils/itemsDataUtils",["require","common/enums","common/itemType"],function(e){var t=e("common/enums"),n=e("common/itemType"),r=function(e,r){var i=_.filter(e,function(e){var i=!r||r&&e.itemType!==n.Bundle;return!e.isSoldOut&&e.status!=t.ShareStatus.TEMPORALLY_UNAVAILABLE&&i&&e.subCategories}).sort(function(e,t){return t.usageCount-e.usageCount});return i},i=function(e,t,n,i){var s=[];t=t||[];var o=r(e,i);for(var u=0,a=o.length;u<a&&s.length<n;u++){var f=o[u];_.contains(t,f.key)||s.push(f)}return s};return{getAvailableItemsSortedByUsage:r,getMostUsedItems:i}}),define("modules/experiments/experimentsModel",["require","common/rawDataModel","common/dataService","common/globals","common/utils","common/enums"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/globals"),i=e("common/utils"),s=e("common/enums"),o=t.Model.extend({initialize:function(){this.rawData=n.getMarketData()},readers:{experiments:(new t.Value("experiments")).getValue,definitions:(new t.Value("experimentDefinitions")).getValue},writers:{},addExperiment:function(e,t){this.rawData.experiments||(this.rawData.experiments={}),this.rawData.experiments[e]=t},getExperimentVariation:function(e){var t=this.get("experiments")||{};return t[e]}});return o}),define("modules/experiments/upsellLogic",["require","common/dataService","common/dataUtils/itemsDataUtils","common/utils","common/enums","common/dataUtils","modules/experiments/experimentsModel","modules/order/orderModel"],function(e){function v(e,t,r,i){var s=e.concat(_.pluck(t,"key")),o=n.getMostUsedItems(r,s,i-t.length,!0);return t=t.concat(o),t}function m(){var e,t=new o;e=t.getExperimentVariation(a);if(!e){var n=r.clientViewPort.isXs(),i=r.clientViewPort.isSm();n||i?e=c:e=d,t.addExperiment(a,e)}return e}var t=e("common/dataService"),n=e("common/dataUtils/itemsDataUtils"),r=e("common/utils"),i=e("common/enums"),s=e("common/dataUtils"),o=e("modules/experiments/experimentsModel"),u=e("modules/order/orderModel"),a="upsellLogic",f=i.ShareActionType,l={};l[f.Add]="add upsell item clicked",l[f.OpenProducerPage]="upsell item info clicked",l[f.OpenProductPage]="upsell item producer info clicked";var c={name:"variation 1 (top items)",id:"topItems",defaultWeight:.7},h={name:"variation 2 (custom low price)",keyword:"#upselllow",id:"mostSold",defaultWeight:.3},p={name:"variation 3 (custom high price)",keyword:"#upsellhigh",id:"mostSold",defaultWeight:.3},d={name:"variation 4 (items on right side)",id:"topItems",isRightSide:!0,defaultWeight:.7},g=function(e){var r=[],i=_.values(t.getSharesMap()),o=(new u).get("orderItems"),f=_.pluck(o,"shareKey"),c=m();if(c.id==="topItems"||c.id==="rightSide")r=s.getFavouriteShares(!0),r=r.filter(function(e){return!_.contains(f,e.key)});else{var h=_.filter(i,function(e){return _.contains(e.keywords,c.keyword)});r=n.getMostUsedItems(h,f,e,!0)}return r.length<e&&(r=v(f,r,i,e)),{items:r,variationName:c.name,experimentName:a,eventActions:l,isRightSide:c.isRightSide,propertyString:'data-automation-variation="'+c.name.split(" ").join("_")+'"'}};return{getChosenVariation:m,getUpsellData:g}}),define("modules/itemList/itemListWidget",["require","modules/shares/sharesView","modules/shares/sharesCollection","modules/experiments/upsellLogic","common/dataService","common/utils","common/enums","common/dataUtils/itemsDataUtils","modules/order/orderModel"],function(e){var t=e("modules/shares/sharesView"),n=e("modules/shares/sharesCollection"),r=e("modules/experiments/upsellLogic"),i=e("common/dataService"),s=e("common/utils"),o=e("common/enums"),u=e("common/dataUtils/itemsDataUtils"),a=e("modules/order/orderModel"),f=o.FilterType,l=function(e){var t=_.reduce(_.values(i.getSharesMap()),function(e,t){return e[t.id]=t,e},{});return c(t,e)},c=function(e,t){var n=[],r=[];return _.each(t,function(t){var i=e[t];i&&(i.isSoldOut||i.status!==o.ShareStatus.AVAILABLE?r.push(i):n.push(i))}),n=n.concat(r),n},h=function(e){var t={},n=i.getMarketData("categories"),r=_.filter(e,function(e){var r=!0;return _.each(n,function(n){var i=n.subCategories;_.each(i,function(n){r&&_.contains(n.itemKeys,e.key)&&(t[n.key]?r=!1:t[n.key]=!0)})}),r});return r},p=function(e,t){var n=(new a).get("orderItems"),r=_.pluck(n,"shareKey"),s=_.values(i.getSharesMap()),o=t.data.itemsToFilter;r=r.concat(o);var f=u.getMostUsedItems(s,r,40,!0);return f},d=function(e,t,n){var s=i.getSharesMap();switch(e){case f.Upsell:return r.getUpsellData(t);case f.Custom:var o=[];return n.data.ids&&(o=l(n.data.ids)),n.data.keys&&(o=c(i.getSharesMap(),n.data.keys)),{items:o};case f.BestSellers:return{items:h(p(t,n))};default:return{items:_.values(s).slice(t,t*2)}}};return{show:function(e,r,i){var s=d(i.filterType,i.data.maxShares,i),o=new n(s.items),u=new Backbone.Model({sharesTitle:i.data.title,maxShares:i.data.maxShares,producerId:i.data.producerId,propertyString:s.propertyString}),a=new t({collection:o,model:u,className:"compact",moduleEventBus:r,childViewOptions:{extraProperties:i.orderItemProperties,filterType:i.filterType,sharesPerRow:i.data.sharesPerRow||i.data.maxShares,categoryDimensionTitle:i.data.categoryDimensionTitle,eventActions:s.eventActions,hideBundleComponents:!0}});return a.on("sharesView:addSubShare",function(e){r.trigger("widgetShareChanged",e)}),o.updateOrderCount(),e.show(a),a}}}),define("hbs!modules/carousel/itemCarouselWidgetTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){var r="",i;r+='\n        <div class="nav-carousel nav-next ',i=n["if"].call(e,e&&e.highTitle,{hash:{},inverse:u.noop,fn:u.program(2,f,t)});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.thanksYouPage,{hash:{},inverse:u.noop,fn:u.program(4,l,t)});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.landingPage,{hash:{},inverse:u.noop,fn:u.program(6,c,t)});if(i||i===0)r+=i;return r+='">\n            <i class="nav-next-icon"></i>\n        </div>\n    ',r}function f(e,t){return"high"}function l(e,t){return"thanks-you-page-nav"}function c(e,t){return"landing-page"}function h(e,t){var r="",i;r+='\n        <div class="nav-carousel nav-prev ',i=n["if"].call(e,e&&e.highTitle,{hash:{},inverse:u.noop,fn:u.program(2,f,t)});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.thanksYouPage,{hash:{},inverse:u.noop,fn:u.program(4,l,t)});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.landingPage,{hash:{},inverse:u.noop,fn:u.program(6,c,t)});if(i||i===0)r+=i;return r+='">\n            <i class="nav-prev-icon"></i>\n        </div>\n    ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="carousel-widget">\n    ',o=n["if"].call(t,t&&t.showAsCarousel,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;s+='\n    <div id="carousel-region"></div>\n    ',o=n["if"].call(t,t&&t.showAsCarousel,{hash:{},inverse:u.noop,fn:u.program(8,h,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("modules/carousel/itemCarouselWidget",["require","modules/shares/sharesView","modules/shares/sharesCollection","modules/experiments/upsellLogic","common/dataService","common/dataUtils","common/enums","hbs!modules/carousel/itemCarouselWidgetTemplate","common/utils","modules/order/orderModel","common/dataUtils/itemsDataUtils","hammer","common/globals"],function(e){var t=e("modules/shares/sharesView"),n=e("modules/shares/sharesCollection"),r=e("modules/experiments/upsellLogic"),i=e("common/dataService"),s=e("common/dataUtils"),o=e("common/enums"),u=e("hbs!modules/carousel/itemCarouselWidgetTemplate"),a=e("common/utils"),f=e("modules/order/orderModel"),l=e("common/dataUtils/itemsDataUtils"),c=e("hammer"),h=e("common/globals"),p=16,d=4,v=o.FilterType,m=o.SortType,g=function(e){return!(e.isSoldOut||e.status!==o.ShareStatus.AVAILABLE||!e.subCategories||!e.subCategories.length)},y=function(e,t){return t.available-e.available},b=function(e){return e.isSoldOut},w=function(e,t){var n=null;for(var r=0,i=e.length;r<i;r++){var s=e[r];if(t[s]){n=t[s];break}}return n},E=function(e){var t=e.filter(b),n=e.filter(g),r=n.length;return r&&r<d&&(n=n.concat(t.slice(0,d-r))),n},S=function(e,t){t=t.slice(3);var n=_.reduce(t,function(e,t){return _.extend(e,_.object(_.map(t.subCategories,function(e){var n=e.key;return[n,t.key]}))),e},{}),r=_.chain(e).map(function(e){return _.extend({},e,{categoryKey:w(e.subCategories,n)})}).sortBy(function(e){return-e.usageCount}).groupBy("categoryKey").values().value(),i=[];while(x(r)&&i.length<p)_.each(r,function(e){e.length&&i.push(e.shift())});return i},x=function(e){return e.some(function(e){return e.length})},T=function(e){var t=_.reduce(_.values(i.getSharesMap()),function(e,t){return e[t.id]=t,e},{});return L(t,e)},N=function(e,t){var n=null;for(var r=0;r<e.length&&!n;r++){var i=e[r].subCategories||[];for(var s=0,o=i.length;s<o;s++){var u=i[s];if(u.key===t){n=u;break}}}return n},C=function(e,t){var n=t.sortType||m.Category,r=[],o=s.getIdByKey(i.getMarketData("tags"),t.data.tagKey),u=_.filter(e,function(e){return _.findWhere(_.compact(e.tags),{id:o})});n===m.Availability&&(r=u.filter(g).sort(y).slice(0,p)),n===m.Category&&(r=S(u.filter(g),i.getMarketData("categories")));if(r.length&&r.length<d){var a=u.filter(b);r=r.concat(a.slice(0,d-r.length))}return r},k=function(e,t,n){var r=N(t,n.data.subcategoryKey);if(r){var i=_.map(r.itemKeys,function(t){return e[t]});return E(_.compact(i))}},L=function(e,t){var n=[],r=[];return _.each(t,function(t){var i=e[t];i&&(i.isSoldOut||i.status!==o.ShareStatus.AVAILABLE?r.push(i):n.push(i))}),n.length<this.itemsInRow&&(n=n.concat(r)),n},A=function(e,t){var n=(new f).get("orderItems"),r=_.pluck(n,"shareKey"),s=_.values(i.getSharesMap()),o=t.data.itemsToFilter;r=r.concat(o);var u=l.getMostUsedItems(s,r,100,!0);return u},O=function(e,t,n){var s=i.getSharesMap();switch(e){case v.Upsell:return r.getUpsellData(t);case v.Custom:var o=[];return n.data.ids&&(o=T(n.data.ids)),n.data.keys&&(o=L(i.getSharesMap(),n.data.keys)),{items:o};case v.BestSellers:return{items:S(A(t,n),i.getMarketData("categories"))};case v.Tag:return{items:C(i.getSharesMap(),n)};case v.SubCategory:return{items:k(i.getSharesMap(),i.getMarketData("categories"),n)};default:return{items:_.values(s).slice(t,t*2)}}},M=Marionette.LayoutView.extend({template:u,events:{"click .nav-next":"showNextItems","click .nav-prev":"showPrevItems","mouseenter .nav-carousel":"onItemMouseIn","mouseleave .nav-carousel":"onItemMouseOut"},initialize:function(){this.carouselX=0},regions:{carousel:"#carousel-region"},showNextItems:function(){this.updateVariables();if(this.currentLastItem===this.model.get("totalNumber"))this.carouselX=0,this.currentLastItem=this.itemsInRow;else if(this.currentLastItem+this.itemsInRow>this.model.get("totalNumber")){var e=this.model.get("totalNumber")-this.currentLastItem;this.carouselX-=this.singleItemMove*e,this.currentLastItem=this.model.get("totalNumber")}else this.carouselX-=this.fullRowMove,this.currentLastItem+=this.itemsInRow;var t=this.$(".compact-carousel .shares");t.css("transform","matrix(1, 0, 0, 1, "+this.carouselX+", 0)"),this.model.get("categoryDimensionTitle")&&h.data.setLastCategories("",this.model.get("categoryDimensionTitle")),h.eventBus.trigger("analytics:event","Community-market","carousel arrow clicked - right",this.model.get("widgetTitle"),0,!0)},showPrevItems:function(){this.updateVariables();if(this.currentLastItem===this.itemsInRow){var e=this.model.get("totalNumber")-this.itemsInRow;this.carouselX=0-e*this.singleItemMove,this.currentLastItem=this.model.get("totalNumber")}else this.currentLastItem-this.itemsInRow<this.itemsInRow?(this.carouselX=0,this.currentLastItem=this.itemsInRow):(this.carouselX+=this.fullRowMove,this.currentLastItem=this.currentLastItem-this.itemsInRow);this.$(".compact-carousel .shares").css("transform","matrix(1, 0, 0, 1, "+this.carouselX+", 0)"),this.model.get("categoryDimensionTitle")&&h.data.setLastCategories("",this.model.get("categoryDimensionTitle")),h.eventBus.trigger("analytics:event","Community-market","carousel arrow clicked - left",this.model.get("widgetTitle"),0,!0)},setSwipeListeners:function(){var e=this.$(".shares");c(e[0]).on("swipeleft",function(e){this.showNextItems()}.bind(this)),c(e[0]).on("swiperight",function(e){this.showPrevItems()}.bind(this))},updateVariables:function(){if(!this.upadteItemsNumberAlready){var e=this.$(".shares")[0].getBoundingClientRect().width;if(this.model.get("thanksYouPage")||this.model.get("landingPage")&&!a.clientViewPort.isXs()&&!a.clientViewPort.isSm())this.updateItemsInARowNumber(4,e);else{var t=a.clientViewPort.isXs()?2:a.clientViewPort.isMd()||a.clientViewPort.isSm()?3:6;this.updateItemsInARowNumber(t,e)}this.upadteItemsNumberAlready=!0,this.currentLastItem=this.itemsInRow}},updateItemsInARowNumber:function(e,t){this.itemsInRow=e,t=a.clientViewPort.isXs()?window.innerWidth:t,this.fullRowMove=t,this.singleItemMove=this.fullRowMove/this.itemsInRow},onItemMouseIn:function(){this.$(".nav-carousel").addClass("active")},onItemMouseOut:function(){this.$(".nav-carousel").removeClass("active")}});return{show:function(e,r,i){var s=O(i.filterType,i.data.maxShares,i);if(!s.items||!s.items.length)return!1;var o=new n(s.items),u=new Backbone.Model({sharesTitle:i.data.title,maxShares:1e3,producerId:i.data.producerId,propertyString:s.propertyString}),f=i.data.thanksYouPage?" thank-you-page":"",l=new t({collection:o,model:u,className:"compact compact-carousel"+f,moduleEventBus:r,childViewOptions:{extraProperties:i.orderItemProperties,filterType:i.filterType,sharesPerRow:i.data.sharesPerRow==4?4:6,categoryDimensionTitle:i.data.categoryDimensionTitle,eventActions:s.eventActions,hideBundleComponents:!0,page:i.data.page}});o.updateOrderCount();var c=a.clientViewPort.isXs()?2:a.clientViewPort.isMd()||a.clientViewPort.isSm()?3:6,h=new M({model:new Backbone.Model({totalNumber:s.items.length,showAsCarousel:s.items.length>c,highTitle:i.data.highTitle,thanksYouPage:i.data.thanksYouPage,widgetTitle:i.data.title,landingPage:i.data.page==="landingPage",categoryDimensionTitle:i.data.categoryDimensionTitle})});return l.on("sharesView:addSubShare",function(e){r.trigger("widgetShareChanged",e)}),a.clientViewPort.isXs()||(l.on("sharesView:itemMouseIn",function(){h.onItemMouseIn()}),l.on("sharesView:itemMouseOut",function(){h.onItemMouseOut()})),e.show(h),h.carousel.show(l),h.setSwipeListeners(),l}}}),define("hbs!modules/landingPage/widgets/headlineWidgetTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function";s+='<div class="title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;s+='</div>\n<p class="description">',(o=n.description)?o=o.call(t,{hash:{}}):(o=t&&t.description,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;return s+="</p>",s});return n}),define("modules/landingPage/widgets/headlineWidget",["require","backbone","marionette","hbs!modules/landingPage/widgets/headlineWidgetTemplate"],function(e){var t=e("backbone"),n=e("marionette"),r=e("hbs!modules/landingPage/widgets/headlineWidgetTemplate"),i=n.ItemView.extend({template:r,className:"headline-widget"});return{show:function(e,n,r){var s=new t.Model({title:r.data.title,description:r.data.description}),o=new i({model:s});e.show(o)}}}),define("hbs!modules/landingPage/widgets/coverPictureWidgetTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n                <h2 class="title">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</h2>\n            ",r}function c(e,t){return'\n                <a class="read-more">Read full profile »</a>\n            '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="cover-picture row" >\n    <div class="col-sm-7 col-lg-8">\n        <div class="picture" style="background-image: url(',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+')"></div>\n    </div>\n    <div class="col-sm-5 col-lg-4">\n        <div class="text-container">\n            ',o=n["if"].call(t,t&&t.title,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n            <p class="description">',(o=n.copy)?o=o.call(t,{hash:{}}):(o=t&&t.copy,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;s+="</p>\n            ",o=n["if"].call(t,t&&t.producerId,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+="\n        </div>\n    </div>\n</div>\n",s});return n}),define("modules/landingPage/widgets/coverPictureWidget",["require","backbone","marionette","common/globals","common/dataService","hbs!modules/landingPage/widgets/coverPictureWidgetTemplate","common/nav"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/dataService"),s=e("hbs!modules/landingPage/widgets/coverPictureWidgetTemplate"),o=n.ItemView.extend({template:s,className:"cover-picture-widget",events:{"click .read-more":"readMore"},readMore:function(t){var n=this.model.get("producerId"),i=this.model.get("producerTitle"),s=e("common/nav");r.eventBus.trigger("analytics:event","Community-market","producer info clicked",i),s.navigate(s.PageEnum.Market,{preventPageEventAnalitics:!0},"producer="+n)}});return{show:function(e,n,r){if(r.data.producerKey){var s=i.getMarketData("producers"),u=s[r.data.producerKey];u&&(r.data.producerId=u.id)}var a=new t.Model(r.data),f=new o({model:a});e.show(f)}}}),define("hbs!modules/landingPage/widgets/tagsWidgetTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n        <div class="col-xs-4 col-sm-2">\n            <a class="tag" data-tag-id="',(i=n.id)?i=i.call(e,{hash:{}}):(i=e&&e.id,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n                <div class="tag-icon ',(i=n.image)?i=i.call(e,{hash:{}}):(i=e&&e.image,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'"></div>\n                <div class="tag-title">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'</div>\n                <div class="tag-link">Shop now</div>\n            </a>\n        </div>\n    ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<h3 class="title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</h3>\n<div class="row">\n    ',o=n.each.call(t,t&&t.tags,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("modules/landingPage/widgets/tagsWidget",["require","backbone","marionette","common/dataService","common/globals","common/nav","hbs!modules/landingPage/widgets/tagsWidgetTemplate"],function(e){function u(e){return e.toLowerCase().split(" ").join("_")}function a(e){var t=_.sortBy(r.getMarketData("tags"),function(e){return e.order}),e=e<=t.length?e:t.length;return _.map(t.slice(0,e),function(e){var t=u(e.title);return _.extend({},e,{image:t})})}var t=e("backbone"),n=e("marionette"),r=e("common/dataService"),i=e("common/globals"),s=e("common/nav"),o=e("hbs!modules/landingPage/widgets/tagsWidgetTemplate"),f=n.ItemView.extend({template:o,className:"tags-widget",events:{"click .tag":"goToTag"},goToTag:function(e){var t=$(e.currentTarget),n=t.data("tag-id"),r=_.findWhere(this.model.get("tags"),{id:n});i.eventBus.trigger("analytics:event","Community-market","tag clicked",r.title,r.order),i.data.setLastCategories("Tags from Landing Page",r.title),s.navigate(s.PageEnum.Market,{preventPageEventAnalitics:!0},"tag="+n)}});return{show:function(e,n,r){var i=new t.Model({title:r.data.title,tags:a(6)}),s=new f({model:i});e.show(s)}}}),define("modules/landingPage/LandingPageLayout",["require","marionette","common/globals","hbs!modules/landingPage/landingPageTemplate","modules/itemList/itemListWidget","modules/carousel/itemCarouselWidget","modules/landingPage/widgets/headlineWidget","modules/landingPage/widgets/coverPictureWidget","modules/landingPage/widgets/tagsWidget"],function(e){function l(e){switch(e){case f.ItemCarousel:return s;case f.ItemList:return i;case f.Headline:return o;case f.CoverPicture:return u;case f.TagsList:return a;default:return!1}}function c(e){var t=_.map(e,function(e,t){return e+"("+(t+1)+")"}).join(", ");n.eventBus.trigger("analytics:event","Community-market","widgets shown",t,!0,!1)}var t=e("marionette"),n=e("common/globals"),r=e("hbs!modules/landingPage/landingPageTemplate"),i=e("modules/itemList/itemListWidget"),s=e("modules/carousel/itemCarouselWidget"),o=e("modules/landingPage/widgets/headlineWidget"),u=e("modules/landingPage/widgets/coverPictureWidget"),a=e("modules/landingPage/widgets/tagsWidget"),f={Headline:"Headline",CoverPicture:"CoverPicture",ItemList:"ItemList",TagsList:"TagsList",ItemCarousel:"ItemCarousel"},h=t.LayoutView.extend({template:r,onRender:function(){var e=!n.model.get("landingPageShown"),t=[],r=this.model.get("widgets");r.forEach(function(n){var r=this.showWidget(n);n.type===f.ItemCarousel&&e&&r&&t.push(n.data.title)}.bind(this)),e&&(c(t),n.model.set("landingPageShown",!0))},showWidget:function(e){var t=l(e.type);if(t){var n=e.key;e.data.page="landingPage";var r=this.addRegion(n,"#region-"+n);return t.show(r,this.options.moduleEventBus,e)}}});return h}),define("modules/landingPage/landingPageModel",["require","common/rawDataModel"],function(e){var t=e("common/rawDataModel"),n=t.Model.extend({readers:{widgets:"getWidgets"},getWidgets:function(){return _.sortBy(this.rawData.widgets,function(e){return e.position})}});return n}),define("modules/landingPage/landingPageData",["require","common/enums","common/dataService"],function(e){function h(e){switch(e){case t.EnumRegion.NY:return f;case t.EnumRegion.SF:return l;case t.EnumRegion.SEA:return c}}function p(e,t){var r;try{r=JSON.parse(n.getMarketData("landingPageData"))}catch(i){r=h(e)}var s=a.widgets.map(function(e){var t=r[e.key]||{};return{key:e.key,position:e.position,type:e.type,filterType:e.filterType,data:_.extend({},e.data,t)}});return{widgets:s}}var t=e("common/enums"),n=e("common/dataService"),r=t.FilterType,i=t.SortType,s={Headline:"Headline",CoverPicture:"CoverPicture",ItemList:"ItemList",TagsList:"TagsList",ItemCarousel:"ItemCarousel"},o={None:"None",Slim:"Slim",Regular:"Regular",Wide:"Wide"},u=o.Regular,a={widgets:[{key:"cover-picture",position:1,type:s.CoverPicture,data:{description:"Satur Farms, owned by chef Eberhard Muller and wife Paulette Satur, began when the couple purchased their original farm on the North Fork of Long Island in 1997, intending to grow some specialty vegetables for Muller’s own restaurant. Almost two decades later the farm is going strong, with a focus on specialty salads and leafy greens and herbs...",imageUrl:"https://i.imgur.com/kXwH84X.jpg"}},{key:"producer-items",position:2,type:s.ItemCarousel,filterType:r.Custom,data:{maxShares:6}},{key:"favorites-items",position:3,type:s.ItemCarousel,filterType:r.Custom,data:{categoryDimensionTitle:"Recommended items",maxShares:6}},{key:"new-this-week",position:4,type:s.ItemCarousel,filterType:r.SubCategory,data:{maxShares:6,categoryDimensionTitle:"new this week"}},{key:"recommendedForYou",position:5,type:s.ItemCarousel,filterType:r.Custom,data:{maxShares:6,categoryDimensionTitle:"Items recommended for You"}},{key:"community-favorites",position:6,type:s.ItemCarousel,filterType:r.Custom,data:{maxShares:6,categoryDimensionTitle:"community favorites"}},{key:"gluten-free",position:7,type:s.ItemCarousel,filterType:r.Tag,data:{maxShares:6,categoryDimensionTitle:"gluten free"}},{key:"organic",position:8,type:s.ItemCarousel,filterType:r.Tag,data:{maxShares:6,categoryDimensionTitle:"organic"}},{key:"deals-this-week",position:9,type:s.ItemCarousel,filterType:r.Tag,sortType:i.Availability,data:{maxShares:6,categoryDimensionTitle:"deals this week"}},{key:"tags-list",position:10,type:s.TagsList,data:{title:"Shop Popular Categories"}}]},f={"cover-picture":{title:"Baking a difference",description:"Hot Bread Kitchen's breads are as diverse as the bakers who make them. Their staff, mostly immigrant and low-income women, have enrolled in the bakery’s training program where they hone their culinary techniques, learn business skills, and even master English. The program empowers them to move into professional baking careers, and open small businesses of their own.",imageUrl:"https://i.imgur.com/TUuL8k0.jpg",producerTitle:"Hot Bread Kitchen",producerId:"5377762911059968"},"producer-items":{title:"Shop Hot Bread Kitchen Bestsellers",categoryDimensionTitle:"Producer items  - Hot Bread Kitchen",producerTitle:"Hot Bread Kitchen",ids:[6745752944508928,6059657688776704,5662160487186432,5888133874843648,4503711296520192,6267327947472896]},"favorites-items":{title:"Support Women-Led Businesses",ids:[5779144784740352,5145008986390528,5137029994119168,6354326805020672,5760590526021632,5710611006619648]},"tags-list":{title:"Shop Popular Categories"}},l={"cover-picture":{title:"The People's Bakery",description:"Danny Gabriner founded Sour Flour as a way to share his passion for traditional sourdough bread. To start, he gave away the first 1,000 loaves for free! That spirit of generosity and community-building is still at the heart of this San Francisco bakery. Their ongoing workshops teach the art and science of bread making, and neighborly gifting is a value they hold dear.",imageUrl:"https://i.imgur.com/R4COdDu.jpg",producerTitle:"Sour Flour",producerId:"6415341110427648"},"producer-items":{title:"Shop Sour Flour Favorites!",categoryDimensionTitle:"Producer items  - Sour Flour",ids:[5847829901737984,5100161994850304,6138100971470848,5869820134293504,5834154725867520,5073292679446528]},"favorites-items":{title:"Butter Up",ids:[5610335390138368,597537325056e4,5691726094139392,5192520971583488,5635902097326080,5737641282633728]},"tags-list":{title:"Shop Popular Categories"}},c={"cover-picture":{title:"A taste of home.",description:"There’s nothing quite like the taste of organic fruit grown right here in Washington, ripened by the warm Skagit Valley sunshine. At Lamb Farm Kitchen, Colleen Lamb and a small staff of artisans combine homegrown flavors with simple ingredients to create mouthwatering fruit spreads, chutneys, and other delectable treats. It’s about as close to homemade as you can get without digging out your own pots and pans!",imageUrl:"https://i.imgur.com/mLotbTd.jpg",producerTitle:"Lamb Farm Kitchen",producerId:"5705751897047040"},"producer-items":{title:"Shop Lamb Farm Kitchens",categoryDimensionTitle:"Producer items  - Lamb Farm Kitchen",ids:[5193641471508480,5722364830547968,5198413180174336,5683160369070080,5675008521142272,5371408020406272,5641859963551744]},"favorites-items":{title:"Shop more farm-fresh favorites!",ids:[5760586365272064,5630110493310976,5690589236428800,5740551081033728,5766239481757696,5684961520648192]},"tags-list":{title:"Shop Popular Categories"}};return{baseLandingPageData:a,getData:p}}),define("modules/landingPage/landingPageModule",["require","common/dataService","modules/landingPage/LandingPageLayout","modules/landingPage/landingPageModel","modules/landingPage/landingPageData"],function(e){var t=e("common/dataService"),n=e("modules/landingPage/LandingPageLayout"),r=e("modules/landingPage/landingPageModel"),i=e("modules/landingPage/landingPageData");return{getView:function(e){var s=t.getMarketData("region"),o=new r(i.getData(s));return new n({model:o,moduleEventBus:e})}}}),define("modules/search/searchResultModule",["require","backbone","marionette","common/dataService","modules/shares/groupedSharesView"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/dataService"),i=e("modules/shares/groupedSharesView"),s=n.Controller.extend({initialize:function(e){this.options=e,this.region=e.region,this.moduleEventBus=e.moduleEventBus},show:function(){var e=this.options.tags,n=this.options.searchText,s,o,u,a;e?s=this._getTagsWithKeys(e):o=n,u=this._filterShares(),a=this._groupShares(u);var f=r.getMarketData("tags");f=_.filter(f,function(e){return e.title.toLowerCase().indexOf(n)>-1});var l=r.getMarketData("producers");l=_.filter(l,function(e){return e.title.toLowerCase().indexOf(n)>-1});var c=new i({model:new t.Model({searchTitle:o,sharesByCategory:a,tags:f,producers:l,foundResults:a.length+f.length+l.length>0,filterTags:s,maxShares:6}),moduleEventBus:this.moduleEventBus});this.region.show(c)},_filterShares:function(){var e=r.getMarketData("sharesMap"),t=this.options.tags,n=this.options.searchText,i,s,o={};return t?(i=this._getTagsWithKeys(t),s=_.values(e).filter(function(e){return i.every(function(t){return _.find(e.tags,function(e){return e.key===t.key})})})):s=_.values(e).filter(function(e){return e.title.toLowerCase().indexOf(n)>-1||n&&n[0]!=="#"&&e.keywords.indexOf(n)>-1}),s.forEach(function(e){o[e.key]=e}),o},_getTagsWithKeys:function(e){var e=e.split(","),t=r.getMarketData("tags"),n=_.map(e,function(e){var n=_.find(t,function(t){return t.id==e});return n});return n},_groupShares:function(e){var t=this,n=[],i=[];return r.getMarketData("categories").forEach(function(r){if(r.subCategories){var s=[];r.subCategories.forEach(function(t){if(t.itemKeys){var n=[];t.itemKeys.forEach(function(r,s){var o;e[r]&&!i[r]&&(o=_.clone(e[r],!0),o.sortOrderInCurrentSubCategory=t.itemSortOrders[s],n.push(o),i[r]=!0)}),n.sort(function(e,t){return e.sortOrderInCurrentSubCategory-t.sortOrderInCurrentSubCategory}),s=s.concat(n)}});var o=t.getSortedShares(s);s.length>0&&n.push({key:r.key,title:r.title,shares:o,showMore:s.length>6})}}),n},getSortedShares:function(e){var t=[],n=_.reject(e,function(e){return e.isSoldOut&&t.push(e),e.isSoldOut});return _.union(n,t)}});return s}),define("hbs!modules/sharesHeader/loadingFavoritesTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="dummy-loading favorites col-xs-12">\n    <em class="blinking-dots">Loading<span>.</span><span>.</span><span>.</span></em>\n</div>\n'});return n}),define("modules/sharesHeader/loadingFavoritesView",["require","marionette","hbs!modules/sharesHeader/loadingFavoritesTemplate"],function(e){var t=e("marionette"),n=e("hbs!modules/sharesHeader/loadingFavoritesTemplate"),r=t.LayoutView.extend({template:n});return r}),define("hbs!modules/order/orderTable/emptyOrderTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/versionHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){return"container"}function h(e,t){var r="",i,s;return r+='\n        <img src="/site/market/images/empty-cart-apple.png?version=',s={hash:{}},r+=a((i=n.versionHelper||e&&e.versionHelper,i?i.call(e,1,s):u.call(e,"versionHelper",1,s)))+'">\n	',r}function p(e,t){var r="",i;r+='\n		<div class="row">\n			<div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10">\n				',i=n["if"].call(e,e&&e.shouldShowCredit,{hash:{},inverse:l.program(8,v,t),fn:l.program(6,d,t)});if(i||i===0)r+=i;return r+='\n			</div>\n		</div>\n        <div class="row">\n            <div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10">\n                <div class="empty-order-img"></div>\n            </div>\n        </div>\n	',r}function d(e,t){var r="",i,s;return r+='\n                <div class="gray-box-msg icon-text row">\n                    <div class="credit-icon col-xs-3"></div>\n                    <div class="col-xs-9 col-md-8">You\'ve got <b class="credit">',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.credit,s):u.call(e,"currencyHelper",e&&e.credit,s)))+"</b> credit in your account!</span>\n                </div>\n                ",r}function v(e,t){var r="",i;r+="\n                    ",i=n["if"].call(e,e&&e.bubbleText,{hash:{},inverse:l.program(12,y,t),fn:l.program(9,m,t)});if(i||i===0)r+=i;return r+="\n				",r}function m(e,t){var r="",i;r+='\n                        <div class="gray-box-msg long-text">\n                            ',(i=n.bubbleText)?i=i.call(e,{hash:{}}):(i=e&&e.bubbleText,i=typeof i===f?i.call(e,{hash:{}}):i),r+=a(i)+"\n                            ",i=n["if"].call(e,e&&e.subTitle,{hash:{},inverse:l.noop,fn:l.program(10,g,t)});if(i||i===0)r+=i;return r+="\n                        </div>\n                    ",r}function g(e,t){var r="",i;return r+='<br> <span class="bottom-line">',(i=n.subTitle)?i=i.call(e,{hash:{}}):(i=e&&e.subTitle,i=typeof i===f?i.call(e,{hash:{}}):i),r+=a(i)+"</span>",r}function y(e,t){return'\n                        <div class="gray-box-msg">\n                            Your order is empty <br> <span class="bottom-line">Let’s find some food!</span>\n                        </div>\n                    '}function b(e,t){return'\n		<p class="big">\n			You have successfully canceled your order.\n		</p>\n	'}function w(e,t){var r="",i;r+="\n        ",i=n["if"].call(e,e&&e.shouldShowCredit,{hash:{},inverse:l.noop,fn:l.program(17,E,t)});if(i||i===0)r+=i;r+='\n		<div class="row">\n			<div class="col-sm-offset-4 col-sm-4 col-xs-offset-1 col-xs-10">\n				<a class="add-items button big">Browse the market</a>\n			</div>\n		</div>\n		',i=n["if"].call(e,e&&e.enableReorderLink,{hash:{},inverse:l.noop,fn:l.program(19,S,t)});if(i||i===0)r+=i;return r+="\n    ",r}function E(e,t){var r="",i,s;return r+='\n            <div class="credit-bottom-line"><b class="credit">',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.credit,s):u.call(e,"currencyHelper",e&&e.credit,s)))+"</b> will be applied to your next order.</div>\n        ",r}function S(e,t){return'\n            <a class="reorder-link">Reorder from past orders <span class="arrow">&raquo;</span></a>\n		'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;s+='<div class="empty-cart ',o=n["if"].call(t,t&&t.isFavoriteCategory,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;s+='" style="display: block;">\n	',o=n["if"].call(t,t&&t.isOrderCanceled,{hash:{},inverse:l.program(5,p,i),fn:l.program(3,h,i)});if(o||o===0)s+=o;s+="\n	",o=n["if"].call(t,t&&t.isOrderCanceled,{hash:{},inverse:l.noop,fn:l.program(14,b,i)});if(o||o===0)s+=o;s+="\n    ",o=n.unless.call(t,t&&t.disableEdit,{hash:{},inverse:l.noop,fn:l.program(16,w,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("modules/order/orderTable/emptyOrderView",["require","hbs!modules/order/orderTable/emptyOrderTemplate","marionette","common/globals","common/marketModel"],function(e){var t=e("hbs!modules/order/orderTable/emptyOrderTemplate"),n=e("marionette"),r=e("common/globals"),i=e("common/marketModel"),s=n.ItemView.extend({template:t,events:{"click a.add-items":"goToMarket","click .reorder-link":"onReOrder"},initialize:function(e){var t=new i;this.model.set(e);var n=t.get("hasOrders"),r=t.get("hasPaymentIssue");this.model.set("enableReorderLink",n&&!r);var s=t.get("credit"),o=this.model.get("isFavoriteCategory");this.model.set("credit",s),this.model.set("shouldShowCredit",!o&&s)},onShow:function(){$(".has-order").removeClass("has-order")},goToMarket:function(){r.eventBus.trigger("flow:header:market")},onReOrder:function(){r.eventBus.trigger("analytics:event","Community-order","Reorder link clicked","",0,!0),r.eventBus.trigger("flow:menu:reorder")}});return s}),define("modules/order/reorder/reorderModel",["require","common/rawDataModel","common/dataService"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=t.Model.extend({readers:{previousOrders:"getPreviousOrders"},getPreviousOrders:function(){var e=(this.rawData.subscription||{}).previousOrders;return e&&e.length>5&&(e=e.slice(0,5)),e}});return{getInstance:function(){return new r(n.getMarketData())}}}),define("hbs!modules/sharesHeader/favoritesLayoutTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="container">\n    <div id="region-favorites-items"></div>\n    <div id="region-cross-selling-items" class="cross-selling-widget"></div>\n</div>'});return n}),define("modules/sharesHeader/favoritesModule",["require","backbone","marionette","common/dataService","common/dataUtils","common/globals","modules/shares/groupedSharesView","modules/sharesHeader/loadingFavoritesView","modules/order/orderTable/emptyOrderView","modules/order/reorder/reorderModel","hbs!modules/sharesHeader/favoritesLayoutTemplate","modules/carousel/itemCarouselWidget","common/enums"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/dataService"),i=e("common/dataUtils"),s=e("common/globals"),o=e("modules/shares/groupedSharesView"),u=e("modules/sharesHeader/loadingFavoritesView"),a=e("modules/order/orderTable/emptyOrderView"),f=e("modules/order/reorder/reorderModel"),l=e("hbs!modules/sharesHeader/favoritesLayoutTemplate"),c=e("modules/carousel/itemCarouselWidget"),h=e("common/enums"),p=n.LayoutView.extend({template:l,regions:{favoriteItems:"#region-favorites-items",crossSellingItems:"#region-cross-selling-items"},initialize:function(e){this.moduleEventBus=e.moduleEventBus},onShow:function(){var e,n=this._getFavorites();if(n.length==0){var r=f.getInstance(),i=r.get("previousOrders"),s=i&&i.length>0,u=s?"It looks like all of your top items are either out of season or temporarily sold out.":"You haven't received an order yet! Once you get your first order, your top items will be listed here.",l=s?"Let’s find some new stuff to eat!":undefined;e=new a({model:new t.Model({isFavoriteCategory:!0,bubbleText:u,subTitle:l})})}else{var c=[];c.push({key:"favorites",title:"FREQUENTLY ORDERED ITEMS",shares:n}),e=new o({model:new t.Model({sharesByCategory:c,foundResults:!0}),moduleEventBus:this.moduleEventBus})}this.favoriteItems.show(e),this.showWidget(n)},_getFavorites:function(){return i.getFavouriteShares()},showWidget:function(e){var t="Try These Farmigo Favorites",n={title:t,maxShares:6,categoryDimensionTitle:t,itemsToFilter:_.map(e,function(e){return e.key}),highTitle:!0};c.show(this.crossSellingItems,this.moduleEventBus,{filterType:h.FilterType.BestSellers,data:n,orderItemProperties:{highlightItemInOrder:!0}})}}),d=n.Controller.extend({initialize:function(e){this.region=e.region,this.moduleEventBus=e.moduleEventBus,this.listenTo(s.eventBus,"loadFavorites:done",function(){this.showFavoriteShares()})},show:function(){if(r.getMarketData("member")&&!r.getMarketData("favoriteShares")){var e=new u({model:new t.Model({})});this.region.show(e)}else this.showFavoriteShares()},showFavoriteShares:function(){var e=new p({model:new t.Model({}),moduleEventBus:this.moduleEventBus});this.region.show(e)}});return d}),function(e,t){if(typeof define=="function"&&define.amd)define("virtualCollection",["backbone","underscore"],function(n,r){n.VirtualCollection=t(e,n,r),e.VirtualCollection=n.VirtualCollection});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore");module.exports=t(e,n,r)}else e.Backbone.VirtualCollection=t(e,e.Backbone,e._),e.VirtualCollection=e.Backbone.VirtualCollection}(this,function(e,t,n){function i(e,t,n,r){var i=0,s=e.length;while(i<s){var o=i+s>>>1;n.call(r,t,e[o])>0?i=o+1:s=o}return i}var r=t.Collection.extend({constructor:function(e,t){t=t||{},this.collection=e,t.comparator!==undefined&&(this.comparator=t.comparator),t.close_with&&this.bindLifecycle(t.close_with,"close"),t.destroy_with&&this.bindLifecycle(t.destroy_with,"destroy"),this.model||(this.model=e.model),this.accepts=r.buildFilter(t.filter),this._rebuildIndex(),this.listenTo(this.collection,"add",this._onAdd),this.listenTo(this.collection,"remove",this._onRemove),this.listenTo(this.collection,"change",this._onChange),this.listenTo(this.collection,"reset",this._onReset),this.listenTo(this.collection,"sort",this._onSort),this.initialize.apply(this,arguments)},bindLifecycle:function(e,t){e.on(t,n.bind(this.stopListening,this))},updateFilter:function(e){return this.accepts=r.buildFilter(e),this._rebuildIndex(),this.trigger("filter",this,e),this.trigger("reset",this,e),this},_rebuildIndex:function(){this._reset(),this.collection.each(function(e,t){this.accepts(e,t)&&(this.models.push(e),this._byId[e.cid]=e,e.id&&(this._byId[e.id]=e))},this),this.length=this.models.length,this.comparator&&this.sort({silent:!0})},orderViaParent:function(e){this.models=this.collection.filter(function(e){return this._byId[e.cid]!==undefined},this),e.silent||this.trigger("sort",this,e)},_onSort:function(e,t){if(this.comparator!==undefined)return;this.orderViaParent(t)},_onAdd:function(e,t,n){this.accepts(e,n.index)&&(this._indexAdd(e),this.trigger("add",e,this,n))},_onRemove:function(e,t,r){if(!this.get(e))return;var i=this._indexRemove(e),s=n.clone(r);s.index=i,this.trigger("remove",e,this,s)},_onChange:function(e,t){if(!e||!t)return;var r=this.get(e);if(this.accepts(e,t.index))r?this.trigger("change",e,this,t):(this._indexAdd(e),this.trigger("add",e,this,t));else if(r){var i=this._indexRemove(e),s=n.clone(t);s.index=i,this.trigger("remove",e,this,s)}},_onReset:function(e,t){this._rebuildIndex(),this.trigger("reset",this,t)},sortedIndex:function(e,t,r){var s=n.isFunction(t)?t:function(e){return e.get(t)};return s.length==1?n.sortedIndex(this.models,e,s,r):i(this.models,e,s,r)},_indexAdd:function(e){if(this.get(e))return;var t;this.comparator?t=this.sortedIndex(e,this.comparator,this):this.comparator===undefined?t=this.sortedIndex(e,function(e){return this.collection.indexOf(e)},this):t=this.length,this.models.splice(t,0,e),this._byId[e.cid]=e,e.id&&(this._byId[e.id]=e),this.length+=1},_indexRemove:function(e){var t=this.indexOf(e);return t===-1?t:(this.models.splice(t,1),delete this._byId[e.cid],e.id&&delete this._byId[e.id],this.length-=1,t)}},{buildFilter:function(e){if(!e)return function(){return!0};if(n.isFunction(e))return e;if(e.constructor===Object)return function(t){return!Boolean(n(Object.keys(e)).detect(function(n){return t.get(n)!==e[n]}))}}});return n.each(["add","remove","set","reset","push","pop","unshift","shift","slice","sync","fetch"],function(e){r.prototype[e]=function(){return this.collection[e].apply(this.collection,n.toArray(arguments))}}),n.extend(r.prototype,t.Events),r}),define("modules/shares/sharesLayout",["require","backbone","marionette","common/globals","common/dataService","common/utils","common/enums","hbs!modules/shares/sharesTemplate","common/Tabs/TabsModule","modules/shares/sharesView","modules/shares/sharesCollection","modules/footer/footerModule","common/nav","modules/sharesHeader/sharesHeaderModule","modules/shares/categoryLayoutView","modules/shares/groupedSharesView","modules/landingPage/landingPageModule","modules/search/searchResultModule","modules/sharesHeader/favoritesModule","common/marketModel","virtualCollection"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/dataService"),s=e("common/utils"),o=e("common/enums"),u=e("hbs!modules/shares/sharesTemplate"),a=e("common/Tabs/TabsModule"),f=e("modules/shares/sharesView"),l=e("modules/shares/sharesCollection"),c=e("modules/footer/footerModule"),h=e("common/nav"),p=e("modules/sharesHeader/sharesHeaderModule"),d=e("modules/shares/categoryLayoutView"),v=e("modules/shares/groupedSharesView"),m=e("modules/landingPage/landingPageModule"),g=e("modules/search/searchResultModule"),y=e("modules/sharesHeader/favoritesModule"),b=e("common/marketModel");e("virtualCollection");var w=n.LayoutView.extend({template:u,className:"shares-module",regions:{sharesHeader:"#shares-header",categoryLayout:"#category-layout",shares:"#shares",footer:"#footer-region"},initialize:function(e){var t=new b;this.isLoginOptimizedFlow=t.get("isLoginOptimizedFlow"),this.moduleEventBus=e.moduleEventBus,this.listenTo(this.moduleEventBus,{"sharesHeader:filter-shares":function(e){h.navigate(h.PageEnum.Market,{trigger:!1},e),this._showSharesForCategory()}})},onShow:function(){var e=this.model.get("tags"),t=this.model.get("searchText");if((e||t)&&s.clientViewPort.isXs())r.eventBus.trigger("sharesLayout:searchResultPage");else{var n=new p({region:this.sharesHeader,moduleEventBus:this.moduleEventBus,filterObj:this.model});n.show()}var i=this.model.get("categoryKey");e||t?this._showSharesForSearch(e,t):i==="favorites"?this._showFavoritesShares():this._showSharesForCategory(),(new c({region:this.footer})).show()},_showSharesForSearch:function(e,t){var n=new g({region:this.shares,moduleEventBus:this.moduleEventBus,tags:e,searchText:t});n.show()},_showSharesForCategory:function(){var e=this._filterShares();if(this.model.get("categoryKey")==="LANDING_PAGE"){this._showCategoryLayout(),this._showLandingPage();return}var e=this._filterShares();this._showCategoryLayout(),this._showSharesBySubCategories(e)},_showCategoryLayout:function(){var e,n=this._getSelectedCategory().layout;(n||{}).name=="SEASONAL"?(e=new d({model:new t.Model(n)}),this.categoryLayout.show(e)):this.categoryLayout.reset()},_showFavoritesShares:function(){var e=new y({region:this.shares,moduleEventBus:this.moduleEventBus});e.show()},_filterShares:function(){var e=this._getSelectedCategory(),t=this._getSelectedSubCategoryKey(),n=i.getMarketData("sharesMap"),r=[],s=this;return e.subCategories.forEach(function(e){var n;(t==e.key||t=="all")&&e.title!=o.SubCategory.NonLocal&&(n=s._getSharesForSubCategory(e),r.push({key:e.key,title:e.title,shares:n,showMore:!1}))}),r},_getSelectedCategory:function(){return _.findWhere(i.getMarketData("categories"),{key:this.model.get("categoryKey")})},_getSelectedSubCategoryKey:function(){return this.model.get("subCategoryKey")||"all"},_getSharesForSubCategory:function(e){var t=i.getMarketData("sharesMap"),n=e.itemKeys.map(function(n,r){var i=t[n];if(i)return i.sortOrderInCurrentSubCategory=e.itemSortOrders[r],i});n=n.filter(function(e){return e!=undefined}),n.sort(function(e,t){return e.sortOrderInCurrentSubCategory-t.sortOrderInCurrentSubCategory});var r=[],s=_.reject(n,function(e){return e.isSoldOut&&r.push(e),e.isSoldOut});return _.union(s,r)},_showLandingPage:function(){var e=m.getView(this.moduleEventBus);this.shares.show(e)},_showSharesBySubCategories:function(e){var n=new v({model:new t.Model({sharesByCategory:e,foundResults:!0}),moduleEventBus:this.moduleEventBus});this.shares.show(n)}});return w}),define("hbs!modules/singleItem/singleItemTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="single-item-page">\n    <div id="item" class="item"></div>\n    <div class="container">\n        <div id="shares"></div>\n        <div class="show-all-link">\n            <a>See more</a>\n        </div>\n        <br>\n    </div>\n</div>\n'});return n}),define("hbs!modules/singleItem/producer/producerTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='\n                    <li role="presentation"><a class="tag" key = ',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+">",(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===a?i.call(e,{hash:{}}):i),r+=f(i)+"</a></li>\n                ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.blockHelperMissing;s+='<div class="producer">\n    <img class="producer-image pull-left visible-xs" src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'"/>\n    <div class="container">\n        <div class="back-link hidden-xs"><a><i class="back-icon"></i>',(o=n.backButtonText)?o=o.call(t,{hash:{}}):(o=t&&t.backButtonText,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'</a></div>\n        <div class="visible-xs"><a class="back-link"><i class="back-icon"></i>back</a></div>\n        <img class="producer-image pull-left hidden-xs" src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'"/>\n        <div class="title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===a?o.call(t,{hash:{}}):o),s+=f(o)+'</div>\n        <div class="description">\n            <ul class="nav nav-pills">\n                ',u={hash:{},inverse:l.noop,fn:l.program(1,h,i)},(o=n.tags)?o=o.call(t,u):(o=t&&t.tags,o=typeof o===a?o.call(t,u):o),n.tags||(o=c.call(t,o,u));if(o||o===0)s+=o;s+='\n            </ul>\n            <div class="description-text">',(o=n.description)?o=o.call(t,{hash:{}}):(o=t&&t.description,o=typeof o===a?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;return s+="</div>\n        </div>\n    </div>\n</div>",s});return n}),define("modules/singleItem/producer/producerView",["require","hbs!modules/singleItem/producer/producerTemplate","marionette","common/utils","common/globals"],function(e){var t=e("hbs!modules/singleItem/producer/producerTemplate"),n=e("marionette"),r=e("common/utils"),i=e("common/globals"),s=n.ItemView.extend({template:t});return s}),define("modules/singleItem/producer/producerModel",["require","common/rawDataModel"],function(e){var t=e("common/rawDataModel"),n=t.Model.extend({readers:{id:(new t.Value("id")).getValue,imageUrl:(new t.Value("imageUrl")).getValue,description:(new t.Value("description")).getValue,title:(new t.Value("title")).getValue,tags:(new t.Value("tags")).getValue}});return n}),define("modules/singleItem/singleItemLayout",["require","hbs!modules/singleItem/singleItemTemplate","marionette","common/nav","common/utils","common/dataUtils","common/globals","common/enums","common/dataService","modules/shares/sharesView","modules/share/shareModel","modules/share/shareView","modules/singleItem/producer/producerView","modules/singleItem/producer/producerModel","modules/shares/sharesCollection"],function(e){var t=e("hbs!modules/singleItem/singleItemTemplate"),n=e("marionette"),r=e("common/nav"),i=e("common/utils"),s=e("common/dataUtils"),o=e("common/globals"),u=e("common/enums"),a=e("common/dataService"),f=e("modules/shares/sharesView"),l=e("modules/share/shareModel"),c=e("modules/share/shareView"),h=e("modules/singleItem/producer/producerView"),p=e("modules/singleItem/producer/producerModel"),d=e("modules/shares/sharesCollection"),v=6,m=function(e){var t=a.getMarketData("producers"),n=_.findWhere(_.values(t),{id:e});return n},g=function(e){return(m(e)||{}).title},y=function(e){var t=a.getMarketData("sharesMap"),n=_.findWhere(_.values(t),{id:e});return n},b=n.LayoutView.extend({template:t,className:"shares-module",ui:{showAllLink:".show-all-link"},events:{"click .back-link":"_onBackClick","click .tag":"_onTagClick","click .show-all-link":"_showAll"},regions:{item:"#item",shares:"#shares"},onRender:function(){var e=this.model.get("isSharePage"),t=this.model.get("share"),n=this.getShares(),r=new d(n),i=this.model.get("id");if(e)var s=this._showShare(i),o=s.get("crossSellingItemsKeys")&&s.get("crossSellingItemsKeys").length>0;else this.showProducer(i,r);this.ui.showAllLink.toggle(n.length>v&&!t);if(n.length>0){r.updateOrderCount();var a=e?this._isBundleProductPage?"ITEMS IN THIS BUNDLE":"Other items you might like":"Products from "+g(i),l=new Backbone.Model({sharesTitle:a,maxShares:t?undefined:v});this._sharesView=new f({collection:r,model:l,moduleEventBus:this.moduleEventBus,childViewOptions:{hideProducerLink:!e,shareViewType:u.ShareViewType.Related,isCrossSellingItem:e&&o?!0:!1}}),this.shares.show(this._sharesView),t&&this._scrollToShare(t)}},_scrollToShare:function(e){_.defer(function(){var t=this._sharesView.children.find(function(t){return t.model.get("dsId")==e});if(t){var n=t.$el.offset();window.scrollTo(0,n.top-$("#header-region").height()-30)}}.bind(this))},_onBackClick:function(){this._triggerAnalyticsEvent(),window.history.length==1?o.eventBus.trigger("flow:header:market"):history.back()},_triggerAnalyticsEvent:function(){this.model.get("isSharePage")?o.eventBus.trigger("analytics:event","Community-market","Product - back clicked",this._share.title,0,!0,"/market/product"):o.eventBus.trigger("analytics:event","Community-market","Producer - back clicked",this._producer.title,0,!0,"/market/producer")},_onTagClick:function(e){var t=_.find(a.getMarketData("tags"),{key:e.currentTarget.getAttribute("key")}),n=undefined;t&&(n=t.id,o.eventBus.trigger("analytics:event","Community-market","tag clicked from product",t.title),o.data.setLastCategories("Tags from Product",t.title)),r.navigate(r.PageEnum.Market,{preventPageEventAnalitics:!0},"tag="+n)},_showShare:function(e){this._share=y(e);var t=new l(this._share);t.set("backButtonText",window.history.length==1?"Browse Market":"back");var n=new c({model:t,singleItem:!0,shareViewType:u.ShareViewType.Main});return this.item.show(n),t},showProducer:function(e,t){this._producer=m(e),this._producer.tags=this.producerTags,t.length>0&&t.models[0].get("marketProducerName")==="Farmigo Producers"&&(this._producer.title="Farmigo Producers");var n=new p(this._producer);n.set("backButtonText",window.history.length==1?"Browse Market":"back");var r=new h({model:n});this.item.show(r)},initialize:function(e){this.moduleEventBus=e.moduleEventBus},getShares:function(){var e=a.getMarketData("sharesMap"),t=this.model.get("id"),n=y(t),r=[];return this.model.get("singleItemType")===u.SingleItemType.Share?r=this._getProductPageShares(n,e):r=this._getProducerPageSharesAndSetTags(t,e),r},_sortShares:function(e,t){return e.isSoldOut?1:t.isSoldOut?-1:t.usageCount-e.usageCount},_getProducerPageSharesAndSetTags:function(e,t){var n=[],r=_.filter(_.values(t),function(t){return t.subCategories?(t.producerId===e&&(n=n.concat(t.tags)),t.producerId===e):!1});return this._setProducerTags(r,n),r.sort(this._sortShares),r},_getProductPageShares:function(e,t){var n,r=[];if(e.bundleComponents&&e.bundleComponents.length>0&&!e.isValuePack)this._isBundleProductPage=!0,n=_.map(e.bundleComponents,function(e){return _.find(t,{key:e.itemKey})}),n.sort(this._sortShares);else{if(e.crossSellingItemsKeys&&e.crossSellingItemsKeys.length>0){var i=a.getMarketData("orderData");return _.each(e.crossSellingItemsKeys,function(n){if(n!=e.key){var s=_.find(t,{key:n});s&&!_.find(i,{shareKey:n})&&r.push(s)}}),r}var s=e?e.producerId:null;n=_.filter(_.values(t),function(t){return t.id!==e.id&&t.producerId===s&&(e.crossSellingItemsKeys?e.crossSellingItemsKeys.indexOf(t.key)<0:!0)&&t.subCategories}),n.sort(this._sortShares)}return n},_showAll:function(){this._sharesView.model.set("maxShares",undefined),this.ui.showAllLink.css("display","none")},_setProducerTags:function(e,t){t=_.uniq(t,function(e){return e.key});var n=_.filter(t,function(t){var n=_.every(e,function(e){return _.contains(e.tags,t)});return n});this.producerTags=n}});return b.getProducerById=m,b.getShareById=y,b}),define("modules/shares/sharesModule",["require","backbone","marionette","common/globals","common/dataService","common/mixpanel","modules/shares/sharesLayout","modules/singleItem/singleItemLayout","modules/referral/referralModule","modules/referral/referralModel","common/enums","common/nav"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/dataService"),s=e("common/mixpanel"),o=e("modules/shares/sharesLayout"),u=e("modules/singleItem/singleItemLayout"),a=e("modules/referral/referralModule"),f=e("modules/referral/referralModel"),l=e("common/enums"),c=e("common/nav").PageParam,h=n.Controller.extend({initialize:function(e){this.region=e.region,this.moduleEventBus=new r.EventAggregator,this.listenTo(r.eventBus,{shareChanged:this.onShareChanged,dataUpdated:function(){this.showShares()}})},show:function(e){return this.showCorrectView(e),this},showCorrectView:function(e){var t=parseInt(e[c.Item]),n=parseInt(e[c.Producer]);if(t&&u.getShareById(t))this.triggerAnalytics("market/product"),this.showItem(t);else if(n&&u.getProducerById(n))this.triggerAnalytics("market/producer"),this.showProducer(n,e[c.Share]);else{var r=this.getKeys(e[c.Category],e[c.SubCategory]);this.showShares(r,e[c.Tag],e[c.Search])}},triggerAnalytics:function(e){r.eventBus.trigger("analytics:pageView",e)},showItem:function(e){var n=new u({model:new t.Model({id:e,singleItemType:l.SingleItemType.Share,isSharePage:!0}),moduleEventBus:this.moduleEventBus});this.region.show(n)},showProducer:function(e,n){var r=new u({model:new t.Model({id:e,share:n,singleItemType:l.SingleItemType.Producer,isSharePage:!1}),moduleEventBus:this.moduleEventBus});this.region.show(r)},showShares:function(e,n,r){r=r?decodeURIComponent(r).replace(/;AMP;+/g,"&"):undefined;var i=new o({model:new t.Model({categoryKey:n||r?"search":e&&e.categoryKey?e.categoryKey:undefined,subCategoryKey:e?e.subCategoryKey:undefined,tags:n,searchText:r}),moduleEventBus:this.moduleEventBus});this.region.show(i)},onShareChanged:function(e){this.moduleEventBus.trigger("shareChanged",e)},getKeys:function(e,t){var n;if(!e)return;var r=_.find(i.getMarketData("categories"),function(t){return t.id==e});return t&&(n=_.find(r.subCategories,function(e){return e.id==t})),{categoryKey:r?r.key:e==="favorites"?"favorites":undefined,subCategoryKey:n?n.key:undefined}}});return h}),define("hbs!modules/order/orderTable/orderTableTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function u(e,t){var r="",i;r+='\n    <div class="row order-header hidden-xs">\n        <div class="col-sm-4 ',i=n["if"].call(e,e&&e.isThirdVariation,{hash:{},inverse:o.noop,fn:o.program(2,a,t)});if(i||i===0)r+=i;return r+='">Item</div>\n        <div class="col-sm-2">Price</div>\n        <div class="col-sm-2">Frequency</div>\n        <div class="col-sm-2">Quantity</div>\n        <div class="col-sm-1">Total</div>\n        <div class="col-sm-1"></div>\n    </div>\n',r}function a(e,t){return"item-title"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s,o=this;return s=n["if"].call(t,t&&t.hasItems,{hash:{},inverse:o.noop,fn:o.program(1,u,i)}),s||s===0?s:""});return n}),define("modules/order/orderTable/orderTableView",["require","hbs!modules/order/orderTable/orderTableTemplate","marionette","common/dataService","common/dataUtils","common/globals","common/marketModel","common/globalMessage","common/handlebars/helpers/formatDateHelper","common/emptyOrderModule","modules/order/orderModel","modules/order/orderTable/emptyOrderView","modules/share/shareModel"],function(e){var t=e("hbs!modules/order/orderTable/orderTableTemplate"),n=e("marionette"),r=e("common/dataService"),i=e("common/dataUtils"),s=e("common/globals"),o=e("common/marketModel"),u=e("common/globalMessage"),a=e("common/handlebars/helpers/formatDateHelper"),f=e("common/emptyOrderModule"),l=e("modules/order/orderModel"),c=e("modules/order/orderTable/emptyOrderView"),h=e("modules/share/shareModel"),p=n.CompositeView.extend({template:t,className:"has-order",childEvents:{itemChanged:"updateItem",itemRemoved:"_onRemoveItem",itemQuantityUpdated:"updateItemQuantity"},emptyView:c,initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.listenTo(this.moduleEventBus,{itemAdded:this.onItemAdded,widgetShareChanged:this.updateCollection})},updateCollection:function(e){var t=new l,n=t.get("orderItems");_.each(n,function(t){t.shareKey!==e&&(t.extraProperties?(t.extraProperties=_.clone(t.extraProperties),t.extraProperties.highlightItemInOrder=!1):t.extraProperties={highlightItemInOrder:!1})}),this.collection.reset(n),this.collection.setCategoriesTitles(),this.collection.sort(),this.render();var r=$(".highlight-item-frame").offset().top-5;$(window).scrollTop(r)},updateItem:function(e,t){(new l).updateOrderItem(t)},_onRemoveItem:function(e,t){this.collection.length==1&&this.model.get("subscriptionKey")&&this.model.get("isOrderHasSavedItems")?f.show():e.removeItem().then(function(){this._removeItem(t)}.bind(this))},_removeItem:function(e){var t=_.find(this.collection.models,function(t){return t.get("key")===e}),n=new l;n.removeOrderItem(e);var r=n.get("orderItems");this.collection.reset(r),s.data.discountChange.promotedItemKey&&u.fade(e),this.collection.setCategoriesTitles(),this.collection.sort(),this.render();var i=t.get("title"),o=this._getShareBadgeLabel(t);s.eventBus.trigger("analytics:event","Community-order","Item deleted from order",i+o,0,!0)},updateItemQuantity:function(e,t,n){(new l).updateOrderItemFrequency(t,n)},onItemAdded:function(e){this.collection.push(e)},_getShareBadgeLabel:function(e){var t="",n=new h(e.rawData),r=n.get("badges");return r&&r.length>0?t=" (Badge: "+r[0]+")":n.get("isSoldOut")?t=" (Badge: Sold out)":n.get("isTempUnavailable")?t=" (Badge: Temporarily unavailable)":n.get("memberDiscount")&&(t=" (Badge: "+n.get("memberDiscount")+"% off!)"),t}});return p}),define("hbs!modules/order/total/totalTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/discountHelper","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,o;r+='\n    <section class="total-section">\n		<div class="total-details row">\n			<img class="decoration" src="/site/market/images/chicken.svg"/>\n            <div class="col-sm-7 farm-share-region hidden-xs"></div>\n			<div class="col-sm-5 col-xs-offset-3 col-sm-offset-0 total-details">\n				<div class="total row">\n					<div class="col-xs-6">Total:</div>\n					<div class="col-xs-6"><b>',o={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.total,o):u.call(e,"currencyHelper",e&&e.total,o)))+"</b></div>\n				</div>\n\n				",s=n["if"].call(e,e&&e.credit,{hash:{},inverse:f.noop,fn:f.program(2,c,t)});if(s||s===0)r+=s;r+="\n\n				",s=n["if"].call(e,e&&e.discount,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(s||s===0)r+=s;r+="\n\n				",s=n["if"].call(e,e&&e.hasRecipientDiscount,{hash:{},inverse:f.noop,fn:f.program(6,p,t)});if(s||s===0)r+=s;r+="\n\n				",s=n["if"].call(e,e&&e.couponActive,{hash:{},inverse:f.noop,fn:f.program(8,d,t)});if(s||s===0)r+=s;r+='\n\n				<div id="add-coupon-region"></div>\n                <hr>\n				',s=n["if"].call(e,e&&e.hasTotalDue,{hash:{},inverse:f.noop,fn:f.program(13,g,t)});if(s||s===0)r+=s;r+="\n\n				",s=n.unless.call(e,e&&e.disableEdit,{hash:{},inverse:f.noop,fn:f.program(15,y,t)});if(s||s===0)r+=s;return r+='\n\n			</div>\n		</div>\n		<div class="row">\n			<div class="col-xs-12 payment-notes">\n				<p class="small">\n					Pay with your saved credit card. <br>\n					Your credit card will be charged on <em >',o={hash:{}},r+=a((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,e&&e.nextDeliveryDate,"%A, %B %d",o):u.call(e,"formatDateHelper",e&&e.nextDeliveryDate,"%A, %B %d",o)))+'</em>.\n					Farmer guaranteed freshness or your money back!\n				</p>\n			</div>\n		</div>\n	</section>\n    <div class="farm-share-mobile-region visible-xs"></div>\n\n',r}function c(e,t){var r="",i,s;return r+='\n					<div class="row">\n						<div class="col-xs-6 credit-title">Credit: </div>\n						<div class="col-xs-6"><b class="lettuce">',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.credit,s):u.call(e,"currencyHelper",e&&e.credit,s)))+"</b></div>\n					</div>\n				",r}function h(e,t){var r="",i,s;return r+='\n					<div class="row">\n						<div class="col-xs-6">Discount:</div>\n						<div class="col-sm-3 col-xs-6"><b class="lettuce">',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.discount,s):u.call(e,"currencyHelper",e&&e.discount,s)))+'<p class="lettuce discount-details visible-xs">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.discountAmount,!1,!0,s):u.call(e,"discountHelper",e&&e.discountAmount,!1,!0,s)))+' Organizer Discount</p></b></div>\n						<div class="col-sm-3"><p class="lettuce discount-details hidden-xs">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.discountAmount,!1,!0,s):u.call(e,"discountHelper",e&&e.discountAmount,!1,!0,s)))+" Organizer Discount</p></div>\n					</div>\n				",r}function p(e,t){var r="",i,s;return r+='\n					<div class="row">\n						<div class="col-xs-6">Discount:</div>\n						<div class="col-sm-3 col-xs-6"><b class="lettuce">',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.recipientDiscountOutOfTotal,s):u.call(e,"currencyHelper",e&&e.recipientDiscountOutOfTotal,s)))+'<p class="lettuce discount-details visible-xs">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.recipientDiscount,e&&e.isRecipientDiscountFixed,s):u.call(e,"discountHelper",e&&e.recipientDiscount,e&&e.isRecipientDiscountFixed,s)))+' Welcome Gift Card</p></b></div>\n						<div class="col-sm-3"><p class="lettuce discount-details hidden-xs">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.recipientDiscount,e&&e.isRecipientDiscountFixed,s):u.call(e,"discountHelper",e&&e.recipientDiscount,e&&e.isRecipientDiscountFixed,s)))+" Welcome Gift Card</p></div>\n					</div>\n				",r}function d(e,t){var r="",i,s,o;r+='\n					<div class="row">\n						<div class="col-xs-6">Coupon:</div>\n                        <div class="col-sm-3 col-xs-6"><b class="lettuce">',o={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.couponValue,!0,o):u.call(e,"currencyHelper",e&&e.couponValue,!0,o))),s=n.unless.call(e,e&&e.couponIsFixedAmount,{hash:{},inverse:f.noop,fn:f.program(9,v,t)});if(s||s===0)r+=s;r+="</b></div>\n						",s=n.unless.call(e,e&&e.couponIsFixedAmount,{hash:{},inverse:f.noop,fn:f.program(11,m,t)});if(s||s===0)r+=s;return r+="\n					</div>\n				",r}function v(e,t){var r="",i,s;return r+='<p class="lettuce discount-details visible-xs">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.couponDiscount,e&&e.couponIsFixedAmount,!0,s):u.call(e,"discountHelper",e&&e.couponDiscount,e&&e.couponIsFixedAmount,!0,s)))+" discount</p>",r}function m(e,t){var r="",i,s;return r+='\n							<div class="col-sm-3 hidden-xs"><p class="lettuce discount-details">',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,e&&e.couponDiscount,e&&e.couponIsFixedAmount,!0,s):u.call(e,"discountHelper",e&&e.couponDiscount,e&&e.couponIsFixedAmount,!0,s)))+" discount</p></div>\n						",r}function g(e,t){var r="",i,s;return r+='\n					<div class="row">\n						<div class="col-xs-6">Total Due</div>\n						<div class="col-xs-6"><b>',s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.totalDue,s):u.call(e,"currencyHelper",e&&e.totalDue,s)))+"</b></div>\n					</div>\n				",r}function y(e,t){var r="",i;r+="\n                    ",i=n["if"].call(e,e&&e.isOrderHasSavedItems,{hash:{},inverse:f.program(19,E,t),fn:f.program(16,b,t)});if(i||i===0)r+=i;return r+="\n				",r}function b(e,t){var r="",i;r+='\n                        <div class="row checkout-button-container">\n                            <div class="col-xs-5 col-sm-4">\n                                <button class="button light btn-block cancel-order-changes" loading-animation ',i=n["if"].call(e,e&&e.disableOrderButton,{hash:{},inverse:f.noop,fn:f.program(17,w,t)});if(i||i===0)r+=i;r+='>\n                                    Cancel\n                                </button>\n                            </div>\n                        <div class="col-xs-7 col-sm-8">\n                            <button id="total-view-checkout-button" class="button btn-block checkout" loading-animation ',i=n["if"].call(e,e&&e.disableOrderButton,{hash:{},inverse:f.noop,fn:f.program(17,w,t)});if(i||i===0)r+=i;return r+=">\n                                Update Order\n                            </button>\n                        </div>\n\n                        </div>\n                    ",r}function w(e,t){return"disabled"}function E(e,t){var r="",i;r+='\n                        <button class="button btn-block checkout" loading-animation ',i=n["if"].call(e,e&&e.disableOrderButton,{hash:{},inverse:f.noop,fn:f.program(17,w,t)});if(i||i===0)r+=i;return r+=">\n                            Place order\n                        </button>\n                    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;o=n["if"].call(t,t&&t.itemCount,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+="\n",s});return n}),define("hbs!modules/order/total/totalReadOnlyTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n        <div class="row">\n            <div class="col-xs-5 title credit-title">Credit: </div>\n            <div class="col-xs-2"></div>\n            <div class="col-xs-5 value"><b class="lettuce">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.credit,s):f.call(e,"currencyHelper",e&&e.credit,s)))+"</b></div>\n        </div>\n    ",r}function p(e,t){var r="",i,s;return r+='\n        <div class="row">\n            <div class="col-xs-5 title">Discount:</div>\n            <div class="col-xs-2"></div>\n            <div class="col-xs-5 value"><b class="lettuce">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.discount,s):f.call(e,"currencyHelper",e&&e.discount,s)))+"</b></div>\n\n        </div>\n    ",r}function d(e,t){var r="",i,s;return r+='\n        <div class="row">\n            <div class="col-xs-5 title">Discount:</div>\n            <div class="col-xs-2"></div>\n            <div class="col-xs-5 value"><b class="lettuce">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.recipientDiscountValue,s):f.call(e,"currencyHelper",e&&e.recipientDiscountValue,s)))+"</b></div>\n\n        </div>\n    ",r}function v(e,t){var r="",i,s;return r+='\n        <div class="row">\n            <div class="col-xs-5 title">Coupon:</div>\n            <div class="col-xs-2"></div>\n            <div class="col-xs-5 value"><b class="lettuce">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.couponValue,s):f.call(e,"currencyHelper",e&&e.couponValue,s)))+"</b></div>\n        </div>\n    ",r}function m(e,t){var r="",i,s;return r+='\n        <div class="row total-due">\n            <div class="col-xs-5 title ">Total Due:</div>\n            <div class="col-xs-2"></div>\n            <div class="col-xs-5 value"><b>',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.totalDue,s):f.call(e,"currencyHelper",e&&e.totalDue,s)))+"</b></div>\n        </div>\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="total">\n    <div class="row">\n        <div class="col-xs-5 title">Total:</div>\n        <div class="col-xs-2"></div>\n        <div class="col-xs-5 value"><b>',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):f.call(t,"currencyHelper",t&&t.total,a)))+"</b></div>\n    </div>\n\n    ",u=n["if"].call(t,t&&t.credit,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;s+="\n\n    ",u=n["if"].call(t,t&&t.discount,{hash:{},inverse:c.noop,fn:c.program(3,p,i)});if(u||u===0)s+=u;s+="\n\n    ",u=n["if"].call(t,t&&t.hasRecipientDiscount,{hash:{},inverse:c.noop,fn:c.program(5,d,i)});if(u||u===0)s+=u;s+="\n\n    ",u=n["if"].call(t,t&&t.couponActive,{hash:{},inverse:c.noop,fn:c.program(7,v,i)});if(u||u===0)s+=u;s+="\n\n    ",u=n["if"].call(t,t&&t.hasTotalDue,{hash:{},inverse:c.noop,fn:c.program(9,m,i)});if(u||u===0)s+=u;return s+="\n</div>",s});return n}),define("hbs!modules/order/total/addCouponTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/discountHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+='\n		<form id="add-coupon">\n			<div class="col-sm-5 col-xs-6">\n				<div class="form-group">\n					<input class="coupon form-control" type="text" data-field-name="couponCode" value="',(i=n.couponId)?i=i.call(e,{hash:{}}):(i=e&&e.couponId,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'" required>\n				</div>\n			</div>\n			<div class="add-coupon-col col-xs-3">\n				<button type="submit" class="add-coupon button" loading-animation>Apply</button>\n			</div>\n			<div class="remove-coupon-col col-xs-3">\n				<a class="remove-coupon" >Remove</a>\n			</div>\n\n			<div class="col-xs-12 coupon-note">* Note: You may only use one coupon per purchase.</div>\n		</form>\n	',r}function h(e,t){var r="",i,s;r+="\n		",s=n["if"].call(e,(i=e&&e.coupon,i==null||i===!1?i:i.key),{hash:{},inverse:l.program(12,y,t),fn:l.program(4,p,t)});if(s||s===0)r+=s;return r+="\n	",r}function p(e,t){var r="",i;r+="\n			",i=n.unless.call(e,e&&e.couponActive,{hash:{},inverse:l.noop,fn:l.program(5,d,t)});if(i||i===0)r+=i;r+="\n			",i=n.unless.call(e,e&&e.disableEdit,{hash:{},inverse:l.noop,fn:l.program(10,g,t)});if(i||i===0)r+=i;return r+="\n		",r}function d(e,t){var r="",i,s;r+='\n				<div class="col-sm-12 col-xs-12">\n					',s=n["if"].call(e,(i=e&&e.coupon,i==null||i===!1?i:i.minimumOrder),{hash:{},inverse:l.noop,fn:l.program(6,v,t)});if(s||s===0)r+=s;r+="\n\n					",s=n["if"].call(e,(i=e&&e.coupon,i==null||i===!1?i:i.couponTarget),{hash:{},inverse:l.noop,fn:l.program(8,m,t)});if(s||s===0)r+=s;return r+="\n				</div>\n			",r}function v(e,t){var r="",i,s;return r+='\n						<div class="coupon-message">\n							To redeem your ',s={hash:{}},r+=a((i=n.discountHelper||e&&e.discountHelper,i?i.call(e,(i=e&&e.coupon,i==null||i===!1?i:i.discount),(i=e&&e.coupon,i==null||i===!1?i:i.isFixedAmount),!0,s):f.call(e,"discountHelper",(i=e&&e.coupon,i==null||i===!1?i:i.discount),(i=e&&e.coupon,i==null||i===!1?i:i.isFixedAmount),!0,s)))+" coupon you must have a <b>minimum order of ",s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,(i=e&&e.coupon,i==null||i===!1?i:i.minimumOrder),!0,s):f.call(e,"currencyHelper",(i=e&&e.coupon,i==null||i===!1?i:i.minimumOrder),!0,s)))+"</b>\n						</div>\n					",r}function m(e,t){var r="",i,s;return r+='\n						<div class="coupon-message">\n							<a class="add-share">Add '+a((i=(i=e&&e.couponShare,i==null||i===!1?i:i.title),typeof i===u?i.apply(e):i))+"</a> to redeem your ",s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,(i=e&&e.coupon,i==null||i===!1?i:i.discount),s):f.call(e,"currencyHelper",(i=e&&e.coupon,i==null||i===!1?i:i.discount),s)))+" coupon\n						</div>\n					",r}function g(e,t){return'\n				<a class="col-xs-12 edit-coupon">Edit coupon</a>\n			'}function y(e,t){var r="",i;r+="\n            ",i=n["if"].call(e,e&&e.shouldDisplayMinimumOrder,{hash:{},inverse:l.noop,fn:l.program(13,b,t)});if(i||i===0)r+=i;r+='\n			<div class="col-xs-12">\n				<a class="display-add-coupon dark" ',i=n["if"].call(e,e&&e.disableEdit,{hash:{},inverse:l.noop,fn:l.program(15,w,t)});if(i||i===0)r+=i;return r+=">+ Add Coupon</a>\n			</div>\n		",r}function b(e,t){var r="",i;return r+='\n                <div class="col-sm-12 col-xs-12">\n                    <div class="coupon-message">\n                        Add coupon code ',(i=n.minimumOrderCouponId)?i=i.call(e,{hash:{}}):(i=e&&e.minimumOrderCouponId,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+" for ",(i=n.minimumOrderCouponDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.minimumOrderCouponDiscount,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"$ off your order of $",(i=n.minimumOrderCouponMinimumOrder)?i=i.call(e,{hash:{}}):(i=e&&e.minimumOrderCouponMinimumOrder,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"+\n                    </div>\n                </div>\n            ",r}function w(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="form-group row">\n	',o=n["if"].call(t,t&&t.displayForm,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n</div>\n",s});return n}),define("modules/order/total/addCouponView",["require","marionette","hbs!modules/order/total/addCouponTemplate","common/validation","common/globals","common/globalMessage","common/enums","common/dataService","common/dataUtils","common/marketModel","modules/order/orderModel"],function(e){var t=e("marionette"),n=e("hbs!modules/order/total/addCouponTemplate"),r=e("common/validation"),i=e("common/globals"),s=e("common/globalMessage"),o=e("common/enums"),u=e("common/dataService"),a=e("common/dataUtils"),f=e("common/marketModel"),l=e("modules/order/orderModel"),c=t.ItemView.extend({template:n,events:{"click a.display-add-coupon:not([disabled])":"displayAddCouponForm","click button.add-coupon":"addCoupon","click .edit-coupon":"editCoupon","click .remove-coupon":"removeCoupon","click .add-share":"addShare"},initialize:function(e){this.moduleEventBus=e.moduleEventBus},displayAddCouponForm:function(e){this.model.set("displayForm",!0),this.render()},editCoupon:function(){var e=this.model.get("coupon");i.eventBus.trigger("analytics:pageEvent","order","Edit coupon clicked",e&&e.id),this.displayAddCouponForm(null)},addCoupon:function(){var e=r.validateForm("#add-coupon");e&&u.getCouponData(e.couponCode.trim(),this.model.get("memberType")).done(_.bind(function(t){if(t.errorCode===o.CouponErrorCode.OK&&this.model.isCouponValid(t.coupon))i.eventBus.trigger("analytics:pageView","apply-coupon"),i.eventBus.trigger("analytics:pageEvent","order","Valid coupon Entered",e.couponCode),this.model.applyCoupon(e.couponCode,t.coupon),this.render(),this.moduleEventBus.trigger("couponApplied"),s.fade(s.KEYS.AutoCouponApplied);else{var n=a.getCouponErrorMessage(t);i.eventBus.trigger("analytics:pageEvent","order","Coupon validation failed",n.analyticsErrorMessage),r.addError('input[data-field-name="couponCode"]',"wrongCoupon",n.errorMessage)}},this)).fail(function(){i.eventBus.trigger("analytics:pageEvent","order","Invalid coupon Entered","unknown error")})},removeCoupon:function(){i.eventBus.trigger("analytics:pageEvent","order","Remove coupon clicked",this.model.get("coupon").id),this.model.removeCoupon(),this.moduleEventBus.trigger("couponRemoved"),s.fade(s.KEYS.AutoCouponApplied)},addShare:function(){var e=this.model.get("couponShare"),t=new l,n={orderDeliveryDate:e.schedules[0].rawNextDelivery,price:e.price,quantity:1,scheduleKey:e.schedules[0].key,shareKey:e.key};t.updateOrderItem(n),this.moduleEventBus.trigger("itemAdded",n)}});return c}),define("hbs!modules/farmShare/farmShareTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n            Your order is contributing about</br>\n            <span class="lettuce"><b>',(i=n.farmSharePercentage)?i=i.call(e,{hash:{}}):(i=e&&e.farmSharePercentage,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"%</b></span> (",s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.farmShareTotal,s):f.call(e,"currencyHelper",e&&e.farmShareTotal,s)))+")<br/>\n            towards creating a more sustainable food system. With each order, you are directly supporting farmers and food makers like these.\n        ",r}function h(e,t){var r="",i,s;return r+='\n            Your local farmers and food makers will be receiving about</br>\n            <span class="lettuce"><b>',(i=n.farmSharePercentage)?i=i.call(e,{hash:{}}):(i=e&&e.farmSharePercentage,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"%</b></span> (",s={hash:{}},r+=a((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.farmShareTotal,s):f.call(e,"currencyHelper",e&&e.farmShareTotal,s)))+")<br/>\n            from your order this week.\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="farm-share-container">\n    <div class="message">\n        ',o=n["if"].call(t,t&&t.isSingleProducer,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n\n    </div>\n\n</div>\n",s});return n}),define("hbs!modules/farmShare/farmShareProducerTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t,r){var i="",s;i+='\n            <div class="producer-image-container',s=n["if"].call(e,r&&r.isThreeProducers,{hash:{},inverse:u.noop,fn:u.program(2,c,t)});if(s||s===0)i+=s;return i+='" data-id="',(s=n.id)?s=s.call(e,{hash:{}}):(s=e&&e.id,s=typeof s===a?s.call(e,{hash:{}}):s),i+=f(s)+'">\n                <img class="producer-image" src="',(s=n.imageUrl)?s=s.call(e,{hash:{}}):(s=e&&e.imageUrl,s=typeof s===a?s.call(e,{hash:{}}):s),i+=f(s)+'" alt="">\n                <span class="frame"/>\n                <div class="producer-title">',(s=n.title)?s=s.call(e,{hash:{}}):(s=e&&e.title,s=typeof s===a?s.call(e,{hash:{}}):s),i+=f(s)+"</div>\n            </div>\n        ",i}function c(e,t){return" three-producers"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this,a="function",f=this.escapeExpression;s+='<div class="farm-share-container producers">\n    <div class="farm-share-message-region"></div>\n    <div class="farm-share-producers">\n        ',o=n.each.call(t,t&&t.producers,{hash:{},inverse:u.noop,fn:u.programWithDepth(1,l,i,t)});if(o||o===0)s+=o;return s+="\n    </div>\n\n</div>",s});return n}),define("modules/farmShare/farmShareModule",["require","hbs!modules/farmShare/farmShareTemplate","hbs!modules/farmShare/farmShareProducerTemplate","marionette","common/nav","common/dataUtils","common/globals"],function(e){var t=e("hbs!modules/farmShare/farmShareTemplate"),n=e("hbs!modules/farmShare/farmShareProducerTemplate"),r=e("marionette"),i=e("common/nav"),s=e("common/dataUtils"),o=e("common/globals"),u=r.ItemView.extend({template:t}),a=r.LayoutView.extend({template:n,regions:{messageRegion:".farm-share-message-region"},events:{"click .producer-image-container":"goToProducer"},onShow:function(){var e=f();this.messageRegion.show(e)},goToProducer:function(e){var t=$(e.currentTarget).data("id");return i.navigate(i.PageEnum.Market,{preventPageEventAnalitics:!0},"producer="+t),!1}}),f=function(e){var t=new Backbone.Model({farmSharePercentage:s.getFarmSharePercentage(),farmShareTotal:s.getFarmShareTotal(),isSingleProducer:s.getFarmShareProducers().length===1});return new u({model:t})};return{getMessageView:f,getProducersView:function(e){var t=s.getFarmShareProducers(),n=new Backbone.Model({producers:t,isThreeProducers:t.length===3});return new a({model:n})}}}),define("modules/order/total/totalView",["require","hbs!modules/order/total/totalTemplate","hbs!modules/order/total/totalReadOnlyTemplate","marionette","common/nav","common/utils","common/globals","common/marketModel","common/dataService","modules/order/total/addCouponView","modules/farmShare/farmShareModule"],function(e){var t=e("hbs!modules/order/total/totalTemplate"),n=e("hbs!modules/order/total/totalReadOnlyTemplate"),r=e("marionette"),i=e("common/nav"),s=e("common/utils"),o=e("common/globals"),u=e("common/marketModel"),a=e("common/dataService"),f=e("modules/order/total/addCouponView"),l=e("modules/farmShare/farmShareModule"),c=r.LayoutView.extend({getTemplate:function(){return this.options.isReadOnly?n:t},events:{"click button.checkout":"checkout","click button.cancel-order-changes":"cancelOrderChanges"},regions:{addCoupon:"#add-coupon-region",farmShareRegion:".farm-share-region",farmShareMobileRegion:".farm-share-mobile-region"},initialize:function(e){this.model.set("isReadOnly",e.isReadOnly),e.moduleEventBus&&(this.moduleEventBus=e.moduleEventBus,this.listenTo(e.moduleEventBus,{shareChanged:this.render,couponApplied:this.onCouponApplied,couponRemoved:this.onCouponRemoved}),this.listenTo(o.eventBus,{checkout:this.checkout}))},onRender:function(){if(!this.model.get("isReadOnly")&&this.model.get("itemCount")){if(!this.model.get("hasRecipientDiscount")){var e=new u;e.set("displayForm",this.model.get("showCouponForm")),this.addCoupon.show(new f({model:e,moduleEventBus:this.moduleEventBus}))}if(this.model.get("shouldShowProducerShare")){var t=l.getMessageView(a.getMarketData());s.clientViewPort.isXs()?this.farmShareMobileRegion.show(t):this.farmShareRegion.show(t)}}},onCouponApplied:function(){o.eventBus.trigger("totalChanged"),this.model.set("showCouponForm",!1),this.render()},onCouponRemoved:function(){o.eventBus.trigger("totalChanged"),this.model.set("showCouponForm",!0),this.render()},checkout:function(e){o.data.setIsOrderEditable(!1),o.eventBus.trigger("analytics:event","Community-order",e==="panelClick"?"Place order clicked (bottom)":"Place order clicked","",0,!0),o.eventBus.trigger("flow:order:checkout")},cancelOrderChanges:function(){o.eventBus.trigger("analytics:event","Community-order","cancel clicked"),this.moduleEventBus.trigger("revert-order-changes")}});return c}),define("hbs!modules/order/checkoutPanelTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function h(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="container order-checkout-panel-container">\n    <div class="row">\n        <div class="col-sm-7">\n            <span class="pull-right total-title">\n                Order total: <b>',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.totalDue,a):f.call(t,"currencyHelper",t&&t.totalDue,a)))+'\n            </span>\n        </div>\n        <div class="col-sm-5">\n            <div class="row checkout-button-container">\n                <div class="col-sm-4">\n                    <button class="button light btn-block cancel-order-changes" loading-animation ',u=n["if"].call(t,t&&t.disableOrderButton,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;s+='>\n                        Cancel\n                    </button>\n                </div>\n                <div class="col-sm-8">\n                    <button class="button btn-block checkout" loading-animation ',u=n["if"].call(t,t&&t.disableOrderButton,{hash:{},inverse:c.noop,fn:c.program(1,h,i)});if(u||u===0)s+=u;return s+=">\n                        Update Order\n                    </button>\n                </div>\n        </div>\n    </div>\n</div>",s});return n}),define("modules/order/checkoutPanelView",["require","hbs!modules/order/checkoutPanelTemplate","marionette","common/utils","common/globals","common/marketModel","common/dataService"],function(e){function a(e){u||window.requestAnimationFrame(function(e){this.setPanelVisibility(!this.isTotalViewVisible()),u=!1}.bind(this)),u=!0}var t=e("hbs!modules/order/checkoutPanelTemplate"),n=e("marionette"),r=e("common/utils"),i=e("common/globals"),s=e("common/marketModel"),o=e("common/dataService"),u=!1,f=n.ItemView.extend({template:t,events:{"click button.checkout":"checkout","click button.cancel-order-changes":"cancelOrderChanges"},initialize:function(e){this.parentContainer=null,this.isVisible=!1,this.listenTo(e.moduleEventBus,{shareChanged:this.render,couponApplied:this.render,couponRemoved:this.render})},isTotalViewVisible:function(){var e=document.getElementById("total-view-checkout-button").getBoundingClientRect().top;return e<window.innerHeight},setPanelVisibility:function(e){this.parentContainer||(this.parentContainer=this.$el.parent()),!this.isVisible&&e&&(this.parentContainer.addClass("visible"),i.model.get("isCheckoutPanelShown")||(i.eventBus.trigger("analytics:event","Community-order","Bottom place order menu shown"),i.model.set("isCheckoutPanelShown",!0))),this.isVisible&&!e&&this.parentContainer.removeClass("visible"),this.isVisible=e},onShow:function(){_.defer(function(){this.setPanelVisibility(!this.isTotalViewVisible())}.bind(this)),this.listener=a.bind(this),window.addEventListener("scroll",this.listener)},onDestroy:function(){window.removeEventListener("scroll",this.listener)},checkout:function(e){i.data.setIsOrderEditable(!1),i.eventBus.trigger("analytics:event","Community-order",e==="panelClick"?"Place order clicked (bottom)":"Place order clicked","",0,!0),i.eventBus.trigger("flow:order:checkout")},cancelOrderChanges:function(){i.eventBus.trigger("analytics:event","Community-order","cancel clicked (bottom)"),this.options.moduleEventBus.trigger("revert-order-changes")}});return f}),define("hbs!common/handlebars/partials/order-not-xs",["hbs","hbs/handlebars","common/handlebars/helpers/orHelper","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/quantityHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n        <span class="price-before-discount vcenter-sm">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.discountPrice,s):f.call(e,"currencyHelper",e&&e.discountPrice,s)))+"</span>\n    ",r}function d(e,t){return'\n        <div class="sale-icon-wrapper-not-xs sale-icon-wrapper vcenter-sm"><i class="sale-icon"></i></div>\n    '}function v(e,t){return"form-control-static"}function m(e,t){var r="",i;r+="\n            ",i=n["if"].call(e,e&&e.hasActiveVolumeDiscount,{hash:{},inverse:h.noop,fn:h.program(8,g,t)});if(i||i===0)r+=i;r+="\n            ",i=n["if"].call(e,e&&e.isPromotedItemWithDiscount,{hash:{},inverse:h.noop,fn:h.program(10,y,t)});if(i||i===0)r+=i;return r+="\n        ",r}function g(e,t){var n="",r;return n+="\n                ("+l((r=(r=e&&e.hasActiveVolumeDiscount,r==null||r===!1?r:r.value),typeof r===c?r.apply(e):r))+" % off)\n            ",n}function y(e,t){var r="",i;return r+="\n                (",(i=n.promotionDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.promotionDiscount,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+" % off)\n            ",r}function b(e,t){var r="",i,s,o;return r+="\n            /",o={hash:{}},r+=l((i=n.quantityHelper||e&&e.quantityHelper,i?i.call(e,e&&e.unitQuantity,o):f.call(e,"quantityHelper",e&&e.unitQuantity,o)))+" ",(s=n.unit)?s=s.call(e,{hash:{}}):(s=e&&e.unit,s=typeof s===c?s.call(e,{hash:{}}):s),r+=l(s)+"\n        ",r}function w(e,t){var r="",i;return r+='\n       		 <span class="form-control-static content">\n				',(i=n.frequency)?i=i.call(e,{hash:{}}):(i=e&&e.frequency,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+"\n            </span>\n		",r}function E(e,t){return'\n         	 <div class="frequency"></div>\n		'}function S(e,t){var r="",i;return r+='\n            <span class="form-control-static content">',(i=n.quantity)?i=i.call(e,{hash:{}}):(i=e&&e.quantity,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+" </span>\n		",r}function x(e,t){return'\n			<div class="share-quantity"></div>\n		'}function T(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="col-sm-1">\n    <a class="item-link">\n        <div class="thumbnail">\n            <img src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n        </div>\n    </a>\n</div>\n<div class="col-sm-3 title-col">\n    <a class="item-link"><span class="title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+'</span></a>\n</div>\n\n<div class="col-sm-2">\n    ',a={hash:{},inverse:h.noop,fn:h.program(1,p,i)},u=(o=n.orHelper||t&&t.orHelper,o?o.call(t,t&&t.isPromotedItemWithDiscount,t&&t.hasActiveVolumeDiscount,a):f.call(t,"orHelper",t&&t.isPromotedItemWithDiscount,t&&t.hasActiveVolumeDiscount,a));if(u||u===0)s+=u;s+="\n    ",u=n["if"].call(t,t&&t.volumeDiscounts,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(u||u===0)s+=u;s+='\n    <span class="',u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:h.program(5,v,i),fn:h.noop});if(u||u===0)s+=u;s+=' content"> ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.price,a):f.call(t,"currencyHelper",t&&t.price,a)))+"\n        ",u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:h.program(12,b,i),fn:h.program(7,m,i)});if(u||u===0)s+=u;s+='\n    </span>\n</div>\n\n<div class="col-sm-2 frequencies-wrapper">\n		',u=n["if"].call(t,t&&t.disableEdit,{hash:{},inverse:h.program(16,E,i),fn:h.program(14,w,i)});if(u||u===0)s+=u;s+='\n</div>\n\n<div class="col-sm-2">\n		',u=n["if"].call(t,t&&t.disableEdit,{hash:{},inverse:h.program(20,x,i),fn:h.program(18,S,i)});if(u||u===0)s+=u;s+='\n</div>\n<div class="col-sm-1">\n    <span class="form-control-static content total">\n		',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):f.call(t,"currencyHelper",t&&t.total,a)))+'\n	</span></div>\n<div class="col-sm-1">\n    <span class="content">\n        <button class="remove" ',u=n["if"].call(t,t&&t.disableRemove,{hash:{},inverse:h.noop,fn:h.program(22,T,i)});if(u||u===0)s+=u;return s+="></button>\n    </span>\n</div>\n",s});return t.registerPartial("order-not-xs",n),n}),define("hbs!common/handlebars/partials/order-xs",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/quantityHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;r+="\n                        ",i=n["if"].call(e,e&&e.volumeDiscounts,{hash:{},inverse:h.program(5,m,t),fn:h.program(2,d,t)});if(i||i===0)r+=i;return r+="\n                    ",r}function d(e,t){var r="",i;r+="\n                            ",i=n["if"].call(e,e&&e.hasActiveVolumeDiscount,{hash:{},inverse:h.noop,fn:h.program(3,v,t)});if(i||i===0)r+=i;return r+='\n                            <div class="sale-icon-wrapper-xs sale-icon-wrapper pull-right"><i class="sale-icon"></i></div>\n                        ',r}function v(e,t){var r="",i,s;return r+="("+l((i=(i=e&&e.hasActiveVolumeDiscount,i==null||i===!1?i:i.value),typeof i===f?i.apply(e):i))+'% off)\n                                <span class="price-before-discount">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.discountPrice,s):c.call(e,"currencyHelper",e&&e.discountPrice,s)))+"</span>\n                            ",r}function m(e,t){var r="",i;r+="\n                            ",i=n["if"].call(e,e&&e.promotionDiscount,{hash:{},inverse:h.noop,fn:h.program(6,g,t)});if(i||i===0)r+=i;return r+="\n                        ",r}function g(e,t){var r="",i,s;return r+="\n                                (",(i=n.promotionDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.promotionDiscount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'% off)\n                                 <span class="price-before-discount">',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.discountPrice,s):c.call(e,"currencyHelper",e&&e.discountPrice,s)))+"</span>\n                            ",r}function y(e,t){var r="",i,s,o;return r+="\n                        /",o={hash:{}},r+=l((i=n.quantityHelper||e&&e.quantityHelper,i?i.call(e,e&&e.unitQuantity,o):c.call(e,"quantityHelper",e&&e.unitQuantity,o)))+" ",(s=n.unit)?s=s.call(e,{hash:{}}):(s=e&&e.unit,s=typeof s===f?s.call(e,{hash:{}}):s),r+=l(s)+"\n                    ",r}function b(e,t){var r="",i;return r+='\n            <p class="form-control-static">\n				',(i=n.frequency)?i=i.call(e,{hash:{}}):(i=e&&e.frequency,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"\n            </p>\n		",r}function w(e,t){return'\n            <div class="frequency-xs"></div>\n		'}function E(e,t){var r="",i;return r+='\n            <p class="form-control-static">\n                ',(i=n.quantity)?i=i.call(e,{hash:{}}):(i=e&&e.quantity,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"\n            </p>\n        ",r}function S(e,t){return'\n            <div class="share-quantity-xs share-quantity pull-right"></div>\n        '}function x(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="row order-top">\n	<div class="col-xs-3 thumbnail-col">\n        <a class="item-link">\n			<div class="thumbnail">\n				<img src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n			</div>\n		</a>\n	</div>\n	<div class="col-xs-9">\n		<div class="row">\n			<div class="col-xs-10">\n				<a class="item-link">\n					<span class="title">\n						<span class="">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span>\n					</span>\n				</a>\n			</div>\n		</div>\n		<div class="row">\n			<div class="col-xs-3">\n				<span class="content total">\n					',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):c.call(t,"currencyHelper",t&&t.total,a)))+'\n				</span>\n			</div>\n			<div class="col-xs-9 price-with-qty-wrapper">\n				<span class="content price-with-qty"> ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.price,a):c.call(t,"currencyHelper",t&&t.price,a)))+"\n                    ",u=n["if"].call(t,t&&t.hasDiscount,{hash:{},inverse:h.program(8,y,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;s+='\n                </span>\n			</div>\n		</div>\n	</div>\n</div>\n<hr/>\n<div class="order-bottom">\n    <div class="frequencies-wrapper pull-left">\n		',u=n["if"].call(t,t&&t.disableEdit,{hash:{},inverse:h.program(12,w,i),fn:h.program(10,b,i)});if(u||u===0)s+=u;s+="\n    </div>\n	<div>\n        ",u=n["if"].call(t,t&&t.disableEdit,{hash:{},inverse:h.program(16,S,i),fn:h.program(14,E,i)});if(u||u===0)s+=u;s+='\n	</div>\n</div>\n<button class="remove" ',u=n["if"].call(t,t&&t.disableRemove,{hash:{},inverse:h.noop,fn:h.program(18,x,i)});if(u||u===0)s+=u;return s+="></button>\n\n\n",s});return t.registerPartial("order-xs",n),n}),define("hbs!modules/order/orderTable/orderItemTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/order-not-xs","hbs!common/handlebars/partials/order-xs"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u=this;s+='<div class="hidden-xs">\n	',o=u.invokePartial(r["order-not-xs"],"order-not-xs",t,n,r);if(o||o===0)s+=o;s+='\n</div>\n<div class="visible-xs">\n	',o=u.invokePartial(r["order-xs"],"order-xs",t,n,r);if(o||o===0)s+=o;return s+="\n</div>\n\n\n",s});return n}),define("hbs!modules/order/orderTable/categoryTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<div class="category-title">\n	',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"\n</div>\n\n",s});return n}),define("hbs!common/toggleButton/toggleButtonTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return"switch-on"}function c(e,t){return"switch-off"}function h(e,t){var r;return(r=n.on)?r=r.call(e,{hash:{}}):(r=e&&e.on,r=typeof r===u?r.call(e,{hash:{}}):r),a(r)}function p(e,t){var r;return(r=n.off)?r=r.call(e,{hash:{}}):(r=e&&e.off,r=typeof r===u?r.call(e,{hash:{}}):r),a(r)}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="switch-wrapper ',o=n["if"].call(t,t&&t.isOn,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='">\n    <div class="toggle-button pull-left">\n        <div class="switch"></div>\n    </div>\n    <span class="switch-title">',o=n["if"].call(t,t&&t.isOn,{hash:{},inverse:f.program(7,p,i),fn:f.program(5,h,i)});if(o||o===0)s+=o;return s+="</span>\n</div>",s});return n}),define("common/toggleButton/toggleButtonView",["require","hbs!common/toggleButton/toggleButtonTemplate","marionette"],function(e){var t=e("hbs!common/toggleButton/toggleButtonTemplate"),n=e("marionette"),r=n.ItemView.extend({template:t,ui:{switchWrapper:".switch-wrapper",title:".switch-title"},events:{"click .toggle-button":"_toggleSwitch"},_toggleSwitch:function(){this.model.get("isOn")?this._switchOff():this._switchOn()},_switchOn:function(){this.model.set("isOn",!0),this.ui.switchWrapper.removeClass("switch-off"),this.ui.switchWrapper.addClass("switch-on"),this.ui.title.text(this.model.get("on")),this.trigger("toggleButton",!0)},_switchOff:function(){this.model.set("isOn",!1),this.ui.switchWrapper.removeClass("switch-on"),this.ui.switchWrapper.addClass("switch-off"),this.ui.title.text(this.model.get("off")),this.trigger("toggleButton",!1)}});return r}),define("modules/order/orderTable/orderItemView",["require","hbs!modules/order/orderTable/orderItemTemplate","hbs!modules/order/orderTable/categoryTemplate","marionette","common/globals","modules/share/shareQuantity/shareQuantityView","common/dataUtils","common/handlebars/helpers/currencyHelper","common/nav","common/toggleButton/toggleButtonView","common/utils","common/dataUtils","modules/share/volumeDiscountView","common/popover/popover","common/dataService","common/enums"],function(e){var t=e("hbs!modules/order/orderTable/orderItemTemplate"),n=e("hbs!modules/order/orderTable/categoryTemplate"),r=e("marionette"),i=e("common/globals"),s=e("modules/share/shareQuantity/shareQuantityView"),o=e("common/dataUtils"),u=e("common/handlebars/helpers/currencyHelper"),a=e("common/nav"),f=e("common/toggleButton/toggleButtonView"),l=e("common/utils"),o=e("common/dataUtils"),c=e("modules/share/volumeDiscountView"),h=e("common/popover/popover"),p=e("common/dataService"),d=e("common/enums"),v=r.LayoutView.extend({getTemplate:function(){return this.model.get("isCategoryTitle")?n:t},className:function(){var e=o.getOrderVariation(),t=e==="third-variation"?"second-variation third-variation":e,n="row order-item "+t;return this.model.get("isTempUnavailable")&&(n+=" temp-unavailable"),this.model.get("highlightItemInOrder")&&(n+=" highlight-item-frame"),n},regions:{shareQuantity:".share-quantity",shareQuantityXS:".share-quantity-xs",frequency:".frequency",frequencyXS:".frequency-xs"},events:{"click .remove:not([disabled])":"_onRemoveItem","input input.quantity":"updateShareQuantity","click a.item-link":"goToItem","click .sale-icon-wrapper":"onSaleIconClick","click .discount-row":"onDiscountClicked"},onRender:function(){this.model.get("isCategoryTitle")||(this.model.get("disableEdit")||(this.setFrequency(),this._setShareQuantity()),this.renderPopover(!1,".sale-icon-wrapper-not-xs"))},setFrequency:function(){var e=this.model.getFrequency(),t=new f({model:new Backbone.Model({on:"Weekly",off:"One-time",isOn:e==="Weekly"})});this.listenTo(t,"toggleButton",function(e){this.updateItemFrequency(e)}.bind(this)),l.clientViewPort.isXs()?this.frequencyXS.show(t):this.frequency.show(t)},_setShareQuantity:function(){var e=this.model;e.set("minimumQuantity",1),this._shareQuantityView=new s({model:e}),l.clientViewPort.isXs()?this.shareQuantityXS.show(this._shareQuantityView):this.shareQuantity.show(this._shareQuantityView),this.listenTo(this._shareQuantityView,{"share-quantity-view:add":function(e){this._addShare(e)}.bind(this),"share-quantity-view:sub":function(){this._subQuantity()}.bind(this)})},_addShare:function(e){this._triggerAnalyticsEvent(d.ShareActionType.AddQuantity),o.canAddShareToOrder(this.model.get("key"),this.model.get("quantity"))&&this._addSubShareQuantity(!0)},_subQuantity:function(){this._triggerAnalyticsEvent(d.ShareActionType.SubQuantity),this._addSubShareQuantity(),this._shareQuantityView.trigger("enableBackAddButton")},_addSubShareQuantity:function(e,t){var n=this.model,r;e?r=n.get("quantity")?n.get("quantity")+1:1:r=n.get("quantity")-1,r=t?t:r,this.model.set("quantity",r);var i={orderDeliveryDate:this.model.get("orderDeliveryDate"),price:this.model.get("price"),quantity:r,scheduleKey:this.model.get("scheduleKey"),shareKey:this.model.get("shareKey")};this.trigger("itemChanged",i);var s=this.model.get("total");this.$(".total").text(u(s)),this._shareQuantityView.model.set("quantity",r),this.render()},goToItem:function(){a.navigate(a.PageEnum.Market,null,"item="+this.model.get("id"))},_onRemoveItem:function(e){var t={orderDeliveryDate:this.model.get("orderDeliveryDate"),price:this.model.get("price"),quantity:0,scheduleKey:this.model.get("scheduleKey"),shareKey:this.model.get("shareKey")};this.trigger("itemChanged",t),this.trigger("itemRemoved",this.model.get("key"))},removeItem:function(e){var t=new $.Deferred;return this.$el.slideUp(250,t.resolve),t},updateItemFrequency:function(e){i.eventBus.trigger("analytics:pageEvent","Item frequency changed");var t=e?"Weekly":"One-time",n=_.findWhere(this.model.rawData.schedules,{title:t});n&&this.trigger("itemQuantityUpdated",this.model.get("key"),n)},renderPopover:function(e,t){if(this.model.get("volumeDiscounts")){var n=this.$el.find(t?t:".sale-icon-wrapper"),r=new c({model:this.model});r.render();var s=h.create(n,r,{trigger:"hover",delay:0,className:"discount-wrapper",container:n,isShow:e,placement:t?"top":"bottom",avoidReRender:!0,isDismissible:!0});e&&!l.isMobile()&&setTimeout(function(){n.popover("hide")},3e3),n.on("shown.bs.popover",function(){this.volumeDiscountDisplayedAlready||(i.eventBus.trigger("analytics:event","Community-market","volume discount shown - order icon",this.model.get("title")+" (volume discount)",0,!1),this.volumeDiscountDisplayedAlready=!0),r.setElement(r.el)}.bind(this))}},onSaleIconClick:function(){l.isMobile()&&this.renderPopover(!0,l.clientViewPort.isXs()?".sale-icon-wrapper-xs":".sale-icon-wrapper-not-xs")},onDiscountClicked:function(e){if(!this.$el.find(".popover").hasClass("in"))return!1;e.stopPropagation();var t=$(e.currentTarget).data("quantity"),n=p.getMarketData("orderData"),r=this.model.get("key"),s=_.find(n,{shareKey:r});i.eventBus.trigger("analytics:event","Community-market","volume discount offer clicked",this.model.get("title")+" (volume discount)",s?t-s.quantity:t,!1);if(!this.model.get("canAddShare"))return;this._addSubShareQuantity(!0,t)},_triggerAnalyticsEvent:function(e){switch(e){case d.ShareActionType.AddQuantity:i.eventBus.trigger("analytics:event","Community-order","item qty increased",this.model.get("title"),0,!0);break;case d.ShareActionType.SubQuantity:i.eventBus.trigger("analytics:event","Community-order","item qty reduced",this.model.get("title"),0,!0)}}});return v}),define("hbs!modules/order/orderLayoutTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="container overflow-xs-hidden">\n	<div id="order-header-region"></div>\n	<div id="order-region" class="order-details"></div>\n    <div id="total-region"></div>\n    <div id="upsell-region" class="shares-module"></div>\n</div>'});return n}),define("modules/order/orderLayout",["require","backbone","marionette","common/utils","modules/order/orderTable/orderTableView","modules/order/total/totalView","common/globals","common/dataService","modules/order/orderModel","common/marketModel","modules/order/checkoutPanelView","modules/order/orderTable/orderItemModel","modules/order/orderTable/orderItemView","hbs!modules/order/orderLayoutTemplate","common/dataUtils","modules/carousel/itemCarouselWidget","common/enums"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/utils"),i=e("modules/order/orderTable/orderTableView"),s=e("modules/order/total/totalView"),o=e("common/globals"),u=e("common/dataService"),a=e("modules/order/orderModel"),f=e("common/marketModel"),l=e("modules/order/checkoutPanelView"),c=e("modules/order/orderTable/orderItemModel"),h=e("modules/order/orderTable/orderItemView"),p=e("hbs!modules/order/orderLayoutTemplate"),d=e("common/dataUtils"),v=e("modules/carousel/itemCarouselWidget"),m=e("common/enums"),g=t.Collection.extend({model:c,comparator:function(e){return d.getOrderVariation()==="third-variation"?e.get("categoryOrder"):!e.get("highlightItemInOrder")},setCategoriesTitles:function(){if(d.getOrderVariation()==="third-variation"){var e=_.groupBy(this.models,function(e){return e.get("categoryOrder")}),t=u.getMarketData("categories");for(var n in e){var r=_.findWhere(t,{order:parseInt(n)});r&&this.models.push(new c({title:r.title,categoryOrder:r.order-.1,isCategoryTitle:!0}))}}}}),y=n.LayoutView.extend({template:p,className:"order-module",regions:{order:"#order-region",header:"#order-header-region",total:"#total-region",upsell:"#upsell-region"},initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.checkoutPanelRegion=e.checkoutPanelRegion},onShow:function(){var e=new f,t=new a,n=t.get("orderItems");_.each(n,function(e){e.extraProperties&&(e.extraProperties=_.clone(e.extraProperties),e.extraProperties.highlightItemInOrder!=="addedFromThankYouPage"?e.extraProperties.highlightItemInOrder=!1:e.extraProperties.highlightItemInOrder=!0)});var o=new g(n);o.setCategoriesTitles(),o.sort();var u=new i({moduleEventBus:this.moduleEventBus,model:t,collection:o,childView:h,emptyViewOptions:{nextDeliveryDate:e.get("nextDeliveryDate"),disableEdit:e.get("disableEdit"),isOrderCanceled:e.get("isOrderCanceled")}});this.order.show(u);var c=new s({moduleEventBus:this.moduleEventBus,model:new f});this.total.show(c),r.html.setBoxedPage(!1),this.showWidget(),e.get("isOrderHasSavedItems")&&!r.clientViewPort.isXs()&&(this.checkoutPanelView=new l({moduleEventBus:this.moduleEventBus,model:e}),this.checkoutPanelRegion.show(this.checkoutPanelView))},onBeforeDestroy:function(){this.checkoutPanelView&&this.checkoutPanelView.destroy()},showWidget:function(){var e="Get Started with Farmigo Favorites",t={title:e,maxShares:6,categoryDimensionTitle:e};v.show(this.upsell,this.moduleEventBus,{filterType:m.FilterType.BestSellers,data:t,orderItemProperties:{highlightItemInOrder:!0}})}});return y}),define("hbs!common/featureRollout/featureRolloutTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function";s+='<h2 class="heading"><i></i>Hey There!</h2>\r\n<p class="message small">',(o=n.message)?o=o.call(t,{hash:{}}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{}}):o);if(o||o===0)s+=o;return s+='</p>\r\n<button class="button ok">Got it</button>\r\n',s});return n}),define("common/featureRollout/featureRolloutModule",["require","backbone","marionette","common/globals","common/localStorage","common/popover/popover","common/glassPane/glassPane","hbs!common/featureRollout/featureRolloutTemplate","modules/referral/referralModule"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/localStorage"),s=e("common/popover/popover"),o=e("common/glassPane/glassPane"),u=e("hbs!common/featureRollout/featureRolloutTemplate"),a=e("modules/referral/referralModule"),f=n.ItemView.extend({template:u,events:{"click .ok":function(){this.trigger("ok")}}}),l=n.Controller.extend({show:function(e,n,u){var l=function(){return"featureRollout"+e};if(!localStorage[l()]&&u.is&&u.is(":visible")){a.getInstance().hideSenderModal();var c,h={className:"feature-rollout",placement:"left",isAuto:!0,isShow:!0,hasClose:!1,isDismissible:!1,onOk:function(){i.setItem(l(),!0)}},p=new f({model:new t.Model({message:n})}),d=function(){c.hide(),v.hide(),u.css({zIndex:0})};p.render(),c=s.create(u,p,h),p.on("ok",d),u.on("click",d),u.css({position:"relative",zIndex:1032});var v=o.getInstance({zIndex:1031});v.show(),r.eventBus.on("route",function(){v.hide()})}}}),c;return{show:function(e,t,n){c===undefined&&(c=new l),c.show(e,t,n)}}}),define("hbs!modules/order/orderLayoutReadOnlyTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n					<h1><span class="icon-order-confirm">Order Confirmed.</span></h1>\n					<p>Yum! If you change your mind and want to add or remove anything from your order, you have until <em>',s={hash:{}},r+=f((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s):a.call(e,"formatDateHelper",(i=e&&e.orderLock,i==null||i===!1?i:i.storeCloseDate),"%A, %b %d",s)))+" at midnight</em> to edit your order.</p>\n				",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<div class="container">\n	<div class="box-container row">\n		<div class="col-md-offset-2 col-md-8">\n			<div class="box-body">\n				',u=n.unless.call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.isStoreClosed),{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(u||u===0)s+=u;return s+='\n				<div id="farm-share-producers-region"></div>\n				<div id="order-details-region"></div>\n			</div>\n		</div>\n	</div>\n</div>',s});return n}),define("hbs!modules/order/orderDetailsReadOnlyTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function f(e,t){return'\n		<button class="edit button pull-right">Edit Order</button>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a=this;s+='<div class="row">\n	<div class="col-sm-offset-3 col-xs-6">\n		<h2 class="heading">Order Summary</h2>\n	</div>\n	',u=n.unless.call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.isStoreClosed),{hash:{},inverse:a.noop,fn:a.program(1,f,i)});if(u||u===0)s+=u;return s+='\n</div>\n\n<div id="order-items-region"></div>\n\n<div class="row">\n	<div id="total-region" class="col-xs-8 col-xs-offset-4 col-sm-offset-8 col-sm-4"></div>\n</div>',s});return n}),define("hbs!modules/order/orderTable/orderItemReadOnlyTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/quantityHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='<span class="visible-xs">, Total: <b>',s={hash:{}},r+=l((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.total,s):f.call(e,"currencyHelper",e&&e.total,s)))+"</b></span>",r}function d(e,t){var n="",r;return n+="\n                ("+l((r=(r=e&&e.hasActiveVolumeDiscount,r==null||r===!1?r:r.value),typeof r===c?r.apply(e):r))+" % off)\n            ",n}function v(e,t){var r="",i;r+="\n                ",i=n["if"].call(e,e&&e.isPromotedItemWithDiscount,{hash:{},inverse:h.noop,fn:h.program(6,m,t)});if(i||i===0)r+=i;return r+="\n            ",r}function m(e,t){var r="",i;return r+="\n                        (",(i=n.promotionDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.promotionDiscount,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+" % off)\n                ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="col-xs-2 col-sm-2 thumbnail-wrapper">\n    <div class="thumbnail">\n        <img alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+'" src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n    </div>\n</div>\n<div class="details col-xs-10 col-sm-8">\n    <p class="title"><b class="title-inner-styled">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===c?o.call(t,{hash:{}}):o),s+=l(o)+" (",a={hash:{}},s+=l((o=n.quantityHelper||t&&t.quantityHelper,o?o.call(t,t&&t.unitQuantity,a):f.call(t,"quantityHelper",t&&t.unitQuantity,a))),(u=n.unit)?u=u.call(t,{hash:{}}):(u=t&&t.unit,u=typeof u===c?u.call(t,{hash:{}}):u),s+=l(u)+')</b></p>\n    <p class="details small">\n		Quantity: <b>',(u=n.quantity)?u=u.call(t,{hash:{}}):(u=t&&t.quantity,u=typeof u===c?u.call(t,{hash:{}}):u),s+=l(u)+'</b>\n        <span class="hidden-xs">, Price: <b>',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.price,a):f.call(t,"currencyHelper",t&&t.price,a)))+"</b></span>\n		",u=n["if"].call(t,t&&t.total,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;s+="\n		<b>\n            ",u=n["if"].call(t,t&&t.hasActiveVolumeDiscount,{hash:{},inverse:h.program(5,v,i),fn:h.program(3,d,i)});if(u||u===0)s+=u;return s+='\n        </b>\n    </p>\n</div>\n<div class="details col-sm-2 hidden-xs">\n    <p class="price"><b>',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):f.call(t,"currencyHelper",t&&t.total,a)))+"</b></p>\n</div>\n",s});return n}),define("modules/order/orderDetailsReadOnly",["require","backbone","marionette","hbs!modules/order/orderDetailsReadOnlyTemplate","hbs!modules/order/orderTable/categoryTemplate","common/utils","common/dataUtils","common/dataService","common/globals","modules/order/orderTable/orderItemModel","modules/order/orderModel","common/marketModel","hbs!modules/order/orderTable/orderItemReadOnlyTemplate","modules/order/total/totalView"],function(e){var t=e("backbone"),n=e("marionette"),r=e("hbs!modules/order/orderDetailsReadOnlyTemplate"),i=e("hbs!modules/order/orderTable/categoryTemplate"),s=e("common/utils"),o=e("common/dataUtils"),u=e("common/dataService"),a=e("common/globals"),f=e("modules/order/orderTable/orderItemModel"),l=e("modules/order/orderModel"),c=e("common/marketModel"),h=e("hbs!modules/order/orderTable/orderItemReadOnlyTemplate"),p=e("modules/order/total/totalView"),d=t.Collection.extend({model:f,comparator:function(e){return e.get("categoryOrder")},setCategoriesTitles:function(){if(o.getOrderVariation()==="third-variation"){var e=_.groupBy(this.models,function(e){return e.get("categoryOrder")}),t=u.getMarketData("categories");for(var n in e){var r=_.findWhere(t,{order:parseInt(n)});r&&this.models.push(new f({title:r.title,categoryOrder:r.order-.1,isCategoryTitle:!0}))}}}}),v=n.ItemView.extend({getTemplate:function(){return this.model.get("isCategoryTitle")?i:h},className:function(){var e=o.getOrderVariation(),t=e==="third-variation"?"second-variation third-variation":e,n="row "+t;return this.model.get("isTempUnavailable")&&(n+=" temp-unavailable"),n}}),m=n.CollectionView.extend({childView:v,className:"order-items"}),g=n.LayoutView.extend({template:r,className:"order-details-read-only",regions:{orderItems:"#order-items-region",total:"#total-region"},events:{"click .edit":function(){a.eventBus.trigger("analytics:pageEvent","Edit Order Clicked"),this.moduleEventBus.trigger("order:edit")}},ui:{edit:".edit"},initialize:function(e){this.moduleEventBus=e.moduleEventBus},onShow:function(){var e=(new l).get("orderItems"),t=new d(e);t.setCategoriesTitles(),t.sort();var n=new m({collection:t});this.orderItems.show(n);var r=new p({isReadOnly:!0,model:new c});this.total.show(r)}});return g}),define("modules/order/orderLayoutReadOnly",["require","marionette","common/utils","common/dataService","common/marketModel","modules/farmShare/farmShareModule","common/featureRollout/featureRolloutModule","hbs!modules/order/orderLayoutReadOnlyTemplate","modules/order/orderDetailsReadOnly"],function(e){var t=e("marionette"),n=e("common/utils"),r=e("common/dataService"),i=e("common/marketModel"),s=e("modules/farmShare/farmShareModule"),o=e("common/featureRollout/featureRolloutModule"),u=e("hbs!modules/order/orderLayoutReadOnlyTemplate"),a=e("modules/order/orderDetailsReadOnly"),f=t.LayoutView.extend({template:u,regions:{farmShareProducers:"#farm-share-producers-region",orderDetails:"#order-details-region"},initialize:function(e){this.moduleEventBus=e.moduleEventBus},onRender:function(){if(this.model.get("shouldShowProducerShare")){var e=s.getProducersView(r.getMarketData());this.farmShareProducers.show(e)}var t=new a({model:this.model,moduleEventBus:this.moduleEventBus});this.orderDetails.show(t),n.html.setBoxedPage(!0),i.hasPaymentIssue()||_.defer(function(){o.show("editOrder","We've made editing or cancelling your order super easy - just click the <span class='nowrap'>'Edit Order'</span> button to make any changes, and <span class='nowrap'>'Update Order'</span> to confirm!",t.ui.edit)})}});return f}),define("hbs!modules/order/reorder/reorderHeaderTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n			<option class="delivery-date" value="'+a(typeof e===u?e.apply(e):e)+'">',s={hash:{}},r+=a((i=n.formatDateHelper||e&&e.formatDateHelper,i?i.call(e,e,"%b %d, %Y",s):f.call(e,"formatDateHelper",e,"%b %d, %Y",s)))+"</option>\n		",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<section class="header">\n	<h2 class="past-orders-title">Your Past Orders Delivered on</h2>\n	<select class="form-control delivery-dates">\n		',o=n.each.call(t,t&&t.deliveryDates,{hash:{},inverse:l.noop,fn:l.program(1,c,i)});if(o||o===0)s+=o;return s+="\n	</select>\n</section>",s});return n}),define("modules/order/reorder/reorderHeaderView",["require","marionette","hbs!modules/order/reorder/reorderHeaderTemplate","common/globals"],function(e){var t=e("marionette"),n=e("hbs!modules/order/reorder/reorderHeaderTemplate"),r=e("common/globals"),i=t.ItemView.extend({template:n,events:{"change .delivery-dates":"deliveryDateChanged"},deliveryDateChanged:function(e){this.trigger("orderDateChanged",e.currentTarget.value)}});return i}),define("hbs!modules/order/reorder/reorderTableTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\n    <div class="add-all-items-row row">\n        <div class="col-sm-offset-10 col-sm-2">\n            <button class="add-all-items button">Add All to Cart</button>\n        </div>\n    </div>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="has-order">\n    <div class="row order-header hidden-xs">\n        <div class="col-sm-7">Item</div>\n        <div class="col-sm-3">Price</div>\n        <div class="col-sm-2">Quantity</div>\n    </div>\n    <div id="order-items"></div>\n</div>\n',o=n["if"].call(t,t&&t.hideAddAllButton,{hash:{},inverse:u.program(1,a,i),fn:u.noop});if(o||o===0)s+=o;return s+="\n\n",s});return n}),define("modules/order/reorder/reorderTableView",["require","hbs!modules/order/reorder/reorderTableTemplate","marionette","modules/order/orderModel","common/dataService","common/globals","common/dataUtils"],function(e){var t=e("hbs!modules/order/reorder/reorderTableTemplate"),n=e("marionette"),r=e("modules/order/orderModel"),i=e("common/dataService"),s=e("common/globals"),o=e("common/dataUtils"),u,a=n.CompositeView.extend({template:t,childViewContainer:"#order-items",events:{"click .add-all-items":"addAllItems"},childEvents:{"order-item-view:addSubShareQuantity":"quantityChanged"},initialize:function(e){this.moduleEventBus=e.moduleEventBus},quantityChanged:function(){var e=this.shouldHideAddAllButton();this.model.set("hideAddAllButton",e),this.render()},setItems:function(e){this.collection.reset(e)},addAllItems:function(e){u=u||i.getMarketData("onceSchedule");var t=this.children.map(function(e){return e}),n=[],a=[];_.each(t,function(e){if(e.model.get("quantity")==0&&e.model.get("canAddShare")&&o.canAddShareToOrder(e.model.get("key"),0)){var t={orderDeliveryDate:u.rawNextDelivery,price:e.model.get("price"),quantity:e.model.get("quantity"),scheduleKey:u.key,shareKey:e.model.get("key")};e.model.set("addedToOrder",!0),a.push(e.animateItem()),n.push(t)}}),$.when.apply($,a).done(_.bind(function(){var e=new r;e.updateMultipleOrderItems(n),s.eventBus.trigger("analytics:pageEvent","Add all to Cart button pressed"),this.model.set("hideAddAllButton",!0),this.render()},this))},shouldHideAddAllButton:function(){var e=this.collection.models,t=(new r).get("order"),n=_.all(e,function(e){var n=_.find(t,function(t){if(e.get("key")===t.shareKey)return!0});if(n||!e.get("canAddShare"))return!0});return n}});return a}),define("modules/order/reorder/reorderHeaderModel",["require","common/rawDataModel","common/dataService"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=t.Model.extend({readers:{deliveryDates:"getDeliveryDates"},getDeliveryDates:function(){var e=(this.rawData.subscription||{}).previousOrders;if(e)return _.pluck(e,"date")}});return{getInstance:function(){return new r(n.getMarketData())}}}),define("hbs!common/handlebars/partials/reorder-not-xs",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/quantityHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="(",(i=n.promotionDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.promotionDiscount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"% off)",r}function d(e,t){var r="",i,s,o;return r+="/",o={hash:{}},r+=l((i=n.quantityHelper||e&&e.quantityHelper,i?i.call(e,e&&e.unitQuantity,o):c.call(e,"quantityHelper",e&&e.unitQuantity,o)))+" ",(s=n.unit)?s=s.call(e,{hash:{}}):(s=e&&e.unit,s=typeof s===f?s.call(e,{hash:{}}):s),r+=l(s),r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="col-sm-7">\n    <div class="picture col-xs-3">\n        <img src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n    </div>\n    <div class="title-wrapper col-xs-9">\n         <span class="title reorder-item-title">\n            <span class="">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span>\n        </span>\n    </div>\n</div>\n<div class="col-sm-3"> <span class="content price-per-unit"> ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.reorderPrice,a):c.call(t,"currencyHelper",t&&t.reorderPrice,a)))+" ",u=n["if"].call(t,t&&t.isPromotedItemWithDiscount,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;return s+=' </span></div>\n\n<div class="col-sm-2">\n    <span class="content quantity">\n        <div class="share-quantity"></div>\n    </span>\n</div>',s});return t.registerPartial("reorder-not-xs",n),n}),define("hbs!common/handlebars/partials/reorder-xs",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper","common/handlebars/helpers/quantityHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="(",(i=n.promotionDiscount)?i=i.call(e,{hash:{}}):(i=e&&e.promotionDiscount,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"% off)",r}function d(e,t){var r="",i,s,o;return r+="/",o={hash:{}},r+=l((i=n.quantityHelper||e&&e.quantityHelper,i?i.call(e,e&&e.unitQuantity,o):c.call(e,"quantityHelper",e&&e.unitQuantity,o)))+" ",(s=n.unit)?s=s.call(e,{hash:{}}):(s=e&&e.unit,s=typeof s===f?s.call(e,{hash:{}}):s),r+=l(s),r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="row reorder-top">\n    <div class="col-xs-3">\n        <div class="picture">\n            <img src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n        </div>\n    </div>\n    <div class="col-xs-9">\n        <span class="title reorder-item-title">\n            <span class="">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span>\n        </span>\n        <div class="row">\n            <div class="col-xs-12">\n                <span class="content price-with-qty"> ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.reorderPrice,a):c.call(t,"currencyHelper",t&&t.reorderPrice,a)))+" ",u=n["if"].call(t,t&&t.isPromotedItemWithDiscount,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(u||u===0)s+=u;return s+=' </span>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="order-bottom">\n    <hr>\n    <div>\n        <div class="share-quantity-xs share-quantity pull-right"></div>\n    </div>\n</div>\n</div>\n\n\n\n',s});return t.registerPartial("reorder-xs",n),n}),define("hbs!modules/order/reorder/orderItemTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/reorder-not-xs","hbs!common/handlebars/partials/reorder-xs"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u=this;s+='<div class="hidden-xs">\n    ',o=u.invokePartial(r["reorder-not-xs"],"reorder-not-xs",t,n,r);if(o||o===0)s+=o;s+='\n</div>\n<div class="visible-xs">\n    ',o=u.invokePartial(r["reorder-xs"],"reorder-xs",t,n,r);if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("modules/order/reorder/orderItemView",["require","hbs!modules/order/reorder/orderItemTemplate","marionette","common/globals","modules/order/orderModel","common/dataService","common/utils","modules/share/shareQuantity/shareQuantityView","common/dataUtils","modules/header/headerModule"],function(e){var t=e("hbs!modules/order/reorder/orderItemTemplate"),n=e("marionette"),r=e("common/globals"),i=e("modules/order/orderModel"),s=e("common/dataService"),o=e("common/utils"),u=e("modules/share/shareQuantity/shareQuantityView"),a=e("common/dataUtils"),f=e("modules/header/headerModule"),l,c=n.LayoutView.extend({template:t,className:function(){var e="row order-item";return this.model.get("isTempUnavailable")||this.model.get("isUnavailable")?e+=" temp-unavailable":this.model.get("isSoldOut")&&(e+=" sold-out"),e},ui:{shareImage:".hidden-xs .picture img"},regions:{shareQuantity:".share-quantity",shareQuantityXS:".share-quantity-xs"},onRender:function(){this._setShareQuantity()},_setShareQuantity:function(){var e=this.model,t=(new i).get("order"),n=_.find(t,{shareKey:e.get("key")});e.set("quantity",n?n.quantity:0),this._shareQuantityView=new u({model:e}),o.clientViewPort.isXs()?this.shareQuantityXS.show(this._shareQuantityView):this.shareQuantity.show(this._shareQuantityView),this.listenTo(this._shareQuantityView,{"share-quantity-view:add":function(e){this._addShare(e)}.bind(this),"share-quantity-view:sub":function(){this._subQuantity()}.bind(this)})},_addShare:function(e){a.canAddShareToOrder(this.model.get("key"),this.model.get("quantity"))&&this._addSubShareQuantity(!0)},_subQuantity:function(){this._addSubShareQuantity(),this._shareQuantityView.trigger("enableBackAddButton")},_addSubShareQuantity:function(e){var t=this.model,n;e?n=t.get("quantity")?t.get("quantity")+1:1:n=t.get("quantity")-1,this.model.set("quantity",n),this.updateOrder(),this._shareQuantityView.model.set("quantity",n)},updateShareQuantity:function(e){this.model.set("quantity",parseInt(e.currentTarget.value)),this.model.get("addedToOrder")&&this.model.set("addedToOrder",!1),r.eventBus.trigger("analytics:pageEvent","Item quantity changed")},updateOrder:function(){var e=this.model,t=new i;l=l||s.getMarketData("onceSchedule");var e={orderDeliveryDate:l.rawNextDelivery,price:e.get("price"),quantity:e.get("quantity"),scheduleKey:l.key,shareKey:e.get("key")};e.quantity>0?this.animateItem().done(function(){t.updateOrderItem(e),this.model.set("addedToOrder",!0),r.eventBus.trigger("analytics:pageEvent","Add Items button pressed"),this.trigger("order-item-view:addSubShareQuantity")}.bind(this)):(t.removeOrderItem(e.shareKey),this.trigger("order-item-view:addSubShareQuantity"))},animateItem:function(){return o.animateElement(this.ui.shareImage,f.getInstance().getOrderLink())}});return c}),define("modules/order/reorder/reorderLayout",["require","backbone","marionette","common/globals","common/dataService","modules/order/orderLayout","modules/order/reorder/reorderHeaderView","modules/order/orderTable/orderItemModel","modules/order/reorder/reorderTableView","modules/order/reorder/reorderModel","modules/order/reorder/reorderHeaderModel","modules/order/reorder/orderItemView","modules/order/orderModel"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/dataService"),s=e("modules/order/orderLayout"),o=e("modules/order/reorder/reorderHeaderView"),u=e("modules/order/orderTable/orderItemModel"),a=e("modules/order/reorder/reorderTableView"),f=e("modules/order/reorder/reorderModel"),l=e("modules/order/reorder/reorderHeaderModel"),c=e("modules/order/reorder/orderItemView"),h=e("modules/order/orderModel"),p,d=t.Collection.extend({model:u}),v=s.extend({onShow:function(){var e=new o({model:l.getInstance()});this.header.show(e);var n=new a({childView:c,moduleEventBus:this.moduleEventBus,collection:new d,model:new t.Model({hideAddAllButton:i.getMarketData("orderLock").isOrderLocked})});p=f.getInstance();var r=p.get("previousOrders"),s=this.getOrderItemsByDate();r&&r.length>0&&(n.setItems(s),this.order.show(n),this.listenTo(e,"orderDateChanged",function(e){var t=this.getOrderItemsByDate(e);n.setItems(t)}))},getOrderItemsByDate:function(e){var t=[];p||(p=f.getInstance());var n=p.get("previousOrders"),r=n&&n.length>0;if(r)if(e){var i=_.findWhere(n,{date:e});i&&(t=i.items)}else t=n[0].items;return t}});return v}),define("modules/order/orderModule",["require","backbone","marionette","common/globals","common/globalMessage","common/dataService","modules/order/orderLayout","modules/order/orderLayoutReadOnly","modules/order/reorder/reorderLayout","common/marketModel","modules/referral/referralModel","common/handlebars/helpers/discountHelper","common/dataUtils","common/localStorage","modules/order/orderModel"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/globals"),i=e("common/globalMessage"),s=e("common/dataService"),o=e("modules/order/orderLayout"),u=e("modules/order/orderLayoutReadOnly"),a=e("modules/order/reorder/reorderLayout"),f=e("common/marketModel"),l=e("modules/referral/referralModel"),c=e("common/handlebars/helpers/discountHelper"),h=e("common/dataUtils"),p=e("common/localStorage"),d=e("modules/order/orderModel"),v=n.Controller.extend({initialize:function(e){this.region=e.region,this.moduleEventBus=new r.EventAggregator,this.listenTo(r.eventBus,{shareChanged:this.onShareChanged,dataUpdated:_.bind(function(){this.region.currentView&&(r.data.setIsOrderEditable(!1),this._doShow())},this)}),this.listenTo(this.moduleEventBus,{"order:edit":function(){r.data.setIsOrderEditable(!0),this._doShow()},"revert-order-changes":function(){var e=(new f).get("nextDeliveryDate");return s.updateSubscriptionDraft(e,!0).then(s.loadMarketData)}})},show:function(e){var t;this.mode=e,r.eventBus.trigger("analytics:pageEvent",s.getMarketData("orderLock").isStoreClosed?"Accessed order during order delay":"Accessed order with items"),this._triggerAnalyticsEvent();if(e!=v.Mode.Reorder&&l.canBeRecipient()){t=s.getReferralInstance();if(t&&!(s.getMarketData("subscription")||{}).referralDiscount)return s.setReferralInstance(t).done(this._doShow.bind(this)),this}return this._doShow(),_.defer(function(){var t=new f;e===v.Mode.Order&&r.data.discountChange.promotedItemKey&&i.showError("This promoted item is for first time users only",{key:r.data.discountChange.promotedItemKey})}),this},onShareChanged:function(e){this.moduleEventBus.trigger("shareChanged",e)},_doShow:function(){var e=new f,t,n,i={model:e,moduleEventBus:this.moduleEventBus,checkoutPanelRegion:this.options.checkoutPanelRegion};switch(this.mode){case v.Mode.Order:t=r.data.isOrderEditable()||e.get("order")==undefined||e.get("order").length==0?o:u;break;case v.Mode.Reorder:t=a}n=new t(i),this.region.show(n)},_triggerAnalyticsEvent:function(){var e=h.getOrderTotal(),t=new d,n=t.get("orderItems"),i=s.getMarketData("nextDeliveryDate"),o=localStorage.orderAnalyticsNoItems===i,u=localStorage.orderAnalytics===i;t.get("isOrderHasSavedItems")?r.eventBus.trigger("analytics:event","Community-order","returned to update order","",parseInt(e*100),!0):n&&n.length>0?u||(p.setItem("orderAnalytics",i),r.eventBus.trigger("analytics:event","Community-order","first order pageview with items","",parseInt(e*100),!0)):o||(p.setItem("orderAnalyticsNoItems",i),r.eventBus.trigger("analytics:event","Community-order","first order pageview without items","",0,!0))}});return v.Mode={Order:0,Reorder:1},v}),define("modules/account/accountModel",["require","common/rawDataModel","common/dataService","common/globals"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=e("common/globals"),i=t.Model.extend({initialize:function(){this.rawData.urls=n.serverData.urls},rawValues:{firstName:new t.Value("firstName"),lastName:new t.Value("lastName"),phone:new t.Value("phone"),email:new t.Value("email"),receiveEmailReminders:new t.Value("receiveEmailReminders"),receiveSmsReminders:new t.Value("receiveSmsReminders"),receiveNewsletter:new t.Value("receiveNewsletter"),isFormDirty:new t.Value("isFormDirty"),urls:new t.Value("urls")},readers:{key:(new t.Value("key")).getValue}}),s;return{getModel:function(){if(!s){var e=_.extend({},n.getMarketData("member"));s=new i(e),s.listenTo(r.eventBus,"accountModel:refresh",function(){s=null})}return s},getOriginalAccountData:function(){var e=(new i(_.extend({},n.getMarketData("member")))).toJSON();return delete e.isFormDirty,e}}}),define("hbs!modules/account/accountTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="container">\n    <div class="box-container row">\n        <div class="col-md-offset-2 col-md-8">\n            <div id="content" class="box-body">\n\n            </div>\n        </div>\n    </div>\n</div>\n'});return n}),define("hbs!modules/account/accountFormTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){return"checked"}function c(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<h1>My Account</h1>\n<form id="account-form" class="form-horizontal" role="form">\n    <div class="form-group has-label">\n        <label for="first-name" class="col-sm-4 control-label">First Name</label>\n        <div class="col-sm-8">\n            <input type="text"\n                   class="form-control"\n                   id="first-name"\n                   placeholder="First Name"\n                   data-field-name="firstName" required\n                   value="',(o=n.firstName)?o=o.call(t,{hash:{}}):(o=t&&t.firstName,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n        </div>\n    </div>\n    <div class="form-group has-label">\n        <label for="last-name" class="col-sm-4 control-label">Last Name</label>\n        <div class="col-sm-8">\n            <input type="text"\n                   class="form-control"\n                   id="last-name"\n                   placeholder="Last Name"\n                   data-field-name="lastName" required\n                   value="',(o=n.lastName)?o=o.call(t,{hash:{}}):(o=t&&t.lastName,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n        </div>\n    </div>\n    <div class="form-group has-label">\n        <label for="email" class="col-sm-4 control-label">Email</label>\n        <div class="col-sm-8">\n            <input type="email"\n                   class="form-control"\n                   id="last-name"\n                   placeholder="Email"\n                   data-field-name="email" required\n                   value="',(o=n.email)?o=o.call(t,{hash:{}}):(o=t&&t.email,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n        </div>\n    </div>\n    <div class="form-group has-label">\n        <label for="phone" class="col-sm-4 control-label">Mobile Phone</label>\n        <div class="col-sm-8">\n            <input type="text"\n                   class="form-control"\n                   id="phone"\n                   data-parsley-phone\n                   placeholder="Mobile Phone"\n                   data-field-name="phone"\n                   value="',(o=n.phone)?o=o.call(t,{hash:{}}):(o=t&&t.phone,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n        </div>\n    </div>\n	<div class="form-group">\n		<label class="col-xs-7 col-sm-4 control-label">Community</label>\n		<div class="col-xs-5 col-sm-8">\n			<a class="change-community">Change</a>\n		</div>\n	</div>\n	<div class="form-group">\n        <label class="col-xs-7 col-sm-4 control-label">Password</label>\n        <div class="col-xs-5 col-sm-8">\n            <a class="change-password">Change</a>\n        </div>\n    </div>\n    <div class="form-group">\n        <label class="col-xs-7 col-sm-4 control-label">Payment Details</label>\n        <div class="col-xs-5 col-sm-8">\n            <a class="change-payment">Change</a>\n        </div>\n    </div>\n    <div class="form-group">\n        <label class="col-sm-12 control-label communication-label">Communication Preferences:</label>\n    </div>\n\n    <div class="form-group">\n        <div class="col-sm-12">\n            <div class="checkbox">\n                <label>\n                    <input type="checkbox" name="receiveNewsletter" ',o=n["if"].call(t,t&&t.receiveNewsletter,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' data-field-name="receiveNewsletter">\n                    <p class="small"><b>Messages from Organizer:</b> Receive messages sent directly by your Organizer through the Farmigo system.</p>\n                </label>\n            </div>\n        </div>\n    </div>\n	\n    <!--<div class="form-group">-->\n        <!--<div class="col-sm-12">-->\n            <!--<div class="checkbox">-->\n                <!--<label>-->\n                    <!--<input type="checkbox" name="receiveEmailReminders" ',o=n["if"].call(t,t&&t.receiveEmailReminders,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' data-field-name="receiveEmailReminders">-->\n                    <!--<p class="small"><b>Weekly order reminders:</b> Never miss the order deadline! Review your upcoming order and edit as you like.</p>-->\n                <!--</label>-->\n            <!--</div>-->\n        <!--</div>-->\n    <!--</div>-->\n    <div class="form-group">\n        <div class="col-sm-12">\n            <div class="checkbox">\n                <label>\n                    <input type="checkbox" name="receiveSmsReminders" ',o=n["if"].call(t,t&&t.receiveSmsReminders,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+=' data-field-name="receiveSmsReminders">\n                    <p class="small"><b>SMS pickup reminders:</b> Receive pickup reminders.</p>\n                </label>\n            </div>\n        </div>\n    </div>\n\n    <button class="button save btn-block" type="button" loading-animation="" ',o=n.unless.call(t,t&&t.isFormDirty,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+=">\n        Save Changes\n    </button>\n</form>",s});return n}),define("modules/account/accountView",["require","marionette","common/nav","hbs!modules/account/accountFormTemplate","common/validation","common/dataService","modules/account/accountModel","common/globals","common/globalMessage"],function(e){var t=e("marionette"),n=e("common/nav"),r=e("hbs!modules/account/accountFormTemplate"),i=e("common/validation"),s=e("common/dataService"),o=e("modules/account/accountModel"),u=e("common/globals"),a=e("common/globalMessage"),f=t.LayoutView.extend({template:r,events:{"click button.save":"saveAccount","keyup .form-control":"updateProperty","change input[type=checkbox]":"updateProperty","click .change-community":"_changeCommunity","click .change-password":"changePassword","click .change-payment":"changePayment"},updateProperty:function(e){var t=e.currentTarget,n=$(t).data("fieldName"),r=t.value;t.type==="checkbox"&&(r=t.checked),this.model.set(n,r),this.model.get("isFormDirty")||(this.model.set("isFormDirty",!0),u.data.isFormDirty=!0,this.$el.find("button.save").removeAttr("disabled"))},getFormChanges:function(e){var t=o.getOriginalAccountData(),n="";return _.each(t,function(t,r){var i=e[r];if(i!=undefined&&i!==t){n&&(n+=" / ");var s=typeof i=="boolean";n+=r+" "+(s?i?"checked":"unchecked":"changed")}}),n},saveAccount:function(){var e=i.validateForm("#account-form");if(e){var t=this.getFormChanges(e);e.memberKey=this.model.get("key"),s.changeMemberDetails(e).done(_.bind(function(e){e&&e.statusCode==="OK"&&(this.model.set("isFormDirty",!1),u.data.isFormDirty=!1,u.eventBus.trigger("analytics:event","Community-account","Account info changes saved",t),this.render()),e&&e.statusCode==="FAILURE"&&a.showError("An unknown error has occurred. Please try again.")},this))}},_changeCommunity:function(){var e=s.getMarketData("pickupSite").zipCode;n.navigate(n.PageEnum.ChooseCommunity,undefined,n.PageParam.Location+"="+e),u.eventBus.trigger("analytics:event","account","Member clicked switch community")},changePassword:function(){u.eventBus.trigger("flow:account:changePassword")},changePayment:function(){u.eventBus.trigger("analytics:pageView","change-payment"),u.eventBus.trigger("flow:account:paymentDetails")}});return f}),define("modules/account/accountModule",["require","backbone","marionette","modules/account/accountModel","hbs!modules/account/accountTemplate","modules/account/accountView","modules/authentication/changePassword/changePasswordView","common/dataService","common/globals"],function(e){var t=e("backbone"),n=e("marionette"),r=e("modules/account/accountModel"),i=e("hbs!modules/account/accountTemplate"),s=e("modules/account/accountView"),o=e("modules/authentication/changePassword/changePasswordView"),u=e("common/dataService"),a=e("common/globals"),f={Account:1,ChangePassword:2},l=n.LayoutView.extend({template:i,className:"account",regions:{content:"#content"},initialize:function(e){this.mode=(e||{}).mode||f.Account},onShow:function(){this.mode==f.Account?this.showAccountForm():this.showChangePassword()},showAccountForm:function(){var e=r.getModel(),t=new s({model:e});this.content.show(t)},showChangePassword:function(){var e=new o({model:new t.Model,showCancelButton:!0});this.content.show(e)}}),c=n.Controller.extend({initialize:function(e){this.region=e.region},show:function(e){var t=new l({mode:e});this.region.show(t)}});return c.Mode=f,c}),define("hbs!modules/orderHistory/orderHistoryViewTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\n		<div class="empty-history">\n			<h2>Looks like you haven\'t had a delivery yet.</h2>\n			<a class="market button">Order now</a>\n		</div>\n	'}function f(e,t){return'\n		<table class="table">\n			<thead>\n			<tr>\n				<th class="col-xs-4 col-sm-3">Date</th>\n				<th class="col-xs-6 col-sm-7">Description</th>\n				<th class="col-xs-2 col-sm-2"></th>\n			</tr>\n			</thead>\n			<tbody>\n			</tbody>\n		</table>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="container">\n    <h1>Order History</h1>\n	',o=n["if"].call(t,t&&t.isEmpty,{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+="\n</div>",s});return n}),define("hbs!modules/orderHistory/orderHistoryRowTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+="($",(i=n.price)?i=i.call(e,{hash:{}}):(i=e&&e.price,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+")",r}function d(e,t){return'<a class="order-details-link">Order Details</a>'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+="<td>",a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.date," %b %d, %Y",a):c.call(t,"formatDateHelper",t&&t.date," %b %d, %Y",a)))+"</td>\n<td>",(u=n.description)?u=u.call(t,{hash:{}}):(u=t&&t.description,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+" ",u=n["if"].call(t,t&&t.price,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;s+="</td>\n<td>",u=n["if"].call(t,t&&t.isSubscription,{hash:{},inverse:h.noop,fn:h.program(3,d,i)});if(u||u===0)s+=u;return s+="</td>",s});return n}),define("hbs!modules/orderHistory/orderDetails/orderDetailsTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;r+='\n    <div class="row">\n        <div class="col-xs-7 col-sm-3 col-sm-offset-7">',(i=n.title)?i=i.call(e,{hash:{}}):(i=e&&e.title,i=typeof i===f?i.call(e,{hash:{}}):i);if(i||i===0)r+=i;return r+=':</div>\n        <div class="col-xs-5 col-sm-2"><b>',s={hash:{}},r+=c((i=n.currencyHelper||e&&e.currencyHelper,i?i.call(e,e&&e.price,s):l.call(e,"currencyHelper",e&&e.price,s)))+"</b></div>\n    </div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=n.helperMissing,c=this.escapeExpression,h=this;s+="<h2>Order details - ",a={hash:{}},s+=c((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.date," %b %d, %Y",a):l.call(t,"formatDateHelper",t&&t.date," %b %d, %Y",a)))+'</h2>\n<div class="order-details">\n    <div class="has-order">\n        <div class="row order-header hidden-xs">\n            <div class="col-sm-6">Item</div>\n            <div class="col-sm-2">Price</div>\n            <div class="col-sm-2">Quantity</div>\n            <div class="col-sm-2">Total</div>\n        </div>\n        <div id="order-items"></div>\n    </div>\n</div>\n',u=n.each.call(t,t&&t.totalItems,{hash:{},inverse:h.noop,fn:h.program(1,p,i)});if(u||u===0)s+=u;return s});return n}),define("hbs!modules/orderHistory/orderDetails/orderDetailsRowTemplate",["hbs","hbs/handlebars","common/handlebars/helpers/currencyHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div class="hidden-xs">\n    <div class="col-sm-6">\n        <div class="picture">\n            <img src="',(o=n.imageUrl)?o=o.call(t,{hash:{}}):(o=t&&t.imageUrl,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'" alt="',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'"/>\n        </div>\n        <div class="title-wrapper">\n            <span class="title">\n                <span class="">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</span>\n            </span>\n        </div>\n    </div>\n    <div class="col-sm-2"> <span class="content price-per-unit"> ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.price,a):c.call(t,"currencyHelper",t&&t.price,a)))+' </span></div>\n\n    <div class="col-sm-2">\n        <span class="content quantity">',(u=n.quantity)?u=u.call(t,{hash:{}}):(u=t&&t.quantity,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</span>\n    </div>\n    <div class="col-sm-2">\n        <span class="content quantity">',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):c.call(t,"currencyHelper",t&&t.total,a)))+'</span>\n    </div>\n</div>\n\n<div class="visible-xs">\n    <div class="col-xs-5">\n        <div class="picture">\n            <img src="',(u=n.imageUrl)?u=u.call(t,{hash:{}}):(u=t&&t.imageUrl,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'" alt="',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'"/>\n        </div>\n\n    </div>\n    <div class="col-xs-7">\n        <div class="row">\n            <div class=""><span class="title">\n                <span class="">',(u=n.title)?u=u.call(t,{hash:{}}):(u=t&&t.title,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</span>\n                </span>\n            </div>\n            <div class="row">\n                <div class="col-xs-5 small">Qty: ',(u=n.quantity)?u=u.call(t,{hash:{}}):(u=t&&t.quantity,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+'</div>\n                <div class="col-xs-7 small">Total: ',a={hash:{}},s+=l((o=n.currencyHelper||t&&t.currencyHelper,o?o.call(t,t&&t.total,a):c.call(t,"currencyHelper",t&&t.total,a)))+"</div>\n            </div>\n        </div>\n\n    </div>\n</div>\n",s});return n}),define("modules/orderHistory/orderDetails/orderDetailsModal",["require","backbone","marionette","common/modal/modal","hbs!modules/orderHistory/orderDetails/orderDetailsTemplate","hbs!modules/orderHistory/orderDetails/orderDetailsRowTemplate","common/rawDataModel"],function(e){var t=e("backbone"),n=e("marionette"),r=e("common/modal/modal"),i=e("hbs!modules/orderHistory/orderDetails/orderDetailsTemplate"),s=e("hbs!modules/orderHistory/orderDetails/orderDetailsRowTemplate"),o=e("common/rawDataModel"),u=o.Model.extend({readers:{title:(new o.Value("title")).getValue,imageUrl:(new o.Value("imageUrl")).getValue,price:(new o.Value("price")).getValue,quantity:(new o.Value("quantity")).getValue,total:function(){return this.get("price")*this.get("quantity")}}}),a=n.ItemView.extend({className:"row order-item",template:s}),f=n.CompositeView.extend({template:i,className:"order-details-modal",childView:a,childViewContainer:"#order-items"});return{show:function(e,n,i){var s=_.filter(i,function(e){return e.isRefundShare});s.push({title:"Total",price:n});var o=new t.Model({date:e,totalItems:s}),a=_.filter(i,function(e){return!e.isRefundShare}),l=new t.Collection(a,{model:u}),c=new f({model:o,collection:l});r.show(c)}}}),define("modules/orderHistory/orderHistoryView",["require","marionette","common/globals","hbs!modules/orderHistory/orderHistoryViewTemplate","hbs!modules/orderHistory/orderHistoryRowTemplate","modules/orderHistory/orderDetails/orderDetailsModal"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("hbs!modules/orderHistory/orderHistoryViewTemplate"),i=e("hbs!modules/orderHistory/orderHistoryRowTemplate"),s=e("modules/orderHistory/orderDetails/orderDetailsModal"),o=t.ItemView.extend({tagName:"tr",template:i,events:{"click .order-details-link":"_showOrderDetails","click a.market":"_goToMarket"},_showOrderDetails:function(){n.eventBus.trigger("analytics:pageEvent","Community-history","order details viewed"),s.show(this.model.get("date"),this.model.get("debit"),this.model.get("orderItems"))}}),u=t.CompositeView.extend({template:r,className:"history-module",childView:o,childViewContainer:"tbody",events:{"click a.market":"_goToMarket"},_goToMarket:function(){n.eventBus.trigger("flow:header:market")}});return u}),define("modules/orderHistory/historyItemModel",["require","common/rawDataModel"],function(e){var t=e("common/rawDataModel"),n={Subscription:"Subscription",Hold:"Hold",New:"New",Vacation:"Vacation",Order:"Order",Payment:"Payment",RejectedPayment:"RejectedPayment",PendingPayment:"PendingPayment",Fee:"Fee",Refund:"Refund",FarmigoCredits:"FarmigoCredits"},r=t.Model.extend({readers:{key:(new t.Value("key")).getValue,description:(new t.Value("description")).getValue,date:(new t.Value("date")).getValue,pickupSite:(new t.Value("pickupSite")).getValue,debit:(new t.Value("debit")).getValue,type:(new t.Value("type")).getValue,orderItems:(new t.Value("orderItems")).getValue,price:"getPrice",isSubscription:"getIsSubscription"},getPrice:function(){var e=this.rawData.credit?this.rawData.credit:this.rawData.debit;return e},getIsSubscription:function(){return this.get("type")===n.Subscription}});return r}),define("modules/orderHistory/orderHistoryModule",["require","backbone","marionette","modules/orderHistory/orderHistoryView","modules/orderHistory/historyItemModel","common/dataService","common/globals"],function(e){function u(){window.history.back()}var t=e("backbone"),n=e("marionette"),r=e("modules/orderHistory/orderHistoryView"),i=e("modules/orderHistory/historyItemModel"),s=e("common/dataService"),o=e("common/globals"),a=n.Controller.extend({initialize:function(e){this.region=e.region},show:function(){this.region.empty(),s.getOrders().done(_.bind(function(e){var n=new t.Collection(e,{model:i}),s=new t.Model({isEmpty:e.length==0}),o=new r({collection:n,model:s});this.region.show(o)},this))}});return a}),define("modules/payment/paymentModel",["require","common/rawDataModel","common/dataService"],function(e){var t=e("common/rawDataModel"),n=e("common/dataService"),r=[{value:"Alabama",key:"AL"},{value:"Alaska",key:"AK"},{value:"American Samoa",key:"AS"},{value:"Arizona",key:"AZ"},{value:"Arkansas",key:"AR"},{value:"California",key:"CA"},{value:"Colorado",key:"CO"},{value:"Connecticut",key:"CT"},{value:"Delaware",key:"DE"},{value:"District Of Columbia",key:"DC"},{value:"Federated States Of Micronesia",key:"FM"},{value:"Florida",key:"FL"},{value:"Georgia",key:"GA"},{value:"Guam",key:"GU"},{value:"Hawaii",key:"HI"},{value:"Idaho",key:"ID"},{value:"Illinois",key:"IL"},{value:"Indiana",key:"IN"},{value:"Iowa",key:"IA"},{value:"Kansas",key:"KS"},{value:"Kentucky",key:"KY"},{value:"Louisiana",key:"LA"},{value:"Maine",key:"ME"},{value:"Marshall Islands",key:"MH"},{value:"Maryland",key:"MD"},{value:"Massachusetts",key:"MA"},{value:"Michigan",key:"MI"},{value:"Minnesota",key:"MN"},{value:"Mississippi",key:"MS"},{value:"Missouri",key:"MO"},{value:"Montana",key:"MT"},{value:"Nebraska",key:"NE"},{value:"Nevada",key:"NV"},{value:"New Hampshire",key:"NH"},{value:"New Jersey",key:"NJ"},{value:"New Mexico",key:"NM"},{value:"New York",key:"NY"},{value:"North Carolina",key:"NC"},{value:"North Dakota",key:"ND"},{value:"Northern Mariana Islands",key:"MP"},{value:"Ohio",key:"OH"},{value:"Oklahoma",key:"OK"},{value:"Oregon",key:"OR"},{value:"Palau",key:"PW"},{value:"Pennsylvania",key:"PA"},{value:"Puerto Rico",key:"PR"},{value:"Rhode Island",key:"RI"},{value:"South Carolina",key:"SC"},{value:"South Dakota",key:"SD"},{value:"Tennessee",key:"TN"},{value:"Texas",key:"TX"},{value:"Utah",key:"UT"},{value:"Vermont",key:"VT"},{value:"Virgin Islands",key:"VI"},{value:"Virginia",key:"VA"},{value:"Washington",key:"WA"},{value:"West Virginia",key:"WV"},{value:"Wisconsin",key:"WI"},{value:"Wyoming",key:"WY"}],i=t.Model.extend({readers:{firstName:"getFirstName",lastName:"getLastName",years:"getYears",hasBillingAddress:"getHasBillingAddress",states:"getStates"},getYears:function(){var e=(new Date).getFullYear(),t=[];for(var n=0;n<11;n++)t.push(e+n);return t},getFirstName:function(){return this.get("ccFirstName")?this.get("ccFirstName"):(this.rawData.member||{}).firstName},getLastName:function(){return this.get("ccLastName")?this.get("ccLastName"):(this.rawData.member||{}).lastName},getStates:function(){return r},getHasBillingAddress:function(){return!0}});return{getInstance:function(){return new i(n.getMarketData())}}}),define("hbs!modules/payment/paymentTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var n="";return n+="\n											<option>"+a(typeof e===u?e.apply(e):e)+"</option>\n										",n}function c(e,t){var r="",i;r+='\n                    <span class="address-container">\n                        <div class="row">\n                            <div class="col-md-12">\n                                <div class="form-group">\n                                    <input type="text" class="form-control" placeholder="Address Line 1" data-field-name="addressLine1" required value="',(i=n.addressLine1)?i=i.call(e,{hash:{}}):(i=e&&e.addressLine1,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n                                </div>\n                            </div>\n                        </div>\n\n                        <div class="row">\n                            <div class="col-md-12">\n                                <div class="form-group">\n                                    <input type="text" class="form-control" placeholder="Address Line 2" data-field-name="addressLine2" value="',(i=n.addressLine2)?i=i.call(e,{hash:{}}):(i=e&&e.addressLine2,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n                                </div>\n                            </div>\n                        </div>\n\n\n                        <div class="row">\n                            <div class="cc-date-wrapper col-xs-5">\n                                    <div class="form-group">\n                                        <input type="text" class="form-control" placeholder="City" data-field-name="city" required value="',(i=n.city)?i=i.call(e,{hash:{}}):(i=e&&e.city,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n                                    </div>\n                            </div>\n\n                            <div class="col-xs-4">\n                                <div class="form-group">\n                                    <select class="form-control" data-field-name="state" required>\n                                        <option value="">State</option>\n                                        ',i=n.each.call(e,e&&e.states,{hash:{},inverse:f.noop,fn:f.program(4,h,t)});if(i||i===0)r+=i;return r+='\n                                    </select>\n                                </div>\n                            </div>\n\n                            <div class="col-xs-3">\n                                <div class="form-group">\n                                    <input type="text" class="form-control" placeholder="Zip" data-field-name="zipCode" data-parsley-pattern="/(^\\d{5}$)|(^\\d{5}-\\d{4}$)/" data-parsley-error-message="Invalid zip code" required value="',(i=n.zipCode)?i=i.call(e,{hash:{}}):(i=e&&e.zipCode,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n                                </div>\n                            </div>\n                        </div>\n                    </span>\n                    ',r}function h(e,t){var r="",i;return r+='\n                                            <option value="',(i=n.key)?i=i.call(e,{hash:{}}):(i=e&&e.key,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">',(i=n.value)?i=i.call(e,{hash:{}}):(i=e&&e.value,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</option>\n                                        ",r}function p(e,t){var r="",i;return r+='\n						<div class="row">\n							<div class="col-md-12">\n								<div class="form-group">\n									<input type="text" class="form-control" placeholder="Mobile Phone" data-field-name="phone" data-parsley-pattern="^\\(?([0-9]{3})\\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$" data-parsley-error-message="Please enter a valid phone number" required value="',(i=n.mobilePhone)?i=i.call(e,{hash:{}}):(i=e&&e.mobilePhone,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+'">\n								</div>\n							</div>\n						</div>\n						<div class="row">\n							<div class="col-md-12">\n								<div class="checkbox">\n									<label>\n										<input type="checkbox" data-field-name="receiveSmsReminders" checked>\n										Send me pickup reminders via text message\n									</label>\n								</div>\n							</div>\n						</div>\n					',r}function d(e,t){return'\n						<div class="row">\n							<div class="col-xs-4">\n								<button class="button light user cancel btn-block" type="button" loading-animation>Cancel</button>\n							</div>\n							<div class="col-xs-8">\n								<button class="button user pay btn-block" type="submit" loading-animation>Finish</button>\n							</div>\n						</div>\n                    '}function v(e,t){return'\n                        <button class="button user btn-block pay" type="submit" loading-animation>Finish</button>\n                    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="container payment">\n	<div class="box-container row">\n		<div class="col-md-offset-3 col-md-6 col-sm-offset-2 col-sm-8">\n			<div class="box-body">\n				<div class="heading">\n					<h2 class="title">Enter your billing information</h2>\n					<p class="secondary-title">We charge you after you pick up and only if you are satisfied</p>\n				</div>\n				<hr/>\n				<div class="cc-logos row">\n					<div class="cc-mastercard" title="MasterCard"></div>\n					<div class="cc-aa" title="American Express"></div>\n					<div class="cc-discover" title="Discover"></div>\n					<div class="cc-visa" title="Visa"></div>\n				</div>\n\n				<form role="form" id="credit-card-details-form" class="payment">\n					<div class="row">\n						<div class="col-xs-6">\n							<div class="form-group">\n								<input type="text" class="form-control" autocorrect="off" placeholder="First Name" data-field-name="firstName" required value="',(o=n.firstName)?o=o.call(t,{hash:{}}):(o=t&&t.firstName,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n							</div>\n						</div>\n\n						<div class="col-xs-6">\n							<div class="form-group">\n								<input type="text" class="form-control" autocorrect="off" placeholder="Last Name" data-field-name="lastName" required value="',(o=n.lastName)?o=o.call(t,{hash:{}}):(o=t&&t.lastName,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n							</div>\n						</div>\n					</div>\n\n					<div class="row">\n						<div class="col-md-12">\n							<div class="form-group">\n								<input type="text" class="form-control inspectletIgnore" placeholder="Credit Card Number" data-field-name="creditCardNumber" required data-parsley-type="digits" data-parsley-length="[12, 16]" value="',(o=n.creditCard)?o=o.call(t,{hash:{}}):(o=t&&t.creditCard,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n							</div>\n						</div>\n					</div>\n\n					<div class="row">\n						<div class="cc-date-wrapper col-xs-9">\n							<div class="cc-date">\n								<div class="form-group">\n									<select class="form-control cc-month pull-left inspectletIgnore" data-parsley-monthselected  data-field-name="expMonth">\n										<option>Exp Month</option>\n										<option>01</option>\n										<option>02</option>\n										<option>03</option>\n										<option>04</option>\n										<option>05</option>\n										<option>06</option>\n										<option>07</option>\n										<option>08</option>\n										<option>09</option>\n										<option>10</option>\n										<option>11</option>\n										<option>12</option>\n									</select>\n								</div>\n								<div class="form-group">\n									<select class="form-control cc-year pull-left inspectletIgnore" data-parsley-ccexpiration="year" data-parsley-yearselected data-field-name="expYear">\n										<option>Exp Year</option>\n										',o=n.each.call(t,t&&t.years,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+='\n									</select>\n								</div>\n							</div>\n						</div>\n\n						<div class="ccv-wrapper col-xs-3">\n							<div class="form-group right">\n								<input type="text" class="form-control inspectletIgnore" placeholder="CVV" data-field-name="ccv" data-parsley-pattern="^[0-9]{3,4}$" data-parsley-error-message="Invalid security code" required value="',(o=n.cvv)?o=o.call(t,{hash:{}}):(o=t&&t.cvv,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\n							</div>\n						</div>\n					</div>\n                    ',o=n["if"].call(t,t&&t.hasBillingAddress,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;s+="\n\n                    ",o=n["if"].call(t,t&&t.showPhone,{hash:{},inverse:f.noop,fn:f.program(6,p,i)});if(o||o===0)s+=o;s+="\n\n                    ",o=n["if"].call(t,t&&t.showCancelButton,{hash:{},inverse:f.program(10,v,i),fn:f.program(8,d,i)});if(o||o===0)s+=o;return s+='\n\n					<p class="secure">Secure Payments &amp; Privacy Protection</p>\n				</form>\n			</div>\n		</div>\n	</div>\n</div>\n\n\n',s});return n}),define("modules/payment/paymentView",["require","marionette","hbs!modules/payment/paymentTemplate","common/validation","parsley","common/globals","common/globalMessage","common/utils"],function(e){var t=e("marionette"),n=e("hbs!modules/payment/paymentTemplate"),r=e("common/validation"),i=e("parsley"),s=e("common/globals"),o=e("common/globalMessage"),u=e("common/utils"),a=u.clientViewPort.isXs()?"Please select expiration date":"Please select card expiration date";window.ParsleyValidator.addValidator("ccexpiration",function(e,t){var n=parseInt($("form select.cc-month").val()),r=parseInt($("form select.cc-year").val());if(!isNaN(n)&&!isNaN(r)){var i=new Date;if(n<i.getMonth()+1&&r<=i.getFullYear())return!1}return!0},22).addMessage("en","ccexpiration","Card date expired").addValidator("monthselected",function(e){return e!="Exp Month"},32).addMessage("en","monthselected",a).addValidator("yearselected",function(e){return e!="Exp Year"},32).addMessage("en","yearselected",a);var f=t.ItemView.extend({template:n,initialize:function(e){e.showPhone&&this.model.set("showPhone",!0),e.showCancelButton&&this.model.set("showCancelButton",!0)},events:{"click button.pay":"pay","click button.cancel":"cancel","change .cc-month":"validateMonth"},validateMonth:function(){this.submittedOnce&&this.$(".cc-year").parsley().validate(!0)},pay:function(){this.submittedOnce=!0,o.hide();var e=r.validateForm("#credit-card-details-form");e&&(e.receiveSmsReminders=this.$('input[data-field-name="receiveSmsReminders"]').is(":checked"),s.eventBus.trigger("paymentDetails",e))},cancel:function(){s.eventBus.trigger("paymentCanceled")}});return f}),define("modules/payment/paymentModule",["require","marionette","modules/payment/paymentModel","modules/payment/paymentView","common/dataService"],function(e){var t=e("marionette"),n=e("modules/payment/paymentModel"),r=e("modules/payment/paymentView"),i=e("common/dataService"),s=t.Controller.extend({initialize:function(e){this.region=e.region},show:function(e,t){var i=n.getInstance(),s=new r({model:i,showPhone:e,showCancelButton:t});this.region.show(s)}});return s}),define("hbs!modules/thankyou/thankyouTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","common/handlebars/helpers/formatDateHelper","common/handlebars/helpers/fullNameHelper","common/handlebars/helpers/gtHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){return'class="col-md-12" '}function d(e,t){return'class="col-md-8 col-md-offset-2"'}function v(e,t){return'class="col-md-8 order-section" '}function m(e,t){return'class="col-md-12"'}function g(e,t){return"-->\n                                <!--<br/>Now share the joy of good food!-->\n                                    <!--"}function y(e,t){var i="",s;i+='\n                            <div class="row message-box">\n                                <div class="col-md-6">\n                                    ',s=h.invokePartial(r.organizerImage,"organizerImage",e,n,r);if(s||s===0)i+=s;i+='\n                                </div>\n                                <div class="col-md-5 messages">\n                                    <p>We sent you an email summary of your order.</p>\n                                    ',s=n["if"].call(e,e&&e.firstName,{hash:{},inverse:h.noop,fn:h.program(12,b,t)});if(s||s===0)i+=s;i+="\n                                    ",s=n["if"].call(e,e&&e.organizerEmail,{hash:{},inverse:h.noop,fn:h.program(14,w,t)});if(s||s===0)i+=s;return i+="\n                                </div>\n                            </div>\n                        ",i}function b(e,t){var r="",i,s;return r+="\n                                        <p><em>Any questions?</em> Ask your Farmigo Organizer:<br/>",s={hash:{}},r+=l((i=n.fullNameHelper||e&&e.fullNameHelper,i?i.call(e,e&&e.firstName,e&&e.lastName,s):f.call(e,"fullNameHelper",e&&e.firstName,e&&e.lastName,s)))+"</p>\n                                    ",r}function w(e,t){var r="",i;return r+='\n                                        <a class="email" href="mailto:',(i=n.organizerEmail)?i=i.call(e,{hash:{}}):(i=e&&e.organizerEmail,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+'">',(i=n.organizerEmail)?i=i.call(e,{hash:{}}):(i=e&&e.organizerEmail,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+"</a>\n                                    ",r}function E(e,t){var r;return r=n["if"].call(e,e&&e.isGoalNotReached,{hash:{},inverse:h.noop,fn:h.program(17,S,t)}),r||r===0?r:""}function S(e,t){return"highlighted"}function x(e,t){var r="",i;r+="\n                                ",i=n["if"].call(e,e&&e.isGoalNotReached,{hash:{},inverse:h.noop,fn:h.program(20,T,t)});if(i||i===0)r+=i;return r+="\n                            ",r}function T(e,t){var r="",i;r+='\n                                    <div class="tell-your-friends">\n                                        <div class="title">\n                                            <span class="stripe-title">Help us reach ',(i=n.incubateNeededOrderCount)?i=i.call(e,{hash:{}}):(i=e&&e.incubateNeededOrderCount,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+" orders!</span>\n                                        </div>\n                                    </div>\n                                    ",i=n["if"].call(e,e&&e.isIncubateGoalNotReached,{hash:{},inverse:h.noop,fn:h.program(21,N,t)});if(i||i===0)r+=i;return r+="\n                                ",r}function N(e,t){var r="",i,s,o;r+='<p class="incubate-message">We need <b>',(i=n.missingOrderCount)?i=i.call(e,{hash:{}}):(i=e&&e.missingOrderCount,i=typeof i===c?i.call(e,{hash:{}}):i),r+=l(i)+" more order",o={hash:{},inverse:h.noop,fn:h.program(22,C,t)},s=(i=n.gtHelper||e&&e.gtHelper,i?i.call(e,e&&e.missingOrderCount,1,o):f.call(e,"gtHelper",e&&e.missingOrderCount,1,o));if(s||s===0)r+=s;return r+="</b> to launch our community. Help us get our first delivery by telling our friends:</p>",r}function C(e,t){return"s"}function k(e,t){return'class="col-md-4" '}function L(e,t){return'class="fixed-right"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="container">\n	<div class="box-container row">\n		<!--<div class="col-md-offset-2 col-md-8">-->\n        <div ',o=n["if"].call(t,t&&t.isUpsellFixedOnRight,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i)});if(o||o===0)s+=o;s+='>\n			<div class="box-body">\n                <div class="row">\n                    <div ',o=n["if"].call(t,t&&t.isUpsellFixedOnRight,{hash:{},inverse:h.program(7,m,i),fn:h.program(5,v,i)});if(o||o===0)s+=o;s+='>\n                        <div class="heading">\n                            <h1 class="title">\n                                <span class="icon-order-confirm">Order confirmed.</span>\n                                    <!--',o=n["if"].call(t,t&&t.senderReferral,{hash:{},inverse:h.noop,fn:h.program(9,g,i)});if(o||o===0)s+=o;s+="-->\n                            </h1>\n\n                            <p>\n                                Yum! if you change your mind and want to add or remove anything from your order,</br>\n                                you have until <em>",a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%A, %b %d",a):f.call(t,"formatDateHelper",(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%A, %b %d",a)))+" at midnight</em> to edit your order.\n                            </p>\n                        </div>\n\n                        ",u=n.unless.call(t,t&&t.hasOrders,{hash:{},inverse:h.noop,fn:h.program(11,y,i)});if(u||u===0)s+=u;s+='\n\n                        <section class="share-section ',u=n.unless.call(t,t&&t.senderReferral,{hash:{},inverse:h.noop,fn:h.program(16,E,i)});if(u||u===0)s+=u;s+='">\n                            ',u=n.unless.call(t,t&&t.senderReferral,{hash:{},inverse:h.noop,fn:h.program(19,x,i)});if(u||u===0)s+=u;s+='\n                            <div id="thankyou-share-region"></div>\n                        </section>\n                        <section id="farmers-share-region"></section>\n                        <!--<section class="download-app hidden-xs">-->\n                            <!--<a class="download-app-link" href="https://itunes.apple.com/app/apple-store/id1017742501?pt=1768701&ct=thank%20you%20page&mt=8">Farmigo, mobile<br>Download now on iOS</a>-->\n\n                            <!--<form id="send-app-sms-form">-->\n                                <!--<span class="send-sms-title">send via SMS:</span>-->\n                                <!--<i class="phone"></i>-->\n                        <!--<span class="enter-phone-number form-group">-->\n                        <!--<input type="text" class="form-control" value="'+l((o=(o=t&&t.member,o==null||o===!1?o:o.phone),typeof o===c?o.apply(t):o))+'" placeholder="Enter U.S. mobile number" data-parsley-phone data-field-name="phone"/>-->\n                        <!--<button class="button send-app-sms" loading-animation>Send</button>-->\n                            <!--</span>-->\n                            <!--</form>-->\n                        <!--</section>-->\n                        <section id="order-exceptions-region"></section>\n                        <section id="order-details-region"></section>\n\n                        <p class="dates">\n                            Orders for <em>',a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,t&&t.nextDeliveryDate,"%A, %b %d",a):f.call(t,"formatDateHelper",t&&t.nextDeliveryDate,"%A, %b %d",a)))+'</em> can be changed until<br class="hidden-xs">\n                            midnight <em>',a={hash:{}},s+=l((o=n.formatDateHelper||t&&t.formatDateHelper,o?o.call(t,(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%A, %b %d",a):f.call(t,"formatDateHelper",(o=t&&t.orderLock,o==null||o===!1?o:o.storeCloseDate),"%A, %b %d",a)))+"</em>\n                        </p>\n                    </div>\n                    <div ",u=n["if"].call(t,t&&t.isUpsellFixedOnRight,{hash:{},inverse:h.program(7,m,i),fn:h.program(24,k,i)});if(u||u===0)s+=u;s+='><section id="upselling-region" ',u=n["if"].call(t,t&&t.isUpsellFixedOnRight,{hash:{},inverse:h.noop,fn:h.program(26,L,i)});if(u||u===0)s+=u;return s+="></section></div>\n                </div>\n\n\n            </div>\n        </div>\n	</div>\n</div>\n\n\n",s});return n}),define("hbs!modules/thankyou/orderExceptions/orderExceptionsTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\n    <h3>Heads Up! The following items are no longer available, and were therefore not included in your order</h3>\n	<div id="order-exceptions-unavailable-region"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;o=n["if"].call(t,t&&t.hasNotAvailable,{hash:{},inverse:u.noop,fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+="\n",s});return n}),define("modules/thankyou/orderExceptions/orderExceptionsView",["require","backbone","marionette","hbs!modules/thankyou/orderExceptions/orderExceptionsTemplate","common/utils","modules/order/orderTable/orderItemModel","hbs!modules/order/orderTable/orderItemReadOnlyTemplate","common/dataService"],function(e){var t=e("backbone"),n=e("marionette"),r=e("hbs!modules/thankyou/orderExceptions/orderExceptionsTemplate"),i=e("common/utils"),s=e("modules/order/orderTable/orderItemModel"),o=e("hbs!modules/order/orderTable/orderItemReadOnlyTemplate"),u=e("common/dataService"),a,f,l=s.extend({constructor:function(e,t){this.readers=_.clone(this.readers),_.extend(this.readers,this.myReaders),delete this.rawValues.quantity,s.prototype.constructor.apply(this,arguments)},myReaders:{total:function(){return null},isSoldOut:"getIsSoldOut",quantity:"getQuantity",isTempUnavailable:"getIsTempUnavailable",isUnavailable:"getIsUnavailable"},initialize:function(){s.prototype.initialize.apply(this,arguments);if(!a){var e=u.getMarketData();a=_.reduce(e.orderDataBeforeSubmission,function(e,t){return e[t.shareKey]=t,e},{}),f=e.orderExceptions}},getQuantity:function(){var e=f[this.rawData.shareKey],t=a[this.rawData.shareKey].quantity;return e<0||e==t?this.rawData.quantity:e+" of "+t},getIsSoldOut:function(){return f[this.rawData.shareKey]>0},getIsTempUnavailable:function(){return f[this.rawData.shareKey]==-1},getIsUnavailable:function(){return f[this.rawData.shareKey]==-2}}),c=t.Collection.extend({model:l}),h=n.ItemView.extend({template:o,className:"row"}),p=n.CollectionView.extend({childView:h,className:"order-items"}),d=n.LayoutView.extend({template:r,className:"order-details-read-only",regions:{unavailable:"#order-exceptions-unavailable-region"},onShow:function(){var e=this.model.get("unavailableItems"),t=new c(e),n=new p({collection:t});this.unavailable.show(n)}});return d}),define("modules/thankyou/orderExceptions/orderExceptionsModel",["require","common/rawDataModel"],function(e){var t=e("common/rawDataModel"),n=t.Model.extend({readers:{hasNotAvailable:"getHasNotAvailable",unavailableItems:"getUnavailableItems"},getHasNotAvailable:function(){var e=this.rawData.orderDataBeforeSubmission;for(var t=0;t<e.length;t++){var n=e[t],r=this.rawData.orderExceptions[n.shareKey];if(r)return!0}return!1},getUnavailableItems:function(){return _.filter(this.rawData.orderDataBeforeSubmission,function(e){var t=this.rawData.orderExceptions[e.shareKey];if(t)return!0},this)}});return n}),!function(e){var t=e(window);e.fn.visible=function(e,n,r){if(!(this.length<1)){var s=this.length>1?this.eq(0):this,o=s.get(0),u=t.width(),a=t.height(),r=r?r:"both",f=n===!0?o.offsetWidth*o.offsetHeight:!0;if("function"==typeof o.getBoundingClientRect){var l=o.getBoundingClientRect(),c=l.top>=0&&l.top<a,h=l.bottom>0&&l.bottom<=a,p=l.left>=0&&l.left<u,d=l.right>0&&l.right<=u,v=e?c||h:c&&h,m=e?p||d:p&&d;if("both"===r)return f&&v&&m;if("vertical"===r)return f&&v;if("horizontal"===r)return f&&m}else{var g=t.scrollTop(),y=g+a,b=t.scrollLeft(),w=b+u,E=s.offset(),S=E.top,x=S+s.height(),T=E.left,N=T+s.width(),C=e===!0?x:S,k=e===!0?S:x,L=e===!0?N:T,A=e===!0?T:N;if("both"===r)return!!f&&y>=k&&C>=g&&w>=A&&L>=b;if("vertical"===r)return!!f&&y>=k&&C>=g;if("horizontal"===r)return!!f&&w>=A&&L>=b}}}}(jQuery),define("jqueryVisible",function(){}),define("modules/thankyou/thankyouView",["require","marionette","common/globals","common/dataService","common/utils","common/enums","hbs!modules/thankyou/thankyouTemplate","modules/sharing/sharingView","modules/farmShare/farmShareModule","common/marketModel","common/validation","modules/order/orderDetailsReadOnly","modules/thankyou/orderExceptions/orderExceptionsView","modules/thankyou/orderExceptions/orderExceptionsModel","modules/itemList/itemListWidget","modules/experiments/upsellLogic","modules/carousel/itemCarouselWidget","jqueryVisible"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/dataService"),i=e("common/utils"),s=e("common/enums"),o=e("hbs!modules/thankyou/thankyouTemplate"),u=e("modules/sharing/sharingView"),a=e("modules/farmShare/farmShareModule"),f=e("common/marketModel"),l=e("common/validation"),c=e("modules/order/orderDetailsReadOnly"),h=e("modules/thankyou/orderExceptions/orderExceptionsView"),p=e("modules/thankyou/orderExceptions/orderExceptionsModel"),d=e("modules/itemList/itemListWidget"),v=e("modules/experiments/upsellLogic"),m=e("modules/carousel/itemCarouselWidget");e("jqueryVisible");var g=t.LayoutView.extend({template:o,regions:{share:"#thankyou-share-region",orderDetails:"#order-details-region",orderExceptions:"#order-exceptions-region",farmShareRegion:"#farmers-share-region",upsellingRegion:"#upselling-region"},ui:{organizerImage:".organizer-image>img"},initialize:function(e){this.moduleEventBus=e.moduleEventBus,this.listenTo(this.moduleEventBus,{"order:edit":function(){n.data.setIsOrderEditable(!0),n.eventBus.trigger("flow:header:order")}}),this.listenTo(n.eventBus,{shareChanged:function(){n.eventBus.trigger("flow:header:order")}});var t=v.getChosenVariation();this.model.set("isUpsellFixedOnRight",t.isRightSide)},onRender:function(){if(this.model.get("shouldShowProducerShare")){var e=a.getProducersView(r.getMarketData());this.farmShareRegion.show(e)}var t=function(){var e=new f,t=new c({model:e,moduleEventBus:this.moduleEventBus});this.orderDetails.show(t)}.bind(this),n=this.model.get("senderReferral"),i=this.model.get("isGoalNotReached");if(!n&&i){var o=n?this.model.get("referralLink"):this.model.get("shareLink");n;var l=u.newView(o,{isSenderReferral:n});this.share.show(l)}var v=this.model.get("orderExceptions"),g=this.model.get("orderDataBeforeSubmission");if(v&&_.keys(v).length>0&&g&&g.length>0){var y=new h({model:new p(this.model.rawData)});this.orderExceptions.show(y),r.loadMarketData().then(t)}else t();var b=this.model.get("isUpsellFixedOnRight"),w="Some other items we think you’ll love",E={title:w+":",maxShares:4,categoryDimensionTitle:w},S;b?(E.sharesPerRow=2,S=d.show(this.upsellingRegion,this.moduleEventBus,{filterType:s.FilterType.Upsell,data:E,orderItemProperties:{highlightItemInOrder:"addedFromThankYouPage"}})):(E.sharesPerRow=4,E.maxShares=20,E.thanksYouPage=!0,S=m.show(this.upsellingRegion,this.moduleEventBus,{filterType:s.FilterType.Upsell,data:E,orderItemProperties:{highlightItemInOrder:"addedFromThankYouPage"}})),_.defer(_.bind(function(){var e=$("#upselling-region .compact");e.visible(!0,!1,"vertical")?this.fireUpsellVisibleEvent():this.checkIfElementVisibleOnScroll(e,this.fireUpsellVisibleEvent)},this))},checkIfElementVisibleOnScroll:function(e,t){var n=0;$(window).on("scroll",function(){n&&clearTimeout(n),n=setTimeout(function(){e.visible(!0,!1,"vertical")&&(t(),$(window).off("scroll"))},300)})},onBeforeDestroy:function(){$(window).off("scroll")},fireUpsellVisibleEvent:function(){n.eventBus.trigger("analytics:event","Community-thankyou","upsell section viewed")},onShow:function(){i.handleImageLoad(this.ui.organizerImage)}});return g}),define("modules/thankyou/thankyouModule",["require","jquery","common/globals","marionette","common/marketModel","modules/thankyou/thankyouView","common/dataService","common/dataUtils"],function(e){var t=e("jquery"),n=e("common/globals"),r=e("marionette"),i=e("common/marketModel"),s=e("modules/thankyou/thankyouView"),o=e("common/dataService"),u=e("common/dataUtils"),a=r.Controller.extend({initialize:function(e){this.region=e.region},show:function(){var e=new i,r=new s({model:e,moduleEventBus:new n.EventAggregator}),o=e.get("subscriptionKey"),u=t.cookie("source");this.region.show(r),this.checkForSellOutItems(e)},checkForSellOutItems:function(e){var t=o.getMarketData("sharesMap"),n=e.get("itemsChanged")?e.get("itemsChanged"):e.get("order");_.each(n,function(e){var n=_.findWhere(t,{key:e.shareKey});if(n){var r=u.canAddShareToOrder(e.shareKey,e.quantity);r||this.sendSellOutItemAnalytics(n)}}.bind(this))},sendSellOutItemAnalytics:function(e){n.eventBus.trigger("analytics:event","Community-market","Item sold out",e.title,0,!0)}});return a}),define("modules/chooseCommunity/chooseCommunityModel",["require","common/rawDataModel"],function(e){var t=e("common/rawDataModel"),n=t.Model.extend({initialize:function(){var e=this.rawData,t,n=[];for(t in e)n=n.concat(e[t].map(function(e){return e.region=t,e}));this.rawData={communities:n}},rawValues:{communities:new t.Value("communities")}});return n}),define("hbs!modules/chooseCommunity/chooseCommunitySearchFormTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<form role="form" class="clearfix">\r\n	<input type="text" class="search-input form-control pull-left" placeholder="Zip code, neighborhood or address"/>\r\n	<button class="button pull-right" type="submit">Search</button>\r\n</form>\r\n'});return n}),define("modules/chooseCommunity/chooseCommunitySearchFormView",["require","marionette","hbs!modules/chooseCommunity/chooseCommunitySearchFormTemplate"],function(e){var t=e("marionette"),n=e("hbs!modules/chooseCommunity/chooseCommunitySearchFormTemplate"),r=t.LayoutView.extend({template:n,ui:{input:".search-input",searchButton:"button"},events:{submit:"_onSubmit"},onRender:function(){this.ui.input.val(this.model.get("location"))},_onSubmit:function(){var e=this.ui.input.val().trim();return e&&this.trigger("search",e),this.ui.searchButton.focus(),this.ui.searchButton.blur(),!1},toggleError:function(e){this.ui.input.toggleClass("input-error",e)}});return r}),define("hbs!modules/chooseCommunity/chooseCommunitySearchStatusTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;r+='\r\n		<a class="start button kale hidden-xs" href="'+a((i=(i=e&&e.urls,i==null||i===!1?i:i.start),typeof i===u?i.apply(e):i))+'">',(s=n.startTxt)?s=s.call(e,{hash:{}}):(s=e&&e.startTxt,s=typeof s===u?s.call(e,{hash:{}}):s);if(s||s===0)r+=s;return r+="</a>\r\n	",r}function c(e,t){var r="",i;return r+='\r\n		<a class="notify-me hidden-xs">',(i=n.notifyMeText)?i=i.call(e,{hash:{}}):(i=e&&e.notifyMeText,i=typeof i===u?i.call(e,{hash:{}}):i),r+=a(i)+"</a>\r\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="search-status" status="',(o=n.status)?o=o.call(t,{hash:{}}):(o=t&&t.status,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'">\r\n	<span class="msg">',(o=n.message)?o=o.call(t,{hash:{}}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+"</span>\r\n	",o=n["if"].call(t,t&&t.isAllowStart,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;s+="\r\n	",o=n["if"].call(t,t&&t.notifyMeText,{hash:{},inverse:f.noop,fn:f.program(3,c,i)});if(o||o===0)s+=o;return s+="\r\n</div>\r\n",s});return n}),define("modules/chooseCommunity/chooseCommunitySearchStatusView",["require","marionette","common/dataService","common/globals","hbs!modules/chooseCommunity/chooseCommunitySearchStatusTemplate"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("common/globals"),i=e("hbs!modules/chooseCommunity/chooseCommunitySearchStatusTemplate"),s=t.LayoutView.extend({template:i,events:{"click .start":"onStart","click .notify-me":"onNotifyMe"},onStart:function(){r.eventBus.trigger("analytics:event","map","Start your own clicked")},onNotifyMe:function(){r.eventBus.trigger("analytics:event","map","Notify me clicked"),this.trigger("showNotifyMe")}});return s}),define("modules/chooseCommunity/chooseCommunitySearchStatusModel",["require","common/dataService","common/rawDataModel"],function(e){var t=e("common/dataService"),n=e("common/rawDataModel"),r={InBoundsAndCommunitiesNear:0,InBoundsAndNoCommunitiesNear:1,OutOfBounds:2,Error:3},i=["In Area","In Area - No Communities","Out of Area"],s=["Great news! Farmigo is active in your search area.","There are no Farmigo communities here yet.","Aw, bummer. We are not in your area just yet.","Location not found. Please enter a valid address, zip code, city or neighborhood name"],o=["+ Start Your Own","Start the First One &raquo;",""],u=["Notify me of new Communities","Notify me when a Community starts","Notify me when Farmigo arrives"],a=n.Model.extend({rawValues:{status:new n.Value("status"),message:new n.Value("message"),isAllowStart:new n.Value("isAllowStart"),startTxt:new n.Value("startTxt"),notifyMeText:new n.Value("notifyMeText"),urls:new n.Value("urls")},setStatus:function(e){var n={status:e,message:s[e],isAllowStart:e!=r.OutOfBounds&&e!=r.Error,startTxt:o[e],notifyMeText:u[e],urls:t.serverData.urls};this.rawData=n}});return a.EnumSearchStatus=r,a}),define("common/handlebars/helpers/formatHourRangeHelper",["require","hbs/handlebars","common/handlebars/helpers/formatHourHelper"],function(e){var t=e("hbs/handlebars"),n=e("common/handlebars/helpers/formatHourHelper"),r=function(e,t){return e.indexOf(t,e.length-t.length)!==-1},i=function(e,t){var i=n(e),s=n(t);if(r(i,"am")&&r(s,"am")||r(i,"pm")&&r(s,"pm"))i=i.substring(0,i.length-2);return i+"-"+s};return t.registerHelper("formatHourRangeHelper",i),i}),define("hbs!modules/chooseCommunity/chooseCommunityCommunityTemplate",["hbs","hbs/handlebars","hbs!common/handlebars/partials/organizerImage","common/handlebars/helpers/formatHourRangeHelper","common/handlebars/helpers/pluralNounHelper"],function(e,t){var n=t.template(function(e,t,n,r,i){function p(e,t){var r="",i;return r+='\r\n					<div class="note">\r\n                        <b>IMPORTANT NOTE</b>\r\n                        <div>',(i=n.instructions)?i=i.call(e,{hash:{}}):(i=e&&e.instructions,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"</div>\r\n					</div>\r\n				",r}function d(e,t){return'\r\n					<em class="incubated">Launching</em>\r\n				'}function v(e,t){var r="",i;return r+='\r\n    <div class="visible-xs">\r\n        <img class="static-map" src="https://maps.googleapis.com/maps/api/staticmap?size=',(i=n.staticMapWidth)?i=i.call(e,{hash:{}}):(i=e&&e.staticMapWidth,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+"x200&markers=",(i=n.lat)?i=i.call(e,{hash:{}}):(i=e&&e.lat,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+",",(i=n.lng)?i=i.call(e,{hash:{}}):(i=e&&e.lng,i=typeof i===f?i.call(e,{hash:{}}):i),r+=l(i)+'&key=AIzaSyAAzD3r0Y7TpT6vy041Y_l7BmK8r79Q6pc"/>\r\n    </div>\r\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials);var s="",o,u,a,f="function",l=this.escapeExpression,c=this,h=n.helperMissing;s+='<div class="pickup-site-details">\r\n	<div>\r\n		<div class="organizer-col col-xs-3">\r\n			',o=c.invokePartial(r.organizerImage,"organizerImage",t,n,r);if(o||o===0)s+=o;s+='\r\n		</div>\r\n		<div class="pickup-site-main-details-col col-xs-9">\r\n			<div class="pickup-site-main-details">\r\n				<h3 class="community-title">',(o=n.title)?o=o.call(t,{hash:{}}):(o=t&&t.title,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+"</h3>\r\n				",o=n["if"].call(t,t&&t.isPrivate,{hash:{},inverse:c.noop,fn:c.program(1,p,i)});if(o||o===0)s+=o;s+="\r\n				",o=n["if"].call(t,t&&t.isGoalNotReached,{hash:{},inverse:c.noop,fn:c.program(3,d,i)});if(o||o===0)s+=o;s+='\r\n				<ul>\r\n					<li class="address"><address>',(o=n.address)?o=o.call(t,{hash:{}}):(o=t&&t.address,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+'</address></li>\r\n					<li class="date">Pickup on ',(o=n.deliveryDays)?o=o.call(t,{hash:{}}):(o=t&&t.deliveryDays,o=typeof o===f?o.call(t,{hash:{}}):o),s+=l(o)+"s, ",a={hash:{}},s+=l((o=n.formatHourRangeHelper||t&&t.formatHourRangeHelper,o?o.call(t,t&&t.deliveryHourStart,t&&t.deliveryHourEnd,a):h.call(t,"formatHourRangeHelper",t&&t.deliveryHourStart,t&&t.deliveryHourEnd,a)))+'</li>\r\n					<li class="count">',(u=n.memberCount)?u=u.call(t,{hash:{}}):(u=t&&t.memberCount,u=typeof u===f?u.call(t,{hash:{}}):u),s+=l(u)+" ",a={hash:{}},s+=l((o=n.pluralNounHelper||t&&t.pluralNounHelper,o?o.call(t,"member",t&&t.memberCount,a):h.call(t,"pluralNounHelper","member",t&&t.memberCount,a)))+'</li>\r\n				</ul>\r\n				<a class="community-link button hidden-xs" loading-animation>Choose</a>\r\n			</div>\r\n		</div>\r\n	</div>\r\n   	<div class="community-link-wrapper visible-xs">\r\n   		<a class="community-link button" loading-animation>Choose</a>\r\n   	</div>\r\n</div>\r\n',u=n.unless.call(t,t&&t.isMap,{hash:{},inverse:c.noop,fn:c.program(5,v,i)});if(u||u===0)s+=u;return s+="\r\n",s});return n}),define("modules/chooseCommunity/chooseCommunityCommunityView",["require","marionette","common/utils","common/globals","hbs!modules/chooseCommunity/chooseCommunityCommunityTemplate"],function(e){var t=e("marionette"),n=e("common/utils"),r=e("common/globals"),i=e("hbs!modules/chooseCommunity/chooseCommunityCommunityTemplate"),s="/site/market/images/map-pins-sprite.png",o=t.ItemView.extend({template:i,initialize:function(){this.model.set("staticMapWidth",screen.width)},ui:{organizerImage:".organizer-image>img"},events:{"click a.community-link":"_onCommunityLinkClicked","mouseover .pickup-site-details":"_onMouseover","mouseout .pickup-site-details":"_onMouseOut","click .pickup-site-details":"_onClick"},_onMouseover:function(){if(!this.model.get("isMap")){var e={size:{width:26,height:36},origin:{x:45,y:0},url:s};this.model.get("marker").setIcon(e)}},_onMouseOut:function(){if(!this.model.get("isMap")){var e=this.model.get("marker").get("pinX"),t={size:{width:26,height:36},origin:{x:e,y:0},url:s};this.model.get("marker").setIcon(t)}},_onClick:function(){n.clientViewPort.isXs()||this.trigger("togglePin",this.model.get("marker"),!0)},onShow:function(){n.handleImageLoad(this.ui.organizerImage)},_onCommunityLinkClicked:function(){this.trigger("communityLinkClicked",this.model)}});return o}),define("modules/chooseCommunity/chooseCommunityListView",["require","marionette","modules/chooseCommunity/chooseCommunityCommunityView"],function(e){var t=e("marionette"),n=e("modules/chooseCommunity/chooseCommunityCommunityView"),r=t.CollectionView.extend({childView:n,className:"list"});return r}),define("common/regionsModel",["require","common/enums","common/rawDataModel"],function(e){var t=e("common/enums"),n=e("common/rawDataModel"),r={};r[t.EnumRegion.NY]={zoom:13,defaultLocation:"ny",bounds:["07003","07004","07006","07007","07009","07017","07018","07019","07021","07028","07039","07040","07041","07042","07043","07044","07050","07051","07052","07068","07078","07079","07101","07102","07103","07104","07105","07106","07107","07108","07109","07110","07111","07112","07114","07175","07182","07184","07188","07189","07191","07192","07193","07194","07195","07198","07199","07620","07621","07603","07072","07010","07624","07626","07627","07628","07073","07020","07407","07630","07631","07632","07410","07022","07024","07026","07452","07640","07604","07641","07601","07602","07642","07423","07605","07643","07644","07071","07607","07432","07074","07646","07031","07647","07648","07649","07650","07652","07653","07656","07657","07660","07450","07451","07661","07662","07070","07663","07606","07670","07608","07676","07463","07057","07666","07675","07075","07677","07481","07699","07002","07029","07030","07032","07047","07086","07087","07093","07094","07096","07097","07099","07302","07303","07304","07305","07306","07307","07308","07309","07310","07311","07395","07399","07011","07014","07015","07055","07501","07502","07503","07504","07505","07509","07510","07511","07512","07513","07514","07522","07524","07533","07538","07543","07544","07034","07035","07054","07058","07927","07932","07936","07950","07981","10001","10002","10003","10004","10005","10006","10007","10008","10009","10010","10011","10012","10013","10014","10015","10016","10017","10018","10019","10020","10021","10022","10023","10024","10025","10026","10027","10028","10029","10030","10031","10032","10033","10034","10035","10036","10037","10038","10039","10040","10041","10043","10044","10045","10046","10047","10048","10055","10060","10065","10069","10072","10075","10079","10080","10081","10082","10087","10090","10094","10095","10096","10098","10099","10101","10102","10103","10104","10105","10106","10107","10108","10109","10110","10111","10112","10113","10114","10115","10116","10117","10118","10119","10120","10121","10122","10123","10124","10125","10126","10128","10129","10130","10131","10132","10133","10138","10149","10150","10151","10152","10153","10154","10155","10156","10157","10158","10159","10160","10161","10162","10163","10164","10165","10166","10167","10168","10169","10170","10171","10172","10173","10174","10175","10176","10177","10178","10179","10184","10185","10196","10197","10199","10203","10211","10212","10213","10242","10249","10256","10257","10258","10259","10260","10261","10265","10268","10269","10270","10271","10272","10273","10274","10275","10276","10277","10278","10279","10280","10281","10282","10285","10286","10292","11002","11004","11005","11101","11102","11103","11104","11105","11106","11109","11120","11351","11352","11354","11355","11356","11357","11358","11359","11360","11361","11362","11363","11364","11365","11366","11367","11368","11369","11370","11371","11372","11373","11374","11375","11377","11378","11379","11380","11381","11385","11386","11390","11405","11411","11412","11413","11414","11415","11416","11417","11418","11419","11420","11421","11422","11423","11424","11425","11426","11427","11428","11429","11430","11431","11432","11433","11434","11435","11436","11439","11451","11499","11690","11691","11692","11693","11694","11695","11697","11201","11202","11203","11204","11205","11206","11207","11208","11209","11210","11211","11212","11213","11214","11215","11216","11217","11218","11219","11220","11221","11222","11223","11224","11225","11226","11228","11229","11230","11231","11232","11233","11234","11235","11236","11237","11238","11239","11240","11241","11242","11243","11244","11245","11247","11248","11249","11251","11252","11254","11255","11256","10451","10452","10453","10454","10455","10456","10457","10458","10459","10460","10461","10462","10463","10464","10465","10466","10467","10468","10469","10470","10471","10472","10473","10474","10475","10499","11001","11003","11010","11020","11021","11022","11023","11024","11025","11026","11027","11030","11040","11041","11042","11043","11044","11050","11051","11052","11053","11054","11055","11096","11099","11501","11507","11509","11510","11514","11516","11518","11520","11530","11531","11535","11536","11542","11545","11547","11548","11549","11550","11551","11552","11553","11554","11555","11556","11557","11558","11559","11560","11561","11563","11565","11566","11568","11569","11570","11571","11572","11575","11576","11577","11579","11580","11581","11582","11590","11592","11594","11595","11596","11597","11598","11599","11709","11710","11714","11732","11735","11736","11737","11753","11756","11758","11762","11765","11771","11773","11774","11783","11791","11793","11797","11801","11802","11803","11804","11815","11819","11853","11854","11855","10502","10503","10507","10510","10522","10523","10528","10530","10532","10533","10538","10543","10550","10551","10552","10553","10557","10558","10562","10570","10571","10572","10573","10577","10580","10583","10591","10594","10595","10601","10602","10603","10604","10605","10606","10607","10610","10701","10702","10703","10704","10705","10706","10707","10708","10709","10710","10801","10802","10803","10804","10805","11701","11702","11703","11704","11705","11706","11707","11708","11715","11716","11717","11718","11720","11721","11722","11724","11725","11726","11727","11729","11730","11731","11733","11738","11739","11740","11741","11742","11743","11746","11747","11749","11750","11751","11752","11754","11755","11757","11760","11764","11766","11767","11768","11769","11770","11775","11776","11777","11778","11779","11780","11782","11784","11787","11788","11789","11790","11794","11795","11796","11798","11953"]},r[t.EnumRegion.SF]={zoom:12,defaultLocation:"sf",bounds:["94002","94005","94010","94011","94014","94015","94016","94017","94022","94023","94024","94025","94026","94027","94028","94030","94035","94039","94040","94041","94042","94043","94044","94061","94062","94063","94064","94065","94066","94070","94080","94083","94085","94086","94087","94088","94089","94101","94102","94103","94104","94105","94107","94108","94109","94110","94111","94112","94114","94115","94116","94117","94118","94119","94120","94121","94122","94123","94124","94125","94126","94127","94128","94129","94130","94131","94132","94133","94134","94137","94139","94140","94141","94142","94143","94144","94145","94146","94147","94151","94153","94156","94158","94159","94160","94161","94163","94164","94172","94177","94188","94301","94302","94303","94304","94305","94306","94309","94401","94402","94403","94404","94497","94501","94502","94505","94506","94507","94509","94513","94514","94516","94517","94518","94519","94520","94521","94522","94523","94524","94525","94526","94527","94528","94529","94530","94531","94536","94537","94538","94539","94540","94541","94542","94543","94544","94545","94546","94547","94549","94550","94551","94552","94553","94555","94556","94557","94560","94563","94564","94565","94566","94568","94569","94570","94571","94572","94575","94577","94578","94579","94580","94582","94583","94586","94587","94588","94595","94596","94597","94598","94601","94602","94603","94604","94605","94606","94607","94608","94609","94610","94611","94612","94613","94614","94615","94617","94618","94619","94620","94621","94622","94623","94624","94649","94659","94660","94661","94662","94666","94701","94702","94703","94704","94705","94706","94707","94708","94709","94710","94712","94720","94801","94802","94803","94804","94805","94806","94807","94808","94820","94850","94901","94903","94904","94912","94913","94914","94915","94920","94925","94930","94933","94939","94941","94942","94945","94947","94948","94949","94950","94952","94953","94954","94955","94957","94960","94964","94965","94966","94973","94974","94975","94976","94977","94978","94979","94998","94999","95002","95008","95009","95011","95013","95014","95015","95030","95031","95032","95033","95035","95036","95037","95044","95050","95051","95052","95053","95054","95055","95056","95070","95071","95101","95103","95106","95108","95109","95110","95111","95112","95113","95115","95116","95117","95118","95119","95120","95121","95122","95123","95124","95125","95126","95127","95128","95129","95130","95131","95132","95133","95134","95136","95138","95139","95141","95148","95150","95151","95152","95153","95154","95155","95156","95157","95158","95159","95160","95161","95164","95170","95172","95173","95190","95191","95192","95193","95194","95196","95301","95342","95204","95344","95348","95204","95337","95366","95350","95355","95354","95380","95340","94503","94509","94558","94559"]},r[t.EnumRegion.SEA]={zoom:10,defaultLocation:"sea",bounds:["98164","98001","98002","98003","98004","98005","98006","98007","98008","98010","98011","98012","98014","98019","98020","98021","98022","98023","98024","98026","98027","98028","98029","98030","98031","98032","98033","98034","98036","98037","98038","98039","98040","98042","98043","98045","98047","98051","98052","98053","98055","98056","98057","98058","98059","98065","98072","98074","98075","98077","98087","98092","98101","98102","98103","98104","98105","98106","98107","98108","98109","98112","98115","98116","98117","98118","98119","98121","98122","98125","98126","98133","98134","98136","98144","98146","98148","98155","98158","98166","98168","98177","98178","98188","98195","98198","98199","98201","98203","98204","98208","98258","98272","98275","98290","98296","98327","98354","98360","98371","98372","98373","98374","98390","98391","98402","98403","98404","98405","98406","98407","98408","98409","98418","98421","98422","98424","98438","98439","98443","98444","98445","98446","98465","98466","98467","98498","98499"]};var i=11,s=n.Model.extend({findRegion:function(e){var t;for(t in r)if(this.isInRegion(e,t))return t},isInRegion:function(e,t){return e.zip&&r[t].bounds.indexOf(e.zip)!=-1},getZoom:function(e){return e?r[e].zoom:i}});return s}),define("hbs!modules/chooseCommunity/chooseCommunityMapTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),'<div class="map">\r\n	<div class="map-canvas"></div>\r\n	<div class="map-overlay">\r\n		<!--<label class="hidden-xs">\r\n			<input type="checkbox" checked/>\r\n			Update results when I move the map\r\n		</label>-->\r\n		<ul class="legend">\r\n			<li class="monday">Monday Pickup</li>\r\n			<li class="wednesday">Wednesday Pickup</li>\r\n            <i class="tooltip-anchor hidden-xs"></i>\r\n		</ul>\r\n	</div>\r\n</div>\r\n'});return n}),define("modules/chooseCommunity/chooseCommunityMapView",["require","marionette","common/maps","common/globals","common/enums","common/regionsModel","hbs!modules/chooseCommunity/chooseCommunityMapTemplate","modules/chooseCommunity/chooseCommunityCommunityView","common/communityModel"],function(e){var t=e("marionette"),n=e("common/maps"),r=e("common/globals"),i=e("common/enums"),s=e("common/regionsModel"),o=e("hbs!modules/chooseCommunity/chooseCommunityMapTemplate"),u=e("modules/chooseCommunity/chooseCommunityCommunityView"),a=e("common/communityModel"),f="/site/market/images/map-sprite.png",l="/site/market/images/map-pins-sprite.png",c={lat:37.0900716,lng:-95.71291050000002},h={InBoundsAndCommunitiesNear:0,InBoundsAndNoCommunitiesNear:1,OutOfBounds:2,Error:3},p={monday:"Monday",wednesday:"Wednesday"},d=t.ItemView.extend({template:o,ui:{mapHook:".map-canvas",mapOverlay:".map-overlay",tooltipAnchor:".tooltip-anchor"},EnumSearchStatus:h,initialize:function(){this._regionsModel=new s},load:function(){var e=new $.Deferred;return n.setReadyCallback(function(){e.resolve()}),e},reSizeMap:function(){this._map.resizeMap()},onRender:function(){var e=this;this._map=new n.Map(this.ui.mapHook[0]),this.model.set("isMarkersVisible",!0),_.defer(function(){e.model.get("communities").forEach(function(t){e._getMarker(t)})}),this.model.set("isUpdateResults",!0),this._map.addListener("bounds_changed",function(){e.model.get("isUpdateResults")&&e._triggerBoundsChanged()}),this._map.addListener("zoom_changed",function(){var t=e._map.getMapObj(),n=17,r=4;t.getZoom()<r?t.setZoom(r):t.getZoom()>n&&t.setZoom(n)}),this.ui.tooltipAnchor.tooltip({title:"Each Farmigo pickup gets its delivery once a week, on either Monday or Wednesday. Pick yours by choosing whichever day is easiest for you to get your food on!",placement:"bottom",trigger:"hover click"})},setModel:function(e){this.model=e},search:function(e,t){var i=e,s=new $.Deferred;return n.geocodeRequestDetailed(e,function(e){var n,o,u,a;e.lat==undefined?u=h.Error:(n={lat:e.lat,lng:e.lng},this._locationMarker==undefined||this._locationMarker.map==null?(o={size:{width:19,height:19},origin:{x:60,y:30},url:f},this._locationMarker=this._map.addMarker("My Location",e,o)):this._locationMarker.setPosition(n),u=this._getSearchStatus(e,t),this._triggerBoundsChanged()),this.model.set("searchStatus",u),function(){var e=["Service area - communities exist","Service area - no communities","Out of service area","Error search"],t=i+" ("+e[u]+")";r.eventBus.trigger("analytics:event","map","Search clicked",t)}(),u===h.Error&&this._setUsaMap(),a=u!=h.Error,a!=this.model.get("isMarkersVisible")&&(this._toggleMarkers(a),this.model.set("isMarkersVisible",a)),s.resolve(u)}.bind(this)),s},isNeedToFilterCommunities:function(){var e=this._map.getMapObj().getBounds();if(e!=this._bounds)return this._bounds=e,!0},filterCommunity:function(e){var t=new google.maps.LatLng(e.get("lat"),e.get("lng")),n;return this._bounds=this._bounds||this._map.getMapObj().getBounds(),n=this.model.get("region")==e.get("region")&&this._bounds.contains(t),e.set("distance",n?this._map.getDistance(t):undefined),n},_setUsaMap:function(){this._map.getMapObj().setCenter(c),this._map.getMapObj().setZoom(0),this.model.unset("region")},_toggleMarkers:function(e){var t=e?this._map.getMapObj():null;this.model.get("communities").forEach(function(e){e.marker.setMap(t)}),this._locationMarker&&this._locationMarker.setMap(t)},_getMarker:function(e){var t,n,r,i=this;if(e.marker==undefined){r=this.model.get("communities");var s=e.deliveryDays===p.wednesday?71:97;t={size:{width:26,height:36},origin:{x:s,y:0},url:l},n=this._map.addMarker(e.title,e,t),n.set("communityKey",e.key),n.set("pinX",s),e.marker=n,_.defer(function(e,t){var n=function(e){i.ui.mapOverlay.fadeOut(),i.trigger("togglePin",e)},r=function(){i.ui.mapOverlay.fadeIn(),i.trigger("togglePin")},s=function(){var e=new u({model:new a(t)});return e.model.set("isMap",!0),e.on({communityLinkClicked:function(e){i.trigger("communityLinkClicked",e)}}),e.render().el};i._map.setInfoWindow(s,e,n,r)},n,e)}return e.marker},_getSearchStatus:function(e,t){var n,r,i,s={lat:e.lat,lng:e.lng};return r=this._regionsModel.findRegion(e),this.model.set("region",r),i=t||this._regionsModel.getZoom(r),this._map.getMapObj().setCenter(s),this._map.getMapObj().setZoom(i),r?n=this._isLocationNearCommunities(i)?h.InBoundsAndCommunitiesNear:h.InBoundsAndNoCommunitiesNear:n=h.OutOfBounds,n},_isLocationNearCommunities:function(e){var t=11,n=this._map.getMapObj().getBounds(),r=0;return this.model.get("communities").forEach(function(e){n.contains(new google.maps.LatLng(e.lat,e.lng))&&(this._getMarker(e),r++)}.bind(this)),r<3&&e>t?(e--,this._map.getMapObj().setZoom(e),this._isLocationNearCommunities(e)):r>0},_triggerBoundsChanged:function(){this.trigger("boundsChanged")}});return d}),define("hbs!modules/chooseCommunity/chooseCommunityUnAssignedTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<div class="community-alert">\r\n    <button class="close pull-right" data-dismiss="alert">\r\n        <span aria-hidden="true">&times;</span>\r\n        <span class="sr-only">Close</span>\r\n    </button>\r\n    <div class="message">\r\n        <h3>Bummer!</h3>\r\n        <p>The ',(o=n.community)?o=o.call(t,{hash:{}}):(o=t&&t.community,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+" community no longer exists. To keep getting fresh, local groceries, select a different pickup near you.</p>\r\n     </div>\r\n</div>\r\n\r\n\r\n",s});return n}),define("modules/chooseCommunity/chooseCommunityUnAssignedView",["require","marionette","common/dataService","common/globals","hbs!modules/chooseCommunity/chooseCommunityUnAssignedTemplate"],function(e){var t=e("marionette"),n=e("common/dataService"),r=e("common/globals"),i=e("hbs!modules/chooseCommunity/chooseCommunityUnAssignedTemplate"),s=t.LayoutView.extend({template:i,events:{"click button.close":"onClose"},onClose:function(){this.trigger("close")}});return s}),define("hbs!modules/chooseCommunity/chooseCommunityNotifyMeTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function a(e,t){return'\r\n        <div class="thank-you-content">\r\n            <img src="/site/farmigo.com/images/thank-you.png" alt="Thank You"/>\r\n            <h3>We will let you know when we come to your area</h3>\r\n        </div>\r\n    '}function f(e,t){return'\r\n        <div class="notify-me-alert">\r\n            <h3>Let me know once a pickup site opens near me.</h3>\r\n            <form id="notify-form" class="notify-form">\r\n                <div class="form-group">\r\n                    <input type="zipCode" class="form-control"  placeholder="Zip Code" data-parsley-zipCode data-field-name="zipCode" required>\r\n                </div>\r\n                <div class="form-group">\r\n                    <input type="email" class="email form-control" placeholder="Email" data-field-name="email" required>\r\n                </div>\r\n                <a class="button notify-me">Notify me</a>\r\n            </form>\r\n        </div>\r\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u=this;s+='<div class="community-alert">\r\n    <button class="close pull-right" data-dismiss="alert">\r\n        <span aria-hidden="true">&times;</span>\r\n        <span class="sr-only">Close</span>\r\n    </button>\r\n    ',o=n["if"].call(t,t&&t.showThankYou,{hash:{},inverse:u.program(3,f,i),fn:u.program(1,a,i)});if(o||o===0)s+=o;return s+="\r\n</div>\r\n\r\n",s});return n}),define("modules/chooseCommunity/chooseCommunityNotifyMeView",["require","marionette","common/validation","common/dataService","common/globals","hbs!modules/chooseCommunity/chooseCommunityNotifyMeTemplate"],function(e){var t=e("marionette"),n=e("common/validation"),r=e("common/dataService"),i=e("common/globals"),s=e("hbs!modules/chooseCommunity/chooseCommunityNotifyMeTemplate"),o=t.LayoutView.extend({template:s,events:{"click button.close":"onClose","click a.notify-me":"onNotify"},onNotify:function(){var e=n.validateForm("#notify-form");e&&(r.notifyMe(e),this.model.set("showThankYou",!0),this.render()),i.eventBus.trigger("analytics:event","map","Notify me submitted")},onClose:function(){this.trigger("close")}});return o}),define("hbs!modules/chooseCommunity/chooseCommunityPrivateAlertTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression;return s+='<div class="private-community-alert">\r\n    <h3 class="heading community-name">',(o=n.community)?o=o.call(t,{hash:{}}):(o=t&&t.community,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</h3>\r\n    <div class="message-box">\r\n        <i class="type"></i>\r\n        <p class="message-box-message">',(o=n.message)?o=o.call(t,{hash:{}}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</p>\r\n    </div>\r\n\r\n    <form id="reason-form" class="reason-form">\r\n        <div>\r\n            <label for="reason" >How are you connected to <span>',(o=n.community)?o=o.call(t,{hash:{}}):(o=t&&t.community,o=typeof o===u?o.call(t,{hash:{}}):o),s+=a(o)+'</span>?</label>\r\n            <div class="form-group">\r\n                <textarea class="form-control"  data-field-name="reason" placeholder="e.g. I know the organizer" required></textarea>\r\n            </div>\r\n        </div>\r\n    </form>\r\n    <div class="button-wrapper">\r\n        <a class="button shop" loading-animation>Shop</a>\r\n        <a class="cancel">Return to map</a>\r\n    </div>\r\n</div>',s});return n}),define("modules/chooseCommunity/chooseCommunityPrivateAlertView",["require","marionette","common/validation","common/dataService","common/dataUtils","common/globals","hbs!modules/chooseCommunity/chooseCommunityPrivateAlertTemplate"],function(e){var t=e("marionette"),n=e("common/validation"),r=e("common/dataService"),i=e("common/dataUtils"),s=e("common/globals"),o=e("hbs!modules/chooseCommunity/chooseCommunityPrivateAlertTemplate"),u="private community popup displayed",a=t.LayoutView.extend({template:o,events:{"click a.shop":"goToMarket","click a.cancel":"onClose"},onClose:function(){this.trigger("close"),s.eventBus.trigger("analytics:event","map",u,"returned to map")},goToMarket:function(){var e=n.validateForm("#reason-form");e&&(i.setPrivateCommunityReason(e.reason),this.trigger("shop"),s.eventBus.trigger("analytics:event","map",u,"continued to shop"))}});return a}),define("hbs!modules/chooseCommunity/chooseCommunityTemplate",["hbs","hbs/handlebars"],function(e,t){var n=t.template(function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\r\n							<p>Already a member? <a href="'+a((r=(r=e&&e.urls,r==null||r===!1?r:r.login),typeof r===u?r.apply(e):r))+'">Log in</a></p>\r\n						',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers);var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="choose-community">\r\n	<div class="content">\r\n		<section class="page-heading">\r\n			<div class="row">\r\n				<div class="col-sm-2">\r\n					<i></i>\r\n				</div>\r\n				<div class="col-sm-10">\r\n					<h1>To start shopping, choose a pickup spot:</h1>\r\n					<div class="hidden-xs">\r\n						<p>Picking up your order helps us provide the best groceries from local farms and producers at competitive prices.</p>\r\n						',o=n.unless.call(t,t&&t.isLoggedIn,{hash:{},inverse:f.noop,fn:f.program(1,l,i)});if(o||o===0)s+=o;return s+='\r\n					</div>\r\n				</div>\r\n			</div>\r\n		</section>\r\n		<section id="search-form-region" class="visible-xs"></section>\r\n		<section id="search-status-region"></section>\r\n		<section id="tabs-region" class="visible-xs"></section>\r\n		<div class="row map-wrapper">\r\n			<div class="list-col col-sm-5">\r\n				<section id="search-form-region" class="hidden-xs"></section>\r\n				<section id="list-region"></section>\r\n			</div>\r\n			<div class="map-col col-sm-7">\r\n				<section id="map-region"></section>\r\n			</div>\r\n		</div>\r\n		<secion class="footer hidden-xs">\r\n			<p>Don\'t worry, if you ever need to change your pick-up location again, you\'ll find it in your account.</p>\r\n		</secion>\r\n	</div>\r\n</div>\r\n',s});return n}),define("modules/chooseCommunity/chooseCommunityModule",["require","marionette","common/globals","common/utils","common/dataService","common/dataUtils","common/glassPane/glassPane","common/modal/modal","common/Tabs/TabsModule","common/communityModel","modules/chooseCommunity/chooseCommunityModel","modules/chooseCommunity/chooseCommunitySearchFormView","modules/chooseCommunity/chooseCommunitySearchStatusView","modules/chooseCommunity/chooseCommunitySearchStatusModel","modules/chooseCommunity/chooseCommunityListView","modules/chooseCommunity/chooseCommunityMapView","modules/chooseCommunity/chooseCommunityUnAssignedView","modules/chooseCommunity/chooseCommunityNotifyMeView","modules/chooseCommunity/chooseCommunityPrivateAlertView","hbs!modules/chooseCommunity/chooseCommunityTemplate","virtualCollection"],function(e){var t=e("marionette"),n=e("common/globals"),r=e("common/utils"),i=e("common/dataService"),s=e("common/dataUtils"),o=e("common/glassPane/glassPane"),u=e("common/modal/modal"),a=e("common/Tabs/TabsModule"),f=e("common/communityModel"),l=e("modules/chooseCommunity/chooseCommunityModel"),c=e("modules/chooseCommunity/chooseCommunitySearchFormView"),h=e("modules/chooseCommunity/chooseCommunitySearchStatusView"),p=e("modules/chooseCommunity/chooseCommunitySearchStatusModel"),d=e("modules/chooseCommunity/chooseCommunityListView"),v=e("modules/chooseCommunity/chooseCommunityMapView"),m=e("modules/chooseCommunity/chooseCommunityUnAssignedView"),g=e("modules/chooseCommunity/chooseCommunityNotifyMeView"),y=e("modules/chooseCommunity/chooseCommunityPrivateAlertView"),b=e("hbs!modules/chooseCommunity/chooseCommunityTemplate");e("virtualCollection");var w="UnassignedCommunity",E="/site/market/images/map-pins-sprite.png",S=Backbone.Collection.extend({model:f}),x=t.LayoutView.extend({template:b,regions:{searchForm:"#search-form-region:visible",searchStatus:"#search-status-region",tabs:"#tabs-region",map:"#map-region",list:"#list-region"}}),T=t.Controller.extend({initialize:function(e){this._region=e.region},show:function(e,t){var n=this;o.getInstance({isDefault:!0,loadingAnimation:!0,zIndex:1033}).show(),r.clientViewPort.isXs()||r.html.setBodyBackgroundImage("choose-community",{backgroundSize:"inherit",backgroundRepeat:"no-repeat",backgroundPosition:"center top"}),this._layout=new x({model:new Backbone.Model({urls:i.serverData.urls,isLoggedIn:i.isLoggedIn()})}),this._region.show(this._layout),this._mapView=new v,this._mapView.on({boundsChanged:function(){n._virtualCollection&&n._mapView.isNeedToFilterCommunities()&&((!r.clientViewPort.isXs()||n._tabs.getSelectedTab()!="list")&&n._virtualCollection.updateFilter(n._filterCollection.bind(n)),n._handleLegend())},communityLinkClicked:function(e){n._onCommunityLinkClicked(e,!0)},togglePin:function(e){n._togglePin(e)}}),n._searchFormView=new c({model:new Backbone.Model({location:e})}),n._searchFormView.on({search:n._search.bind(n)}),n._layout.searchForm.show(n._searchFormView),$.when(i.getCommunities(e),this._mapView.load()).then(function(i){n._model=new l(i),n._mapView.setModel(new l(i)),n._layout.map.show(n._mapView),n._mapView.reSizeMap(),n._search(e,t).then(function(){var e,t=new S(n._model.get("communities"));n._virtualCollection=new Backbone.VirtualCollection(t,{filter:n._filterCollection.bind(n),comparator:"distance",destroy_with:e}),e=new d({collection:n._virtualCollection}),e.on({"childview:communityLinkClicked":function(e,t){n._onCommunityLinkClicked(t,!1)},"childview:togglePin":function(e,t,r){n._togglePin(t,r)}}),n._layout.list.show(e);var r=$.cookie(w);r&&n._onUnassigned(r),n._handleLegend()});if(r.clientViewPort.isXs()){n._tabs=new a;var s=n._tabs.getView(new Backbone.Collection([{key:"map",title:"Map"},{key:"list",title:"List"}]));n._tabs.on("tab:clicked",function(e){n._selectTab(e),e==="map"&&(n._mapView.reSizeMap(),n._togglePin(null,!0))}),n._layout.tabs.show(s),n._tabs.setSelectedTab("map")}o.getInstance({isDefault:!0}).hide(),r.clientViewPort.isXs()||o.getInstance({isDefault:!0,zIndex:1033}).show()})},onBeforeDestroy:function(){o.getInstance({isDefault:!0}).hide(),r.html.clearBodyBackgroundImage()},_search:function(e,t){return r.clientViewPort.isXs()&&this._tabs&&(this._selectTab("map"),this._tabs.setSelectedTab("map")),this._mapView.search(e,t).then(function(e){this._searchStatus=e,this._showSearchStatus(),this._toggleSearchError()}.bind(this))},_toggleSearchError:function(){this._searchFormView.toggleError(this._searchStatus===p.EnumSearchStatus.Error)},_filterCollection:function(e){return this._mapView.filterCommunity(e)},_onCommunityLinkClicked:function(e,t){var r="Community Clicked"+(e.get("isPrivate")?" (Private)":"")+" - "+(t?"Map":"List");n.eventBus.trigger("analytics:event","map",r,e.get("title")),e.get("isPrivate")?this._onPrivateCommunity(e):(s.clearPrivateCommunityReason(),this._onCommunitySelected(e))},_onCommunitySelected:function(e){var t={pickupSiteUrl:e.get("pickupSiteUrl"),pickupSiteKey:e.get("key"),farmKey:e.get("farmKey")};window.chooseCommunityCallback&&_.isFunction(window.chooseCommunityCallback)?window.chooseCommunityCallback(t):n.eventBus.trigger("communitySelected",t)},_onUnassigned:function(e){s.removeCookie(w);var t=new m({model:new Backbone.Model({community:e})});t.on("close",function(){this._showSearchStatus()}.bind(this)),this._layout.searchStatus.show(t)},_onPrivateCommunity:function(e){var t=new y({model:new Backbone.Model({community:e.get("title"),message:e.get("instructions")})}),r="privateCommunity";u.show(t,{modalId:r,isDisallowClose:!0}),t.on({close:function(){u.close()},shop:function(){n.eventBus.once("route",function(){u.close(r)}),this._onCommunitySelected(e)}.bind(this)})},_showNotifyMe:function(){var e=new g({model:new Backbone.Model});e.on("close",function(){this._showSearchStatus()}.bind(this)),this._layout.searchStatus.show(e)},_showSearchStatus:function(){var e=new p;e.setStatus(this._searchStatus),this.searchStatusView=new h({model:e}),this.searchStatusView.on("showNotifyMe",function(){this._showNotifyMe()}.bind(this)),this._layout.searchStatus.show(this.searchStatusView)},_selectTab:function(e){this._layout.list.$el.toggle(e=="list"),this._layout.map.$el.toggle(e=="map")},_togglePin:function(e,t){var n={size:{width:26,height:36},url:E};this._curSelectedMarker&&(n.origin={x:this._curSelectedMarker.get("pinX"),y:0},this._curSelectedMarker.setIcon(n)),e&&(n.origin={x:45,y:0},e.setIcon(n),this._curSelectedMarker=e),t&&this._closeOpenedMapWindowInfo()},_closeOpenedMapWindowInfo:function(){this._mapView._map&&this._mapView._map.closeInfoWindow()},_handleLegend:function(){var e=_.filter(this._virtualCollection.models,function(e){return e.get("deliveryDays")==="Wednesday"}).length;e===0||e===this._virtualCollection.models.length?this._mapView.$el.find(".legend").css("display","none"):this._mapView.$el.find(".legend").css("display","inline-block")}});return T}),define("controller",["require","app","common/globals","common/globalMessage","common/utils","common/nav","common/dataService","modules/authentication/authenticationModule","modules/shares/sharesModule","modules/order/orderModule","modules/account/accountModule","modules/orderHistory/orderHistoryModule","modules/payment/paymentModule","modules/thankyou/thankyouModule","modules/chooseCommunity/chooseCommunityModule","common/marketModel","common/glassPane/glassPane"],function(e){function T(e,t,n){if(e.isRequireLogin&&t!=S&&!o.isLoggedIn()){var r=i.deparam(n);if(!r[s.PageParam.IsForceNotRequireLogin])return _.has(r,"createAccount")?s.PageEnum.SignUp:s.PageEnum.Login}return null}var t=e("app"),n=e("common/globals"),r=e("common/globalMessage"),i=e("common/utils"),s=e("common/nav"),o=e("common/dataService"),u=e("modules/authentication/authenticationModule"),a=e("modules/shares/sharesModule"),f=e("modules/order/orderModule"),l=e("modules/account/accountModule"),c=e("modules/orderHistory/orderHistoryModule"),h=e("modules/payment/paymentModule"),p=e("modules/thankyou/thankyouModule"),d=e("modules/chooseCommunity/chooseCommunityModule"),v=e("common/marketModel"),m=e("common/glassPane/glassPane"),g=i.hasPushState(),y,b=function(e,t,n){var r=e.path;return e.isCommunityDependent&&(r+="/"+(n?n:o.getMarketData().pickupSite.url)),t&&(r+="?"+t),r},w=function(){y&&_.isFunction(y.destroy)&&(y.destroy(),y=null)};n.eventBus.on("navigate",function(e,n,r,i){n=_.defaults(n||{},{trigger:!0});var s=b(e,r,i);t.router.navigate(s,n)});var E={doRoute:function(e){var t=s.getPage();t&&s.navigate(t,null,e)},goToLogin:function(){o.getMarketData("shouldShowLogin")?(n.eventBus.trigger("flow:router:optimizedLogin"),y=(new u({region:t.main})).show("login",!0,!1)):(n.eventBus.trigger("flow:router:login"),y=(new u({region:t.main})).show("login"))},goToSignUp:function(e,r){var o=i.deparam(r)[s.PageParam.Checkout];n.eventBus.trigger("flow:router:signup"+(o?"-checkout":"")),y=(new u({region:t.main})).show("sign-up",!1,o)},goToForgotPassword:function(){n.eventBus.trigger("flow:router:forgotPassword"),y=(new u({region:t.main})).show("forgotPassword",!0)},goToChangePassword:function(e,r){var o=!!i.deparam(r)[s.PageParam.AccountChangePassword];n.eventBus.trigger("flow:router:changePassword"+o?"-fromAccount":""),o?y=(new l({region:t.main})).show(l.Mode.ChangePassword):y=(new u({region:t.main})).show("changePassword",!0)},goToMarket:function(e,r){if(o.getMarketData("shouldShowLogin")){s.navigate(s.PageEnum.Login);return}n.eventBus.trigger("flow:router:market");var u=i.deparam(r);y=(new a({region:t.main})).show(u)},goToOrder:function(){n.eventBus.trigger("flow:router:order"),y=(new f({region:t.main,checkoutPanelRegion:t.checkoutPanel})).show(f.Mode.Order)},goToReOrder:function(){n.eventBus.trigger("flow:router:reorder"),y=(new f({region:t.main})).show(f.Mode.Reorder)},goToAccount:function(){n.eventBus.trigger("flow:router:account"),y=(new l({region:t.main})).show()},goToHistory:function(){n.eventBus.trigger("flow:router:history"),y=(new c({region:t.main})).show()},goToPay:function(e,r){var o=i.deparam(r),u=o[s.PageParam.ReactivateSubscription],a=o[s.PageParam.Checkout],f=o[s.PageParam.ChangePaymentDetails],l=a?"-checkout":u?"-reactivate":f?"-changeDetails":"";n.eventBus.trigger("flow:router:payment"+l);var c=!!a;y=(new h({region:t.main})).show(c,!!f)},goToThankYou:function(){n.eventBus.trigger("flow:router:thankyou"),y=(new p({region:t.main})).show()},goToMap:function(e){var n=i.deparam(e);y=new d({region:t.main}),y.show(n[s.PageParam.Location],parseInt(n[s.PageParam.Zoom]))},doLogout:function(){var e=v.hasPaymentIssue();m.getInstance({isDefault:!0,loadingAnimation:!0}).show(),o.logout().done(function(){o.loadMarketData().then(function(){m.getInstance({isDefault:!0}).hide(e?"paymentIssue":undefined),r.hide(),n.data.init(),s.navigate(s.PageEnum.Market),n.eventBus.trigger("loggedOut")})}).fail(function(){m.getInstance({isDefault:!0}).hide()})}},S=E.goToLogin,x;for(x in E)x.indexOf("goTo")===0&&(E[x]=_.wrap(E[x],function(e){var t=s.getPage(),r=t;t||console.log("Failed to find a page for current page - ignoring..."),document.title=t.title;var o=T(t,e,arguments[2]);o?_.defer(function(){s.navigate(o)}):(w(),n.eventBus.trigger("route",t),i.html.setBoxedPage(r.isBoxed),e.apply(E,Array.prototype.slice.call(arguments,1)),window.optimizely=window.optimizely||[],window.optimizely.push(["activate"]),window.optimizely.push("activateUniversalAnalytics"),$("html").attr("page",t.path),$(window).scrollTop(0),(t==s.PageEnum.Market||t==s.PageEnum.Order)&&v.hasPaymentIssue()&&m.getInstance({isDefault:!0}).show("paymentIssue"))}));return E}),require(["config"],function(){require(["marionette","hbs/handlebars","bootstrap","datepicker","app","router","controller"],function(e,t,n,r,i,s,o){i.router=s.newRouter({controller:o}),Farmigo.initialData||Farmigo.initialDataType!="marketData"?i.start():document.addEventListener("initialDataReady",function(){i.start()})})}),define("main",function(){});